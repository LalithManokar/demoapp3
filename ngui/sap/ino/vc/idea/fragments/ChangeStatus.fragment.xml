<core:FragmentDefinition
	xmlns="sap.m"
	xmlns:core="sap.ui.core"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:l="sap.ui.layout"
	xmlns:f="sap.ui.layout.form">
	<Dialog 
        afterClose="onAfterChangeStatusDialogClose"
        title="{i18n>IDEA_OBJECT_TIT_CHANGE_STATUS}">
		<f:SimpleForm
            maxContainerCols="2"
            layout="ResponsiveGridLayout"
            editable="true"
            labelSpanM="12"
            labelSpanL="12">
			<f:content>
				<Label text="{i18n>IDEA_OBJECT_FLD_CHANGE_STATUS}"/>
				<Select change="onStatusActionChanged"
                    items="{
                        path: 'property>/actions/executeStatusTransition/customProperties/statusTransitions',
                        sorter: { path: 'SEQUENCE_NO' }
                    }"
                    selectedKey="{status>/STATUS_ACTION_CODE}">
					<core:Item
                    key="{property>STATUS_ACTION_CODE}"
                    text="{path: 'property>STATUS_ACTION_CODE', formatter: '.formatter.ideaStatusAction'}"/>
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</Select>
				<VBox width="100%" class="sapInoIdeaChangeStatusVbox">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
					<HBox visible="{status>/IS_PHASE_CHANGE}" class="sapInoIdeaChangeStatusHbox">
						<Label text="{i18n>IDEA_OBJECT_FLD_NEW_PHASE}" class="sapInoIdeaChangeStatusLabel"/>
						<Text text="{path: 'status>/NEXT_PHASE_CODE', formatter: '.formatter.ideaPhase'}" class="sapInoIdeaChangeStatusText" />
					</HBox>
					<HBox class="sapInoIdeaChangeStatusHbox">
						<Label text="{i18n>IDEA_OBJECT_FLD_NEW_STATUS}" visible="true" class="sapInoIdeaChangeStatusLabel"/>
						<Text text="{path: 'status>/NEXT_STATUS_CODE', formatter: '.formatter.ideaStatus'}" class="sapInoIdeaChangeStatusText" />
					</HBox>
				</VBox>
				<Label text="{i18n>IDEA_OBJECT_FLD_DECISION_DATE}" required="true" visible="{status>/IS_DECISION_RELEVANT}"/>
				<DatePicker
                visible="{status>/IS_DECISION_RELEVANT}"
                displayFormat="long"
                placeholder="{i18n>IDEA_OBJECT_FLD_DECISION_DATE}"
                value="{path: 'status>/DECISION_DATE', type: 'sap.ui.model.type.Date', 
                formatOptions:{ style: 'medium', source: { pattern : 'yyyy-MM-dd'}}}">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</DatePicker>
				<Label text="{i18n>IDEA_OBJECT_FLD_DECISION_MAKER}" required="true" visible="{status>/IS_DECISION_RELEVANT}"/>
				<Input type="Text" visible="{status>/IS_DECISION_RELEVANT}"
                value="{path: 'status>/DECIDER_NAME', type: 'sap.ui.model.type.String', constraints: {minLength: 1}}"
				placeholder="{i18n>IDEA_OBJECT_FLD_DECISION_MAKER_PLACEHOLDER}" tooltip="{i18n>IDEA_OBJECT_FLD_DECISION_MAKER_PLACEHOLDER}"
				displaySecondaryValues="true" showSuggestion="true" suggest="onChangeStatusSuggestUser" suggestionItemSelected="onChangeStatusSuggestionUserSelected"
				valueLiveUpdate = "true"
				liveChange="onChangeStatusMakerChange">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</Input>
				<Label text="{i18n>IDEA_OBJECT_FLD_DECISION_REASON}" required="true" visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}"/>
				<ComboBox width="100%"
                        id="ReasonList"
                        visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}"
                        items="{status>/reasonList}"
                        selectedKey="{path: 'status>/REASON_CODE', type:'sap.ui.model.type.String', constraints: {minLength: 1}}">
					<core:Item
                            key="{status>CODE}"
                            text="{status>DEFAULT_TEXT}"/>
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</ComboBox>
				<Label text="{i18n>IDEA_OBJECT_FLD_REASON_COMMENTS}" visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}"/>
				<TextArea value="{path: 'status>/REASON', type: 'sap.ui.model.type.String'}" 
                rows="2" visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</TextArea>
				<Label text="{i18n>IDEA_OBJECT_FLD_REASON}" visible="{=!${status>/DECISION_REASON_LIST_CODE} &amp;&amp; ${status>/IS_DECISION_RELEVANT}}"  
				required="{=!${status>/DECISION_REASON_LIST_CODE} &amp;&amp; ${status>/IS_DECISION_RELEVANT}}"/>
				<TextArea value="{path: 'status>/REASON', type: 'sap.ui.model.type.String', constraints: {minLength: 1}}" 
                rows="2" visible="{=!${status>/DECISION_REASON_LIST_CODE} &amp;&amp; ${status>/IS_DECISION_RELEVANT}}">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</TextArea>
				<Label text="{i18n>IDEA_OBJECT_FLD_REASON_LINK}" visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}"/>
				<VBox alignItems="start" visible="{path: 'status>/DECISION_REASON_LIST_CODE', formatter: '.reasonCodeExist'}">
					<Button id="addLink" 
                        press="onAddLink"
                        type="Transparent"
                        icon="sap-icon://add"
                        tooltip="{i18n>IDEA_OBJECT_BTN_ADD_LINK}"/>
					<FlexBox
                        alignItems="Center"
                        justifyContent="SpaceBetween" 
                        visible="{=${status>/LINK_URL} ? true : false}">
						<items>
							<Link text="{ parts : [{path: 'status>/LINK_LABEL'}, {path: 'status>/LINK_URL'}] , formatter : '.formatter.linkLabel' }"
                              href="{status>/LINK_URL}"
                              target="new"
                              wrapping="true"/>
							<HBox>
								<Button press="onEditLink"
                                icon="sap-icon://edit-outside"
                                type="Transparent" />
								<Button press="onDeleteLink"
                                icon="sap-icon://sys-cancel"
                                type="Transparent" />
							</HBox>
						</items>
					</FlexBox>
				</VBox>
				<CheckBox selected="{path: 'status>/SEND_RESPONSE', type: 'sap.ino.commons.models.types.IntBooleanType'}" text="{i18n>IDEA_OBJECT_FLD_NOTIFY_AUTHOR}" textAlign="Left"
                visible="{path: 'status>/INCLUDE_RESPONSE', type: 'sap.ino.commons.models.types.IntBooleanType'}" select="clearClientMessages">
                 		<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
                </CheckBox>
				<Label text="{i18n>IDEA_OBJECT_FLD_MY_TEXT}" required="true" visible="{= ${status>/INCLUDE_RESPONSE} ===1 &amp;&amp; !${status>/TEXT_MODULE_CODE}}"/>
				<TextArea id ="responseRequireTextArea" value="{path: 'status>/RESPONSE', type: 'sap.ui.model.type.String', constraints: {minLength: 1}}"
                rows="2" visible="{=( ${status>/INCLUDE_RESPONSE} + ${status>/SEND_RESPONSE} ) === 2 &amp;&amp; !${status>/TEXT_MODULE_CODE}}" enabled="{path: 'status>/SEND_RESPONSE', type: 'sap.ino.commons.models.types.IntBooleanType'}">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</TextArea>
				<Label text="{i18n>IDEA_OBJECT_FLD_MY_TEXT}" required="false" visible="{= ${status>/INCLUDE_RESPONSE} ===1 &amp;&amp; !!${status>/TEXT_MODULE_CODE}}"/>
				<TextArea value="{path: 'status>/RESPONSE', type: 'sap.ui.model.type.String'}"
                rows="2" visible="{=( ${status>/INCLUDE_RESPONSE} + ${status>/SEND_RESPONSE} ) === 2 &amp;&amp; !!${status>/TEXT_MODULE_CODE}}" enabled="{path: 'status>/SEND_RESPONSE', type: 'sap.ino.commons.models.types.IntBooleanType'}">
					<layoutData>
						<l:GridData span="XL12 L12 M12 S12"/>
					</layoutData>
				</TextArea>
				<Link text="{i18n>IDEA_OBJECT_FLD_MAIL_PREVIEW}" target="_blank" press="onShowMailPreview" visible="{path: 'status>/SEND_RESPONSE', type: 'sap.ino.commons.models.types.IntBooleanType'}"/>
			</f:content>
		</f:SimpleForm>
		<buttons>
			<Button text="{i18n>IDEA_OBJECT_BUT_CHANGE_STATUS}" type="Accept" press="onChangeStatusDialogOK" />
			<Button text="{i18n>BTN_CANCEL}" press="onChangeStatusDialogCancel" />
		</buttons>
	</Dialog>
</core:FragmentDefinition>