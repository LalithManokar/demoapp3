/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/ToggleButton","sap/m/Input"],function(C,T,I){"use strict";var a=C.extend("sap.ino.controls.ColorPickerLite",{metadata:{properties:{color:{type:"string",defaultValue:"FFFFFF"},valueStateText:{type:"string",defaultValue:null},showValueStateMessage:{type:"boolean",defaultValue:true},defaultColors:{type:"string[]",defaultValue:["#ffffff","f0ab00","f27020","e52929","ab218e","009de0","007cc0","004990","73bf93","008a3b","#bfbfbf","#777777"]},preview:{type:"boolean",defaultValue:true},showHex:{type:"boolean",defaultValue:true}},aggregations:{"_colorButtons":{type:"sap.m.ToggleButton",multiple:true,visibility:"hidden"},"_input":{type:"sap.m.Input",multiple:false,visibility:"hidden"}},events:{change:{}}},_getButtons:function(){var b=this.getAggregation("_colorButtons");if(!b||b.length===0){var t=this;b=[];for(var i=0;i<this.getDefaultColors().length;i++){var B=new T({customData:{Type:"sap.ui.core.CustomData",key:"button-color",value:t._cleanColor(this.getDefaultColors()[i].trim())},press:function(e){t._onPress(e.getSource().data("button-color"));}});B.addStyleClass("sapInoColorPickerColorButton");this.addAggregation("_colorButtons",B);}b=this.getAggregation("_colorButtons");}return b;},_getInput:function(){var i=this.getAggregation("_input");if(!i){var t=this;i=new I({valueStateText:this.getValueStateText(),maxLength:7,showValueStateMessage:this.getShowValueStateMessage(),liveChange:function(e){t._setCurrentColor(e.getParameter("newValue"),false,false);},change:function(e){var v=e.getParameter("newValue");t._setCurrentColor(v,false,true);v=t._cleanColor(v);t.fireChange({value:v,hashValue:"#"+v});}});this.setAggregation("_input",i,true);}return i;},_setCurrentColor:function(v,u,s){if(this._validateLiveInput(v)){if(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(v)){this._setColor(v,u,s);}else if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(v)){this._setColor(v.substr(1),u,s);}else if(s){this._getInput.setValueState("Error");}}},_setColor:function(v,u,s){jQuery(".sapInoColorPickerLitePreview").css("background","#"+v);if(u){this._getInput().setValue("#"+v);}if(s){this.setProperty("color",v,true);}},_validateLiveInput:function(v){if(/(^[0-9A-F]{0,6}$)/i.test(v)){this._getInput().setValueState("None");return true;}if(/(^#[0-9A-F]{0,7}$)/i.test(v)){this._getInput().setValueState("None");return true;}this._getInput().setValueState("Error");return false;},_onPress:function(c){var b=this.getAggregation("_colorButtons");b.forEach(function(B){B.setPressed(B.data("button-color")===c);});this._setCurrentColor(c,true,true);c=this._cleanColor(c);this.fireChange({value:c,hashValue:"#"+c});},_cleanColor:function(c){if(c&&c.substr(0,1)==='#'){c=c.substr(1);}return c.toUpperCase();},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapInoColorPickerLite");r.writeClasses("");r.write(">");r.write("<div");r.addClass("sapInoColorPickerLiteButtonContainer");r.writeClasses("");r.write(">");c._getButtons().forEach(function(b){r.renderControl(b);});r.write("</div>");if(c.getShowHex()){r.write("<div");r.addClass("sapInoColorPickerLitePreviewInput");r.writeClasses("");r.write(">");if(c.getPreview()){r.write("<div");r.addClass("sapInoColorPickerLitePreview");r.writeClasses("");r.write(">");r.write("</div>");}r.renderControl(c._getInput());r.write("</div>");}r.write("</div>");}});a.prototype.onAfterRendering=function(){var c=this._cleanColor(this.getColor());this._setCurrentColor(c,true,true);var b=this.getAggregation("_colorButtons");for(var i=0;i<b.length;i++){jQuery(b[i].getDomRef().children[0]).css("background","#"+b[i].data("button-color"));jQuery(b[i].getDomRef().children[0]).attr("aria-label","#"+b[i].data("button-color"));jQuery(b[i].getDomRef().children[0]).attr("title","#"+b[i].data("button-color"));b[i].setPressed(b[i].data("button-color")===c);}};return a;});
