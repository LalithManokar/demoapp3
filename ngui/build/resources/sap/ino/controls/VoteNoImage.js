/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/m/ButtonType","sap/ui/core/Control","sap/ui/core/IconPool","sap/m/HBox","sap/m/RatingIndicator","sap/m/ToggleButton","sap/ino/controls/VoteType","sap/ui/core/format/NumberFormat","sap/ino/controls/LabelledIcon","sap/m/Label"],function(B,C,I,H,R,T,V,N,L,a){"use strict";var i=N.getIntegerInstance({style:"short"});var f=N.getFloatInstance({decimals:1});var b=C.extend("sap.ino.controls.VoteNoImage",{metadata:{properties:{"voteId":{type:"int"},"objectId":{type:"int"},"enabled":{type:"boolean"},"type":{type:"string"},"value":{type:"float"},"maxStar":{type:"int"},"tooltip":{type:"string"},"likeVotes":{type:"int"},"starVoteCount":{type:"int"},"starVotes":{type:"float"},"score":{type:"float"},"voteCount":{type:"int"}},aggregations:{"_like":{type:"sap.m.ToggleButton",multiple:false,visibility:"hidden"},"_likeDislike":{type:"sap.m.HBox",multiple:false,visibility:"hidden"},"_star":{type:"sap.m.RatingIndicator",multiple:false,visibility:"hidden"},"_score":{type:"sap.m.Text",multiple:false,visibility:"hidden"}},events:{userVote:{}}},init:function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");},_getLike:function(){var l=this.getAggregation("_like");var t=this;if(!l){l=new T({enabled:this.getProperty("enabled"),icon:I.getIconURI("heart","InoIcons"),press:function(){t._onButtonPressed();},pressed:this.getProperty("value")===1,tooltip:this.getProperty("tooltip"),type:B.Transparent});this.setAggregation("_like",l,true);}return l;},_getLikeDislike:function(){var l=this.getAggregation("_likeDislike");var t=this;if(!l){var o=new T({enabled:this.getProperty("enabled"),icon:I.getIconURI("thumbsup","InoIcons"),press:function(){t._onButtonPressed(true);},pressed:this.getValue()===1,tooltip:this.getProperty("tooltip"),type:B.Transparent});o.addStyleClass("sapInoVoteLikeDislikeLike");var d=new T({enabled:this.getProperty("enabled"),icon:I.getIconURI("thumbsdown","InoIcons"),press:function(){t._onButtonPressed();},pressed:this.getValue()===-1,tooltip:this.getProperty("tooltip"),type:B.Transparent});d.addStyleClass("sapInoVoteLikeDislikeDislike");l=new H({displayInline:true,items:[o,d],tooltip:this.getProperty("tooltip")});this.setAggregation("_likeDislike",l,true);}return l;},_getLikeDislikeLike:function(){return this._getLikeDislike().getItems()[0];},_getLikeDislikeDislike:function(){return this._getLikeDislike().getItems()[1];},_getStar:function(){var s=this.getAggregation("_star");var t=this;if(!s){s=new R({change:function(){t._onButtonPressed();},enabled:this.getEnabled(),maxValue:this.getMaxStar(),value:this.getValue(),tooltip:this.getProperty("tooltip")}).addStyleClass('starVote');this.setAggregation("_star",s,true);}return s;},_getStatusText:function(){var v=this.getValue()===1||this.getValue()===-1?this._oRB.getText('CTRL_VOTE_DISPLAY_VOTED'):this._oRB.getText('CTRL_VOTE_DISPLAY_VOTE');return v;},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass("sapInoVoteNoImage");r.writeClasses();if(c.getTooltip_Text()){r.writeAttributeEscaped("title",c.getTooltip());}r.write(">");var v;switch(c.getProperty("type")){case V.TYPE_LIKE:v=c._getLike();break;case V.TYPE_LIKE_DISLIKE:v=c._getLikeDislike();break;case V.TYPE_STAR:v=c._getStar();break;default:break;}if(v){r.renderControl(v);if(c.getProperty("type")===V.TYPE_STAR){var d=c._getStarLabel();r.renderControl(d);}}r.write("</div>");},_getStarLabel:function(){var l;var v=this.getVoteId()?this._oRB.getText('CTRL_VOTE_DISPLAY_VOTED'):this._oRB.getText('CTRL_VOTE_DISPLAY_VOTE');var s=this.getVoteId()?'sapInoStarVoted':'';var S=this.getStarVotes();var c=this.getStarVoteCount();if(S!==undefined&&S!==null&&c!==undefined&&c!==null){l=v+'  '+f.format(S);}var o=new L({label:l}).addStyleClass(s);return o;},_onButtonPressed:function(l){var v=this.getProperty("value");var t=this.getProperty("type");if(t){switch(t){case V.TYPE_LIKE:this.setProperty("value",(v===1)?0:1);break;case V.TYPE_LIKE_DISLIKE:var o=this._getLikeDislikeLike();var d=this._getLikeDislikeDislike();if(l&&o&&d){d.setPressed(false);o.setPressed(o.getPressed());this.setProperty("value",(o.getPressed())?1:0);}else if(o&&d){d.setPressed(d.getPressed());o.setPressed(false);this.setProperty("value",(d.getPressed())?-1:0);}break;case V.TYPE_STAR:var s=this._getStar();this.setProperty("value",s.getValue());break;default:break;}this.fireUserVote({voteId:this.getVoteId(),value:this.getValue(),objectId:this.getObjectId(),type:this.getType(),oldValue:v});}}});b.prototype.setEnabled=function(v){this.setProperty("enabled",v);if(this.getProperty("type")){switch(this.getProperty("type")){case V.TYPE_LIKE:this._getLike().setEnabled(v);break;case V.TYPE_LIKE_DISLIKE:this._getLikeDislikeLike().setEnabled(v);this._getLikeDislikeDislike().setEnabled(v);break;case V.TYPE_STAR:this._getStar().setEnabled(v);break;default:break;}}};b.prototype.setValue=function(v){this.setProperty("value",v);if(this.getProperty("type")){switch(this.getProperty("type")){case V.TYPE_LIKE:this._getLike().setPressed(v===1).setText(this._getStatusText());break;case V.TYPE_LIKE_DISLIKE:this._getLikeDislikeLike().setPressed(v===1);this._getLikeDislikeDislike().setPressed(v===-1);if(v===1){this._getLikeDislikeLike().setText(this._getStatusText());}else if(v===-1){this._getLikeDislikeDislike().setText(this._getStatusText());}else{this._getLikeDislikeLike().setText(this._getStatusText());this._getLikeDislikeDislike().setText(this._getStatusText());}break;case V.TYPE_STAR:this._getStar().setValue(v);break;default:break;}}};b.prototype.setType=function(v){this.setProperty("type",v);this.setValue(this.getValue());this.setEnabled(this.getEnabled());};b.prototype.setMaxStar=function(m){this.setProperty("maxStar",m);if(this.getProperty("type")===V.TYPE_STAR){this._getStar().setMaxValue(m);}};b.prototype.setTooltip=function(v){this.setProperty("tooltip",v);if(this.getProperty("type")){switch(this.getProperty("type")){case V.TYPE_LIKE:this._getLike().setTooltip(v);break;case V.TYPE_LIKE_DISLIKE:this._getLikeDislikeLike().setTooltip(v);this._getLikeDislikeDislike().setTooltip(v);break;case V.TYPE_STAR:this._getStar().setTooltip(v);break;default:break;}}else{this.setAggregation("_like",undefined);this.setAggregation("_likeDislike",undefined);this.setAggregation("_star",undefined);}};return b;});
