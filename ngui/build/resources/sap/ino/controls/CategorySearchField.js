sap.ui.define(['sap/ui/core/Control','sap/m/SearchField','sap/m/Button','sap/m/ActionSelect','sap/ui/core/InvisibleText','sap/ui/core/ListItem',"sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/commons/application/Configuration"],function(C,S,B,A,I,L,F,a,b){'use strict';return C.extend("sap.ino.controls.CategorySearchField",{metadata:{properties:{enbaled:{type:'boolean'},selectedCategory:{type:'string'},category:{type:'object[]'}},aggregations:{_SearchField:{type:'sap.m.SearchField',multiple:false,visibility:false},_CategoryDropDown:{type:'sap.m.ActionSelect',multiple:false,visibility:false}},events:{search:{}}},init:function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");},_onSearch:function(e,k){var s=this.getModel('search').getProperty('/searchAguments');this.fireSearch({category:this.getProperty('selectedCategory'),search:k||e.getParameters().query.trim(),param:s});},_selectCategory:function(e){var p=e.getParameters();var i=p&&p.selectedItem;var k=i&&i.getKey();this.setProperty('selectedCategory',k);this.getModel('search').setProperty('/selectedCategory',k);var s=this.getAggregation('_SearchField');if(k==='idealistbycompany'||k==='campaign-idealistbycompany'){if(!s.getEnableSuggestions()){s.attachSuggest(function(E){var v=E.getParameter("suggestValue");var g=b.getGroupConfiguration();var T=g.GROUP==='COMPANY'?1:2;s.getModel("data").read("/SearchIdentityOrgCompanyParams(searchToken='"+jQuery.sap.encodeURL(v)+"')/Results",{urlParameters:{"$skip":0,"$top":30,"$filter":'TYPENAME eq \''+T+'\''},success:function(d){s.removeAllSuggestionItems();for(var c=0;c<d.results.length-1;c++){s.addAggregation("suggestionItems",new sap.m.SuggestionItem({key:d.results[c][g.GROUP],text:d.results[c].DISPLAYLABEL}),true);}if(d.results.length>0){s.addSuggestionItem(new sap.m.SuggestionItem({key:d.results[d.results.length-1][g.GROUP],text:d.results[d.results.length-1].DISPLAYLABEL}));}s.suggest(true);}});});s.setEnableSuggestions(true);}}else{s.setEnableSuggestions(false);s.destroySuggestionItems();}},_SearchInput:function(){var s=this;var c=s.getAggregation('_SearchField');if(!c){c=new S({showSearchButton:true,value:"{path: 'search>/searchAguments/?query/search', formatter: 'sap.ino.commons.formatters.BaseFormatter.URIdecoding'}",search:function(e){var i=e.getParameter("suggestionItem");if(i){e.getSource().setValue(i.getKey());}var d=i?i.getKey():null;s._onSearch(e,d);}}).addStyleClass('sapInoGlobalSearchInput');s.setAggregation('_SearchField',c,true);}return c;},_SearchCategory:function(){var s=this;var c=s.getAggregation('_CategoryDropDown');if(!c){c=new A({autoAdjustWidth:true,selectedKey:'{search>/selectedCategory}',change:function(e){s._selectCategory(e);}}).bindItems({path:'search>/category',template:new L({key:'{search>key}',tooltip:"{parts: [{path: 'search>value'}, {path: 'search>bNotFormatter'}], formatter: 'sap.ino.commons.formatters.BaseFormatter.formatGlobalSearchKey'}",text:"{parts: [{path: 'search>value'}, {path: 'search>bNotFormatter'}], formatter: 'sap.ino.commons.formatters.BaseFormatter.formatGlobalSearchKey'}"})}).addStyleClass('sapInoGlobalSearchDropDown');s.setAggregation('_CategoryDropDown',c,true);}return c;},renderer:function(r,c){r.write('<div');r.addClass('sapInoGlobalSearch');r.writeClasses();r.write('>');r.renderControl(c._SearchCategory());r.renderControl(c._SearchInput());r.write('</div>');}});});
