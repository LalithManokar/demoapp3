/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/ino/controls/IdentityCard","sap/m/Button","sap/m/Text","sap/m/ToggleButton","sap/m/ButtonType"],function(C,I,B,T,a,b){"use strict";var c=I.extend("sap.ino.controls.IdentityActionCard",{metadata:{properties:{userRole:{type:"string"},actionable:{type:"boolean"},mailable:{type:"boolean"},pinnable:{type:"boolean"},isAdd:{type:"boolean"},isPinned:{type:"boolean"}},events:{pinPressed:{},addRemovePressed:{},mailPressed:{}}},init:function(){I.prototype.init.call(this,arguments);this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");this.addStyleClass("sapInoIdentityBox sapUiTinyMarginBeginEnd sapUiTinyMarginTopBottom sapThemeBaseBG sapUiResponsiveContentPadding");this.addContent(new T({text:"",visible:false,wrapping:true}));this.addAction(new a({type:b.Transparent,icon:"sap-icon://pushpin-off",visible:false,press:this._firePinPressed.bind(this)}).addStyleClass("sapInoPinBtn"));this.addAction(new B({type:b.Transparent,icon:"sap-icon://add",visible:false,press:this._fireAddRemovePressed.bind(this)}).addStyleClass("sapInoIdentityAddRemoveBtn"));this.addAction(new B({type:b.Transparent,icon:"sap-icon://email",visible:false,press:this._fireMailPressed.bind(this)}));},setUserRole:function(r){var R=this.getContent()[0];R.setText(r);R.setVisible(!!r);this.setProperty("userRole",r);return this;},setActionable:function(i){var A=this.getActions()[1];A.setVisible(i);this.setProperty("actionable",i);return this;},setMailable:function(i){var A=this.getActions()[2];A.setVisible(i);this.setProperty("mailable",i);return this;},setIsAdd:function(i){var A=this.getActions()[1];A.setIcon(i?"sap-icon://add":"sap-icon://decline");A.setTooltip(this._oRB.getText(i?"CTRL_IDENTITY_CARD_BTN_TOOLTIP_ADD":"CTRL_IDENTITY_CARD_BTN_TOOLTIP_REMOVE"));this.setProperty("isAdd",i);return this;},setPinnable:function(i){var p=this.getActions()[0];p.setVisible(i);this.setProperty("pinnable",i);return this;},setIsPinned:function(i){var p=this.getActions()[0];p.setTooltip(this._oRB.getText(i?"CTRL_CLIPBOARD_BTN_TOOLTIP_PERSON_REMOVE":"CTRL_CLIPBOARD_BTN_TOOLTIP_PERSON_ADD"));p.setPressed(i);this.setProperty("isPinned",i);return this;},_firePinPressed:function(e){this.firePinPressed({identityId:this.getIdentityId(),userName:this.getUserName(),pinned:e.getSource().getPressed()});},_fireAddRemovePressed:function(e){this.fireAddRemovePressed({identityId:this.getIdentityId(),userName:this.getUserName(),action:this.getIsAdd()?"add":"remove"});},_fireMailPressed:function(e){this.fireMailPressed({identityId:this.getIdentityId(),userName:this.getUserName()});},renderer:"sap.ino.controls.IdentityCardRenderer",onAfterRendering:function(){I.prototype.onAfterRendering.call(this,arguments);this._initTabs();},_initTabs:function(){this._tabs=[];var t=this;if(this.getAggregation("_nameLink")){this._tabs.push(this.getAggregation("_nameLink").$()[0].id);}this.getActions().forEach(function(i){if(i.$().length>0){t._tabs.push(i.$()[0].id);}});},_getTabs:function(){return this._tabs;},onkeydown:function(e){var t=this._getTabs();var f=true;var u=this._incr;if(e.shiftKey||e.keyCode===jQuery.sap.KeyCodes.ARROW_UP||e.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){u=this._decr;f=false;}if(e.keyCode===jQuery.sap.KeyCodes.ESCAPE){this.getParent().focus();}else if(e.keyCode===jQuery.sap.KeyCodes.TAB||e.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN||e.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT||e.keyCode===jQuery.sap.KeyCodes.ARROW_UP||e.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){var i=-1;if(document.activeElement){i=t.indexOf(document.activeElement.id);if(i===-1){return;}if((f&&i<t.length-1)||(!f&&i>0)){i=u(i,t.length-1);this._focus(jQuery("#"+t[i]));e.preventDefault();e.stopPropagation();}}}},_incr:function(v,m){v++;if(v>m){return 0;}return v;},_decr:function(v,m){v--;if(v<0){return m;}return v;},_focus:function(e){if(jQuery.type(e.focus)==="function"){setTimeout(function(){e.focus();},0);}}});return c;});
