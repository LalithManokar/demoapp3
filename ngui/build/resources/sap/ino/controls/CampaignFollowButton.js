/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/InvisibleText","sap/m/Image","sap/m/Link","sap/m/Text","sap/m/Button","sap/ino/controls/util/ColorSupport","sap/ino/controls/LabelledIcon","sap/ui/Device","sap/ui/core/ResizeHandler","sap/ino/controls/CampaignType","sap/ino/controls/CampaignStatusType","sap/ino/commons/application/Configuration","sap/base/security/sanitizeHTML"],function(C,I,a,L,T,B,b,c,D,R,d,e,f,s){"use strict";var g=C.extend("sap.ino.controls.CampaignFollowButton",{metadata:{properties:{"objectId":{type:"int"},"type":{type:"sap.ino.controls.CampaignType",defaultValue:"Normal"},"openForSubmission":{type:"boolean"},"openForRegistration":{type:"boolean"}},aggregations:{"_createIdeaButton":{type:"sap.m.Button",multiple:false,visibility:"hidden"},"registerButton":{type:"sap.ui.core.Control",multiple:false},"campaignSettingButton":{type:"sap.ui.core.Control",multiple:false},"_createIdeaDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"_registerDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"_settingDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"followButton":{type:"sap.ui.core.Control",multiple:false}},events:{createIdea:{},openSetting:{}}},init:function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");this._sResizeRegId=R.register(this,this._onResize);},exit:function(){R.deregister(this._sResizeRegId);this.destroyAggregation('_image');},_getCreateIdeaDescription:function(){var o=this.getAggregation("_createIdeaDescription");return o;},_getFollowButton:function(){var h=this.getAggregation("followButton");return h;},_getRegisterDescription:function(){var o=this.getAggregation("_registerDescription");if(!o){o=new I({text:this._oRB.getText("CTRL_CAMPAIGN_EXP_REGISTER_DESCRIPTION")});this.setAggregation("_registerDescription",o);}return o;},_getSettingButton:function(){var t=this;var S=this.getAggregation("campaignSettingButton");if(!S){S=new B({ariaDescribedBy:t._getSettingDescription(),icon:"sap-icon://action-settings",tooltip:t._oRB.getText("CTRL_CAMPAIGN_EXP_SETTING_DESCRIPTION"),type:"Transparent",press:function(E){E.preventDefault();t.fireOpenSetting();},enabled:true});this.setAggregation("campaignSettingButton",S,true);}return S;},_getSettingDescription:function(){var o=this.getAggregation("_settingDescription");if(!o){o=new I({text:this._oRB.getText("CTRL_CAMPAIGN_EXP_SETTING_DESCRIPTION")});this.setAggregation("_settingDescription",o);}return o;},_getRegisterButton:function(){var r=this.getAggregation('registerButton');if(r){r.addAriaDescribedBy(this._getRegisterDescription());}return r;},_getCreateIdeaButton:function(){var t=this;var o=this.getAggregation("_createIdeaButton");if(!o){o=new B({ariaDescribedBy:t._getCreateIdeaDescription(),icon:"sap-icon://InoIcons/idea-add",tooltip:t._oRB.getText("CTRL_CAMPAIGN_EXP_BTN_CREATE_IDEA"),type:"Transparent",press:function(E){E.preventDefault();t.fireCreateIdea({campaignId:t.getProperty("objectId")});},enabled:true});this.setAggregation("_createIdeaButton",o,true);}return o;},_displayCreateIdeaButton:function(){return this.getOpenForSubmission()&&this.hasListeners("createIdea");},renderer:function(r,o){r.renderControl(o._getRegisterButton());r.renderControl(o._getRegisterDescription());if(o._displayCreateIdeaButton()){r.renderControl(o._getCreateIdeaButton());r.renderControl(o._getCreateIdeaDescription());}r.renderControl(o._getFollowButton());if(o.getType()==="Managed"){r.renderControl(o._getSettingButton());}},ontap:function(E){if((E.srcControl&&E.srcControl.sParentAggregationName==="_follow")||(E.srcControl.getParent()&&E.srcControl.getParent().sParentAggregationName==="_follow")){return false;}if((E.srcControl&&E.srcControl.sParentAggregationName==="registerButton")||(E.srcControl.getParent()&&E.srcControl.getParent().sParentAggregationName==="registerButton")){return false;}if((!E.srcControl||E.srcControl!==this._getCreateIdeaButton())&&(!E.srcControl.getParent()||(E.srcControl.getParent()&&E.srcControl.getParent()!==this._getCreateIdeaButton()))){if((!E.srcControl||E.srcControl!==this._getSettingButton())&&(!E.srcControl.getParent()||(E.srcControl.getParent()&&E.srcControl.getParent()!==this._getSettingButton()))){E.stopPropagation();this.firePress({campaignId:this.getObjectId()});}}},_initTabs:function(){this._tabs=[];if(this._displayCreateIdeaButton()){this._tabs.push(s(this._getCreateIdeaButton().$()[0].id));}if(this.getAggregation("followButton")){this._tabs.push(s(this.getAggregation("followButton").$().find("[tabindex=0],button")[0].id));}if(this.getAggregation('registerButton')&&this.getAggregation('registerButton').$().length){this._tabs.push(s(this.getAggregation('registerButton').$()[0].id));}},_getTabs:function(){return this._tabs;},_defaultOnKeyDown:function(E){if(C.prototype.onkeydown){C.prototype.onkeydown.apply(this,arguments);}},onkeydown:function(E){var t=this._getTabs();var u=this._incr;if(this.getType()!==d.Normal){this._defaultOnKeyDown(E);return;}if(E.shiftKey||E.keyCode===jQuery.sap.KeyCodes.ARROW_UP||E.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){u=this._decr;}if(E.keyCode===jQuery.sap.KeyCodes.ESCAPE){this.getParent().focus();}else if(E.keyCode===jQuery.sap.KeyCodes.TAB||E.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN||E.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT||E.keyCode===jQuery.sap.KeyCodes.ARROW_UP||E.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){var $=jQuery(":focus");var i=-1;if($&&$.length>0){i=t.indexOf($[0].id);if(i!==-1){i=u(i,t.length-1);this._focus(jQuery("#"+t[i]));E.preventDefault();E.stopPropagation();}else{this.getParent().focus();}}else{this.getParent().focus();}}else{this._defaultOnKeyDown(E);}event.stopPropagation();},_incr:function(v,m){v++;if(v>m){return 0;}return v;},_decr:function(v,m){v--;if(v<0){return m;}return v;},_focus:function(E){if(jQuery.type(E.focus)==="function"){setTimeout(function(){E.focus();},0);}}});g.prototype.RegistrationenForSubmission=function(v){this.setProperty("openForSubmission",v);};g.prototype.setOpenForRegistration=function(v){this.setProperty("openForRegistration",v);};return g;});
