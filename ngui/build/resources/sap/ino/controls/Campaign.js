/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/core/InvisibleText","sap/m/Image","sap/m/Link","sap/m/Text","sap/m/FormattedText","sap/m/Button","sap/ino/controls/util/ColorSupport","sap/ino/controls/LabelledIcon","sap/ui/Device","sap/ui/core/ResizeHandler","sap/ino/controls/CampaignType","sap/ino/controls/CampaignStatusType","sap/ino/commons/application/Configuration","sap/base/security/sanitizeHTML"],function(C,I,a,L,T,F,B,b,c,D,R,d,e,f,s){"use strict";var g=C.extend("sap.ino.controls.Campaign",{metadata:{properties:{"color":{type:"sap.ui.core.CSSColor",defaultValue:"#FFFFFF"},"objectId":{type:"int"},"isManaged":{type:"string",defaultValue:"false"},"href":{type:"sap.ui.core.URI"},"title":{type:"string"},"type":{type:"sap.ino.controls.CampaignType",defaultValue:"Banner"},"status":{type:"sap.ino.controls.CampaignStatusType",defaultValue:e.Published},"width":{type:"sap.ui.core.CSSSize",defaultValue:"300px"},"height":{type:"sap.ui.core.CSSSize",defaultValue:"160px"},"image":{type:"sap.ui.core.URI"},"date":{type:"string"},"submissionDate":{type:"string"},"registrationDate":{type:"string"},"dateTooltip":{type:"string"},"submissionDateTooltip":{type:"string"},"registrationDateTooltip":{type:"string"},"ideaCount":{type:"sap.ui.model.odata.type.Int64"},"participantCount":{type:"sap.ui.model.odata.type.Int64"},"activeParticipantCount":{type:"sap.ui.model.odata.type.Int64"},"viewCount":{type:"sap.ui.model.odata.type.Int64"},"openForSubmission":{type:"boolean"},"openForRegistration":{type:"boolean"},"isInnovationView":{type:"string",defaultValue:"true"},},aggregations:{"_image":{type:"sap.m.Image",multiple:false,visibility:"hidden"},"_title":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_date":{type:"sap.m.FormattedText",multiple:false,visibility:"hidden"},"_submissionDate":{type:"sap.m.FormattedText",multiple:false,visibility:"hidden"},"_registrationDate":{type:"sap.m.FormattedText",multiple:false,visibility:"hidden"},"_ideaCount":{type:"sap.ino.controls.LabelledIcon",multiple:false,visibility:"hidden"},"_participantCount":{type:"sap.ino.controls.LabelledIcon",multiple:false,visibility:"hidden"},"_activeParticipantCount":{type:"sap.ino.controls.LabelledIcon",multiple:false,visibility:"hidden"},"_isManaged":{type:"string",defaultValue:"false"},"_viewCount":{type:"sap.ino.controls.LabelledIcon",multiple:false,visibility:"hidden"},"_createIdeaButton":{type:"sap.m.Button",multiple:false,visibility:"hidden"},"registerButton":{type:"sap.ui.core.Control",multiple:false},"campaignSettingButton":{type:"sap.ui.core.Control",multiple:false},"_titleDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"_createIdeaDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"_registerDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"_settingDescription":{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"},"followButton":{type:"sap.ui.core.Control",multiple:false}},events:{press:{},createIdea:{},openSetting:{}}},init:function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");this._sResizeRegId=R.register(this,this._onResize);},exit:function(){R.deregister(this._sResizeRegId);this.destroyAggregation('_image');},_onResize:function(E){var o=this.oControl||this;var i;if(o.getType()===d.Banner){var $=o.$().find(".sapInoCampaignInfo");var h=30;var j=20;if($&&$.length>0){var l=parseInt($.css("margin-left"),10)||0;if(E.size.width<2*parseInt(o.getWidth(),10)&&!o.$().hasClass("sapInoCampaignSqueeze")){o.$().addClass("sapInoCampaignSqueeze");return;}if(E.size.width<l+parseInt(o.getWidth(),10)+h&&!o.$().hasClass("sapInoCampaignShrink")){o._iLeftMargin=l;o.$().addClass("sapInoCampaignShrink");return;}if(E.size.width>(o._iLeftMargin||0)+parseInt(o.getWidth(),10)+h+j&&o.$().hasClass("sapInoCampaignShrink")){o.$().removeClass("sapInoCampaignShrink");if(D.system.phone){i=o._getImage();if(i&&!i.getVisible()){i.setVisible(true);}}return;}if(E.size.width>=2*parseInt(o.getWidth(),10)&&o.$().hasClass("sapInoCampaignSqueeze")){o.$().removeClass("sapInoCampaignSqueeze");return;}}}else{if(D.system.phone){i=o._getImage();if(i&&!i.getVisible()){i.setVisible(true);}}}},_getCount:function(k,i,t){var o=this.getAggregation("_"+k);if(!o&&this.getProperty(k)!==undefined){o=new c({iconUrl:i,label:this.getProperty(k),tooltip:this._oRB.getText(t)});this.setAggregation("_"+k,o,true);}return o;},_getIdeaCount:function(){return this._getCount("ideaCount","sap-icon://InoIcons/idea","CTRL_CAMPAIGN_EXP_IDEA_COUNT");},_getParticipantCount:function(){return this._getCount("participantCount","sap-icon://group","CTRL_CAMPAIGN_EXP_PARTICIPANT_COUNT");},_getActiveParticipantCount:function(){return this._getCount("activeParticipantCount","sap-icon://InoIcons/active-participates","CTRL_CAMPAIGN_EXP_ACTIVE_PARTICIPANT_COUNT");},_getViewCount:function(){return this._getCount("viewCount","sap-icon://show","CTRL_CAMPAIGN_EXP_VIEW_COUNT");},_getDate:function(){var o=this.getAggregation("_date");if(!o){o=new F({htmlText:this.getProperty("date")||"",tooltip:this.getProperty("dateTooltip")}).addStyleClass("sapInoCampaignDate sapInoCampaignMaxSize");this.setAggregation("_date",o,true);}return o;},_getSubmissionDate:function(){var o=this.getAggregation("_submissionDate");if(!o){o=new F({htmlText:this.getProperty("submissionDate")||"",tooltip:this.getProperty("submissionDateTooltip")}).addStyleClass("sapInoCampaignDate sapInoCampaignMaxSize");this.setAggregation("_submissionDate",o,true);}return o;},_getManaged:function(){var i=this.getAggregation("_isManaged");if(!i){i="false";}return i;},_getRegistrationDate:function(){var o=this.getAggregation("_registrationDate");if(!o){o=new F({htmlText:this.getProperty("registrationDate")||"",tooltip:this.getProperty("registrationDateTooltip")}).addStyleClass("sapInoCampaignDate sapInoCampaignMaxSize");this.setAggregation("_registrationDate",o,true);}return o;},_getImage:function(){var i=this.getAggregation("_image");if(!i){var u=this.getProperty("image");if(u){i=new a({src:u,mode:"Background",width:"100%",height:"100%",visible:!D.system.phone,densityAware:false});this.setAggregation("_image",i);}}return i;},_getTitleDescription:function(){var o=this.getAggregation("_titleDescription");if(!o){o=new I().setText(this._oRB.getText("CTRL_CAMPAIGN_EXP_NAV_LINK",[this.getProperty("title")]));if(this.getProperty("title")){this.setAggregation("_titleDescription",o);}}return o;},_getTitle:function(){var t=this;var o=this.getAggregation("_title");if(!o){var h=this.getProperty("title");if(h){if(this.getType()===d.Banner){if(this.hasListeners("press")){o=new L({ariaDescribedBy:t._getTitleDescription(),wrapping:true,href:jQuery.sap.validateUrl(this.getProperty("href"))?this.getProperty("href"):"",press:function(E){E.preventDefault();t.firePress({campaignId:t.getProperty("objectId")});}}).setText(h).addStyleClass("sapInoCampaignTitle sapInoCampaignMaxSize");}else{o=new T({wrapping:true}).setText(h).addStyleClass("sapInoCampaignTitle sapInoCampaignMaxSize");}}else{o=new L({ariaDescribedBy:t._getTitleDescription(),wrapping:true,href:jQuery.sap.validateUrl(this.getProperty("href"))?this.getProperty("href"):"",press:function(E){E.preventDefault();t.firePress({campaignId:t.getProperty("objectId")});}}).setText(h).addStyleClass("sapInoCampaignTitle sapInoCampaignMaxSize");}this.setAggregation("_title",o);}}return o;},_getCreateIdeaDescription:function(){var o=this.getAggregation("_createIdeaDescription");if(!o){o=new I({text:this._oRB.getText("CTRL_CAMPAIGN_EXP_CREATE_IDEA_DESCRIPTION",[this.getProperty("title")])});if(this.getProperty("title")){this.setAggregation("_createIdeaDescription",o);}}return o;},_getFollowButton:function(){var h=this.getAggregation("followButton");return h;},_getRegisterDescription:function(){var o=this.getAggregation("_registerDescription");if(!o){o=new I({text:this._oRB.getText("CTRL_CAMPAIGN_EXP_REGISTER_DESCRIPTION")});this.setAggregation("_registerDescription",o);}return o;},_getSettingButton:function(){var t=this;var S=this.getAggregation("campaignSettingButton");if(!S){S=new B({ariaDescribedBy:t._getSettingDescription(),icon:"sap-icon://action-settings",tooltip:t._oRB.getText("CTRL_CAMPAIGN_EXP_SETTING_DESCRIPTION"),press:function(E){E.preventDefault();t.fireOpenSetting();},enabled:true});this.setAggregation("campaignSettingButton",S,true);}return S;},_getSettingDescription:function(){var o=this.getAggregation("_settingDescription");if(!o){o=new I({text:this._oRB.getText("CTRL_CAMPAIGN_EXP_SETTING_DESCRIPTION")});this.setAggregation("_settingDescription",o);}return o;},_getRegisterButton:function(){var r=this.getAggregation('registerButton');if(r){r.addAriaDescribedBy(this._getRegisterDescription());}return r;},_getCreateIdeaButton:function(){var t=this;var o=this.getAggregation("_createIdeaButton");if(!o){o=new B({ariaDescribedBy:t._getCreateIdeaDescription(),icon:"sap-icon://InoIcons/idea-add",tooltip:t._oRB.getText("CTRL_CAMPAIGN_EXP_BTN_CREATE_IDEA"),press:function(E){E.preventDefault();t.fireCreateIdea({campaignId:t.getProperty("objectId")});},enabled:true});this.setAggregation("_createIdeaButton",o,true);}return o;},_displayCreateIdeaButton:function(){return this.getOpenForSubmission()&&this.hasListeners("createIdea");},onAfterRendering:function(){this._onResize({size:{width:this.$().width()}});var h=[".sapInoCampaignInfoBottomCounts",".sapInoCampaignInfoBottom"];var t=this;h.forEach(function(i){var $=t.$().find(".sapInoCampaignInfo");var j=t.$().find(".sapInoCampaignInfoTop");var k=t.$().find(".sapInoCampaignInfoBottom");var l=t.$().find(i);if($&&$.length>0&&j&&j.length>0&&k&&k.length>0){var m=(parseInt(j.css("padding-top"),10)||0)+(parseInt(j.css("padding-bottom"),10)||0);var n=(parseInt(k.css("padding-top"),10)||0)+(parseInt(k.css("padding-bottom"),10)||0);if($.height()<j.height()+m+k.height()+n){if(!l.hasClass("sapInoCampaignHide")){l.addClass("sapInoCampaignHide");}}}});this._initTabs();},renderer:function(r,o){var h=s(o.getColor());r.write("<div");r.writeControlData(o);r.addStyle("background-color",h);r.writeStyles();r.addClass("sapInoCampaign");r.addClass("sapInoCampaign"+s(o.getType()));if(!h){h="#FFFFFF";}r.addClass("sapInoCampaign"+b.calculateTitleTextColor(h.substr(1,2),h.substr(3,2),h.substr(5,2)));r.writeClasses();r.write(">");if(o.getType()===d.Banner){r.write("<style>#"+s(o.getId())+".sapInoCampaignSqueeze { height : "+s(o.getHeight())+"; }</style>");}o._renderContent(r,o);r.write("</div>");},_renderContent:function(r,o){var h=s(o.getColor());r.write("<div");r.addStyle("width",s(o.getWidth()));r.addStyle("height",s(o.getHeight()));r.writeStyles();r.write(">");var i=o.getWidth();if(o._getImage()&&o.getType()===d.Normal){i="60%";}else if(o._getImage()&&o.getType()===d.Small){i="50%";}else if(o._getImage()&&o.getType()===d.Banner){if(D.system.phone){i="97%";}r.write("<div");r.addStyle("width","100%");r.addStyle("height","100%");r.writeStyles();r.addClass("sapInoCampaignImage");r.writeClasses();r.write(">");r.renderControl(o._getImage());r.write("</div>");}r.write("<div");r.addStyle("width",i);r.addStyle("height",s(o.getHeight()));r.addStyle("background-color",h);r.writeStyles();r.addClass("sapInoCampaignInfo");r.writeClasses();r.write(">");r.write("<style>#"+s(o.getId())+" .sapInoCampaignMaxSize { max-width : calc("+s(o.getWidth())+" - 2rem); }</style>");r.write("<div");r.addClass("sapInoCampaignInfoTop");r.writeClasses();r.write(">");var t=o._getTitle();if(t){r.renderControl(t);if(o.getStatus()===e.Draft){r.write("<div");r.addClass("sapInoCampaignInfoDraftIndicator");r.writeClasses();r.write(">");r.write(o._oRB.getText("CTRL_CAMPAIGNCARD_MSG_DRAFT"));r.write("</div>");}if(t instanceof L){r.renderControl(o._getTitleDescription());}}r.write("</div>");r.write("<div");r.addClass("sapInoCampaignInfoBottom");r.writeClasses();r.write(">");r.write("<div");r.addClass("sapInoCampaignInfoBottomDate");r.writeClasses();r.write(">");if(o.getOpenForRegistration()&&o._getRegistrationDate()){r.renderControl(o._getRegistrationDate());}else if(o._getSubmissionDate()){r.renderControl(o._getSubmissionDate());}if(o._getDate()){r.renderControl(o._getDate());}r.write("</div>");r.write("<div");r.addClass("sapInoCampaignInfoBottomCounts");r.writeClasses();r.write(">");if(o._getIdeaCount()){r.renderControl(o._getIdeaCount().addStyleClass("sapInoCampaignInfoBottomCount"));}if(o._getViewCount()&&this.getProperty("isInnovationView")==="true"){r.renderControl(o._getViewCount().addStyleClass("sapInoCampaignInfoBottomCount"));}if(o._getParticipantCount()&&this.getProperty("isInnovationView")==="true"){r.renderControl(o._getParticipantCount().addStyleClass("sapInoCampaignInfoBottomCount"));}if(o._getActiveParticipantCount()&&this.getProperty("isInnovationView")==="true"){r.renderControl(o._getActiveParticipantCount().addStyleClass("sapInoCampaignInfoBottomCount"));}r.write("</div>");r.write("</div>");r.write("</div>");if(o._getImage()&&(o.getType()===d.Normal||o.getType()===d.Small)){var w=100-parseInt(i,10);r.write("<div");r.addStyle("width",w+"%");r.addStyle("height",o.getHeight());r.writeStyles();r.addClass("sapInoCampaignImage");r.writeClasses();r.write(">");r.renderControl(o._getImage());r.write("</div>");}r.write("<div");r.addClass("sapInoCampaignClear");r.writeClasses();r.write(">");r.write("</div>");r.write("<div");r.addClass('sapInoCampaignButtons');r.writeClasses();r.write('>');r.write("<div");r.addClass('sapInoCampaignRegisterButton');r.writeClasses();r.write('>');if(o._getRegisterButton()&&o._getRegisterButton().getVisible()){r.renderControl(o._getRegisterButton());r.renderControl(o._getRegisterDescription());}r.write('</div>');r.write("<div");r.addClass("sapInoCampaignCreateIdeaButton");r.writeClasses();r.write(">");if(o._displayCreateIdeaButton()&&o.getType()==="Normal"){r.renderControl(o._getCreateIdeaButton());r.renderControl(o._getCreateIdeaDescription());}r.write("</div>");r.write("<div");r.addClass('sapInoCampaignFollowButton');r.writeClasses();r.write('>');r.renderControl(o._getFollowButton());r.write('</div>');r.write("<div");r.addClass('sapInoCampaignFollowButton');r.writeClasses();r.write('>');if(this.getProperty("isManaged")==="true"){r.renderControl(o._getSettingButton());}r.write('</div>');r.write("</div>");r.write("</div>");},ontap:function(E){if((E.srcControl&&E.srcControl.sParentAggregationName==="_follow")||(E.srcControl.getParent()&&E.srcControl.getParent().sParentAggregationName==="_follow")){return false;}if((E.srcControl&&E.srcControl.sParentAggregationName==="registerButton")||(E.srcControl.getParent()&&E.srcControl.getParent().sParentAggregationName==="registerButton")){return false;}if((!E.srcControl||E.srcControl!==this._getCreateIdeaButton())&&(!E.srcControl.getParent()||(E.srcControl.getParent()&&E.srcControl.getParent()!==this._getCreateIdeaButton()))){if((!E.srcControl||E.srcControl!==this._getSettingButton())&&(!E.srcControl.getParent()||(E.srcControl.getParent()&&E.srcControl.getParent()!==this._getSettingButton()))){E.stopPropagation();this.firePress({campaignId:this.getObjectId()});}}},getFocusDomRef:function(){if(this._getTitle()instanceof L){return this._getTitle().$();}else if(this._displayCreateIdeaButton()){this._getCreateIdeaButton().$();}else{return undefined;}},_initTabs:function(){this._tabs=[];if(this._getTitle()instanceof L){this._tabs.push(this._getTitle().$()[0].id);}if(this._displayCreateIdeaButton()&&this.getType()==="Normal"){this._tabs.push(this._getCreateIdeaButton().$()[0].id);}if(this.getAggregation("followButton")){this._tabs.push(this.getAggregation("followButton").$().find("[tabindex=0],button")[0].id);}if(this.getAggregation('registerButton')&&this.getAggregation('registerButton').$().length){this._tabs.push(this.getAggregation('registerButton').$()[0].id);}},_getTabs:function(){return this._tabs;},_defaultOnKeyDown:function(E){if(C.prototype.onkeydown){C.prototype.onkeydown.apply(this,arguments);}},onkeydown:function(E){var t=this._getTabs();var u=this._incr;if(this.getType()!==d.Normal){this._defaultOnKeyDown(E);return;}if(E.shiftKey||E.keyCode===jQuery.sap.KeyCodes.ARROW_UP||E.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){u=this._decr;}if(E.keyCode===jQuery.sap.KeyCodes.ESCAPE){this.getParent().focus();}else if(E.keyCode===jQuery.sap.KeyCodes.TAB||E.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN||E.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT||E.keyCode===jQuery.sap.KeyCodes.ARROW_UP||E.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT){var $=jQuery(":focus");var i=-1;if($&&$.length>0){i=t.indexOf($[0].id);if(i!==-1){i=u(i,t.length-1);this._focus(jQuery("#"+t[i]));E.preventDefault();E.stopPropagation();}else{this.getParent().focus();}}else{this.getParent().focus();}}else{this._defaultOnKeyDown(E);}event.stopPropagation();},_incr:function(v,m){v++;if(v>m){return 0;}return v;},_decr:function(v,m){v--;if(v<0){return m;}return v;},_focus:function(E){if(jQuery.type(E.focus)==="function"){setTimeout(function(){E.focus();},0);}}});g.prototype.setDate=function(v){this.setProperty("date",v);this._getDate().setHtmlText(v);};g.prototype.setSubmissionDate=function(v){this.setProperty("submissionDate",v);this._getSubmissionDate().setHtmlText(v);};g.prototype.setRegistrationDate=function(v){this.setProperty("registrationDate",v);this._getRegistrationDate().setHtmlText(v);};g.prototype.setDateTooltip=function(v){this.setProperty("dateTooltip",v);this._getDate().setTooltip(v);};g.prototype.setSubmissionDateTooltip=function(v){this.setProperty("submissionDateTooltip",v);this._getSubmissionDate().setTooltip(v);};g.prototype.setRegistrationDateTooltip=function(v){this.setProperty("registrationDateTooltip",v);this._getRegistrationDate().setTooltip(v);};g.prototype.setIdeaCount=function(v){this.setProperty("ideaCount",v);if(this._getIdeaCount()){this._getIdeaCount().setLabel(v);}};g.prototype.setParticipantCount=function(v){this.setProperty("participantCount",v);if(this._getParticipantCount()){this._getParticipantCount().setLabel(v);}};g.prototype.setActiveParticipantCount=function(v){this.setProperty("activeParticipantCount",v);if(this._getActiveParticipantCount()){this._getActiveParticipantCount().setLabel(v);}};g.prototype.setViewCount=function(v){this.setProperty("viewCount",v);if(this._getViewCount()){this._getViewCount().setLabel(v);}};g.prototype.RegistrationenForSubmission=function(v){this.setProperty("openForSubmission",v);};g.prototype.setOpenForRegistration=function(v){this.setProperty("openForRegistration",v);};g.prototype.setTitle=function(v){this.setProperty("title",v);if(this._getTitle()){this._getTitle().setText(v);}};g.prototype.setHref=function(v){this.setProperty("href",v);if(this._getTitle()&&this._getTitle().setHref){this._getTitle().setHref(v);}};g.prototype.setImage=function(v){this.setProperty("image",v);if(this._getImage()){this._getImage().setSrc(v);}};return g;});
