/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Label","sap/m/Text","sap/m/FlexBox","sap/ui/core/Icon","sap/base/security/sanitizeHTML"],function(C,L,T,F,I,s){"use strict";var P=C.extend("sap.ino.controls.ProcessIndicator",{metadata:{properties:{currentStep:{type:"int",defaultValue:0},isDraft:{type:"boolean",defaultValue:false},phase:{type:"string"},processSteps:{type:"int",defaultValue:6},processStopped:{type:"boolean",defaultValue:false},renderProcessFirst:{type:"boolean",defaultValue:false},status:{type:"string"},statusColor:{type:"string"},width:{type:"sap.ui.core.CSSSize",defaultValue:"160px"},displaySvg:{type:"boolean",defaultValue:true},displayStatus:{type:"boolean",defaultValue:true},visibleNewFlag:{type:"boolean",defaultValue:false}},aggregations:{"_status":{type:"sap.m.FlexBox",multiple:false,visibility:"hidden"},"_phase":{type:"sap.m.FlexBox",multiple:false,visibility:"hidden"}}},init:function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.controls");if(sap.ui.core.Control.prototype.init){sap.ui.core.Control.prototype.init.apply(this,arguments);}},_getPhase:function(){var p=this.getAggregation("_phase");if(!p){p=new F({items:[this._getPhaseLabel(),this._getPhaseText()],alignItems:"Start",justifyContent:"Start",alignContent:"Start"}).addStyleClass("sapInoProcessIndicatorPhase");this.setAggregation("_phase",p);}return p;},_getStatus:function(){var S=this.getAggregation("_status");if(!S){S=new F({items:[this._getStatusLabel(),this._getStatusText(),this._getStatusNewIcon()],alignItems:"Start",justifyContent:"Start",alignContent:"Start"}).addStyleClass("sapInoProcessIndicatorStatus");this.setAggregation("_status",S);}return S;},_getPhaseLabel:function(){var p=this.getProperty("phase");if(this.getProperty("isDraft")){p="";}return new L({text:this._oRB.getText("CTRL_PROCESSINDICATOR_FLD_PHASE_LABEL"),tooltip:this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_PHASE_TOOLTIP",p)}).addStyleClass("sapInoProcessIndicatorPhaseLabel");},_getPhaseText:function(){var p=this.getProperty("phase");if(this.getProperty("isDraft")){p="";}return new T({text:p,tooltip:this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_PHASE_TOOLTIP",p)}).addStyleClass("sapInoProcessIndicatorPhaseText");},_getStatusLabel:function(){var S=this.getProperty("status");return new L({text:this._oRB.getText("CTRL_PROCESSINDICATOR_FLD_STATUS_LABEL"),tooltip:this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_STATUS_TOOLTIP",S)}).addStyleClass("sapInoProcessIndicatorStatusLabel");},_getStatusNewIcon:function(){return new I({tooltip:this._oRB.getText("CTRL_IDEA_OBJECT_LATEST_UPDATE_NEW"),visible:this.getProperty("visibleNewFlag"),src:"sap-icon://InoIcons/idea-news"}).addStyleClass("sapInoIdeaLatestUpdateNewIcon");},_getStatusText:function(){var S=this.getProperty("status");return new T({text:S,tooltip:this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_STATUS_TOOLTIP",S)}).addStyleClass("sapInoProcessIndicatorStatusText");},_renderInfoText:function(r,c,R){if(R&&!c.getProperty("isDraft")&&this.getProperty("phase")){r.renderControl(c._getPhase());}if((R||c.getProperty("isDraft"))&&this.getProperty("status")&&c.getDisplayStatus()){r.renderControl(c._getStatus());}},renderer:function(r,c){var S=c.getProperty("processSteps");var a=c.getProperty("currentStep");var w=s(c.getProperty("width").replace("px",""));var R=false;if(c.getProperty("phase")||c.getProperty("status")){R=true;}var d=12;var f=d/2;var b=d/2;if(R){b=d/2;f=d/2;}var l=d/2.5;var e=0;if(S>=2){e=(w-b*2)/(S-1);}var p=((a<0)?0:a*e);if(a>=S){p=w;}function g(x,y,w,H,m){r.write("<rect");r.writeAttributeEscaped("x",x);r.writeAttributeEscaped("y",y-H/2);r.writeAttributeEscaped("width",w+"px");r.writeAttributeEscaped("height",H+"px");r.addClass(m);r.writeClasses();r.write("/>");}function h(x,y,m,n){r.write("<circle");r.writeAttributeEscaped("cx",x);r.writeAttributeEscaped("cy",y);r.writeAttributeEscaped("r",m);r.addClass(n);r.writeClasses();r.write("/>");}r.write("<div");r.writeControlData(c);r.addStyle("width",w+"px");r.addStyle("overflow","hidden");r.writeStyles();r.writeClasses();if(c.getProperty('phase')&&c.getProperty('status')){r.writeAttributeEscaped("title",c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE",[c.getProperty('phase'),c.getProperty('status')]));}else if(c.getProperty('phase')&&!c.getProperty('status')){r.writeAttributeEscaped("title",c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE_WITHOUT_STATUS",[c.getProperty('phase')]));}else if(!c.getProperty('phase')&&c.getProperty('status')){r.writeAttributeEscaped("title",c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE_WITHOUT_PHASE",[c.getProperty('status')]));}r.write(">");r.write("<span style=\"position:absolute;clip:rect(1px,1px,1px,1px)\">");if(c.getProperty('phase')&&c.getProperty('status')){r.writeEscaped(c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE",[c.getProperty('phase'),c.getProperty('status')]));}else if(c.getProperty('phase')&&!c.getProperty('status')){r.writeEscaped(c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE_WITHOUT_STATUS",[c.getProperty('phase')]));}else if(!c.getProperty('phase')&&c.getProperty('status')){r.writeEscaped(c._oRB.getText("CTRL_PROCESSINDICATOR_ALT_NOTE_WITHOUT_PHASE",[c.getProperty('status')]));}r.write("</span>");if(c.getDisplaySvg()){r.write("<svg");r.writeAttribute("focusable","false");r.addStyle("width",w+"px");r.addStyle("height",d+"px");r.writeStyles();r.writeClasses();r.write(">");var j="sapInoProcessIndicatorActive";if(c.getProcessStopped()){j="sapInoProcessIndicatorStopped";}if(S>1){g(b,f,p,l,j);g(b+p,f,w-p-d,l,"sapInoProcessIndicatorInactive");}for(var i=0;i<S;i++){var x=i*e+b;var k=j;if(i>a||c.getProperty("isDraft")){k="sapInoProcessIndicatorInactive";}h(x,f,d/2,k);}r.write("</svg>");}if(!c.getRenderProcessFirst()){c._renderInfoText(r,c,R);}if(c.getRenderProcessFirst()){c._renderInfoText(r,c,R);}r.write("</div>");},onAfterRendering:function(){var S=this.getModel("object")?this.getModel("object").getProperty("/STATUS_COLOR"):null||this.getProperty("statusColor");if(S&&S.length===6){S="#"+S;}else{S="#333333";}if(this.getModel("object")){$(".sapInoProcessIndicatorStatusText").css('color',S);}else{if(this.getDomRef()){$(this.getDomRef()).find('.sapInoProcessIndicatorStatusText').css("color",S);}}}});P.prototype.bindProperty=function(k,b){C.prototype.bindProperty.apply(this,arguments);switch(k){case"status":var S=this._getStatus().getItems()[1];S.bindProperty("text",b);break;case"phase":C.prototype.bindProperty.apply(this,arguments);var p=this._getPhase().getItems()[1];p.bindProperty("text",b);break;default:break;}};P.prototype.setVisibleNewFlag=function(v){this.setProperty("visibleNewFlag",v);var S=this._getStatus().getItems()[2];S.setVisible(v);};P.prototype.setStatus=function(v){this.setProperty("status",v);var S=this._getStatus().getItems()[0];S.setText(this._oRB.getText("CTRL_PROCESSINDICATOR_FLD_STATUS_LABEL",v));S.setTooltip(this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_STATUS_TOOLTIP",v));var o=this._getStatus().getItems()[1];o.setText(v);};P.prototype.setPhase=function(v){this.setProperty("phase",v);var p=this._getPhase().getItems()[0];p.setText(this._oRB.getText("CTRL_PROCESSINDICATOR_FLD_PHASE_LABEL",v));p.setTooltip(this._oRB.getText("CTRL_PROCESSINDICATOR_ALT_PHASE_TOOLTIP",v));var o=this._getPhase().getItems()[1];o.setText(v);};return P;});
