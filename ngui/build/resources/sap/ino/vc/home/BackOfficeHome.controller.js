sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ino/vc/iam/mixins/IdentityProfileMixin","sap/ino/commons/formatters/ObjectListFormatter","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ino/commons/application/Configuration","sap/ino/vc/idea/mixins/FollowUpMixin","sap/ino/vc/idea/mixins/AssignmentActionMixin","sap/ino/vc/idea/mixins/ChangeStatusActionMixin","sap/ino/vc/idea/mixins/DeleteActionMixin","sap/ino/vc/idea/mixins/AddExpertFromClipboardMixin","sap/ino/vc/evaluation/EvaluationFormatter","sap/ino/vc/idea/mixins/MergeActionMixin","sap/ino/vc/blog/mixins/DeleteActionMixin","sap/ino/vc/commons/mixins/TagCardMixin","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/idea/RewardFormatter","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/idea/mixins/VolunteerMixin","sap/ino/vc/follow/mixins/FeedsMixin","sap/ino/vc/idea/mixins/IdeaFormCriteriaFilterMixin","sap/ino/commons/models/object/Homepagewidget","sap/ui/model/json/JSONModel"],function(C,I,O,S,F,a,b,A,c,D,d,E,M,B,T,R,e,f,V,g,h,i,H,J){"use strict";var l={"follow":{filterParam:"",filter:[new F("FOLLOW_UP_ID","NE",null),new F("STATUS","NE","sap.ino.config.DRAFT")],sorter:new S("FOLLOW_UP_DATE",false)},"coachme":{filterParam:"",filter:[new F("COACH_ID","EQ",a.getCurrentUser().USER_ID),new F("STATUS","NE","sap.ino.config.DRAFT")],sorter:new S("SUBMITTED_AT",false)},"unassigned":{filterParam:"unassignedCoach",filter:[new F("STATUS","NE","sap.ino.config.DRAFT")],sorter:new S("SUBMITTED_AT",true)},"evaldone":{filterParam:"evaluatedIdeas",filter:[new F("STATUS","NE","sap.ino.config.DRAFT")],sorter:new S("LAST_PUBL_EVAL_AT",true)}};var m={"published":{filterParam:"publishedBlogs",filter:[],sorter:new S("PUBLISHED_AT",true),name:"publish"},"draft":{filterParam:"draftBlogs",filter:[],sorter:new S("CHANGED_AT",true),name:"draft"},"all":{filterParam:"",filter:[],sorter:new S("PUBLISHED_AT",true),name:"all"}};var j={Backoffice:{PATH:"/BackofficeEntityCount(1)",Binding:[{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_IDEAS_COACHED",COUNT:"COACHED_BY_ME_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"coachme"}},ROLES:["sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]},{ICON:"sap-icon://InoIcons/campaign",LINK_TEXT:"PROFILE_LNK_MANAGED_CAMPAIGNS",COUNT:"MANAGED_CAMPAIGN_COUNT",Route:{NAME:"campaignlistvariant",QUERY:{variant:"manage"}},ROLES:["sap.ino.ui::camps_mgr_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_IDEAS_UNASSIGNED",COUNT:"UNASSIGNED_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"unassigned"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]},{ICON:"sap-icon://hr-approval",LINK_TEXT:"REGISTER_APPR_LIST_TIT",COUNT:"MY_PENDING_APPR_COUNT",Route:{NAME:"registerapprovallistvariant",QUERY:{variant:"pending"}},ROLES:["sap.ino.ui::camps_mgr_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_IDEA_FOLLOWUP",COUNT:"FOLLOW_UP_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"follow"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_IDEAS_EVALUATED",COUNT:"EVALUATED_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"evaldone"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]},{ICON:"sap-icon://competitor",LINK_TEXT:"REWARDS_MANAGEMENT_LIST_TIT",COUNT:"REWARDS_MANAGEMENT_COUNT",Route:{NAME:"rewardlist",QUERY:{variant:"rewardmanage"}},ROLES:["sap.ino.ui::camps_mgr_role"]},{ICON:"sap-icon://InoIcons/following",LINK_TEXT:"PROFILE_LNK_FOLLOWED_MY",COUNT:"MY_FOLLOWED_COUNT",Route:{NAME:"followlistvariant",QUERY:{variant:"campaign"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"IDEA_LIST_MIT_COMPLETED",COUNT:"COMPLETED_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"managedcompleted"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role"]}]}};var r={"UnchangedIdeasFrame":"ReportTemplates('sap.ino.config.7')","VotesFrame":"ReportTemplates('sap.ino.config.16')"};var L={XS:{centerProfileContainer:"identityProfileFragment--identityProfile",centerReportUnchangedIdeasContainer:"unchangedIdeasFragment--unchangedIdeas",centerReportUnchangedIdeasSplitContainer:undefined,leftReportUnchangedIdeasContainer:undefined,rightReportUnchangedIdeasContainer:undefined,centerReportVotesContainer:"votesFragment--votes",centerReportVotesSplitContainer:undefined,leftReportVotesContainer:undefined,rightReportVotesContainer:undefined},S:{leftProfileContainer:"identityProfileFragment--identityProfile",centerReportUnchangedIdeasContainer:"unchangedIdeasFragment--unchangedIdeas",centerReportVotesContainer:"votesFragment--votes"},M:{leftProfileContainer:"identityProfileFragment--identityProfile",centerReportUnchangedIdeasSplitContainer:"unchangedIdeasFragment--unchangedIdeas",centerReportVotesSplitContainer:"votesFragment--votes"},L:{leftProfileContainer:"identityProfileFragment--identityProfile",leftReportUnchangedIdeasContainer:"unchangedIdeasFragment--unchangedIdeas",leftReportVotesContainer:"votesFragment--votes"},XL:{leftProfileContainer:"identityProfileFragment--identityProfile",rightReportUnchangedIdeasContainer:"unchangedIdeasFragment--unchangedIdeas",rightReportVotesContainer:"votesFragment--votes"}};return C.extend("sap.ino.vc.home.BackOfficeHome",jQuery.extend({},I,b,A,c,D,M,B,T,R,e,O,V,g,h,d,i,{formatter:jQuery.extend(this.formatter,O,E,b.followUpMixinFormatter,f),feedTitleLink:function(o,s){if(!isNaN(parseInt(o,10))){switch(s){case'CAMPAIGN':return this.formatter.navigationLink.apply(this,["campaign",{id:o}]);case'IDEA':return this.formatter.navigationLink.apply(this,["idea-display",{id:o}]);default:break;}}return undefined;},initialFocus:"backofficeButton--backofficeToogle",onInit:function(){C.prototype.onInit.apply(this,arguments);this.aBusyControls=[this.getView()];this._sBOHResizeIdeaListId=this.attachListControlResized(this.byId("ideasFragment--ideasList"));var o=H.getBackofficeHomepageWidget();o.done(function(k){var w=k.RESULT[0]||{IS_VISIBLE:false,HTML_CONTENT:""};w.IS_VISIBLE=!!w.IS_VISIBLE;this.getView().setModel(new J(w),"widget");}.bind(this));},onExit:function(){C.prototype.onExit.apply(this,arguments);this.detachListControlResized(this._sBOHResizeIdeaListId);},getIdeaList:function(){return this.byId("ideasFragment--ideasList");},getCampaignList:function(){return this.byId("campaignsListFragment--campaignsList");},show:function(p){this._oParentView=p;this.bindViewData();this.setIdentityProfileBinding();this.getIdeaList().attachUpdateFinished(this._onIdeaListUpdateFinished,this);this.getCampaignList().attachUpdateFinished(this._onCampaignListUpdateFinished,this);},_onIdeaListUpdateFinished:function(){var o=this.getIdeaList();o.$().find(".sapMListUl").attr("role","list");var k=o.$().find("li");jQuery.each(k,function(n,p){var $=jQuery(p);$.attr("role","group");var q=$.find(".sapInoItemAriaLabel");if(q&&q.length>0){$.attr("aria-labelledby",q[0].id);}var s=$.find(".sapMLIBContent");if(s&&s.length>0){s.attr("role","listitem");}});},_onCampaignListUpdateFinished:function(){var o=this.getCampaignList();o.$().find(".sapMListUl").attr("role","list");var k=o.$().find("li");jQuery.each(k,function(n,p){var $=jQuery(p);$.attr("role","group");var q=$.find(".sapInoItemAriaLabel");if(q&&q.length>0){$.attr("aria-labelledby",q[0].id);}var s=$.find(".sapMLIBContent");if(s&&s.length>0){s.attr("role","listitem");}});},_replaceReportName:function(o){var t=this;o.forEach(function(k){var K=k.getProperty("name");var s=t.getText(K);k.setProperty("name",s);});},_changeReportTitle:function(o){var t=this;if(o.getFeeds()){o.getFeeds().forEach(function(k){var K=k.getProperty("values");var s=t.getText(K);k.setProperty("values",[s]);});}if(o.getDataset()&&o.getDataset().getMeasures()){t._replaceReportName(o.getDataset().getMeasures());}if(o.getDataset()&&o.getDataset().getDimensions()){t._replaceReportName(o.getDataset().getDimensions());}},onAfterRendering:function(){var t=this;var u=this.byId("unchangedIdeasFragment--UnchangedIdeasFrame");var v=this.byId("votesFragment--VotesFrame");var o={title:{visible:false},legendGroup:{layout:{position:"auto"}},categoryAxis:{title:{visible:false},label:{visible:false}},valueAxis:{title:{visible:false}}};if(u){u.setVizProperties(o);if(!this.getModel("device").getProperty("/system/phone")&&!u.aBindParameters){u.attachBrowserEvent("click",this.onNavigateToReport,this);}t._changeReportTitle(u);}if(v){if(this.getModel("device").getProperty("/system/phone")){o.categoryAxis.label.visible=true;}v.setVizProperties(o);if(!this.getModel("device").getProperty("/system/phone")&&!v.aBindParameters){v.attachBrowserEvent("click",this.onNavigateToReport,this);}t._changeReportTitle(v);}},getLayout:function(s){return L[s];},setIdentityProfileBinding:function(){this.bindIdentityProfile(this.byId("identityProfileFragment--identityProfile"),j.Backoffice);if(this.getModel("data").getProperty(j.Backoffice.PATH)){var o=this;this.getModel("data").read(j.Backoffice.PATH,{success:function(){var k=o.byId("identityProfileFragment--identityProfileList").getBindingInfo("items");o.byId("identityProfileFragment--identityProfileList").bindItems(k);}});}},bindViewData:function(){this._bindCampaigns();var s;if(this.getModel("device").getProperty("/system/phone")){s=this.byId("ideasFragment--sapInoCampHomeIdeasSelect").getSelectedKey();}else{s=this.byId("ideasFragment--sapInoCampHomeIdeasButtons").getSelectedKey();}this._sIdeaViewKey=s||Object.keys(l)[0];this._bindIdeas(this._sIdeaViewKey);var k;if(this.getModel("device").getProperty("/system/phone")){k=this.byId("blogsFragment--sapInoCampHomeBlogsSelect").getSelectedKey();}else{k=this.byId("blogsFragment--sapInoCampHomeBlogsButtons").getSelectedKey();}this._sBlogViewKey=k||Object.keys(m)[0];if(!this.getModel("component").getProperty("/SHOW_BACKOFFICE_BLOG")){this._sBlogViewKey=Object.keys(m)[2];}this._bindBlogs(this._sBlogViewKey);this._bindUnchangedIdeas();this._bindVotes();},_bindCampaigns:function(){var k=this.getModel("device").getProperty("/system/phone");var s=a.hasCurrentUserPrivilege('sap.ino.xs.rest.admin.application::campaign');var n=s?'filterBackoffice=0':'filterBackoffice=1';var p="data>/CampaignSearchParams(searchToken='',"+"tagsToken='',"+"tagsToken1='',"+"tagsToken2='',"+"tagsToken3='',"+"tagsToken4='',"+"filterName='submittableCampaigns',"+n+")/Results";if(k){var o=this.byId("campaignsListFragment--campaignsCarousel");o.bindAggregation("pages",{path:p,template:this.createFragment("sap.ino.vc.home.fragments.CampaignBanner"),length:4,top:4,filters:[new F("STATUS_CODE","NE","sap.ino.config.CAMP_DRAFT")],sorter:new S("SUBMIT_TO",false)});}else{var q=this.byId("campaignsListFragment--campaignsList");q.bindItems({path:p,template:this.getFragment("sap.ino.vc.campaign.fragments.HomeCampaignListItem"),length:3,top:3,filters:[new F("STATUS_CODE","NE","sap.ino.config.CAMP_DRAFT")],sorter:new S("SUBMIT_TO",false)});}},_bindIdeas:function(k){var n=this.getModel("device").getProperty("/system/phone");var p="data>/IdeaMediumBackofficeSearchParams(searchToken='',"+"searchType="+"0"+","+"tagsToken='',"+"tagsToken1='',"+"tagsToken2='',"+"tagsToken3='',"+"tagsToken4='',"+"filterName='"+l[k].filterParam+"',"+"filterBackoffice=1"+this.getEmptyIdeaformFilters()+",cvt='"+""+"',"+"cvr="+"0"+","+"cvy="+"0"+")/Results";var o=this.byId("ideasFragment--ideasList");var q=a.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE")*1||a.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE_HIDE_PHASE_BAR")*1;var t=Number(q)?this.getFragment("sap.ino.vc.idea.fragments.ManageListItemNoImage"):this.getFragment("sap.ino.vc.idea.fragments.ManageListItem");o.bindItems({path:p,template:t,sorter:l[k].sorter,filters:l[k].filter,length:4});var s=this.byId("ideasFragment--panelTitle");s.setText(this.getText("CAMPAIGN_HOME_PANEL_IDEAS_"+k.toUpperCase()));var u=a.hasCurrentUserPrivilege("sap.ino.ui::backoffice.access");var v="";if(u){v="/sap/ino/xs/rest/backoffice/odata.xsodata";}else{v="/sap/ino/xs/rest/community/odata.xsodata";}p=a.getBackendRootURL()+v+o.mBindingInfos.items.binding.sPath+"?$format=json";var w=o.mBindingInfos.items.binding.sFilterParams;var x=o.mBindingInfos.items.binding.sSortParams;var y="&$select(ID)";p=p+"&"+x+"&"+w+y;var z=new J();z.setData({path:p});sap.ui.getCore().setModel(z,"ideaSearchParams");},_bindBlogs:function(k){if(a.getCurrentUser().USER_ID){var n=this.getModel("device").getProperty("/system/phone");var p="data>/BlogSearchParams(searchToken='',"+"tagsToken='',"+"filterName='"+m[k].filterParam+"')/Results";var o={path:p,template:this.getFragment("sap.ino.vc.blog.fragments.ListItemHome"),sorter:m[k].sorter,length:4,top:4};if(n){var q=this.byId("blogsFragment--blogsCarousel");q.bindAggregation("pages",o);}else{var s=this.byId("blogsFragment--blogsList");if(s){s.bindItems(o);}}var t=this.byId("blogsFragment--panelBlogTitle");if(this.getModel("component").getProperty("/SHOW_BACKOFFICE_BLOG")){t.setText(this.getText("CAMPAIGN_HOME_PANEL_BLOGS_"+k.toUpperCase()));}else{t.setText(this.getText("HOMEPAGE_PANEL_CAMPAIGN_BLOGS"));}}},_bindUnchangedIdeas:function(){var v=this.byId("unchangedIdeasFragment--UnchangedIdeasFrame");var o=this.getModel("data");o.read("/UnchangedIdeas",{async:true,success:function(k){var n=new sap.ui.model.json.JSONModel();n.setData(k);v.setModel(n);}});},_bindVotes:function(){var v=this.byId("votesFragment--VotesFrame");var o=this.getModel("data");o.read("/IdeaVotes",{async:true,sorters:[new S("CHANGED_AT_YEAR_MONTH",false)],success:function(k){var n=new sap.ui.model.json.JSONModel();n.setData(k);v.setModel(n);}});},onCampaignsListItemPress:function(o){var k=o.getSource();var n=k.getBindingContext("data");if(n){this.navigateTo("campaign",{id:n.getProperty("ID")});}},onNavigateToCampaigns:function(){this.navigateTo("campaignlistvariant",{variant:"submittable"});},onOfficeToggle:function(){if(this._oParentView){var o=this._oParentView.getController();if(o.switchView){o.switchView();}}},onOpenCampaignSettings:function(o){if(this._oParentView){var s=o.getSource();var k=s.getBindingContext("data");var n=this._oParentView.getController();if(n.openCampaignSettings){n.openCampaignSettings(k.getProperty("ID"));}}},onBackofficeSettings:function(){if(this._oParentView){var o=this._oParentView.getController();if(o.onBackofficeSettings){o.onBackofficeSettings();}}},onCreateIdea:function(o){this.navigateTo("idea-create",{query:{campaign:o.getParameter("campaignId")}});},onIdeaListTypeSelect:function(o){this._sIdeaViewKey=o.getParameter("key")||o.getParameter("selectedItem")&&o.getParameter("selectedItem").getKey();this._bindIdeas(this._sIdeaViewKey);},onBlogListTypeSelect:function(o){this._sBlogViewKey=o.getParameter("key")||o.getParameter("selectedItem")&&o.getParameter("selectedItem").getKey();this._bindBlogs(this._sBlogViewKey);},onOpenSubmitter:function(o){var s=o.getSource();var k=s.getBindingContext("data").getProperty("SUBMITTER_ID");this.openIdentityQuickView(s,k);},onOpenCoach:function(o){var s=o.getSource();var k=s.getBindingContext("data").getProperty("COACH_ID");this.openIdentityQuickView(s,k);},onNavigateToIdeas:function(){if(!this._sIdeaViewKey){this.navigateTo("idealist");}else{this.navigateTo("idealistvariant",{variant:this._sIdeaViewKey});}},onNavigateToBlogs:function(){if(!this._sBlogViewKey){this.navigateTo("bloglist");}else{this.navigateTo("bloglistvariant",{variant:m[this._sBlogViewKey].name});}},onNavigateToReport:function(o){var k=((o.currentTarget&&o.currentTarget.id)||(o.oSource.sId)).split("--");var s=k[k.length-1];this.navigateTo("report",{code:r[s]});},onItemPress:function(o){var k=o.getSource();var n=k.getBindingContext("data");if(n){this.navigateTo("idea-display",{id:n.getProperty("ID")});}},onBlogItemPress:function(o){if(this._bIsTokenPressed){this._bIsTokenPressed=false;return;}var k=o.getSource();var n=k.getBindingContext("data");if(n){this.navigateTo("blog-display",{id:n.getProperty("ID")});}},onOpenCreator:function(o){var s=o.getSource();var k=s.getBindingContext("data").getProperty("CREATED_BY_ID");if(!this.oIdentityCardView){this.oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});this.getView().addDependent(this.oIdentityCardView);}this.oIdentityCardView.getController().open(s,k);},onNavigateToFeedList:function(){this.navigateTo("feedlist");},showPopupTagCard:function(o){this._bIsTokenPressed=true;if(!this._oPopover){this._oPopover=sap.ui.xmlfragment("sap.ino.vc.tag.fragments.TagCardPopover",this);this.getView().addDependent(this._oPopover);}var t=o.getSource();var p="/SearchTagsAll(searchToken='',ID="+t.getKey()+")";var k=this.getModel("data");var n=this;k.read(p,{async:true,success:function(q){var s=new sap.ui.model.json.JSONModel();s.setData(q);n._oPopover.setModel(s,"Tag");jQuery.sap.delayedCall(0,n,function(){n._oPopover.openBy(t);});}});}}));});
