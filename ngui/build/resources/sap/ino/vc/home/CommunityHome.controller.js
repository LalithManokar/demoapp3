sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ino/vc/iam/mixins/IdentityProfileMixin","sap/ino/commons/application/Configuration","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/commons/mixins/TagCardMixin","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/vc/idea/RewardFormatter","sap/ino/vc/idea/mixins/VolunteerMixin","sap/ui/core/IconPool","sap/ino/vc/follow/mixins/FeedsMixin","sap/ino/commons/models/object/Homepagewidget","sap/ui/model/json/JSONModel"],function(C,I,a,S,F,V,b,O,T,R,c,d,f,g,H,J){"use strict";var m={Community:{PATH:"/EntityCount(1)",SHOW_BUTTONS:true,Binding:[{ICON:"sap-icon://InoIcons/campaign",LINK_TEXT:"PROFILE_LNK_CAMPAIGNS_OPENED",COUNT:"OPEN_CAMPAIGN_COUNT",Route:{NAME:"campaignlistvariant",QUERY:{variant:"open"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_part_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_OPEN_FOR_EVALUATION",COUNT:"EVALUATION_OPEN_COUNT",EXPERT:true,Route:{NAME:"idealistvariant",QUERY:{variant:"evalopen"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_expert_role","sap.ino.ui::camps_resp_expert_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_IDEAS_MY",COUNT:"AUTHORED_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"my"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_part_role"]},{ICON:"sap-icon://lightbulb",LINK_TEXT:"PROFILE_LNK_EVAL_BY_ME",COUNT:"EVALUATED_IDEA_COUNT",EXPERT:true,Route:{NAME:"idealistvariant",QUERY:{variant:"eval"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_expert_role","sap.ino.ui::camps_resp_expert_role"]},{ICON:"sap-icon://InoIcons/wall",LINK_TEXT:"PROFILE_LNK_WALLS_MY",COUNT:"MY_WALLS_COUNT",Route:{NAME:"walllistvariant",QUERY:{variant:"my"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_part_role"]},{ICON:"sap-icon://InoIcons/heart",LINK_TEXT:"PROFILE_LNK_MY_VOTES",COUNT:"MY_VOTES_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"voted"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_expert_role","sap.ino.ui::camps_resp_expert_role","sap.ino.ui::camps_part_role"]},{ICON:"sap-icon://comment",LINK_TEXT:"PROFILE_LNK_MY_COMMENTS",COUNT:"MY_COMMENTS_IDEA_COUNT",Route:{NAME:"idealistvariant",QUERY:{variant:"commented"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_expert_role","sap.ino.ui::camps_resp_expert_role","sap.ino.ui::camps_part_role"]},{ICON:f.getIconURI('following','InoIcons'),LINK_TEXT:"PROFILE_LNK_FOLLOWED_MY",COUNT:"MY_FOLLOWED_COUNT",Route:{NAME:"followlistvariant",QUERY:{variant:"campaign"}},ROLES:["sap.ino.ui::camps_mgr_role","sap.ino.ui::camps_coach_role","sap.ino.ui::camps_resp_coach_role","sap.ino.ui::camps_expert_role","sap.ino.ui::camps_resp_expert_role","sap.ino.ui::camps_part_role"]}]}};var l={"my":{sPath:"data>/MyIdeaMediumCommunity",sorter:new S("CHANGED_AT",true)},"all":{sPath:"data>/IdeaMediumCommunity",filter:[new F("STATUS","NE","sap.ino.config.DRAFT")],sorter:new S("SUBMITTED_AT",true)},"completed":{sPath:"data>/IdeaMediumSearchParams(searchToken='',tagsToken='',tagsToken1='',tagsToken2='',tagsToken3='',tagsToken4='',filterName='completedIdeas',filterBackoffice=0,c1='',o1=-2,v1='',c2='',o2=-1,v2='',c3='',o3=-1,v3='',cvt='',cvr=0,cvy=0)/Results",sorter:new S("SUBMITTED_AT",true)}};var L={XS:{centerProfileContainer:"identityProfileFragment--identityProfile",centerTopContributorContainer:"topContributorFragment--topContributor",centerBlogContainer:"blogsFragment--blogCommunity",rightTopContributorContainer:undefined,leftProfileContainer:undefined},S:{leftProfileContainer:"identityProfileFragment--identityProfile",centerTopContributorContainer:"topContributorFragment--topContributor",centerBlogContainer:"blogsFragment--blogCommunity"},M:{leftProfileContainer:"identityProfileFragment--identityProfile",centerTopContributorContainer:"topContributorFragment--topContributor",centerBlogContainer:"blogsFragment--blogCommunity"},L:{leftProfileContainer:"identityProfileFragment--identityProfile",centerTopContributorContainer:"topContributorFragment--topContributor",centerBlogContainer:"blogsFragment--blogCommunity"},XL:{leftProfileContainer:"identityProfileFragment--identityProfile",rightTopContributorContainer:"topContributorFragment--topContributor",rightTopBlogContainer:"blogsFragment--blogCommunity"}};return C.extend("sap.ino.vc.home.CommunityHome",jQuery.extend({},I,V,b,T,R,d,O,g,{identityProfile:m,list:l,formatter:jQuery.extend({},O,c),initialFocus:["backofficeButton--backofficeToogle","identityProfileFragment--createIdea"],onInit:function(){C.prototype.onInit.apply(this,arguments);this.aBusyControls=[this.getView()];var D=H.getCommunityHomepageWidget();D.done(function(o){var w=o.RESULT[0]||{IS_VISIBLE:false,HTML_CONTENT:""};w.IS_VISIBLE=!!w.IS_VISIBLE;this.getView().setModel(new J(w),"widget");}.bind(this));},feedTitleLink:function(o,s){if(!isNaN(parseInt(o,10))){switch(s){case'CAMPAIGN':return O.navigationLink.apply(this,["campaign",{id:o}]);case'IDEA':return O.navigationLink.apply(this,["idea-display",{id:o}]);default:break;}}return undefined;},show:function(p){this._oParentView=p;this.setIdentityProfileBinding();this.bindViewData();},setIdentityProfileBinding:function(){this.bindIdentityProfile(this.byId("identityProfileFragment--identityProfile"),m.Community);if(this.getModel("data").getProperty(m.Community.PATH)){var o=this;this.getModel("data").read(m.Community.PATH,{success:function(){var B=o.byId("identityProfileFragment--identityProfileList").getBindingInfo("items");o.byId("identityProfileFragment--identityProfileList").bindItems(B);}});}},bindViewData:function(){this._bindCampaigns();this.setViewProperty("/IS_COMMUNITY_VIEW",true);var i;if(this.getModel("device").getProperty("/system/phone")){i=Object.keys(l)[0];}else{i=this.byId("ideasFragment--sapInoHomeIdeasButtons").getSelectedKey();}this._sIdeaViewKey=i||Object.keys(l)[0];this._bindIdeas(this._sIdeaViewKey);this._bindBlogs();},onResizeLayoutChange:function(o,n){var t=this;function s(j,N){for(var i=0;i<j.length;i+=1){if(i<N){j[i].setVisible(true);}else{j[i].setVisible(false);}}}function e(i){var j=t.byId(i);var k=j.getItems();switch(n){case"XL":if(i==="blogsFragment--blogsList"){s(k,3);}else{s(k,4);}break;case"L":s(k,4);break;case"M":s(k,3);break;case"S":s(k,2);break;case"XS":s(k,1);break;default:break;}}var h=this.getModel("device").getProperty("/system/phone");if(!h){e("ideasFragment--ideasList");e("blogsFragment--blogsList");}},_bindCampaigns:function(){var p="data>/CampaignSearchParams(searchToken='',"+"tagsToken='',"+"tagsToken1='',"+"tagsToken2='',"+"tagsToken3='',"+"tagsToken4='',"+"filterName='openCampaigns',"+"filterBackoffice=0)/Results";var o=this.byId("campaignsListFragment--campaignsCarousel");o.bindAggregation("pages",{path:p,template:this.createFragment("sap.ino.vc.home.fragments.CampaignBanner"),length:4,top:4,filters:[new F("STATUS_CODE","NE","sap.ino.config.CAMP_DRAFT")],sorter:new S("SUBMIT_TO",false)});},_bindIdeas:function(k){var i=this.getModel("device").getProperty("/system/phone");var e=a.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE")*1||a.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE_HIDE_PHASE_BAR")*1;var t=Number(e)?this.getFragment("sap.ino.vc.idea.fragments.CardListItemNoImage"):this.getFragment("sap.ino.vc.idea.fragments.CardListItem");var o={path:l[k].sPath,template:t,length:4,top:4,sorter:l[k].sorter,filters:l[k].filter};var h=this;var p="";var s="";var j="";var n="&$select(ID)";var B=a.hasCurrentUserPrivilege("sap.ino.ui::backoffice.access");var q="";if(B){q="/sap/ino/xs/rest/backoffice/odata.xsodata";}else{q="/sap/ino/xs/rest/community/odata.xsodata";}if(i){var r=this.byId("ideasFragment--ideasCarousel");r.bindAggregation("pages",o);p=a.getBackendRootURL()+q+r.mBindingInfos.pages.binding.sPath+"?$format=json";s=r.mBindingInfos.pages.binding.sFilterParams;j=r.mBindingInfos.pages.binding.sSortParams;}else{var u=this.byId("ideasFragment--ideasList");u.bindItems(o);u.attachEventOnce("updateFinished",function(E){h.onResizeLayoutChange(null,h._sCurrentLayout);});p=a.getBackendRootURL()+q+u.mBindingInfos.items.binding.sPath+"?$format=json";s=u.mBindingInfos.items.binding.sFilterParams;j=u.mBindingInfos.items.binding.sSortParams;}var v=this.byId("ideasFragment--panelTitle");v.setText(this.getText("HOMEPAGE_PANEL_IDEAS_"+k.toUpperCase()));p=p+"&"+j+"&"+s+n;var w=new J();w.setData({path:p});sap.ui.getCore().setModel(w,"ideaSearchParams");},_bindBlogs:function(){if(a.getCurrentUser().USER_ID){var i=this.getModel("device").getProperty("/system/phone");var p="data>/BlogSearchParams(searchToken='',"+"tagsToken='',"+"filterName='publishedBlogs')/Results";var B={path:p,template:this.getFragment("sap.ino.vc.blog.fragments.ListItemHome"),sorter:new S("PUBLISHED_AT",true),length:4,top:4};var t=this;if(i){var o=this.byId("blogsFragment--blogsCarousel");o.bindAggregation("pages",B);}else{var e=this.byId("blogsFragment--blogsList");if(e){e.bindItems(B);e.attachEventOnce("updateFinished",function(){t.onResizeLayoutChange(null,t._sCurrentLayout);});}}var h=this.byId("blogsFragment--panelBlogTitle");h.setText(this.getText("HOMEPAGE_PANEL_CAMPAIGN_BLOGS"));}},onIdeaListTypeSelect:function(e){this._sIdeaViewKey=e.getParameter("key")||e.getParameter("selectedItem")&&e.getParameter("selectedItem").getKey();this._bindIdeas(this._sIdeaViewKey);},onNavigateToIdeas:function(){if(!this._sIdeaViewKey){this.navigateTo("idealist");}else{this.navigateTo("idealistvariant",{variant:this._sIdeaViewKey});}},onNavigateToBlogs:function(){this.navigateTo("bloglist");},onNavigateToCampaigns:function(){this.navigateTo("campaignlistvariant",{variant:"open"});},onCampaignsListItemPress:function(e){var i=e.getSource();var o=i.getBindingContext("data");if(o){this.navigateTo("campaign",{id:o.getProperty("ID")});}},onCardItemPress:function(e){var i=e.getSource();var o=i.getAggregation("content")[0];o.getFocusDomRef().focus();},onCreateIdea:function(e){this.navigateTo("idea-create",{query:{campaign:e.getParameter("campaignId")}});},onOpenIdea:function(E){var i;if(E.getParameter("ideaId")){i=E.getParameter("ideaId");}else{try{if(E.getSource().getProperty("objectId")){i=E.getSource().getProperty("objectId");}}catch(e){i=E.getSource().getBindingContext("data").getProperty("ID");}}if(i){this.navigateTo("idea-display",{id:i});}},onIdeaCommentPress:function(E){var i;if(E.getParameter("ideaId")){i=E.getParameter("ideaId");}else{try{if(E.getSource().getProperty("objectId")){i=E.getSource().getProperty("objectId");}}catch(e){i=E.getSource().getBindingContext("data").getProperty("ID");}}if(i){this.navigateTo("idea-display",{id:i,query:{section:"sectionComments"}});}},onOpenCampaign:function(e){this.navigateTo("campaign",{id:e.getParameter("campaignId")});},getLayout:function(s){return L[s];},onBackofficeSettings:function(){if(this._oParentView){var o=this._oParentView.getController();if(o.onBackofficeSettings){o.onBackofficeSettings();}}},onNavigateToFeedList:function(){this.navigateTo("feedlist");},onOfficeToggle:function(){if(this._oParentView){var o=this._oParentView.getController();if(o.switchView){o.switchView();}}},onBlogItemPress:function(e){if(this._bIsTokenPressed){this._bIsTokenPressed=false;return;}var i=e.getSource();var o=i.getBindingContext("data");if(o){this.navigateTo("blog-display",{id:o.getProperty("ID")});}},onOpenCreator:function(e){var s=e.getSource();var i=s.getBindingContext("data").getProperty("CREATED_BY_ID");if(!this.oIdentityCardView){this.oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});this.getView().addDependent(this.oIdentityCardView);}this.oIdentityCardView.getController().open(s,i);},showPopupTagCard:function(e){this._bIsTokenPressed=true;if(!this._oPopover){this._oPopover=sap.ui.xmlfragment("sap.ino.vc.tag.fragments.TagCardPopover",this);this.getView().addDependent(this._oPopover);}var t=e.getSource();var p="/SearchTagsAll(searchToken='',ID="+t.getKey()+")";var D=this.getModel("data");var h=this;D.read(p,{async:true,success:function(o){var M=new sap.ui.model.json.JSONModel();M.setData(o);h._oPopover.setModel(M,"Tag");jQuery.sap.delayedCall(0,h,function(){h._oPopover.openBy(t);});}});}}));});
