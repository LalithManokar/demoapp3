sap.ui.define(["sap/ino/vc/commons/BaseVariantListController","sap/ui/Device","sap/ino/commons/formatters/ObjectListFormatter","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/commons/application/Configuration","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/controls/OrientationType","sap/m/MessageToast","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/commons/mixins/TagCardMixin"],function(B,D,O,S,J,F,a,C,T,b,M,c,d){"use strict";var o={ASC:"ASC",DESC:"DESC"};var s={NAME:"NAME"};var v={ALL:"all",OTHER:"other"};var f={NONE:undefined};var l={NAME:"TAG_LIST_TIT_NAME",ADJUSTMENT_TITLE:"TAG_LIST_TIT_ADJUSTMENT",Filter:{},Sorter:{Values:[{TEXT:"SORT_MIT_NAME",ACTION:s.NAME,DEFAULT_ORDER:o.ASC}]},Order:{Values:[{TEXT:"ORDER_MIT_ASC",ACTION:o.ASC},{TEXT:"ORDER_MIT_DESC",ACTION:o.DESC}]},Variants:{DEFAULT_VARIANT:v.ALL,TITLE:"TAG_LIST_TIT_VARIANTS",Values:[{TEXT:"TAG_LIST_MIT_TAGS",NAME:"TAG_LIST_MIT_TAGS",ACTION:v.ALL,FILTER:f.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true}]}};var L={TAG:"taglist",TAG_VARIANT:"taglistvariant"};var t=B.extend("sap.ino.vc.tag.List",jQuery.extend({},T,c,d,{routes:["taglist","taglistvariant"],initialFocus:"mainFilterButton",list:l,view:{"List":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.ALL,"Default":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.ALL}},"ORIENTATION":b.PORTRAIT,"DISABLE_ORIENTATION":true},onInit:function(){B.prototype.onInit.apply(this,arguments);this.oViewModel=this.getModel("view")||new J({});this.oViewModel.setData(this.view,true);},onRouteMatched:function(e,g){this.bindVariants();var V=this.getModel("view");V.setData(this.view,true);var q;var h;var i=this.getListProperty("/Variants/DEFAULT_VARIANT");if(e&&e.getParameter){var A=e.getParameter("arguments");this._sRoute=e.getParameter("name");q=A["?query"];h=A.variant;}else{this._sRoute=e;q=g;h=g.variant;}this.setViewProperty("/List/VARIANT",h||i);h=this.getViewProperty("/List/VARIANT");var j;var k=this.getVariant(h)||V.getProperty("/List/CURRENTVAR");if(!k){k={ACTION:h,DEFAULT_SORT:"NAME"};}var m=this.getList().isBound("items");if(!q||!q.sort){var n=k.DEFAULT_SORT;var p=this.getSort(n)[0].DEFAULT_ORDER;q=q||{};q.sort=q.sort||n;q.sort=q.sort+" "+(q.order||p);}var r=this.hasStateChanged(this._sRoute,h,q,D.orientation.portrait);if(!m||r){this.setParameters(q,k);j=this.getSort(this.getViewProperty("/List/SORT"));this.setSorter(j);this.updateFilter();this.setSortIcon(this.byId("panelFilterFragment--sortreverse"),this.getViewProperty("/List/ORDER"));this.bindList(q);this.initialSorterItems();}this._bInnerViewNavigation=true;this.setHelp("TAG_LIST");},bindList:function(q){this.saveState();this.setPath("data>/"+this.getBindingPath(q));B.prototype.bindList.apply(this);},bindVariants:function(){var p=C.getBackendRootURL()+"/sap/ino/xs/rest/common/tagGroupQuery.xsjs";var e=new J(p);var V=this.getDefaultVariantValue();var g=this;e.attachRequestCompleted(null,function(){var h=e.getData();if(h.length>0){h.push({TEXT:"TAG_LIST_MIT_OTHER",NAME:"TAG_LIST_MIT_OTHER",ACTION:v.OTHER,FILTER:f.NONE,DEFAULT_SORT:s.NAME,HIERARCHY_LEVEL:"1",VISIBLE:true});}h=V.concat(h);g.getModel("list").setProperty("/Variants/Values",h);},e);},getList:function(){return this.byId("objectlist");},getItemTemplate:function(){return this.getFragment("sap.ino.vc.tag.fragments.CardListItem");},getBindingPath:function(q){var e=q&&q.search||"";if(this.getFilter().length===0){return"SearchTagsAllParams(searchToken='"+e+"')/Results";}else{return"SearchTagsAllFullParams(searchToken='"+e+"')/Results";}},updateFilter:function(){var e=[];this.setFilter([]);var V=this.getViewProperty("/List/VARIANT");if(V===v.ALL){return;}else if(V===v.OTHER){var g=this.getModel("list").getProperty("/Variants/Values");jQuery.each(g,function(i,h){if(h.ACTION!==v.ALL&&h.ACTION!==v.OTHER){e.push(new F("GROUP_ID",a.NE,h.ACTION));}});}else{e.push(new F("GROUP_ID",a.EQ,this.getViewProperty("/List/VARIANT")));}this.addFilter(new F({filters:e,and:true}));},setParameters:function(q,V){B.prototype.setParameters.apply(this,arguments);},getDefaultVariantValue:function(){return[{TEXT:"TAG_LIST_MIT_TAGS",ACTION:v.ALL,NAME:"TAG_LIST_MIT_TAGS",FILTER:f.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true}];},follow:function(){M.show("test");}}));t.list=l;t.listContext=L;return t;});
