sap.ui.getCore().loadLibrary("sap.ino.wall");sap.ui.define(["sap/ino/vc/commons/BaseVariantListController","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ino/vc/commons/TopLevelPageFacet","sap/ui/core/mvc/ViewType","sap/ino/controls/OrientationType","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/commons/mixins/TagCardMixin","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/commons/mixins/GlobalSearchMixin","sap/ino/wall/Wall","sap/ino/vc/wall/util/WallFactory","sap/ino/commons/application/Configuration","sap/ino/vc/blog/mixins/BlogCardMixin","sap/ui/model/type/DateTime","sap/m/MessageToast","sap/ino/vc/idea/mixins/VolunteerMixin"],function(B,D,J,T,V,O,a,F,b,R,c,G,W,d,C,e,f,M,g){"use strict";return B.extend("sap.ino.vc.search.Global",jQuery.extend({},T,a,F,b,R,G,e,g,{routes:["search","searchcategory"],formatter:$.extend({variantTitle:function(){return"Search";}},c,B.prototype.formatter),onInit:function(){B.prototype.onInit.apply(this,arguments);},onBeforeHide:function(E){},onBeforeRendering:function(){},isGlobalSearch:function(){return true;},onRouteMatched:function(E,o){var p=E.getParameters();var s=p.arguments;var q=s['?query'];var v=this.getView();this.setViewProperty("/SEARCH_QUERY",q);this.setHelp("GLOBAL_SEARCH");if(!v.getBusy()){v.setBusy(true);}this.getSearchResult(q);},getSearchResult:function(h){var s=this;var v=this.getView();var p={keyword:h.search&&window.decodeURIComponent(h.search)||'',id:h.id||'',type:h.type||'',managed:h.managed};var i=$.get('xs/rest/common/search.xsjs',p);v.setBusy(true);i.done(function(r){s.setModel(new J(r),'data');s.bindSearchResult(r);v.setBusy(false);});i.fail(function(j){if(j){M.show(j);}v.setBusy(false);});i.error(function(j){if(j){M.show(j);}v.setBusy(false);});},bindSearchResult:function(r){var s=this;var h=this.getCampaignList();var i=this.getIdeaList();var t=this.getTagList();var u=this.getUserList();var w=this.getWallList();var j=this.getBlogList();if(r.Campaigns&&h){h.bindItems({path:'data>/Campaigns/data',template:s.getFragment("sap.ino.vc.campaign.fragments.CardListItem")});}if(r.Ideas&&i){var k=C.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE")*1;var l=k?this.getFragment("sap.ino.vc.idea.fragments.CardListItemNoImage"):this.getFragment("sap.ino.vc.idea.fragments.CardListItem");i.bindItems({path:'data>/Ideas/data',template:l});}if(r.Tags&&t){t.bindItems({path:'data>/Tags/data',template:s.getFragment('sap.ino.vc.tag.fragments.CardListItem')});}if(r.Users&&u){u.bindItems({path:'data>/Users/data',template:s.getFragment('sap.ino.vc.iam.fragments.IdentityListItem')});}if(r.Walls&&w){w.bindItems({path:'data>/Walls/data',template:s.getFragment('sap.ino.vc.wall.fragments.WallListItem')}).addStyleClass("sapInoWallListPreviewItems");s.bindWallList(w,r.Walls.data);var m=this.getWallList().getBinding("items");if(m){m.attachDataReceived(this.bindWallList,this);}}if(r.Blogs&&j){j.bindItems({path:'data>/Blogs/data',template:s.getFragment('sap.ino.vc.search.fragments.BlogListItem')}).addStyleClass('sapInoBlogList');}},bindWallList:function(l,h){var j=l.getItems();var h=h;var w=[];var s=this;s._oPreview2Wall=s._oPreview2Wall||{};for(var i=0;i<j.length;i++){var k=j[i].getAggregation("content")[1];var I=k.getBindingContext("data").getProperty("ID");var m=h.filter(function(o){return o.ID===I;});if(!k.getWallControl()){if(m&&m.length>0){w.push(I);var n=d.createWallFromInoJSON(m[0]);if(m[0].BACKGROUND_IMAGE_ATTACHMENT_ID){n.setBackgroundImage(C.getAttachmentDownloadURL(m[0].BACKGROUND_IMAGE_ATTACHMENT_ID));}s._oPreview2Wall[I]=n;k.setWall(n);k.invalidate();}}else if(!k.getWallControl().getItems().length){if(m&&m.length>0){w.push(I);}}}},getCampaignList:function(){return this.getView().byId('objectCampaignList');},getIdeaList:function(){return this.getView().byId('objectIdeaList');},getTagList:function(){return this.getView().byId('objectTagList');},getUserList:function(){return this.getView().byId('objectUserList');},getWallList:function(){return this.getView().byId('objectWallList');},getBlogList:function(){return this.getView().byId('objectBlogList');},getListController:function(){return this._oListController;},setListController:function(o){this._oListController=o;},getListView:function(){return this._oListView;},setListView:function(v){this._oListView=v;},displayListView:function(s){var v=this.getListView();if(s){v.removeStyleClass("sapInoMobileObjectListNotVisible");}else{if(!v.hasStyleClass("sapInoMobileObjectListNotVisible")){v.addStyleClass("sapInoMobileObjectListNotVisible");}}},enableListBinding:function(E){if(E){this.getListController().bindList=this.getListController().bindListCore;}else{this.getListController().bindList=function(){};}},onVariantBasePress:function(){var l=this.getListController();l.onVariantBasePress.apply(l,arguments);},onTagSelected:function(){var l=this.getListController();l.onTagSelected.apply(l,arguments);},onTagDeselected:function(){var l=this.getListController();l.onTagDeselected.apply(l,arguments);},onTagItemDeselectPress:function(){var l=this.getListController();l.onTagItemDeselectPress.apply(l,arguments);},getList:function(){return this.getListController()&&this.getListController().getList();},getPath:function(){return this.getListController()&&this.getListController()._sPath;},getItemTemplate:function(){return this.getListController()&&this.getListController().getItemTemplate();},getListLayout:function(){return this.byId("searchresults");},showMoreLink:function(r){return!!(r&&r.data&&r.counts>r.data.length);},onItemPress:function(h){var s=h.getSource();var i=s.getBindingContext('data');var p=h.getParameters();if(p.campaignId){this.navigateTo('campaign',{id:p.campaignId});}if(i.getProperty('WALL_TYPE_CODE')){this.navigateToWall("wall",{id:i.getProperty('ID')});}},onOpenCampaign:function(E){this.navigateTo("campaign",{id:E.getParameter("campaignId")});},onOpenIdea:function(h){var i=h.getSource();var j=i.getBindingContext("data");if(j){this.navigateTo("idea-display",{id:j.getProperty("ID")});}},onBlogItemPress:function(h){var I=h.getSource();var i=I.getBindingContext("data");if(i){this.navigateTo("blog-display",{id:i.getProperty("ID")});}},navigateToMore:function(h,i){var s=this.getModel('search');var j=s.getData();var k=j.searchAguments;var l=k['?query']&&k['?query'].search;var m={category:h,search:l,param:$.extend(k,i||{})};if(m.category&&m.param&&m.category==='idealist'){m.param['?query']=m.param['?query']||{};m.param['?query'].sort="SEARCH_SCORE DESC";}this._handleSearchNavgate(l,m);},goCampaigns:function(){this.navigateToMore('campaignlist');},goIdeas:function(){var h={};var i='idealist';var s=this.getModel('search');var j=s.getData();var k=j.searchAguments;var q=k&&k['?query'];var t=q&&q.type;if(t==='campaign'){h.id=q.id;i='campaign-idealist';}this.navigateToMore(i,h);},goTags:function(){this.navigateToMore('taglist');},goUsers:function(){this.navigateToMore('peoplelist');},goWalls:function(){this.navigateToMore('walllist');},goBlogs:function(){var s=this.getModel('search');var h=s.getData();var i=h.searchAguments&&h.searchAguments['?query']&&h.searchAguments['?query'].id;if(!i){return false;}this.navigateToMore('campaign-bloglist',{id:i});},isShown:function(h){return!!h&&!!h.data;},transToDate:function(s){var h=new Date(s);return h.toDateString();},showResultCount:function(t,n,r){var N=!!(r&&r.data&&r.counts>r.data.length);var h=t;var i=n||0;if(N){return h+'  ('+(i-1)+'+)';}else{return h+'  ('+i+')';}}}));});
