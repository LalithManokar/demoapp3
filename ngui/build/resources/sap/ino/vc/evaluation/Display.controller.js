sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ino/commons/models/object/Evaluation","sap/ino/vc/evaluation/EvaluationFacet","sap/m/MessageToast","sap/ui/model/json/JSONModel","sap/ino/commons/models/object/Attachment","sap/ino/vc/commons/TopLevelPageFacet"],function(B,E,a,M,J,A,T){"use strict";var b=A.getEndpointURL();return B.extend("sap.ino.vc.evaluation.Display",jQuery.extend({},T,a,{routes:["evaluation-display"],onInit:function(){B.prototype.onInit.apply(this,arguments);if(!this.getModel("local")){this.setModel(new J({ATTACHMENT_UPLOAD_URL:b}),"local");}this.setModel(new J({EVAL_REWORK:"sap.ino.config.EVAL_REWORK",V_REWORK:false,EVAL_PUB_SUBMITTER:"sap.ino.config.EVAL_PUB_SUBMITTER",V_PUB_SUBMITTER:false,EVAL_PUB_COMMUNITY:"sap.ino.config.EVAL_PUB_COMMUNITY",V_PUB_COMMUNITY:false,EVAL_UNPUBLISH:"sap.ino.config.EVAL_UNPUBLISH",V_UNPUBLISH:false}),"status");var v=this.getModel("view");if(!v){v=new J({});this.setModel(v,"view");}v.setProperty("/IDEA_NAVIGATION_SECTION","sectionEvaluations");v.setProperty("/EDIT_MODE",false);this.aBusyControls=[this.byId("evaluationLayout")];this.initMatrixControl();this.scrollDockElement("evaluationDisplay","evaluationMatrix");this._sResizeEvalList=this.attachListControlResized(this.byId("criteriaList"));},onExit:function(){B.prototype.onExit.apply(this,arguments);this.detachListControlResized(this._sResizeEvalList);},resetStatusModel:function(){var s=this.getModel("status");s.setProperty("/V_REWORK",false);s.setProperty("/V_PUB_COMMUNITY",false);s.setProperty("/V_PUB_SUBMITTER",false);s.setProperty("/V_UNPUBLISH",false);},setStatusChangeButtons:function(){var n=this.getObjectModel()&&this.getObjectModel().getPropertyModel().getData().actions.executeStatusTransition.customProperties&&this.getObjectModel().getPropertyModel().getData().actions.executeStatusTransition.customProperties.statusTransitions;if(!n){return;}this.resetStatusModel();var s=this.getModel("status");jQuery.each(n,function(i,k){switch(k.STATUS_ACTION_CODE){case"sap.ino.config.EVAL_REWORK":s.setProperty("/V_REWORK",true);break;case"sap.ino.config.EVAL_PUB_SUBMITTER":s.setProperty("/V_PUB_SUBMITTER",true);break;case"sap.ino.config.EVAL_PUB_COMMUNITY":s.setProperty("/V_PUB_COMMUNITY",true);break;case"sap.ino.config.EVAL_UNPUBLISH":s.setProperty("/V_UNPUBLISH",true);break;default:break;}});},onRouteMatched:function(e){B.prototype.onRouteMatched.apply(this,arguments);var t=this;var o=this.getObjectModel();o.getDataInitializedPromise().done(function(){t.setHelp("EVALUATION_DISPLAY");});o.getPropertyModel().attachEvent("modelInitialized",function(){t.setStatusChangeButtons();});this.bindMatrix();},createObjectModel:function(o){return new E(o,{actions:["update","del","executeStatusTransition","submit"],continuousUse:true,readSource:{model:this.getDefaultODataModel(),groupSetting:{EvalAttachments:"IdeaEvalAttachments"}}});},onExecuteStatusTransition:function(e){var t=this;var c=this.getObjectModel();var d;if(!c){return;}var s=e.getSource().getCustomData()[0].getValue();var i=s==="sap.ino.config.EVAL_REWORK";d=c.executeStatusTransition({STATUS_ACTION_CODE:s,IDEA_ID:c.getProperty("/IDEA_ID")});if(d){d.done(function(){M.show(t.getText("OBJECT_MSG_STATUS_CHANGE_SUCCESS"));if(i){t.resetStatusModel();t.setObjectModel(undefined);t.onNavBack(true);}});d.fail(function(o){if(i){t.onNavBack(true);}if(o.MESSAGES&&o.MESSAGES.length>0){M.show(t.getText(o.MESSAGES[0].MESSAGE_TEXT));}});}},onEdit:function(){this.navigateTo("evaluation-edit",{id:this.getObjectModel().getKey()});},onClose:function(){this.navigateBack();}}));});
