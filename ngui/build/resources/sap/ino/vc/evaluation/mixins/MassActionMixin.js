sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/core/MessageType","sap/ui/core/message/Message","sap/m/MessageToast","sap/ino/commons/application/Configuration","sap/ino/commons/models/object/EvaluationRequestItem","sap/ino/vc/commons/BaseController"],function(F,a,S,M,b,c,C,E,B){"use strict";var d=function(){throw"Mixin may not be instantiated directly";};d._addForwardExpertInputHandling=function(o,s){if(!o){return;}var t=this;var f=t._createSuggestHandler(s.suggestion);o.attachSuggest(f,t);};d._createForwardDialog=function(){if(!this._oRequestForwardDialog){this._oRequestForwardDialog=this.createFragment("sap.ino.vc.evaluation.fragments.RequestForward",this.getView().getId());this.getView().addDependent(this._oRequestForwardDialog);}return this._oRequestForwardDialog;};d._createObjectModel=function(){var t=this.getList();var o=t.getContextByIndex(t.getSelectedIndex()).getProperty("ID");return new E(o,{actions:["update","del","executeStatusTransition","sendClarification","forward"],continuousUse:true,readSource:{model:this.getDefaultODataModel()}});};d._executeStatusTransition=function(s){var t=this;this._oModel=this._createObjectModel();var A=this._oModel.executeStatusTransition({STATUS_ACTION_CODE:s});if(A){A.done(function(){c.show(t.getText("OBJECT_MSG_STATUS_CHANGE_SUCCESS"));});A.fail(function(o){if(o.MESSAGES&&o.MESSAGES.length>0){c.show(t.getText(o.MESSAGES[0].MESSAGE_TEXT));}});}};d.onAccept=function(){this._executeStatusTransition("sap.ino.config.EVAL_REQ_ACCEPT");};d.onReject=function(){this._executeStatusTransition("sap.ino.config.EVAL_REQ_REJECT");};d.onForward=function(){var r=this._createForwardDialog();r.open();if(!this._oModel){this._oModel=this._createObjectModel();}this._addForwardExpertInputHandling(this.byId("inputForwardExpert"),{suggestion:{key:"ID",text:"NAME",additionalText:"USER_NAME",path:"data>/SearchIdentity(searchToken='$suggestValue')/Results",filters:[new F({path:"ID",operator:a.NE,value1:C.getCurrentUser().USER_ID})],sorter:new S("NAME")},token:{key:"IDENTITY_ID",text:"NAME"}});};d.onForwardClose=function(){if(!this._oModel){this._oModel=this._createObjectModel();}this._oModel.oData.Forwards=[];this._oRequestForwardDialog.close();this.byId("inputForwardExpert").removeAllTokens();this.byId("txtAreaForwardReasonDes").setValue("");};d.onSubmitForward=function(){var t=this;if(!this._oModel){this._oModel=this._createObjectModel();}var f=t.byId("inputForwardExpert").getTokens();var T=t.byId("inputForwardExpert").getValue();if(f.length>0&&!T){t._createForwardDialog();var i=parseInt(f[0].mProperties.key,10);var o=t.executeObjectAction(this._oModel,"forward",{parameters:{EXPERT_ID:i,COMMENT_FORWARD:t.byId("txtAreaForwardReasonDes").getValue().trim()},messages:{success:"EVALUATIONREQUESTS_MSG_FORWARD_SUCCESS",error:"EVALUATIONREQUESTS_MSG_FORWARD_FAILURE"}});o.done(function(){t._oRequestForwardDialog.close();t.byId("inputForwardExpert").removeAllTokens();t.byId("txtAreaForwardReasonDes").setValue("");});o.always(function(){t._oRequestForwardDialog.setBusy(false);});}else{t.setClientMessage(new b({code:"EVALUATIONREQUESTS_MSG_FORWARD_NO_EXPERT",type:M.Error}),t.byId("inputForwardExpert"));t.byId("inputForwardExpert").setValue("");}};d.onCreateEvaluation=function(){var t=this.getList();var i=t.getContextByIndex(t.getSelectedIndex()).getProperty("IDEA_ID");this.navigateTo("evaluation-create",{query:{ideaId:i}});};d.onMassDelete=function(e){var s=e.getSource();var t=this.getList();var f=t.getSelectedIndices();var g=[];if(f.length){for(var i=0;i<f.length;i++){g.push(t.getContextByIndex(f[i]).getProperty("ID"));}}var h=this;var D=B.prototype.executeObjectAction.call(h,E,"bulkDeleteItems",{staticparameters:{"EVAL_REQ_ITEM_ID":g},messages:{confirm:"MSG_DEL_CONFIRM",success:"MSG_DEL_SUCCESS"}});D.done(function(r){if(r&&r.confirmationCancelled===true){if(s&&jQuery.type(s.focus)==="function"){s.focus();}return;}if(h.bindList&&typeof(h.bindList)==="function"){h.bindList();}});};d.resetActionState=function(){var t=this;var e=["sapInoAcceptBtn","sapInoRejectBtn","sapInoFowardBtn","sapInoCreateBtn","sapInoMassDeleteBtn"];jQuery.each(e,function(i,s){var o=t.byId(s);if(o){o.setEnabled(false);}});};return d;});
