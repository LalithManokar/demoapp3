/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.getCore().loadLibrary("sap.ino.wall");sap.ui.define(["sap/ino/vc/commons/BaseVariantListController","sap/ui/Device","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/wall/WallMixin","sap/ino/vc/attachment/AttachmentMixin","sap/ui/model/json/JSONModel","sap/ino/commons/models/object/Attachment","sap/ino/commons/application/Configuration","sap/m/MessageToast"],function(B,D,O,W,A,J,a,C,M){"use strict";var v={MY:"my",SHARED:"shared"};var f={NONE:"myWalls",MY:"myWalls",SHARED:"sharedWalls"};var b=a.getEndpointURL();return B.extend("sap.ino.vc.internal.InternalWall",jQuery.extend({},W,{routes:[],list:{"Variants":{},"Picker":{"Variants":{"Values":[{"TEXT":"WALL_LIST_MIT_MY","ACTION":v.MY,"FILTER":f.MY},{"TEXT":"WALL_LIST_MIT_SHARED","ACTION":v.SHARED,"FILTER":f.SHARED}]}}},view:{"Picker":{"VARIANT":undefined},"EDITABLE":undefined},formatter:O,objectListFormatter:O,onInit:function(){var t=this;this._wallMixinInit({wallId:"interalwalllistinidea",wallBindPath:"object>/InternalWalls",wallAddAction:function(o,w){o.addInternalWall(w);},wallRemoveAction:function(o,w){o.removeInternalWall(w.getStorageId());o.update();},wallData:function(o){return o.getProperty("/InternalWalls");}});this.getList().addStyleClass("sapInoWallListPreviewItems");B.prototype.onInit.apply(this,arguments);if(!this.getModel("local")){this.setModel(new J({ATTACHMENT_UPLOAD_URL:b}),"local");}},onBeforeRendering:function(){this.view.EDITABLE=true;var V=this.getModel("view");V.setData(this.view,true);this._bindList();var o=this.getList().getBinding("items");if(o){this._updateWallPreviewControls();}},onAfterRendering:function(){this._attachmentMixinInit({attachmentId:"InternalAttachments",updateObject:function(o){o.update();},uploadSuccess:function(o,r){o.addInternalAttachment({"CREATED_BY_NAME":C.getCurrentUser().NAME,"ATTACHMENT_ID":r.attachmentId,"FILE_NAME":r.fileName,"MEDIA_TYPE":r.mediaType,"CREATED_AT":new Date()});o.update().fail(function(){o.getMessageParser().parse(r);M.show(this.getText("OBJECT_MSG_ATTACHMENT_FAILED"));return true;});}});},getVariantsPopover:function(){if(!this._getWallPickerDialog().isActive()){return B.prototype.getVariantsPopover.apply(this,arguments);}else{if(!this._oPickerVariantPopover){this._oPickerVariantPopover=sap.ui.xmlfragment("sap.ino.vc.wall.fragments.PickerListVariants",this);this.getView().addDependent(this._oPickerVariantPopover);}return this._oPickerVariantPopover;}},getVariant:function(s){if(!this._getWallPickerDialog().isActive()){return B.prototype.getVariant.apply(this,arguments);}else{return this._getListDefinitionEntry(s,"ACTION","/Picker/Variants/Values");}},onVariantPress:function(V,e){this.setViewProperty("/Picker/VARIANT",V);var w=this._getWallPickerView();if(w){w.getController().setViewProperty("/List/VARIANT",V);w.invalidate();}},_onVariantPress:function(e){var i=e.getSource();var c=i.getBindingContext("list");var s;var o;if(c){o=c.getObject();s=o?o.ACTION:undefined;}this.onVariantPress(s,e);var p=this.getVariantsPopover();if(typeof p.close==="function"){p.close();}},onWallPicked:function(w){this._bindList();var o=this.getList().getBinding("items");var i=this.getModel("object");if(o){var t=this;i.update().done(function(){t._updateWallPreviewControls();});}}}));});
