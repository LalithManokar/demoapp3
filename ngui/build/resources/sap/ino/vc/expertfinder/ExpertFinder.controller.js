sap.ui.define(["sap/ino/vc/commons/BaseController","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/ino/vc/commons/TopLevelPageFacet","sap/ui/Device","sap/ui/core/ListItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/vc/commons/mixins/ClipboardMixin","sap/ino/vc/commons/mixins/IdentityQuickviewMixin"],function(B,C,J,T,D,L,F,a,b,I){"use strict";return B.extend("sap.ino.vc.expertfinder.ExpertFinder",jQuery.extend({},T,b,I,{routes:["expertfinder"],view:{INPUT:"",IDEACARD_SECTION_VISIBLE:'TAG',Tags:[]},onRouteMatched:function(e){var v=this.getView();this.view.Tags=[];v.setModel(new J(this.view),"view");var E=new J({});var c=this.getModel("user").getProperty("/privileges")["sap.ino.ui::backoffice.access"];if(!c){this.navigateTo("home");return;}v.setModel(E,"proposedExperts");this.displayExpertDetail(false);this.setHelp("EXPERT_FINDER");var A=this.getModel("config").oData["sap.ino.config.EXPERT_FINDER_ACTIVE"];this.setObjectExists(c&&(A==="1"));},displayExpertDetail:function(d){var e=this.getView().byId("expertDetailContainer");e.toggleStyleClass("sapInoInvisible",!d);var E=this.getView().byId("expertGraphContainer");E.toggleStyleClass("sapInoExpertGraphContainerDetail",d);E.toggleStyleClass("sapInoExpertGraphContainer",!d);},onSuggestTag:function(e){var c=e.getSource();var t=this;var v=e.getParameter("suggestValue");var o=new L({key:"{data>ID}",text:"{data>NAME}"});var s="/SearchIdeaTagsParams(searchToken='"+jQuery.sap.encodeURL(v)+"')/Results";var f=this._getSuggestionItemsFilter(this.view.Tags);c.bindAggregation("suggestionItems",{path:"data>"+s,filters:f,template:o});},_getSuggestionItemsFilter:function(e){var f=[];jQuery.each(e,function(i,t){var o=new F({path:"NAME",operator:a.NE,value1:t.NAME});f.push(o);});return(f.length===0)?[]:[new F(f,true)];},onAddTag:function(e){var v=this.getView();var V=v.getModel("view");var i=this.byId("suggestTag");var s;var r=jQuery.grep(i.getSuggestionItems(),function(S){return S.getText().toLowerCase()===i.getValue().toLowerCase();});if(r.length>0){s=r[0];this.view.INPUT=s.getText();}var n={TAG_ID:s&&s.getKey(),NAME:s&&s.getText()};if(n.NAME&&n.NAME.length!==0){var t=V.getProperty("/Tags");var d=jQuery.grep(t,function(o){return o.NAME.toLowerCase()===n.NAME.toLowerCase();});if(d.length===0){t.push(n);V.setProperty("/Tags",[]);V.setProperty("/Tags",t);var u=this._getExpertUrl(this.view.Tags);v.getModel("proposedExperts").loadData(u);v.getModel("proposedExperts").refresh();}i.setValue("");i.setValueState("None");i.focus();}else if(i.getValue().length!==0){i.setValueState("Error");}},onChangeTag:function(e){var v=this.getView();var V=v.getModel("view");if(e.getParameter("type")==="removed"){var t=e.getParameter("token");var r={TAG_ID:t&&t.getKey(),NAME:t&&t.getText()};if(r.NAME){var c=jQuery.grep(V.getProperty("/Tags"),function(o){return o.NAME!==r.NAME;});V.setProperty("/Tags",[]);V.setProperty("/Tags",c);if(this.view.Tags.length>0){var u=this._getExpertUrl(this.view.Tags);v.getModel("proposedExperts").loadData(u);}else{v.getModel("proposedExperts").setData({});this.bindExpert(null);this.displayExpertDetail(false);}}}},_getExpertUrl:function(o){var s=o.map(function(t){return t.NAME;});var u=C.getIdeaExpertsByTagsURL(s);return u;},bindExpert:function(e){var v=this.getView();var p=this.getView().byId("expertDetails");var s=jQuery.map(v.getModel("proposedExperts").getData(),function(o,i){if(o.ID===e.PERSON_ID){return i;}});if(s.length>0){p.bindElement("proposedExperts>/"+s[0]);}else{p.unbindElement("proposedExperts");}},onClickNode:function(e){if(e.getParameters().group&&e.getParameters().group!=="0"){var E=e.getParameters();this.bindExpert(E);this.displayExpertDetail(true);}},onOpenIdea:function(e){if(D.system.phone){this.getView().getParent().close();}var c=e.getSource().getBindingContext("proposedExperts");var i=c.getProperty("IDEA/ID");if(i){this.navigateTo("idea-display",{id:i});}},onExpertExpand:function(e){var c=e.getSource().getParent();c.toggleStyleClass("sapInoIdeaExpertItemSelected");},isExpertActionable:function(){return false;},isExpertAddedForDialog:function(){return false;},}));});
