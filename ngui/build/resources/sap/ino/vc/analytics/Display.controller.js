sap.ui.define(["sap/ino/vc/commons/BaseObjectModifyController","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/commons/application/Configuration","sap/ui/model/odata/ODataModel","sap/ui/comp/smartfilterbar/ControlConfiguration","sap/ui/comp/smartfilterbar/SelectOption","sap/m/FlexItemData","sap/m/SegmentedButtonItem","sap/ui/comp/smartfilterbar/SmartFilterBar","sap/ui/comp/smarttable/SmartTable","sap/ui/comp/smartchart/SmartChart","sap/ino/commons/models/object/Report","sap/ino/commons/util/ReportUtil","sap/ui/core/MessageType","sap/ui/core/message/Message","sap/m/Label","sap/m/LabelDesign","sap/ino/vc/commons/mixins/ExportMixin","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/m/FlexBox","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(B,T,C,O,a,S,F,b,c,d,e,R,f,M,g,L,h,E,V,H,k,J,l){"use strict";return B.extend("sap.ino.vc.analytics.Display",jQuery.extend({},T,E,{routes:["report"],onInit:function(){B.prototype.onInit.apply(this,arguments);this.oFlexItemData=new F({growFactor:0});this.oFlexItemLayoutData=new F({growFactor:1});this.oVBox=this.byId("oVBox");this.oSegmentedButton=this.byId("segmentedButton");},onRouteMatched:function(o){var i=this.getModel("user").getProperty("/privileges")["sap.ino.ui::backoffice.access"];if(!i){this.navigateTo("home");return;}this.initFullScreen();this.setHelp("REPORT_DISPLAY");var j=this;var p=o.getParameter("arguments").code;this.sCampaignId=null;if(o.getParameter("arguments")["?query"]){this.sCampaignId=o.getParameter("arguments")["?query"].campaign;}this.oObjectContext={chartVisible:!C.getPersonalize().REPORT_VIEW,tableVisible:!!C.getPersonalize().REPORT_VIEW,saveButtonEnabled:true,otbFooterVisible:true,listBoxVisible:false,VBoxVisible:false,datePickerVisible:false};this.setModel(new J(this.oObjectContext),"objectContext");if(this.oSegmentedButton.getItems()&&this.oSegmentedButton.getItems().length>0){this.oSegmentedButton.destroyItems();this.oSegmentedButton.destroyButtons();}this.initModel(p);if(this.oConfiguration.Views.length>1){jQuery.each(this.oConfiguration.Views,function(m,v){var n=new b({text:"{i18n>"+v.DisplayName+"}",key:m,width:"200px"});j.oSegmentedButton.addItem(n);});}var I=this.oVBox.getItems();if(I.length>0){this.oVBox.removeAllItems();}j.aTempParameter=[];j.iParameterIndex=0;if(f.checkMandatoryParameters(this.oConfiguration)){this.freshViews(this.oConfiguration.SelectedView);}},initModel:function(p){var o=this;p="/"+p;if(this.getOwnerComponent().getModel("data").getProperty(p)){this.oConfig=this.getOwnerComponent().getModel("data").getProperty(p);this.oConfiguration=JSON.parse(this.oConfig.CONFIG);f.deleteSorterInConfig(this.oConfiguration);o.onAfterShow();}else{var s=C.getApplicationPath("sap.ino.config.URL_PATH_OD_BACKOFFICE");var D=new sap.ui.model.odata.ODataModel(C.getBackendRootURL()+"/"+s);D.read(p,{async:false,success:function(i){o.oConfig=i;o.oConfiguration=JSON.parse(i.CONFIG);f.deleteSorterInConfig(o.oConfiguration);o.onAfterShow();}});}this.iSelectedView=this.oConfiguration.SelectedView;this.oSegmentedButton.setSelectedKey(this.iSelectedView.toString());this.oChartPage=this.byId("chartPage");this.oSaveButton=this.byId("saveButton");if(parseInt(this.oConfig.ID,0)<0){this.getModel("objectContext").setProperty("/saveButtonEnabled",false);}else{this.getModel("objectContext").setProperty("/saveButtonEnabled",true);}this.oModel=this.createModel(parseInt(this.oConfig.ID,0),this.oConfig.CODE);this.setObjectModel(this.oModel);if(this.sCampaignId){this.oConfiguration.Parameters.Campaign.Selection.push(this.sCampaignId);this.oTemplateDataRequest.done(function(){o.getObjectModel().getProperty("/CONFIG").Parameters.Campaign.Selection.push(o.sCampaignId);});}this._oSeletedTableView=0;},onSaveAs:function(){this.getDialog().open();this.byId('reportTitle').setValue(this.oChartPage.getText());},onSave:function(){var o=this;this.storeConfiguration();this.getObjectModel().setConfiguration(this.oConfiguration);var r=this.executeObjectAction("modify");r.always(function(){o.setBusy(false);});},getDialog:function(){if(!this._oDialog){this._oDialog=this.createFragment("sap.ino.vc.analytics.fragments.Dialog");this.getView().addDependent(this._oDialog);}return this._oDialog;},onSubmit:function(){var o=this;this.storeConfiguration();this.oConfiguration.Title=this.byId('reportTitle').getValue();var s={continuousUse:true,actions:["modify"],readSource:{model:this.getDefaultODataModel()}};o.oModel=new R(-1,s);o.oModel.setProperty("/ID",-1);o.oModel.setConfiguration(this.oConfiguration);o.setObjectModel(o.oModel);var D=this.getDialog();D.setBusy(true);o.resetClientMessages();var r=o.executeObjectAction("create");r.done(function(){D.close();o.oChartPage.setText(o.oConfiguration.Title);o.oSaveButton.setEnabled(true);o.getModel("objectContext").setProperty("/saveButtonEnabled",true);});r.fail(function(){});r.always(function(){D.setBusy(false);});},onCancel:function(){this._oDialog.close();},createModel:function(i,s){var o={continuousUse:true,actions:["modify"],readSource:{model:this.getDefaultODataModel()}};this.oModel=new R(i,o);if(s!==undefined&&s!==null){if(!i||i<0){this.oTemplateDataRequest=this.oModel.setDataFromTemplate(s,this.getDefaultODataModel());}}if(!i||i<0){this._bSaveAllowed=false;}else{this._bSaveAllowed=true;}this.oModel.setAfterInitChanges();return this.oModel;},onNavigateToChart:function(){var t=this;var r=this.checkSelectedClumns();if(r.errors.length>0){l.error(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("P13NDIALOG_VALIDATION_CHARTTYPE"),{icon:l.Icon.ERROR,actions:[l.Action.CLOSE],onClose:function(D){t.byId("typeSegmentedButton").setSelectedButton(t.byId("navigateToTable"));t.getModel("objectContext").setProperty("/chartVisible",false);t.getModel("objectContext").setProperty("/tableVisible",true);}});}else{this.getModel("objectContext").setProperty("/chartVisible",true);this.getModel("objectContext").setProperty("/tableVisible",false);this.oSmartChart.applyVariant(this._convertTableSetingToChart());}this._oSeletedTableView=0;},checkSelectedClumns:function(){var s=this.oSmartChart.getChart().getChartType();var D=[];var m=[];var i=this.oSmartChart.getChart().mAggregations.dimensions;var j=this.oSmartChart.getChart().mAggregations.measures;var n=this.oSmartTable.getTable().mAggregations.columns;jQuery.each(n,function(o,p){if(p.getProperty("visible")){jQuery.each(i,function(q,t){if(t.getProperty("name")===p.getProperty("leadingProperty")){D.push({"name":t.getProperty("name")});}});jQuery.each(j,function(q,t){if(t.getProperty("name")===p.getProperty("leadingProperty")){m.push({"name":t.getProperty("name")});}});}});sap.ui.getCore().loadLibrary("sap.chart");var r=sap.chart.api.getChartTypeLayout(s,D,m);return r;},onNavigateToTable:function(){var o=this.getModel("objectContext");o.setProperty("/chartVisible",false);o.setProperty("/tableVisible",true);this._convertChartSetingToTable();this._oSeletedTableView=1;},_formatChartType:function(s){var i="";if(s&&s.indexOf("_")>=0){var j=s.split("_").reverse();jQuery.each(j,function(I,m){var n=m.replace(/^(\w)(\w+)/,function(v,o,p){return o.toUpperCase()+p.toLowerCase();});i+=n;});if(i.indexOf("Horizontal")>=0){i=i.replace("Horizontal","");}if(i.indexOf("Vertical")>=0){i=i.replace("Vertical","");}}else{if(s!=="heatmap"){i=s;}else{i="HeatMap";}}return i;},onSelect:function(o){this.storeConfiguration();this.iSelectedView=parseInt(o.getParameters().key,0);this.oConfiguration.SelectedView=this.iSelectedView;this.freshViews(this.iSelectedView);},freshViews:function(s){var i=this.getModel("objectContext").getProperty("/chartVisible")?0:1;var t=this.byId("typeSegmentedButton");t.setSelectedButton(t.getButtons()[i]);this.getModel("objectContext").setProperty("/otbFooterVisible",true);this.sChartType=this.oConfiguration.Views[s].Chart.Type;this.aDimensions=this.oConfiguration.Views[s].Dimensions;this.aMeasures=this.oConfiguration.Views[s].Measures;var I=this.oVBox.getItems();if(I.length>0){this.oVBox.removeAllItems();}var o=new c({showClearButton:true,layoutData:this.oFlexItemData,visible:false});var A=this.oConfiguration.DataSource+"Type";o.setEntityType(A);var G={};jQuery.each(this.oConfiguration.Parameters,function(w,P){if(P.hasOwnProperty("groupKey")&&P.groupKey){G[P.groupKey]=G[P.groupKey]||[];G[P.groupKey].push(P);return true;}var x=new a({key:P.Key,label:"{i18n>"+P.DisplayName+"}",visibleInAdvancedArea:true});jQuery.each(P.Selection,function(y,z){if(z){var D=new S({low:z});x.addDefaultFilterValue(D);}else{return true;}});o.addControlConfiguration(x);});jQuery.each(G,function(K,w){var x=new a({key:K,label:"{i18n>"+w[0].groupName+"}",visibleInAdvancedArea:true});var y=new S({low:w[0].Selection,high:w[1].Selection+"T23:59:59",operator:"BT"});x.addDefaultFilterValue(y);o.addControlConfiguration(x);});this.oSmartChart=new e({useChartPersonalisation:true,enableAutoBinding:true,layoutData:this.oFlexItemLayoutData,useVariantManagement:true,visible:"{objectContext>/chartVisible}"});if(this.aMeasures&&this.aMeasures.length===0){this.getModel("objectContext").setProperty("/chartVisible",false);this.getModel("objectContext").setProperty("/tableVisible",true);this.byId("typeSegmentedButton").setSelectedButton(this.byId("navigateToTable"));this._oSeletedTableView=1;}var j=o.getId();this._sSmartFilterBarId=j;this.oSmartChart.setSmartFilterId(j);this.oSmartChart.setEntitySet(this.oConfiguration.DataSource);this.oConfiguration.SelectedView=this.iSelectedView;var m=this.oConfiguration.ODataPath||C.getApplicationPath("sap.ino.config.URL_PATH_OD_ANALYTICS");var p={json:false,loadAnnotationsJoined:true};var n=new O(C.getBackendRootURL()+"/"+m,p);n.addAnnotationXML(f.getAnnotationXML(this.oConfiguration));var v=this.getView();v.setModel(n);var q={sort:{sortItems:[]},filter:{filterItems:[]}};if(this.oConfiguration.Views[s].hasOwnProperty("Sorter")&&this.oConfiguration.Views[s].Sorter){this.oConfiguration.Views[s].Sorters=[{columnKey:this.oConfiguration.Views[s].Sorter.Path,operation:this.oConfiguration.Views[s].Sorter.Descending?"Descending":"Ascending"}];delete this.oConfiguration.Views[s].Sorter;}if(this.oConfiguration.Views[s].Sorters){q.sort.sortItems=this.oConfiguration.Views[s].Sorters;}if(this.oConfiguration.Views[s].Filters){q.filter.filterItems=this.oConfiguration.Views[s].Filters;}this.oSmartChart.attachInitialise(null,function(){this.oSmartChart.applyVariant(q);},this);this.oVBox.addItem(o);this.oVBox.addItem(this.oSmartChart);var r=this;setTimeout(function(){var w=r.oSmartChart.getChart();if(w){w.setUiConfig({applicationSet:"fiori"});}},0);var u="";jQuery.each(this.oConfiguration.Views[s].Dimensions,function(w,D){u+=(D+",");});if(this.oConfiguration.Views[s].SecondaryDimensions){jQuery.each(this.oConfiguration.Views[s].SecondaryDimensions,function(w,D){u+=(D+",");});}jQuery.each(this.oConfiguration.Views[s].Measures,function(w,x){u+=(x+",");});if(this.oConfiguration.Views[s].SecondaryMeasures){jQuery.each(this.oConfiguration.Views[s].SecondaryMeasures,function(w,x){u+=(x+",");});}u=u.substring(0,u.length-1);this._createSmartTable(u);},_createSmartTable:function(v){if(this.oSmartTable){this.oVBox.removeItem(this.oSmartTable);this.oSmartTable=undefined;}this.oSmartTable=new d({entitySet:this.oConfiguration.DataSource,smartFilterId:this._sSmartFilterBarId,tableType:"AnalyticalTable",useExportToExcel:true,useVariantManagement:false,useTablePersonalisation:true,header:"Views",showRowCount:true,enableAutoBinding:true,initiallyVisibleFields:v,ignoredFields:"ID",ignoreFromPersonalisation:"ID",layoutData:this.oFlexItemLayoutData,visible:"{objectContext>/tableVisible}"});this.oSmartTable.attachInitialise(function(){console.log(this.oSmartTable.getTable().getColumns());},this);this.oSmartTable.attachBeforeRebindTable(function(){console.log(this.oSmartTable.getTable().getColumns());},this);this.oVBox.addItem(this.oSmartTable);},fnGetFilter:function(p){var o=this,m=[];for(var i=0;i<o.aTempParameter.length;i++){var P=o.aTempParameter[i];if(p.Key==="CAMPAIGN_ID"||P.Key.indexOf("SUBMISSION_DATE_")>-1){continue;}var n=[];for(var j=0;j<P.Selection.length;j++){n.push(new sap.ui.model.Filter(P.Key,"EQ",P.Selection[j]));}if(n.length>0){m.push(new sap.ui.model.Filter(n,false));}}var r;if(m.length>0){r=new sap.ui.model.Filter(m,true);}return r;},fnBindData:function(p,D){var o=this,v=o.getView(),i=o.byId("listBox");i.setAllowMultiSelect(p.Multiselect);var j=new sap.ui.core.ListItem({key:"{"+p.Key+"}",text:"{"+p.Text+"}"});var m=o.fnGetFilter(p);i.bindAggregation("items",{path:"/"+(D||o.oConfiguration.DataSource),filters:m,parameters:{select:p.Key+","+p.Text},template:j,sorter:new sap.ui.model.Sorter(p.Text,false)});if(p.Selection!==undefined&&p.Selection!==null&&p.Selection.length>0){i.getBinding("items").attachDataReceived(function(){i.setBusy(false);i.setSelectedKeys(p.Selection);});}var n=jQuery("#"+v.createId("listBox-list"));n.attr("aria-require",p.Mandatory||false);},_setListBox:function(o){var i=this,D,p,j=i.byId("listBox"),m=this.getParameterDialog(),P=o.Parameters,n=jQuery.map(P,function(v){return[v];});var s=o.ODataPath||C.getApplicationPath("sap.ino.config.URL_PATH_OD_ANALYTICS");if(n&&n[i.iParameterIndex]&&n[i.iParameterIndex].Key&&n[i.iParameterIndex].Key==="CAMPAIGN_ID"){D="AuthCampaignReports";p=new sap.ui.model.odata.v2.ODataModel(C.getBackendRootURL()+"/"+C.getApplicationPath("sap.ino.config.URL_PATH_OD_BACKOFFICE"),{disableHeadRequestForToken:true});p.setSizeLimit(10*1000);}else{D=undefined;p=new sap.ui.model.odata.v2.ODataModel(C.getBackendRootURL()+"/"+s,{disableHeadRequestForToken:true});}j.setModel(p);if(m&&m.getParent()){m.getParent().setBusy(true);}p.attachBatchRequestCompleted(function(){if(m.getParent()){m.getParent().setBusy(false);}j.setBusy(false);m.open();i.getModel("objectContext").setProperty("/listBoxVisible",true);i.getModel("objectContext").setProperty("/VBoxVisible",false);});i.fnBindData(n[i.iParameterIndex],D);},_bindCancelBtn:function(){var o=this,i=this.byId("parametercancelbutton");var j=function(){var _=o.byId("parameterDialog");o.iParameterIndex=0;_.close();if(o.oVBox.getItems().length===0){o.navigateBack();}};i.attachPress(j);},_nextPress:function(){var o=this;return function(){var i=o.oConfiguration,p=i.Parameters,P=jQuery.map(p,function(v){return[v];}),D=o.byId("datePicker"),j=o.byId("dialogLabel");var m=P[o.iParameterIndex];if(m.ControlType&&m.ControlType==="DatePicker"){if(m.Mandatory&&!D.getValue()){if(D.setValueState){D.setValueState(sap.ui.core.ValueState.Error);}return;}o.aTempParameter[o.iParameterIndex]={};o.aTempParameter[o.iParameterIndex].Selection=D.getValue();o.aTempParameter[o.iParameterIndex].SelectionString=D.getValue();o.aTempParameter[o.iParameterIndex].Key=m.Key;}else{var n=o.byId("listBox");var s=function(m){var t=true;var u=n.getSelectedItems();if(m.Mandatory&&u.length===0){n.addStyleClass("sapUiInoListBoxErr");t=false;}else{var v=[];var w=[];jQuery.each(u,function(I,y){v.push(y.getKey());w.push(y.getText().trim());});var x=w.join(", ");o.aTempParameter[o.iParameterIndex]={};o.aTempParameter[o.iParameterIndex].Selection=v;o.aTempParameter[o.iParameterIndex].SelectionString=x;o.aTempParameter[o.iParameterIndex].Key=m.Key;}return t;};if(!s(P[o.iParameterIndex])){return;}if((P&&P.length>1&&n.getModel().sServiceUrl.indexOf("analytics.xsodata")<0)||(P&&P.length===1&&P[0].Key!=="CAMPAIGN_ID")){var q=new sap.ui.model.odata.v2.ODataModel(C.getBackendRootURL()+"/"+(i.ODataPath||C.getApplicationPath("sap.ino.config.URL_PATH_OD_ANALYTICS")),{disableHeadRequestForToken:true});q.attachBatchRequestCompleted(function(){n.setBusy(false);});if(n.getBindingInfo("items").path.indexOf("AuthCampaignReports")>-1){n.removeAllItems();n.setModel(null);n.mBindingInfos.items.path="";}n.setModel(q);}n.setBusy(true);}o.iParameterIndex+=1;m=P[o.iParameterIndex];if(!m){o._goNext(null,P[o.iParameterIndex]);return;}j.setText(o.getText(m.DisplayName));j.setRequired(m.Mandatory||false);o.getModel("objectContext").setProperty("/listBoxVisible",false);o.getModel("objectContext").setProperty("/VBoxVisible",false);o.getModel("objectContext").setProperty("/datePickerVisible",false);if(m.ControlType&&m.ControlType==="DatePicker"){o.getModel("objectContext").setProperty("/datePickerVisible",true);o._goNext(null,P[o.iParameterIndex]);if(D){var r="";if(o.aTempParameter&&o.aTempParameter[o.iParameterIndex]){r=o.aTempParameter[o.iParameterIndex].Selection;}D.setValue(r);if(D.setValueState){D.setValueState(sap.ui.core.ValueState.None);}}}else{o.getModel("objectContext").setProperty("/listBoxVisible",true);o._goNext(o.fnBindData,P[o.iParameterIndex]);}};},_goNext:function(j,p){var o=this,D=o.getParameterDialog(),m=o.oConfiguration;var P=m.Parameters;var n=jQuery.map(P,function(v){return[v];});if(o.iParameterIndex===n.length){for(var i=0;i<n.length;i++){n[i].Selection=o.aTempParameter[i].Selection;n[i].SelectionString=o.aTempParameter[i].SelectionString;}o.iParameterIndex=0;D.close();o.freshViews(m.SelectedView);}else{if(o.iParameterIndex===n.length-1){o.byId("parameterbutton").setText(o.getText("BO_ANA_BUT_OK"));}if(j){j.call(o,p);}}},getReportParameter:function(){var o=this.oConfiguration,i=this;if(!o.Parameters){return;}var D=i.getParameterDialog();if(D&&D.isOpen()){if(f.checkMandatoryParameters(o)){D.close();}}i.getModel("objectContext").setProperty("/listBoxVisible",false);i.getModel("objectContext").setProperty("/datePickerVisible",false);i.getModel("objectContext").setProperty("/VBoxVisible",true);var j=i.byId("parameterbutton");i.iParameterIndex=i.iParameterIndex||0;i.aTempParameter=i.aTempParameter||[];var p=o.Parameters;var P=jQuery.map(p,function(v){return[v];});var m=P[i.iParameterIndex];if(m.ControlType&&m.ControlType==="DatePicker"){i.getModel("objectContext").setProperty("/datePickerVisible",true);D.open();}else{var n=i.byId("dialogLabel");n.setText(i.getText(m.DisplayName));n.setRequired(m.Mandatory||false);i._setListBox(o);}j.setText(P.length>1?i.getText("BO_ANA_BUT_NEXT"):i.getText("BO_ANA_BUT_OK"));if(!i.hasNextBtnEvent){i.hasNextBtnEvent=true;j.attachPress(i._nextPress());i._bindCancelBtn();}},getParameterDialog:function(){if(!this._oParameterDialog){this.hasNextBtnEvent=false;this._oParameterDialog=this.createFragment("sap.ino.vc.analytics.fragments.ParameterDialog");this.getView().addDependent(this._oParameterDialog);}return this._oParameterDialog;},onFilter:function(){this.getReportParameter();},onShowFilter:function(o){if(!this._oPopover){this._oPopover=this.createFragment("sap.ino.vc.analytics.fragments.Popover");this.getView().addDependent(this._oPopover);}if(this._oPopover.isOpen()){this._oPopover.close();}else{this._oPopover.destroyContent();var j=this;var m=new V({width:"500px"});var p=this.oConfiguration.Parameters;if(p){var n=true;jQuery.each(p,function(I,P){if(P.SelectionString){var s=P.SelectionString.split(",");var r=s.length;for(var i=0;i<r;i++){if(n){m.addContent(j.createFilterRow("{i18n>BO_ANA_FLD_SELECT_PARAMETER}"));n=false;}if(!i){m.addContent(j.createFilterRow("{i18n>"+P.DisplayName+"}",s[i]));}else{m.addContent(j.createFilterRow(undefined,s[i]));}}}});}var v=f.getViewConfiguration(this.oConfiguration).FilterText;if(v){m.addContent(j.createFilterRow("{i18n>BO_ANA_FLD_LOCAL_VIEW_FILTER}"));jQuery.each(v,function(K,s){m.addContent(j.createFilterRow(K,s));});}if(m.getContent().length===0){m.addContent(j.createFilterRow("{i18n>BO_ANA_FLD_NO_FILTER_SET}"));}this._oPopover.addContent(m);var q=o.getSource();jQuery.sap.delayedCall(0,this,function(){this._oPopover.openBy(q);});}},onAfterShow:function(){if(this.oConfiguration&&!f.checkMandatoryParameters(this.oConfiguration)){this.getReportParameter();}},onAfterHide:function(){var i=this.byId("listBox");if(i){i.setModel(null);}this.oConfiguration=null;if(this._oParameterDialog){this.getView().removeDependent(this._oParameterDialog);this._oParameterDialog.destroy();this._oParameterDialog=null;}},createFilterRow:function(D,v){var o;if(D){o=new L({text:D,width:"150px"});}var i;if(v){i=new L({text:v,width:"250px"});}else{o.setDesign(h.Bold);return new H({content:[new k({alignItems:"Center",height:"40px",width:"150px",items:[o]})]});}return new H({content:[new k({alignItems:"Center",height:"40px",width:"150px",items:[o]}),new k({alignItems:"Center",height:"40px",width:"250px",items:[i]})]});},resetPendingChanges:function(){var m=this.getObjectModel();if(m&&m.hasPendingChanges()){m.revertChanges();}m.revertChanges();this._oReset=true;},hasPendingChanges:function(){if(this._oReset===true){this._oReset=false;return false;}if(!this.oSmartChart||!this.oSmartTable){return false;}if(!this.getObjectModel().getConfiguration()){return false;}if(this.getObjectModel().getKey()<0){if(this.oConfiguration.Parameters&&this.oConfiguration.Parameters.Campaign.Mandatory){var i=!!this.oConfiguration.Parameters.Campaign.Selection[0];return i;}else{if(this.getObjectModel().getConfiguration().Description){delete this.getObjectModel().getConfiguration().Description;}if(this.getObjectModel().getConfiguration().Title){delete this.getObjectModel().getConfiguration().Title;}}}var v=this.getObjectModel().getConfiguration();if(v.Parameters&&typeof(v.Parameters.Campaign.Selection[0])==="number"){v.Parameters.Campaign.Selection[0]=v.Parameters.Campaign.Selection[0].toString();}if(JSON.stringify(v)!==JSON.stringify(this.oConfiguration)){return true;}var j,m,n;var o=this.oSmartChart.fetchVariant();if(!this._oSeletedTableView){if(!o||!o.dimeasure){j=this.sChartType;m=this.aDimensions;n=this.aMeasures;}else{j="viz/"+this._formatChartType(o.dimeasure.chartTypeKey);m=[];n=[];jQuery.each(o.dimeasure.dimeasureItems,function(I,w){if(!w.visible){return true;}else{if(w.role.indexOf("axis")>=0){n.push(w.columnKey);}else{if(w.role==="category"||w.role==="series"){m.push(w.columnKey);}}}});}}else{var p=this.oSmartTable.fetchVariant();if(!p||!p.columns){j=this.sChartType;m=this.aDimensions;n=this.aMeasures;}else{j=this.sChartType;m=[];n=[];var q=this.oSmartTable.getTable();var t=q.getColumns();var r=this.oSmartChart.getChart();var D=r.getDimensions();var s=r.getMeasures();jQuery.each(t,function(w,x){if(!x.getVisible()){return true;}else{jQuery.each(D,function(I,y){if(y.getName()===x.getLeadingProperty()){m.push(y.getName());}});jQuery.each(s,function(I,y){if(y.getName()===x.getLeadingProperty()){n.push(y.getName());}});}});}}var u=this.getObjectModel().getConfiguration().Views[this.iSelectedView];if(u.Chart.Type!==j||JSON.stringify(u.Dimensions)!==JSON.stringify(m)||JSON.stringify(u.Measures)!==JSON.stringify(n)){return true;}return false;},storeConfiguration:function(){var i,j,m;var o=this.oSmartChart.fetchVariant();if(!this._oSeletedTableView){if(!o||!o.dimeasure){i=this.sChartType;j=this.aDimensions;m=this.aMeasures;}else{i="viz/"+this._formatChartType(o.dimeasure.chartTypeKey);j=[];m=[];jQuery.each(o.dimeasure.dimeasureItems,function(I,u){if(!u.visible){return true;}else{if(u.role.indexOf("axis")>=0){m.push(u.columnKey);}else{if(u.role==="category"||u.role==="series"){j.push(u.columnKey);}}}});}}else{var n=this.oSmartTable.fetchVariant();if(!n||!n.columns){i=this.sChartType;j=this.aDimensions;m=this.aMeasures;}else{i=this.sChartType;j=[];m=[];var p=this.oSmartTable.getTable();var t=p.getColumns();var q=this.oSmartChart.getChart();var D=q.getDimensions();var r=q.getMeasures();jQuery.each(t,function(u,v){if(!v.getVisible()){return true;}else{jQuery.each(D,function(I,w){if(w.getName()===v.getLeadingProperty()){j.push(w.getName());}});jQuery.each(r,function(I,w){if(w.getName()===v.getLeadingProperty()){m.push(w.getName());}});}});}if(!o||!o.dimeasure){this.aDimensions=j;this.aMeasures=m;}}var s=this.oConfiguration;s.SelectedView=this.iSelectedView;s.Views[this.iSelectedView].Chart.Type=i;s.Views[this.iSelectedView].Measures=m;s.Views[this.iSelectedView].Dimensions=j;if(o){if(o.filter){s.Views[this.iSelectedView].Filters=o.filter.filterItems;}if(o.sort){s.Views[this.iSelectedView].Sorters=o.sort.sortItems;}}},onExport:function(o){if(this.oSmartTable.getVisible()){var v=this.getModel("view");if(v){var i=v.getProperty("/List");if(!i){v.setProperty("/List",{});}v.setProperty("/List/HIDE_PPT_EXPORT",true);}this.onListExport(o);}else{this.onChartExportSVG(o);}},getExportControl:function(){return this.oSmartTable.getTable();},getExportChartControl:function(){return this.oSmartChart._getVizFrame();},getChartTitle:function(){return this.oChartPage.getText();},initFullScreen:function(){if(this._bFullscreenReset===undefined||this._bFullscreenReset===true){this._bPreviouslyFullscreen=this.getFullScreen();}this.setFullScreen(true);this._bFullscreenReset=false;},_convertChartSetingToTable:function(){var r=jQuery.extend(true,{},this.oSmartChart.fetchVariant()),t=this;var i=[],o,s;r.columns={columnsItems:[]};var j=[].concat(this.oSmartChart.getChart().getVisibleDimensions()).concat(this.oSmartChart.getChart().getVisibleMeasures());var m=this.oSmartTable._aColumnKeys;jQuery.each(j,function(n,p){o=t.oSmartChart.getChart().getDimensionByName(p);if(o){s=o.getTextProperty();}jQuery.each(m,function(q,u){if(p===u||(s&&s===u)){r.columns.columnsItems.push({"columnKey":u,"visible":true});i.push(u);}});});delete r.dimeasure;this._createSmartTable(i.join(","));this.oSmartTable.applyVariant(r);},_convertTableSetingToChart:function(){var r=jQuery.extend(true,{},this.oSmartTable.fetchVariant());r.dimeasure={chartTypeKey:this.oSmartChart.getChart().getProperty("chartType"),dimeasureItems:[]};var i=[].concat(this.oSmartChart.getChart().mAggregations.dimensions).concat(this.oSmartChart.getChart().mAggregations.measures);jQuery.each(this.oSmartTable.getTable().mAggregations.columns,function(j,m){if(m.getProperty("visible")){jQuery.each(i,function(n,o){if(o.getProperty("name")===m.getProperty("leadingProperty")){r.dimeasure.dimeasureItems.push({"columnKey":m.getProperty("leadingProperty"),"visible":true,"role":o.getRole()});}});}});delete r.columns;return r;}}));});
