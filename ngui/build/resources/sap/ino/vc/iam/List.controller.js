sap.ui.define(["sap/ino/vc/commons/BaseVariantListController","sap/ui/Device","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/controls/OrientationType","sap/ino/commons/application/Configuration"],function(B,D,S,J,F,T,O,C){"use strict";var o={ASC:"ASC",DESC:"DESC"};var s={CHANGED_AT:"CHANGED_AT",NAME:"NAME",SEARCH_SCORE:"SEARCH_SCORE"};var v={ALL:"all"};var f={NONE:undefined,USER:"USER"};var l={PEOPLE:"peoplelist",PEOPLE_VARIANT:"peoplelistvariant"};var L={NAME:"PEOPLE_LIST_TIT_NAME",ADJUSTMENT_TITLE:"IDENTITY_LIST_TIT_ADJUSTMENT",Filter:{},Sorter:{Values:[{TEXT:"SORT_MIT_CHANGED",ACTION:s.CHANGED_AT,DEFAULT_ORDER:o.DESC},{TEXT:"SORT_MIT_NAME",ACTION:s.NAME,DEFAULT_ORDER:o.ASC}]},Order:{Values:[{TEXT:"ORDER_MIT_ASC",ACTION:o.ASC},{TEXT:"ORDER_MIT_DESC",ACTION:o.DESC}]},Variants:{DEFAULT_VARIANT:v.ALL,TITLE:"PEOPLE_LIST_TIT_VARIANTS",Values:[{TEXT:"PEOPLE_LIST_MIT_USER",ACTION:v.ALL,FILTER:f.USER,DEFAULT_SORT:s.NAME,VISIBLE:true}]}};var i=B.extend("sap.ino.vc.iam.List",jQuery.extend({},T,{routes:["peoplelist","peoplelistvariant"],initialFocus:"mainFilterButton",list:L,view:{"List":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.ALL,"Default":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.ALL}},"ORIENTATION":O.PORTRAIT,"DISABLE_ORIENTATION":true},onInit:function(){B.prototype.onInit.apply(this,arguments);var V=this.getModel("view")||new J({});V.setData(this.view,true);this.getList().attachUpdateFinished(this.onUpdateFinished,this);if(D.system.phone&&!D.orientation.portrait){this.getList().setWrapping(false);}else{this.getList().setWrapping(true);}},onRouteMatched:function(e,a){var q;var V;var b;var c;var d;var g=this.getListProperty("/Variants/DEFAULT_VARIANT");if(e&&e.getParameter){var A=e.getParameter("arguments");this._sRoute=e.getParameter("name");q=A["?query"];V=A.variant;}else{this._sRoute=e;q=a;V=a.variant;}var h=this.getModel("view");h.setData(this.view,true);var j=this.getList().isBound("items");if(!q||!q.sort){var k=this.getViewProperty("/List/Default/SORT");var m=this.getSort(k)[0].DEFAULT_ORDER;q=q||{};q.sort=q.sort||k;q.sort=q.sort+" "+(q.order||m);}var r=this.hasStateChanged(this._sRoute,V,q,D.orientation.portrait);if(!j||r){c=this.getVariant(V);if(!c){c=this.getVariant(g);}d=c.FILTER;this.setParameters(q,c);b=this.getSort(this.getViewProperty("/List/SORT"));this.setSorter(b);this.updateFilter();this.setSortIcon(this.byId("panelFilterFragment--sortreverse"),this.getViewProperty("/List/ORDER"));var n=this.getViewProperty("/List/SEARCH");this.bindList(n,d);this.initialSorterItems();}this._bInnerViewNavigation=true;this.setHelp("IDENTITY_LIST");},getBindingPath:function(q){if(!q||q==={}){return{Path:this.getIdentiryEntityName()};}else{var b={};if(q.search===undefined){b.Path=this.getIdentiryEntityName();}else{b.Path="SearchIdentityPeopleList(searchToken='"+(q.search||"")+"')/Results";}if(q.variant){b.Filter=[new F("TYPE_CODE","EQ",q.variant)];}return b;}},getIdentiryEntityName:function(){if(C.hasCurrentUserPrivilege("sap.ino.ui::backoffice.access")){return"Identity";}return"LeanIdentity";},updateListAccessibilityUserCard:function(){this.getList().getBinding("items").attachDataReceived(function(){var a=this.getList();var I=a.$().find("li");jQuery.each(I,function(b,c){var $=jQuery(c);$.attr("aria-label",$.getEncodedText());});},this);},bindList:function(a,V){var r=this.getCurrentRoute();var b;if(r==="identitylistvariant"){b=this.getCurrentVariant().ACTION;}this.saveState(b);var c=this.getBindingPath({search:a,variant:V});this.setPath("data>/"+c.Path);B.prototype.setFilter.apply(this,c.Filter);B.prototype.bindList.apply(this,arguments);this.updateListAccessibilityUserCard();},getList:function(){return this.byId("objectlist");},getItemTemplate:function(){return this.getFragment("sap.ino.vc.iam.fragments.IdentityListItem");},onVariantPress:function(V,e){B.prototype.onVariantPress.apply(this,[V,e,"identitylistvariant","identitylist"]);},onRefresh:function(){var a=this.getList();var b=a.getBindingInfo("items");a.bindAggregation("items",b);},updateFilter:function(){},onUserPressed:function(e){var I=e.getSource();var c=I.getBindingContext("data");if(c){this.navigateTo("userdetail",{id:c.getProperty("ID")});}},formatObjectListVariantsVisible:function(){return true;}}));i.list=L;i.listContext=l;return i;});
