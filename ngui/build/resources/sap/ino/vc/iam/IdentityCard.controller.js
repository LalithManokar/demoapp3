sap.ui.define(["sap/ino/vc/commons/BaseController","sap/ino/vc/commons/mixins/MailMixin","sap/ui/model/json/JSONModel","sap/ino/commons/application/Configuration","sap/m/MessageToast","sap/ui/Device","sap/ino/controls/QuickViewGroupDimension"],function(B,M,J,C,a,D,Q){"use strict";var f={};jQuery.extend(f,B.prototype.formatter);f.generateMailURL=function(m){var c=this.oView.getController().createMailContent();if(c){return sap.m.URLHelper.normalizeEmail(m,c.subject,c.body);}else{return sap.m.URLHelper.normalizeEmail(m);}};return B.extend("sap.ino.vc.iam.IdentityCard",jQuery.extend({},M,{formatter:f,open:function(c,i){var t=this;var v=t.getView();var I;if(D&&D.system&&D.system.phone){I=v.byId("identityCardPhone");}else{I=v.byId("identityCard");}t._iUserId=i;t._oIdentityModel=new J();if(C.getUserProfileByTextURL(i)){t._oIdentityModel.loadData(C.getUserProfileByTextURL(i),{"USER_ID":i},true,"GET");t._oIdentityModel.attachRequestCompleted(null,function(){var b=t._oIdentityModel.getData();b.ENABLE_GAMIFICATION=t.getView().getModel("config").getProperty("/ENABLE_GAMIFICATION")===1?true:false;b.ENABLE_LEADERBOARD=t.getView().getModel("config").getProperty("/ENABLE_LEADERBOARD")===1?true:false;b.CURRENT_USER_ID=C.getCurrentUser().USER_ID;b.QUERY_USER_ID=t._iUserId;t._oIdentityModel.setData(b);v.setModel(t._oIdentityModel,"identityData");if(b.ENABLE_GAMIFICATION){t.constructGamificationDimension(t._oIdentityModel,v);}jQuery.sap.delayedCall(0,t,function(){if(D.system.phone){I.open();}else{I.openBy(c);}});});}},onClose:function(){if(D.system.phone){var i=this.getView().byId("identityCardPhone");i.close();}},onPressNavigateToLeaderBoard:function(e){var c=this.getView().getController();c.navigateTo("leaderboard");},constructGamificationDimension:function(m,v){var c,q,I,s,e,d,p,b;if(D.system.phone){c=v.getContent()[1];q=c.getContent()[0];}else{c=v.getContent()[0];q=c.getPages()[0];}var g=m.getData().GAMIFICATION_INFO;q.removeAllDimensionGroups();if(!Array.isArray(g)){return;}var S=true;if(m.getData().CURRENT_USER_ID!==m.getData().QUERY_USER_ID){S=false;}for(var i=0;i<g.length;i++){s="";e="";d=0;p=0;I="";b=0;if(JSON.stringify(g[i].BADGE)!=="{}"){s=g[i].BADGE.currentBadge.NAME;e=!g[i].BADGE.nextBadge.NAME?"":g[i].BADGE.nextBadge.NAME;if(g[i].BADGE.nextBadge.NAME&&g[i].BADGE.currentBadge.NAME){d=g[i].BADGE.nextBadge.BADGE_VALUE-g[i].BADGE.currentBadge.BADGE_VALUE;}if(g[i].BADGE.nextBadge.NAME&&!g[i].BADGE.currentBadge.NAME){d=g[i].BADGE.nextBadge.BADGE_VALUE;}if(!g[i].BADGE.nextBadge.NAME&&g[i].BADGE.currentBadge.NAME){d=g[i].BADGE.currentBadge.BADGE_VALUE;}p=g[i].BADGE.nextBadge.NAME?g[i].BADGE.nextBadge.BADGE_VALUE-parseInt(g[i].TOTAL,10):0;if(JSON.stringify(g[i].BADGE.currentBadge)!=="{}"&&g[i].BADGE.currentBadge.Attachment.length>0){I=C.getAttachmentTitleImageDownloadURL(g[i].BADGE.currentBadge.Attachment[0].ATTACHMENT_ID);}if(JSON.stringify(g[i].BADGE.currentBadge)!=="{}"){var h=parseInt(g[i].TOTAL,10)-g[i].BADGE.currentBadge.BADGE_VALUE;b=h>0?h:parseInt(g[i].TOTAL,10);}else{b=parseInt(g[i].TOTAL,10);}}if(I){q.addDimensionGroup(new Q({heading:g[i].NAME,headingIcon:I,totalPoints:parseInt(g[i].TOTAL,10),pointsToNextLevel:p,startLevel:s,nextLevel:e,currentPointsBWBadge:b,diffPointsToNextLevel:d,dimensionUnit:g[i].UNIT,redeemPoints:g[i].TOTAL_FOR_REDEEM,redeemEnabled:!!g[i].REDEEM,showOnlyDimension:!S}));}else if(S){q.addDimensionGroup(new Q({heading:g[i].NAME,headingIcon:I,totalPoints:parseInt(g[i].TOTAL,10),pointsToNextLevel:p,startLevel:s,nextLevel:e,currentPointsBWBadge:b,diffPointsToNextLevel:d,dimensionUnit:g[i].UNIT,redeemPoints:g[i].TOTAL_FOR_REDEEM,redeemEnabled:!!g[i].REDEEM,showOnlyDimension:!S}));}}}}));});
