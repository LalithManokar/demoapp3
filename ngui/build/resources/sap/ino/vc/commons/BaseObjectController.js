/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["./BaseBlockController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ino/commons/formatters/ObjectFormatter","./mixins/IdentityQuickviewMixin","./mixins/ClipboardMixin","./mixins/IdentityCardSendMailMixin","sap/ui/core/MessageType"],function(B,J,M,O,I,C,a,b){return B.extend("sap.ino.vc.commons.BaseObjectController",jQuery.extend({},I,C,a,{formatter:O,onInit:function(){B.prototype.onInit.apply(this,arguments);},onExit:function(){if(B.prototype.onExit){B.prototype.onExit.apply(this,arguments);}this.releaseObjectModel();},setObjectModel:function(m){if(m!==this.getView().getModel("object")&&this.hasOwnModel("object")){this.releaseObjectModel();}else{this.getView().setModel(null,"object");}this.getView().setModel(m,"object");this.getView().bindElement({path:"object>/"});},releaseObjectModel:function(){var o=this.getView().getModel("object");if(o){o.releaseFromSyncMode();o.destroy();}},createObjectModel:function(o,r,R){},getObjectModel:function(){var o=this.getView().getModel("object");if(o&&o.isDeleted()){this.setObjectExists(false);this.setObjectModel(undefined);return undefined;}return o;},hasPendingChanges:function(){return false;},resetPendingChanges:function(){var m=this.getObjectModel();if(m&&m.hasPendingChanges()){m.revertChanges();}},doModelsMatch:function(m){if(!m){return false;}var o=this.getObjectModel();if(!o){return false;}if(m.getObjectName()===o.getObjectName()&&m.getKey()===o.getKey()){return true;}return false;},getODataEntitySet:function(){return null;},bindDefaultODataModel:function(i,c){var t=this;var e=this.getODataEntitySet();if(e&&i>0){this.getView().bindElement({path:"data>/"+e+"("+i+")",events:{dataRequested:function(){jQuery.each(t.getBusyControls(),function(d,f){if(jQuery.type(f.setBusy)==="function"){f.setBusy(true);}});},dataReceived:function(E){jQuery.each(t.getBusyControls(),function(d,f){if(jQuery.type(f.setBusy)==="function"){f.setBusy(false);}});if(E.getParameter("data")===undefined){t.setObjectExists(false);}else{t.setObjectExists(true);}if(typeof c==="function"){c.apply(t);}},change:function(){var d=this.getModel().getProperty(this.getPath())!==undefined;t.setObjectExists(d);}}});if(typeof c==="function"){var o=this.getView().getBindingContext("data");if(o&&o.getPath()===("/"+e+"("+i+")")){c.apply(t);}}}},getDefaultODataModelEntity:function(i){return this.getModel("data").getProperty("/"+this.getODataEntitySet()+"("+i+")");},onRouteMatched:function(e){var t=this;var r=e.getParameter("name");var R=e.getParameter("arguments");var o;try{o=parseInt(R.id,10);}catch(E){return;}var c=this.getObjectModel();if(!c||c.getKey()!==o){c=this.createObjectModel(o,r,R);this.setObjectModel(c);c.getDataInitializedPromise().fail(function(){t.setObjectExists(false);if(t.preCheck){t.checkObjectExists(c.getObjectName(),c.getKey()||c.getInitKey());}});c.getDataInitializedPromise().done(function(){t.setObjectExists(true);});}this.bindDefaultODataModel(o);var q=R["?query"];var s=(q&&q.section)||"sectionDetails";this.showSection(s);},onTabSelect:function(e){var s=e.getParameter("section");this.navigateTo(this.getCurrentRoute(),{id:this.getObjectModel().getKey(),query:{section:this.getLocalElementId(s)}},true);},showSection:function(l,o){var t=this;var L=this.byId(o?o:"objectpage");if(!L){return;}var s=this.byId(l);if(!s){return;}var S=s.getId();L.addEventDelegate({onAfterRendering:jQuery.proxy(function(){jQuery.sap.delayedCall(500,L,L.scrollToSection,[S]);},t)});var f=function(){L.scrollToSection(S);var e=L.getAggregation("_anchorBar");jQuery.sap.delayedCall(500,this,function(){e.scrollToSection(S);});t.setViewProperty("/objectPageSection",l);};var c=jQuery.Deferred();c.done(f);if(L._bDomReady===true){c.resolve();}else{var d=function(){if(L._bDomReady===true){c.resolve();}else{jQuery.sap.delayedCall(500,this,d);}};jQuery.sap.delayedCall(500,this,d);}},onShowMessages:function(e){this.byId("messagePopover").openBy(e.getSource());},executeObjectAction:function(A,o){var c=(o&&o.objectModelExt)||this.getObjectModel();if(c instanceof sap.ino.commons.models.object.Idea&&c.getProperty("/STATUS_CODE")==="sap.ino.config.DRAFT"&&((A==="modify"&&c.getProperty("/NAME"))||A==="del")){this.enforceInputTypeValidations();this.resetInputTypeValidations(this.getView());}else if(this.hasAnyClientErrorMessages()){var d=new jQuery.Deferred();if(c instanceof sap.ino.commons.models.object.Idea){var e=this.getErrorClientMessages(this.getOwnerComponent().getModel("message").getData());var E=this.getText("MSG_SAVE_USER_ERROR");if(e.length>0){E=e[0].message;}M.show(E);}else{M.show(this.getText("MSG_SAVE_USER_ERROR"));}d.reject();return d.promise();}return B.prototype.executeObjectAction.call(this,c,A,o);},executeObjectActionPrototypeDirectly:function(A,o){var c=(o&&o.objectModelExt)||this.getObjectModel();return B.prototype.executeObjectAction.call(this,c,A,o);},getErrorClientMessages:function(m){if(this._previousClientMessages&&this._previousClientMessages.length>0){return this._previousClientMessages;}var e=m.filter(function(o){return o.processor.getMetadata().getName()==="sap.ui.core.message.ControlMessageProcessor"&&o.type===b.Error;});return e;}}));});
