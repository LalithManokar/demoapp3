sap.ui.define(["sap/ino/vc/commons/mixins/MailMixin","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox"],function(M,C,J,a,b){"use strict";var I=function(){throw"Mixin may not be instantiated directly";};var _=new J();var c=new J();I.getEmailDialog=function(){if(!this._oEmailDialog){this._oEmailDialog=this.createFragment("sap.ino.vc.iam.fragments.SendEmail",this.getView().createId());this.getView().addDependent(this._oEmailDialog);this._oEmailDialog.setModel(c,"mail");}return this._oEmailDialog;};I.getMailSignatureBody=function(B,w){var A=C.getSystemSetting('sap.ino.config.APPLICATION_TITLE');if(!A||A===""){A="SAP Innovation Management";}var u=this.getModel('user').getProperty("/data/NAME");var s=this.getText("MAIL_SIGNATURE_TEMPLATE",[A,u]);B=B+"\n\n\n\n\n\n\n\n\n\n\n"+s;if(w){B=B+'\n'+this.getModel('user').getProperty("/data/EMAIL");}return B;};I.onMailPressed=function(e){var i=e.getParameter("identityId");var u=e.getParameter("userName");var o=M.createMailContent.apply(this);var t=this;_.loadData(C.getUserProfileByTextURL(i),{"USER_ID":i},false,"GET");if(_.getProperty("/CONTACT_DETAIL")&&_.getProperty("/CONTACT_DETAIL/EMAIL")){sap.m.URLHelper.triggerEmail(_.getProperty("/CONTACT_DETAIL/EMAIL"),o.subject,o.body);}else{var O=function(w){o.body=t.getMailSignatureBody(o.body,w);c.setData(o);c.setProperty("/username",u);c.setProperty("/to_identity",i);var m=t.getEmailDialog();m.open();};b.confirm(this.getText("MAIL_MSG_SEND_CONFIRMATION"),{title:this.getText("MAIL_CONFIRMATION_LABEL"),icon:b.Icon.NONE,actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(A){if(A==="YES"){O(true);}else{O(false);}}});}};I.onIdeaContactMail=function(p){var t=this;var i=p.map(function(P){return P.IDENTITY_ID;});var u=p.map(function(P){return P.NAME;}).join(";");var o=M.createMailContent.apply(this);var O=function(w){o.body=t.getMailSignatureBody(o.body,w);c.setData(o);c.setProperty("/username",u);c.setProperty("/to_identity",i);var m=t.getEmailDialog();m.open();};b.confirm(this.getText("MAIL_MSG_SEND_CONFIRMATION"),{title:this.getText("MAIL_CONFIRMATION_LABEL"),icon:b.Icon.NONE,actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(A){if(A==="YES"){O(true);}else{O(false);}}});};I.onEmailDialogSend=function(){var t=this;var d={TO_IDENTITY:c.getProperty("/to_identity"),SUBJECT:c.getProperty("/subject"),CONTENT:c.getProperty("/body")};var s="/sap/ino/xs/rest/common/send_identity_email.xsjs";jQuery.ajax({url:C.getBackendRootURL()+s,headers:{"X-CSRF-Token":C.getXSRFToken()},method:"POST",cache:false,data:JSON.stringify(d),success:function(){a.show(t.getText("MAIL_MSG_SEND_SUCCESS"));t._oEmailDialog.close();},error:function(){a.show(t.getText("MAIL_MSG_SEND_ERROR"));}});};I.onEmailDialogCancel=function(){this._oEmailDialog.close();};return I;});
