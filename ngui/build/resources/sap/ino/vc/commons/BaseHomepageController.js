/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["./BaseController","sap/ui/core/ResizeHandler","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ino/vc/commons/mixins/GlobalSearchMixin","sap/ino/commons/application/Configuration"],function(B,R,V,J,G,C){return B.extend("sap.ino.vc.commons.BaseHomepageController",jQuery.extend({},G,{onInit:function(){B.prototype.onInit.apply(this,arguments);this._sResizeRegId=R.register(this.getView(),this._onResize);},onExit:function(){if(this._sResizeRegId){R.deregister(this._sResizeRegId);}},onRouteMatched:function(e){var t=this;var a=e.getParameter("arguments");var i=parseInt(a.id,10);this.openDisplayViewonRouteMatched(i);},onBeforeHide:function(){if(this.getCurrentRoute()!=="wall"){this._bFullscreenReset=true;this.setFullScreen(this._bPreviouslyFullscreen);}},onAfterShow:function(){this.initFullScreen();var c=this.getCurrentView();if(c&&c.getController()){var o=c.getController();if(typeof o.onAfterShow==="function"){o.onAfterShow();}}},getDisplayView:function(){},_initDisplayView:function(e){this._onResize({control:this.getView(),size:{width:this.getView().$().width()}});},openDisplayView:function(i){var d=this.getDisplayView(i);this.setCurrentView(d);},openDisplayViewonRouteMatched:function(i){var d;var t=this;var I=function(){if(typeof t.onBeforeDisplayViewShow==="function"){t.onBeforeDisplayViewShow();}var v=t.getCurrentView();if(typeof v.getController().show==="function"){v.getController().show(t.getView());}};if(i){var p="/CampaignPrivilege("+i+")";this.getModel("data").read(p,{async:true,success:function(D){t.getModel("component").setProperty("/REGISTRABLE",D.REGISTRATION_PRIVILEGE?true:false);t.getModel("component").setProperty("/COMMUNITY",D.COMMUNITY_PRIVILEGE?true:false);d=t.getDisplayView(i);t.setCurrentView(d);t.bindDefaultODataModel(i,I);},error:function(){t.getModel("component").setProperty("/REGISTRABLE",false);t.getModel("component").setProperty("/COMMUNITY",true);d=t.getDisplayView(i);t.setCurrentView(d);t.bindDefaultODataModel(i,I);}});}else{d=this.getDisplayView(i);this.setCurrentView(d);this.bindDefaultODataModel(i,I);}},initFullScreen:function(){if(this._bFullscreenReset===undefined||this._bFullscreenReset===true){this._bPreviouslyFullscreen=this.getFullScreen();}this.setFullScreen(true);this._bFullscreenReset=false;},getCurrentView:function(){var c=this.getView().getContent();var p=(c&&c.length>0)?c[0]:undefined;if(p){if(p.getContent().length>0){return p.getContent()[0];}}return undefined;},getCurrentController:function(){var v=this.getCurrentView();return v?v.getController():undefined;},setCurrentView:function(v){var c=this.getView().getContent();var p=(c&&c.length>0)?c[0]:undefined;if(p){var o=this.getCurrentView();var a=this._mViews?this._mViews[v]:undefined;if(a){p.removeContent(o);p.addContent(a);}else{if(!o){a=this.createView({type:V.XML,viewName:v});a.attachAfterRendering(this._initDisplayView,this);p.addContent(a);}else if(o&&o.getViewName()!==v){a=this.createView({type:V.XML,viewName:v});a.attachAfterRendering(this._initDisplayView,this);p.removeContent(o);p.addContent(a);}this._mViews=this._mViews?this._mViews:{};this._mViews[v]=a;}}},switchView:function(){var s=this.getModel("component").getProperty("/SHOW_BACKOFFICE");var i=this.iCampaignId?this.iCampaignId:null;s=!s;this.getModel("component").setProperty("/SHOW_BACKOFFICE",s);var a=this.getModel('search').getProperty('/selectedCategory');if(!s){this._removeCategory('campaign-idealistbycompany');this._removeCategory('idealistbycompany');this.getModel('search').setProperty('/selectedCategory',a);}else{this._addCategory({key:'idealistbycompany',value:C.getGroupConfiguration().DISPLAY_LABEL});this.getModel('search').setProperty('/selectedCategory',a);}this.openDisplayView(i);var c=this.getCurrentView();var o=c.getController();if(typeof o.show==="function"){o.show(this.getView());}o.setViewFocus();},setViewFocus:function(){if(this.getCurrentController()){this.getCurrentController().setViewFocus();}},updateLayout:function(l){var u=false;if(this.getCurrentController()){var L=this.getCurrentController().getLayout(l);for(var c in L){if(L.hasOwnProperty(c)){var s=L[c];var o=this.getCurrentView().byId(c);if(o){var a=this.getCurrentView().byId(s);if(a){a.removeStyleClass("sapInoInvisible");if(o.indexOfItem(a)===-1){o.addItem(a);}}else{var i=o.getItems();var I=i.length>0?i[0]:undefined;if(I){I.addStyleClass("sapInoInvisible");}}u=true;}}}}return u;},_onResize:function(e){var v=e.control;var t=v.getController();var c=t.getCurrentController();var l=(typeof t.getLayoutPrefix==="function"&&t.getLayoutPrefix())?t.getLayoutPrefix():undefined;var w=e.size.width;var n;var o=e.oldsize?e.oldsize.width:-1;if(w!==o){if(w<800){n="XS";}else if(w<1100){n="S";}else if(w<1350){n="M";}else if(w<1700){n="L";}else{n="XL";}if(c&&(!c._sCurrentLayout||c._sCurrentLayout!==n)){if(l){v.removeStyleClass(l+"XS");v.removeStyleClass(l+"S");v.removeStyleClass(l+"M");v.removeStyleClass(l+"L");v.removeStyleClass(l+"XL");v.addStyleClass(l+n);}v.removeStyleClass("sapInoBaseHomepageXS");v.removeStyleClass("sapInoBaseHomepageS");v.removeStyleClass("sapInoBaseHomepageM");v.removeStyleClass("sapInoBaseHomepageL");v.removeStyleClass("sapInoBaseHomepageXL");v.addStyleClass("sapInoBaseHomepage"+n);if(t.updateLayout(n)){var O=c._sCurrentLayout;c._sCurrentLayout=n;if(typeof c.onResizeLayoutChange==="function"){c.onResizeLayoutChange(O,n);}}}}},setObjectExists:function(o){var c=this.getCurrentController();if(c){c.setViewProperty("/objectExists",o);}},getObjectExists:function(o){var c=this.getCurrentController();if(c){return c.getViewProperty("/objectExists");}else{return undefined;}},bindDefaultODataModel:function(i,c){var t=this;var e=(typeof this.getODataEntitySet==="function")?this.getODataEntitySet():undefined;if(e&&i>0){this.getView().bindElement({path:"data>/"+e+"("+i+")",events:{dataRequested:function(){jQuery.each(t.getBusyControls(),function(I,a){if(jQuery.type(a.setBusy)==="function"){a.setBusy(true);}});},dataReceived:function(E){jQuery.each(t.getBusyControls(),function(I,a){if(jQuery.type(a.setBusy)==="function"){a.setBusy(false);}});if(E.getParameter("data")===undefined){t.setObjectExists(false);}else{t.setObjectExists(true);}if(typeof c==="function"){c.apply(t);}},change:function(){var O=this.getModel().getProperty(this.getPath())!==undefined;t.setObjectExists(O);}}});if(typeof c==="function"){var o=this.getView().getBindingContext("data");if(o&&o.getPath()===("/"+e+"("+i+")")){c.apply(t);}}return true;}if(typeof c==="function"){c.apply(t);}return false;}}));});
