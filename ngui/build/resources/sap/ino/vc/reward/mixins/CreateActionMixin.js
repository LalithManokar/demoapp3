sap.ui.define(["sap/ino/vc/idea/mixins/BaseActionMixin","sap/ino/vc/commons/BaseController","sap/ui/model/json/JSONModel","sap/ino/commons/models/object/Idea","sap/ino/commons/models/object/RewardList","sap/ino/commons/models/aof/PropertyModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/m/MessageToast"],function(B,a,J,I,R,P,F,b,S,M){"use strict";var C=jQuery.extend({},B);C.onCreateReward=function(e){var c=e.getSource().getCustomData();if(!c||c.length===0){return;}var p=this._parseCustomDatas(e);var d=this._createRewardDialog();this._getChildController(d).setDialog(d);var s={actions:["create","del","executeStatusTransition"],nodes:["Root"],invalidation:{entitySets:["IdeaFull"]},continuousUse:true,concurrencyEnabled:true,readSource:{model:this.getDefaultODataModel()}};var r=new R(p.oKey,s);this._getChildController(d).getView().setBusy(true);if(!p.oKey.hasOwnProperty("IDEA_ID")){var t=this;r.getDataInitializedPromise().done(function(){t._getChildController(d).getView().setBusy(false);});}else{this._handleIdeaInfo(d,r,p.oKey.IDEA_ID);}this._setDefaultValue(r,p);d.setModel(r,"object");d.open();};C.onDismissReward=function(e){var c=e.getSource().getCustomData();if(!c||c.length===0){return;}var p=this._parseCustomDatas(e);if(p.oKey.IDEA_ID){var o=this;var r=I.dismissReward(p.oKey.IDEA_ID);r.done(function(){var d=o.getList().getBindingInfo("items");o.getList().bindItems(d);});}};C._createRewardDialog=function(){var r=this.createFragment("sap.ino.vc.idea.fragments.CreateRewardDialog",this.getView().getId());this.getView().addDependent(r);return r;};C._parseCustomDatas=function(e){var p={oKey:null,IdeaPhaseCode:null,IdeaName:null,UnitCode:null,UnitText:null};var c=e.getSource().getCustomData();jQuery.each(c,function(i,d){var k=d.getKey();var v=d.getValue();if(k==="IdeaId"){p.oKey={IDEA_ID:d.getValue(),OBJECT_TYPE_CODE:"IDEA",OBJECT_ID:d.getValue()};}else if(k==="RewardListId"){p.oKey=v;}else if(p.hasOwnProperty(k)){p[k]=v;}});return p;};C._setDefaultValue=function(r,p){if(typeof p.oKey!=="object"){return;}r.setProperty("/IDEA_NAME",p.IdeaName);r.setProperty("/IDEA_PHASE_CODE",p.IdeaPhaseCode);r.setProperty("/REWARD_UNIT_CODE",p.UnitCode);r.setProperty("/REWARD_UNIT_TEXT",p.UnitText);};C._getChildController=function(d){return d.getContent()[0].getController();};C._handleIdeaInfo=function(d,r,n){var t=this;r.getReadSourceModel().read("/IdeaFull("+n+")/ContributionShare",{success:function(o){var c=[];jQuery.each(o.results||[],function(i,e){c.push({ID:r.getNextHandle(),AUTHOR_ID:e.AUTHOR_ID,REWARD_AMOUNT:e.REWARD_AMOUNT,REWARD_SHARE:e.REWARD_SHARE,CONTRIBUTION_SHARE:e.PERCENTAGE,IDEA_ID:e.IDEA_ID,EMPLOYEE_NAME:e.AUTHOR_NAME});});t._setIdeaDetails(r,n,c);t._getChildController(d).getView().setBusy(false);},error:function(){t._getChildController(d).getView().setBusy(false);}});};C._setIdeaDetails=function(r,n,o){r.setProperty("/IDEA_ID",n);r.setProperty("/Rewards",o);r.setProperty("/REWARD_AMOUNT_TOTAL",0);};return C;});
