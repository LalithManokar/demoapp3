sap.ui.define(["sap/ino/vc/commons/BaseObjectModifyController","sap/m/MessageToast","sap/ino/vc/idea/RewardFormatter"],function(B,M,R){"use strict";return B.extend("sap.ino.vc.idea.ModifyRewardList",{formatter:R,setDialog:function(d){this._oDialog=d;},onExecuteStatusTransition:function(s){var c=this;var m=c.getObjectModel();var a=m.executeStatusTransition({STATUS_ACTION_CODE:s});if(a){a.done(function(){M.show(c.getText("OBJECT_MSG_STATUS_CHANGE_SUCCESS"));});a.fail(function(o){if(o.MESSAGES&&o.MESSAGES.length>0){M.show(c.getText(o.MESSAGES[0].MESSAGE_TEXT));}});}},onSave:function(){this.resetClientMessages();this._setRewardUnit();this.executeObjectAction("modify");},onDel:function(e){return this.executeObjectAction("del",{messages:{confirm:"MSG_DEL_CONFIRM",success:"MSG_DEL_SUCCESS"}});},onRewardsBtnUnPublish:function(){this.onExecuteStatusTransition('sap.ino.config.REWARD_UNPUBLISH');},onRewardsBtnPublishAuthor:function(){this.onExecuteStatusTransition('sap.ino.config.REWARD_PUB_AUTHOR');},onRewardsBtnPublishCommunity:function(){this.onExecuteStatusTransition('sap.ino.config.REWARD_PUB_COMMUNITY');},onRewardDialogDel:function(e){var t=this;var d=this.onDel(e);var D=e.getSource();d.done(function(r){if(!r||!r.confirmationCancelled){t._closeDialog();return;}if(D&&jQuery.type(D.focus)==="function"){D.focus();}});},onRewardDialogCancel:function(){this._closeDialog();},onRewardAmoutChange:function(e){var n=this._getAuthorId(e);var a=this._getTotalAmount(n,e);this._setRewardShare(n,a,e);this._setLastRewardShare();this.getObjectModel().setProperty("/REWARD_AMOUNT_TOTAL",a);},_getAuthorId:function(e){var n=-1;var c=e.getSource().getCustomData();jQuery.each(c,function(i,d){if(d.getKey()==="Id"){n=d.getValue();return false;}});return n;},_getTotalAmount:function(n,e){var s=0;var r=this.getObjectModel().getProperty("/Rewards");jQuery.each(r,function(i,d){var v=d.REWARD_AMOUNT;if(d.AUTHOR_ID===n){v=e.getParameter("value");}if(v){var a=parseInt(v.toString().replace(/,/g,""),10);if(!isNaN(a)){s+=parseInt(a,10);}}});return s;},_setRewardShare:function(n,a,e){var b=a;if(!b){b=1;}var m=this.getObjectModel();var r=m.getProperty("/Rewards");jQuery.each(r,function(i,d){var v=d.REWARD_AMOUNT;if(d.AUTHOR_ID===n){v=e.getParameter("value");}if(v){var c=parseInt(v.toString().replace(/,/g,""),10);if(isNaN(c)||c===0){c=0;}else{c=Math.round(c*100/b);}m.setProperty("/Rewards/"+i+"/REWARD_SHARE",c);}});},_setLastRewardShare:function(){var n=0;var m=this.getObjectModel();var r=m.getProperty("/Rewards");jQuery.each(r,function(i,d){if(d.REWARD_SHARE){n+=d.REWARD_SHARE;}});var a=r.length-1;for(;a>=0;a--){if(r[a].REWARD_SHARE>0){m.setProperty("/Rewards/"+a+"/REWARD_SHARE",100-n+r[a].REWARD_SHARE);break;}}},_setRewardUnit:function(){var m=this.getObjectModel();var r=m.getProperty("/Rewards");var u=m.getProperty("/REWARD_UNIT_CODE");m.setProperty("/REWARD_UNIT",u);jQuery.each(r,function(i,d){m.setProperty("/Rewards/"+i+"/REWARD_UNIT",u);});},rewardShareFormatter:function(n){if(n===null||n===void 0){return"";}return Math.round(parseFloat(n*100))/100+"%";},_closeDialog:function(){if(this._oDialog){this._oDialog.close();this._oDialog.destroy();}}});});
