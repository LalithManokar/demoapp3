sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ino/vc/evaluation/EvaluationFormatter","sap/ino/vc/idea/mixins/FollowUpMixin","sap/ino/commons/models/object/Idea","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/commons/models/object/Vote","sap/ino/vc/idea/mixins/AssignmentActionMixin","sap/ino/vc/idea/mixins/ChangeStatusActionMixin","sap/ino/vc/commons/mixins/MailMixin","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/idea/mixins/VolunteerMixin","sap/ino/vc/idea/mixins/MergeActionMixin","sap/ino/commons/application/WebAnalytics","sap/m/Label","sap/m/Text","sap/m/CheckBox","sap/ino/commons/models/core/CodeModel","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/commons/mixins/TagCardMixin","sap/ino/commons/models/object/RewardList","sap/ino/vc/idea/mixins/CreateRewardActionMixin","sap/ino/commons/models/aof/PropertyModel","sap/ino/vc/idea/RewardFormatter","sap/ino/commons/models/aof/ApplicationObjectChange","sap/ino/controls/IdeaStatusType","sap/ino/vc/idea/mixins/ChangeAuthorActionMixin","sap/ino/vc/idea/mixins/ChangeAuthorActionFormatter","sap/ino/vc/idea/mixins/ChangeDecisionMixin","sap/ino/commons/models/object/IdeaObjectIntegration","sap/ino/commons/models/object/IdeaLatest","sap/m/Dialog","sap/m/DialogType","sap/ui/core/ValueState","sap/m/MessageBox","sap/m/FlexBox","sap/m/Link","sap/m/Button","sap/m/ButtonType","sap/ui/core/HTML"],function(B,E,F,I,C,J,M,T,V,A,c,d,e,f,g,W,L,h,j,k,l,m,R,o,P,p,q,r,s,t,u,v,w,D,x,y,z,G,H,K,N,O){"use strict";var Q={decisionQuickViewVisibility:function(a,b,i,n,S,U,X,Y){if(b!==n||(a!==i||!U||U.trim()==='')&&(!Y||Y.trim()==='')){return false;}if(X||S===1){return true;}else{return false;}},decisionValueOption:function(a,b){if(a&&a.trim()!==""){return B.prototype.formatter.valueOption.call(this,a);}if(b&&b.trim()!==""){return b.substr(0,6);}return"";},voteTabVisibility:function(b,a,i,n){if(!b&!a&&i!=='TEXT'&&i!=='LIST'){return false;}else if(n){return true;}else if(b){return true;}else{return false;}},enableEditDecision:function(i,n,S,U){if(i&&n&&n.length>0){n.sort(function(a,b){return b.ID-a.ID;});if(n[0].STATUS_CODE!==U||(n[0].PHASE_CODE!==S||!n[0].REASON_CODE||n[0].REASON_CODE.trim()==='')&&(!n[0].REASON||n[0].REASON.trim()==='')){return false;}return true;}else{return false;}},editDecisionCustomData:function(i){if(i&&i.length>0){i.sort(function(a,b){return b.ID-a.ID;});return i[0].ID;}},visibleDecision:function(i,n,S,U){if(n&&n.length>0){n.sort(function(a,b){return b.ID-a.ID;});if(n[0].STATUS_CODE!==U||(n[0].PHASE_CODE!==S||!n[0].REASON_CODE||n[0].REASON_CODE.trim()==='')&&(!n[0].REASON||n[0].REASON.trim()==='')){return false;}if(i||n[0].DECISION_REASON_LIST_VISIBLE===1){return true;}else{return false;}}else{return false;}},adjustDesWidth:function(b,a,i,n){var S=Q.visibleDecision(b,a,i,n);if(S===false){return"IDEA_DEATAIL_WIDTH";}else{return"null";}},sectionTitle:function(i,a){if(i>0){return a&&a+"("+String(i)+")";}else{return a;}},sectionInternalTitle:function(n,a,b){if(!parseInt(n,10)&&!parseInt(a,10)){return b;}else{return b&&b+this.getText("MENU_MIT_INTERNAL_COUNTS",[String(n),String(a)]);}},sectionInternalTitleToolTip:function(n,a,b){if(!parseInt(n,10)&&!parseInt(a,10)){return null;}else{return b;}},setIdeaDetailCommentsTab:function(i){if(i===1){return"LATESTUPDATE_COMMENT_TAB";}else{return"null";}},setIdeaDetailCreateIcon:function(i,a){if(i===1&&a===false){return"LATESTCTEATE_ICON";}else{return"null";}},isPreviousEnabled:function(a){var b=this.getView().getModel("ideaList");if(b&&b.getData()){var S=b.getData();if(S&&S.length>=0){var U=0;$.each(S,function(i,n){if(n===a){U=i;return false;}});if(U-1>=0){return true;}else{return false;}}else{return false;}}else{return false;}},isNextEnabled:function(a){var b=this.getView().getModel.getModel("ideaList").getData();if(b&&b.length>=0){var S=0;$.each(b,function(i,n){if(n===a){S=i;return false;}});if(S+1<b.length){return true;}else{return false;}}else{return false;}},isPreviousOrNextVisible:function(a){var b=this.getView().getModel("ideaList").getData();if(b&&b.length>=0){var S=$.grep(b,function(n,i){return n===a;});if(S.length>0){return true;}return false;}else{return false;}},aContributorsFirstPerson:function(a){if(!a||a.length<=0){return"";}if(a.length===1){return a[0].NAME;}else if(a.length>1){return a[0].NAME+"...";}},formatPressPreviousButton:function(i){if(i===1){return false;}},formatPressNextButton:function(i,a){if(i===a){return false;}},enableLinkObject:function(a){if(a){return true;}else{return false;}}};jQuery.extend(Q,B.prototype.formatter,F.followUpMixinFormatter,E,p,t);return B.extend("sap.ino.vc.idea.Display",jQuery.extend({},T,A,c,F,d,e,g,l,m,o,f,s,u,{routes:["idea-display"],formatter:Q,preCheck:true,onInit:function(){B.prototype.onInit.apply(this,arguments);this.setViewProperty("/EDIT",false);this.aBusyControls=[this.byId("ideaDisplay")];this.setModel(new J({EvaluationSelection:{},CreateAverageEvaluationEnabled:false,CreateTotalEvaluationEnabled:false}),"objectContext");this._initHandleRewardsAOChange();},createObjectModel:function(a){var S={nodes:["Root","Extension"],actions:["modify","modifyAndSubmit","del","assignCoach","executeStatusTransition","assignToMe","unassignCoach","mergeIdeas","markAsDuplicate","addExpert","reassignCampaign","changeAuthorStatic","changeDecision","createObject","linkExistedObject","copy"],continuousUse:true,readSource:{model:this.getDefaultODataModel(),includeNodes:[{name:"CampaignExperts",parentNode:"Root",primaryKey:"ID"},{name:"RespExperts",parentNode:"Root",primaryKey:"ID"},{name:"CampaignManagers",parentNode:"Root",primaryKey:"ID"},{name:"Decisions",parentNode:"Root",primaryKey:"ID"},{name:"StatusDecisions",parentNode:"Root",primaryKey:"ID"}]}};W.logIdeaView(a);return new I(a,S);},onRouteMatched:function(a){B.prototype.onRouteMatched.apply(this,arguments);var b=this;var i=this.getObjectModel();var n=this.byId("vBoxFormIdeals");var S=this.byId("vBoxAdminFormIdeals");i.getDataInitializedPromise().done(function(b1){var c1=b1.CAMPAIGN_BACKGROUND_IMAGE_ID;var d1=b1.CAMPAIGN_SMALL_BACKGROUND_IMAGE_ID;b.setBackgroundImages(c1,d1);b.setViewProperty("/CO_AUTHOR",false);if(i.oData.Contributors.length>0){b.setViewProperty("/CO_AUTHOR",true);}if(n){n.removeAllItems();}if(S){S.removeAllItems();}if(!!i.oData.FieldsValue&&i.oData.FieldsValue.length>0){b.bindingFormIdeals(n,i);}if(!!i.oData.AdminFieldsValue&&i.oData.AdminFieldsValue.length>0){b.bindingAdminFormIdeals(S,i);}b.setVisibilityForRewards(b1);var e1=b.getOwnerComponent().getModel('search');if(e1){e1.setProperty('/searchAguments',{"id":i.getProperty("/CAMPAIGN_ID")});}var f1=b.byId('objectpage')?b.byId('objectpage').getSelectedSection():"";var g1=[];var h1=f1&&(f1.indexOf("sectionComments")>-1)?true:false;var i1=f1&&(f1.indexOf("sectionDetails")>-1)?true:false;if(i.getProperty("/SHOW_CREATED_VIEWER")===1){g1.push("CreatedViewer");}if(i.getProperty("/SHOW_STATUSCHANGE_VIEWER")===1){g1.push("StatusChangeViewer");}if(i1&&i.getProperty("/SHOW_UPDATED_VIEWER")===1){g1.push("UpdatedViewer");}if(h1&&i.getProperty("/SHOW_COMMENT_VIEWER")===1){g1.push("CommentViewer");}if(!h1&&b._commentAlreadyRead){i.setProperty("/SHOW_COMMENT_VIEWER",0);b._commentAlreadyRead=false;}if(g1.length>0){var j1={TYPE_CODE:g1,IDEA_ID:i.getProperty("/ID")};var k1=w.deleteViewerByObjectIdAndTypeCode(j1);k1.done(function(m1){if(h1&&i.getProperty("/SHOW_COMMENT_VIEWER")===1){b._commentAlreadyRead=true;}});}var l1=f1&&(f1.indexOf("sectionAttachments")>-1)?true:false;if(l1){i.setProperty("/EDITABLE",false);}});var U=b.getModel("objectContext");var X=Object.keys(U.getProperty("/EvaluationSelection")||{});if(X.length>0){U.setProperty("/EvaluationSelection",{});U.setProperty("/CreateAverageEvaluationEnabled",false);U.setProperty("/CreateTotalEvaluationEnabled",false);}this.setHelp("IDEA_DISPLAY","IDEA_DISPLAY_ADDITIONAL");var Y=a.getParameter("arguments").id;this.initPageIndicatorLabel(Y);var Z=C.getBackendRootURL()+"/sap/ino/xs/rest/common/update_object_view_count.xsjs";var _={OBJECT_TYPE:"IDEA",OBJECT_ID:Y,USER_NAME:C.getCurrentUser().USER_NAME};var a1=jQuery.ajax({url:Z,headers:{"X-CSRF-Token":C.getXSRFToken()},data:JSON.stringify(_),dataType:"json",type:"POST",contentType:"application/json; charset=UTF-8",async:true});a1.done();},onAfterRendering:function(){var a=this;var b=C.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE");var i=C.getSystemSetting("sap.ino.config.DISABLE_IDEA_IMAGE_HIDE_PHASE_BAR");a.setViewProperty('/DISABLE_IDEA_IMAGE',!!(b*1)||!!(i*1));a.setViewProperty('/DISABLE_IDEA_IMAGE_HIDE_PHASE_BAR',!!(i*1));a.setPageContentTopStyle();jQuery.sap.delayedCall(0,a,function(){k.getCodes("sap.ino.xs.object.evaluation.Model.Criterion");k.getCodes("sap.ino.xs.object.basis.Unit.Root");k.getCodes("sap.ino.xs.object.status.Action.Root");});},bindingAdminFormIdeals:function(a,b){var n=this;jQuery.each(b.oData.AdminFieldsValue,function(i,S){if(S.STATE_OF_PUBLISH===1){var U=S.DEFAULT_TEXT+":";if(S.UOM_CODE){U=S.DEFAULT_TEXT+"("+k.getText("sap.ino.xs.object.basis.Unit.Root",S.UOM_CODE)+"):";}var X=new L({text:U,tooltip:S.DEFAULT_LONG_TEXT});X.addStyleClass("sapInoIdeaFormLabelStyle");var Y;if(S.DATATYPE_CODE==="BOOLEAN"){Y="BOOL_VALUE";}else if(S.DATATYPE_CODE==="TEXT"){Y="TEXT_VALUE";}else if(S.DATATYPE_CODE==="RICHTEXT"){Y="RICH_TEXT_VALUE";}else if(S.DATATYPE_CODE==="DATE"){Y="DATE_VALUE";}else{Y="NUM_VALUE";}var Z=S[Y];var _=S.valueOptionList;if(!_){if(S.VALUE_OPTION_LIST_CODE){var a1="sap.ino.xs.object.basis.ValueOptionList.Root_"+S.VALUE_OPTION_LIST_CODE;_=k.getCodes(a1,function(g1){return g1.ACTIVE===1;});}}if(!!_&&_.length>0&&Z!==undefined&&Z!==null&&Z!==""){jQuery.each(_,function(g1,h1){if(h1.CODE.toString()===Z.toString()){Z=h1.DEFAULT_TEXT;return;}});}if(S.DATATYPE_CODE==="BOOLEAN"&&(!_||_.length===0)){var b1=S[Y]===0||!S[Y]?false:true;var c1=new j({text:S.DEFAULT_TEXT,selected:b1,editable:false,tooltip:S.DEFAULT_LONG_TEXT});var d1=c1._getLabel();d1.addStyleClass("sapInoIdeaFormLabelStyle");a.addItem(c1);}else{var e1;if(S.DATATYPE_CODE==="NUMERIC"&&!!Z&&(!_||_.length===0)){var f1=sap.ui.core.format.NumberFormat.getFloatInstance({groupingEnabled:true,groupingSeparator:","});e1=new h();e1.setText(f1.format(Z));}else if(S.DATATYPE_CODE==="RICHTEXT"&&!!Z&&(!_||_.length===0)){e1=new sap.ui.core.HTML({sanitizeContent:true,preferDOM:false});e1.setContent(Z);}else if(S.DATATYPE_CODE==="DATE"&&!!Z&&(!_||_.length===0)){e1=new h();e1.setText(Q.toDate(Z));}else{e1=new h();e1.setText(Z);}a.addItem(X);a.addItem(e1);}}});},bindingFormIdeals:function(a,b){var n=this;jQuery.each(b.oData.FieldsValue,function(i,S){var U=S.DEFAULT_TEXT+":";if(S.IS_DISPLAY_ONLY){var X=new O({sanitizeContent:true,preferDOM:false,content:{model:"object",path:"/FieldsValue/"+i+"/DISPLAY_TEXT",formatter:n.formatter.wrapHTML}});a.addItem(X);return true;}if(S.UOM_CODE){U=S.DEFAULT_TEXT+"("+k.getText("sap.ino.xs.object.basis.Unit.Root",S.UOM_CODE)+"):";}var Y=new L({text:U,tooltip:S.DEFAULT_LONG_TEXT});Y.addStyleClass("sapInoIdeaFormLabelStyle");var Z;if(S.DATATYPE_CODE==="BOOLEAN"){Z="BOOL_VALUE";}else if(S.DATATYPE_CODE==="TEXT"){Z="TEXT_VALUE";}else if(S.DATATYPE_CODE==="RICHTEXT"){Z="RICH_TEXT_VALUE";}else if(S.DATATYPE_CODE==="DATE"){Z="DATE_VALUE";}else{Z="NUM_VALUE";}var _=S[Z];var a1=S.valueOptionList;if(!!a1&&a1.length>0&&_!==undefined&&_!==null&&_!==""){jQuery.each(a1,function(h1,i1){if(i1.CODE.toString()===_.toString()){_=i1.DEFAULT_TEXT;return;}});}if(S.DATATYPE_CODE==="BOOLEAN"&&(!a1||a1.length===0)){if(S.IS_HIDDEN===1){var b1=new h();b1.setText("******");b1.setTooltip(n.getText("IDEA_DISPLAY_FORM_HIDDEN_TOOLTIP"));a.addItem(Y);a.addItem(b1);}else{var c1=S[Z]===0||!S[Z]?false:true;var d1=new j({text:S.DEFAULT_TEXT,selected:c1,editable:false,tooltip:S.DEFAULT_LONG_TEXT});var e1=d1._getLabel();e1.addStyleClass("sapInoIdeaFormLabelStyle");a.addItem(d1);}}else{var f1;if(S.DATATYPE_CODE==="NUMERIC"&&!!_&&(!a1||a1.length===0)){var g1=sap.ui.core.format.NumberFormat.getFloatInstance({groupingEnabled:true,groupingSeparator:","});f1=new h();f1.setText(g1.format(_));}else if(S.DATATYPE_CODE==="RICHTEXT"&&!!_&&(!a1||a1.length===0)){f1=new sap.ui.core.HTML({sanitizeContent:true,preferDOM:false});f1.setContent(_);}else if(S.DATATYPE_CODE==="DATE"&&!!_&&(!a1||a1.length===0)){f1=new h();f1.setText(Q.toDate(_));}else{f1=new h();f1.setText(_);}if(S.IS_HIDDEN===1){if(S.DATATYPE_CODE==="RICHTEXT"){f1=new h();}f1.setText("******");f1.setTooltip(n.getText("IDEA_DISPLAY_FORM_HIDDEN_TOOLTIP"));}a.addItem(Y);a.addItem(f1);}});},hasBackgroundImage:function(){return true;},getODataEntitySet:function(){return"IdeaFull";},onCampaignPressed:function(a){a.preventDefault();var i=this.getObjectModel().getProperty("/CAMPAIGN_ID");this.navigateTo("campaign",{id:i});},onIdeaPressed:function(a){a.preventDefault();var i=this.getObjectModel().getProperty("/LINK_IDEA_ID");this.navigateTo("idea-display",{id:i});},onEdit:function(a){this.navigateTo("idea-edit",{id:this.getObjectModel().getKey()});},onGeneralEdit:function(a){if(!this._oEditActionSheet){this._oEditActionSheet=this.createFragment("sap.ino.vc.idea.fragments.EditActionSheet",this.getView().getId());this.getView().addDependent(this._oEditActionSheet);}this._oEditActionSheet.openBy(a.getSource());},onRewardCreateEanble:function(a){if(a){return P.getStaticActionEnabledStaticFormatter("sap.ino.xs.object.reward.RewardList","create",{IDEA_ID:a})(a);}return false;},onCreate:function(a){if(!this._oCreateActionSheet){this._oCreateActionSheet=this.createFragment("sap.ino.vc.idea.fragments.CreateActionSheet",this.getView().getId());this.getView().addDependent(this._oCreateActionSheet);}this._oCreateActionSheet.openBy(a.getSource());},onCreateEvaluation:function(){var a=this;this.navigateTo("evaluation-create",{query:a._getEvaluationQuery()});},_getEvaluationQuery:function(){var a={ideaId:this.getObjectModel().getKey()};var b=this.getModel("data").oData;var i=/^EvaluationRequestFullItem\((\d+)\)$/igm;var n;if(b){for(var S in b){if(b.hasOwnProperty(S)){var U=i.exec(S);if(U&&U.length>1){n=U[1];}}}}if(n){a.EvalReqItemId=n;}return a;},onCreateAverageEvaluation:function(){var a=this;var b=function(n){var S=Object.keys(a.getModel("objectContext").getProperty("/EvaluationSelection")||{});if(S.length>0){a.navigateTo("evaluation-create",{query:{ideaId:a.getObjectModel().getKey(),EvalReqItemId:a.getObjectModel().getKey(),evalIds:S.join(","),evalAction:1,includeAttachs:n}});}};var i=[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO];sap.m.MessageBox.confirm(a.getText("IDEA_OBJECT_MSG_NEW_CREATE_AVERAGE_EVALUATION"),{actions:i,onClose:function(n){var S=Math.pow(i.length,i.indexOf(n)+1);if(S===2){b(1);}}});},onCreateTotalEvaluation:function(){var a=this;var b=function(n){var S=Object.keys(a.getModel("objectContext").getProperty("/EvaluationSelection")||{});if(S.length>0){a.navigateTo("evaluation-create",{query:{ideaId:a.getObjectModel().getKey(),EvalReqItemId:a.getObjectModel().getKey(),evalIds:S.join(","),evalAction:2,includeAttachs:n}});}};var i=[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO];sap.m.MessageBox.confirm(a.getText("IDEA_OBJECT_MSG_NEW_CREATE_TOTAL_EVALUATION"),{actions:i,onClose:function(n){var S=Math.pow(i.length,i.indexOf(n)+1);if(S===2){b(1);}}});},onContactPeople:function(a){var S=a.getSource();if(!this._oContactActionSheet){this._oContactActionSheet=this.createFragment("sap.ino.vc.idea.fragments.ContactActionSheet",this.getView().getId());this.getView().addDependent(this._oContactActionSheet);}this._oContactActionSheet.openBy(S);},onContactContributors:function(){var i=this.getObjectModel();var a=i.getProperty("/Contributors").concat(i.getProperty("/Submitter"));if(this.getObjectModel().getPropertyModel().getProperty("/nodes/Root/customProperties/EmailVisibilies").CONTRIBUTORS){this.triggerMail(a);}else{this.onIdeaContactMail(a);}},onContactCoach:function(){var i=this.getObjectModel();var a=i.getProperty("/Coach");if(this.getObjectModel().getPropertyModel().getProperty("/nodes/Root/customProperties/EmailVisibilies").COACHES){this.triggerMail(a);}else{this.onIdeaContactMail(a);}},onContactIdeaExperts:function(){var i=this.getObjectModel();var a=i.getProperty("/Experts");if(this.getObjectModel().getPropertyModel().getProperty("/nodes/Root/customProperties/EmailVisibilies").IDEA_EXPERTS){this.triggerMail(a);}else{this.onIdeaContactMail(a);}},onContactCampaignExperts:function(){var i=this.getObjectModel();var a=i.getProperty("/CampaignExperts");if(this.getObjectModel().getPropertyModel().getProperty("/nodes/Root/customProperties/EmailVisibilies").CAMP_EXPERTS){this.triggerMail(a);}else{this.onIdeaContactMail(a);}},triggerMail:function(a){var b=a.filter(function(n){return n.IS_VALID_EMAIL&&n.EMAIL;}).map(function(n){return n.EMAIL;}).reduce(function(n,S){if(n.indexOf(S)<0){n.push(S);}return n;},[]).join(";");var i=this.createMailContent();sap.m.URLHelper.triggerEmail(b,i.subject,i.body);},onCreateWall:function(a){var b=this;var i=this.getObjectModel();if(i){i.createWall(this.getOwnerComponent()).done(function(n){b.navigateToWall("wall",{id:n});});}},getCopyDialog:function(a){if(!this._oCopyIdeaDialog){this._oCopyIdeaDialog=this.createFragment("sap.ino.vc.idea.fragments.Copy",this.getView().getId());this.getView().addDependent(this._oCopyIdeaDialog);this._oCopyOkBtn=this.byId(this.createId("copyok"));this._oCopyIdeaDialog.setInitialFocus();}return this._oCopyIdeaDialog;},onCopyIdea:function(){var i=this.getObjectModel();var a=this.getCopyDialog();a.setModel(new J({"NAME":this.getText("IDEA_OBJECT_FLD_COPY_PREFIX",[i.getProperty("/NAME")])}),"copy");a.open();},onCopyIdeaTitleChange:function(a){if(a.getParameters().newValue&&a.getParameters().newValue.length>0){this._oCopyOkBtn.setEnabled(true);}else{this._oCopyOkBtn.setEnabled(false);}},onCopyDialogOk:function(){var a=this;var b=this.getCopyDialog();var i=b.getModel("copy").getProperty("/NAME");b.setBusy(true);var n=a.executeObjectAction("copy",{parameters:{ID:-1,NAME:i},messages:{success:"IDEA_OBJECT_MSG_COPY_SUCCESS",error:"IDEA_OBJECT_MSG_COPY_FAILURE"}});n.done(function(S){b.close();setTimeout(function(){a.navigateTo("idea-edit",{id:S.getKey()});},500);});n.always(function(){b.setBusy(false);});},onCopyDialogClose:function(){this.getCopyDialog().close();},onCopyDialogAfterClose:function(){this.resetClientMessages();this.getCopyDialog().destroy();this._oCopyIdeaDialog=undefined;},onOpenDecisionQuickView:function(a){var S=a.getSource();var i=S.getBindingContext("object").getProperty("ID");if(S&&i){if(!this._oDecisionCardView||!this._oDecisionCardView.getController()){this._oDecisionCardView=sap.ui.xmlview({viewName:"sap.ino.vc.idea.DecisionQuickView"});S.addDependent(this._oDecisionCardView);}this._oDecisionCardView.getController().open(S,i);}},onRespListHint:function(a){var b=this._getRespListHintDialog();var i=this.getObjectModel();var n=i.getProperty("/RESP_VALUE_CODE");b.bindElement({path:"data>/RespValues('"+n+"')/"});b.open();},onRespListHintDialogClose:function(){var a=this._getRespListHintDialog();a.close();},_getRespListHintDialog:function(){var a=this._oRespListHintDialog;if(!a){a=this.createFragment("sap.ino.vc.idea.fragments.ResponsibilityDetail",this.getView().getId());this.getView().addDependent(a);this._oRespListHintDialog=a;this._oRespListHintDialog.setInitialFocus(this.createId("TagToken"));}return a;},showPopupTagCard:function(a){if(!this._oPopover){this._oPopover=sap.ui.xmlfragment("sap.ino.vc.tag.fragments.TagCardPopover",this);this.getView().addDependent(this._oPopover);}var b=a.getSource();var i="/SearchTagsAll(searchToken='',ID="+b.getKey()+")";var n=this.getModel("data");var S=this;n.read(i,{async:true,success:function(U){var X=new J();X.setData(U);S._oPopover.setModel(X,"Tag");jQuery.sap.delayedCall(0,S,function(){S._oPopover.openBy(b);});}});},_initHandleRewardsAOChange:function(){var a=this;var b=function(i){if(i.getParameter("object").getMetadata().getName()==="sap.ino.commons.models.object.RewardList"&&a&&a.getObjectModel()){a.getObjectModel().checkUpdate(true,false);}};q.attachChange(q.Action.Create,b);q.attachChange(q.Action.Del,b);q.attachChange(q.Action.Action,b);},setVisibilityForRewards:function(a){if(this.byId("sectionRewards")&&a){this.byId("sectionRewards").setVisible(a.IDEA_HAS_REWARDS>0||a.REWARD_ACTIVE>0);}},hasPendingChanges:function(){var i=this.getObjectModel();if(!i){return false;}var a=i.getProperty("/IDEA_COMMENT_VIEW");var b=i.getProperty("/IDEA_INTERNAL_COMMENT_VIEW");var n=a?a.getModel("comment"):null;var S=b?b.getModel("comment"):null;if(n&&(this.getCurrentRoute()!=="idea-display"||n.getProperty("/OBJECT_ID")!==i.getProperty("/ID")||(this.getCurrentRoute()==="idea-display"&&this.getRouter().getContext().indexOf("idea/")<0))){a.setModel(null,"comment");n=null;}if(S&&(this.getCurrentRoute()!=="idea-display"||S.getProperty("/OBJECT_ID")!==i.getProperty("/ID")||(this.getCurrentRoute()==="idea-display"&&this.getRouter().getContext().indexOf("idea/")<0))){b.setModel(null,"comment");S=null;}return false;},getCorrespondingCommentModel:function(a){var i=this.getObjectModel();var b,n;if(a==="IDEA"){n=i.getProperty("/IDEA_COMMENT_VIEW");b=n?n.getModel("comment"):null;}else if(a==="INTERNAL"){n=i.getProperty("/IDEA_INTERNAL_COMMENT_VIEW");b=n?n.getModel("comment"):null;}return b;},onCreateEvaluationRequest:function(a){this.navigateTo("evaluationrequest-create",{query:{idea:this.getObjectModel().getKey()}});},onOpenDecisionMaker:function(a){var S=a.getSource();var b=S.getBindingContext("object");var i=b.getProperty(b.sPath+"/DECIDER_ID");if(!this._oIdentityCardView){this._oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});this.getView().addDependent(this._oIdentityCardView);}this._oIdentityCardView.getController().open(S,i);},onAuthorPressed:function(a){var S=a.getSource();var b=S.getBindingContext("object");var i=b.getProperty(b.sPath+"SUBMITTER_ID");this.callIdentityView(S,i);},onCoauthorPressed:function(a){var S=a.getSource();var b=S.getBindingContext("object");var i=b.getProperty(b.sPath+"Contributors")[0].IDENTITY_ID;this.callIdentityView(S,i);},onCoachPressed:function(a){var S=a.getSource();var b=S.getBindingContext("object");var i=b.getProperty(b.sPath+"COACH_ID");this.callIdentityView(S,i);},callIdentityView:function(S,i){if(!this._oIdentityCardView){this._oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});this.getView().addDependent(this._oIdentityCardView);}this._oIdentityCardView.getController().open(S,i);},getIntegrationObjectDialog:function(){if(!this._oCopyIntegrationObject){this._oCopyIntegrationObject=this.createFragment("sap.ino.vc.idea.fragments.IntegrationObjectDialog",this.getView().getId());this.getView().addDependent(this._oCopyIntegrationObject);}return this._oCopyIntegrationObject;},onCreateIntegrationObject:function(){var a=this;var b=this.getIntegrationObjectDialog();v.getAllApiFromCampaign({CAMPAIGN_ID:this.getObjectModel().getProperty("/CAMPAIGN_ID")}).done(function(i){if(i&&i.RESULT&&i.RESULT.length===1){a.enableCreateIntegrationObjectTag=true;a.getIntegrationObjectDialog().getModel("objectContext").setProperty("/enableCreateIntegrationObjectBtn",true);a.objectTechnicalName=i.RESULT[0].TECHNICAL_NAME;}else{i.enableCreateIntegrationObjectBtn=false;}setTimeout(function(){b.setModel(new J(i),"objectContext");b.open();},500);}).fail(function(i){i.RESULT=[];});},onIntegrationObjectTargetConfim:function(){var a=this;var b=this.getIntegrationObjectDialog();b.setBusy(true);var i={duration:7000,width:'20em'};v.createObject({API_TECH_NAME:this.objectTechnicalName,CAMPAIGN_ID:this.getObjectModel().getProperty("/CAMPAIGN_ID"),IDEA_ID:this.getObjectModel().getProperty("/ID")}).done(function(n){b.setBusy(false);b.close();var S=n.RESULT.status.toString().includes('20')?'Your request to create a new object request has been sent successfully.':'Your request to create a new object request has been failed.';var U=S+'The request ID is '+(n.RESULT.generatedId?n.RESULT.generatedId[-1]:'')+' and message status is: '+(n.RESULT.status?n.RESULT.status:'')+'.';var X=new h({text:U});var Y=new H({href:C.getBackendRootURL()+'/sap/ino/config#integrationMonitorList',text:'For more detail, please navigate to Innovation Office->Monitor->Integration',target:'_blank'});if(!this.oSuccessMessageDialog){this.oSuccessMessageDialog=new D({type:x.Message,title:n.RESULT.status.toString().includes('20')?y.Success:y.Error,state:n.RESULT.status.toString().includes('20')?y.Success:y.Error,content:new G({items:[X,Y],alignItems:"Start",justifyContent:"Start",alignContent:"Start"}),beginButton:new K({type:N.Emphasized,text:"OK",press:function(){this.oSuccessMessageDialog.close();}.bind(this)})});}this.oSuccessMessageDialog.open();}).fail(function(){b.setBusy(false);b.close();M.show(a.getText("INTEGRATION_TARGET_MSG_STATUS_CREATE_FAILED"),i);});},onIntegrationObjectDialogClose:function(){this.getIntegrationObjectDialog().close();this.getIntegrationObjectDialog().destroy();this._oCopyIntegrationObject=undefined;},selectIntegrationTarget:function(a){this.getIntegrationObjectDialog().getModel("objectContext").setProperty("/enableCreateIntegrationObjectBtn",true);this.objectTechnicalName=a.getParameter("listItem").getBindingContext("objectContext").getProperty("TECHNICAL_NAME");},onUpdateFinished:function(a){if(this.enableCreateIntegrationObjectTag){this.enableCreateIntegrationObjectTag=false;var i=this.byId("integrationTargetList");if(i&&i.getItems()){i.setSelectedItem(i.getItems()[0]);}}},onLinkExternalObject:function(){var a=this.getLinkExternalObjectDialog();v.getAllApiFromCampaign({CAMPAIGN_ID:this.getObjectModel().getProperty("/CAMPAIGN_ID")}).done(function(b){setTimeout(function(){a.setModel(new J(b),"ExternalObjectModel");a.getModel("ExternalObjectModel").setProperty("/LINK_OBJECT_INFO",{API_TECHNICAL_NAME:b&&b.RESULT&&b.RESULT.length===1?b.RESULT[0].TECHNICAL_NAME:null,OBJECT_ID:null,OBJECT_TYPE:null});a.open();},500);}).fail(function(b){b.RESULT=[];});},getLinkExternalObjectDialog:function(){if(!this._oLinkExternalObject){this._oLinkExternalObject=this.createFragment("sap.ino.vc.idea.fragments.LinkExternalObjectDialog",this.getView().getId());this.getView().addDependent(this._oLinkExternalObject);}return this._oLinkExternalObject;},onTargetSystemChange:function(a){var S=a.getSource();},onLinkExternalObjectSave:function(){var a=this;var b=this.getLinkExternalObjectDialog();if(this.getView().getController().hasAnyClientErrorMessages()){return;}var i=b.getModel("ExternalObjectModel");b.setBusy(true);var n={duration:7000,width:'20em'};v.linkExistedObject({API_TECH_NAME:i.getProperty("/LINK_OBJECT_INFO/API_TECHNICAL_NAME"),OBJECT_ID:i.getProperty("/LINK_OBJECT_INFO/OBJECT_ID"),OBJECT_TYPE:i.getProperty("/LINK_OBJECT_INFO/OBJECT_TYPE"),CAMPAIGN_ID:this.getObjectModel().getProperty("/CAMPAIGN_ID"),IDEA_ID:this.getObjectModel().getProperty("/ID")}).done(function(S){if(S.RESULT.existed){b.setBusy(false);z.show(a.getText("IDEA_OBJECT_MSG_INTEGRATION_LINK_EXISTED"),{title:a.getText("IDEA_OBJECT_TITLE_INTEGRATION_LINK_EXISTED"),icon:z.Icon.WARNING,actions:[z.Action.OK],onClose:function(b1){}});}else{b.setBusy(false);b.close();var U=S.RESULT.status.toString().includes('20')?a.getText("IDEA_OBJECT_MSG_INTEGRATION_LINK_SUCCESS"):a.getText("IDEA_OBJECT_MSG_INTEGRATION_LINK_FAILED");var X=S.RESULT.generatedId?S.RESULT.generatedId[-1]:'';var Y=S.RESULT.status?S.RESULT.status:'';var Z=a.getText("IDEA_OBJECT_MSG_INTEGRATION_LINK_SHOW_TEXT",[U,X,Y]);var _=new h({text:Z});var a1=new H({href:C.getBackendRootURL()+'/sap/ino/config#integrationMonitorList',text:a.getText("IDEA_OBJECT_MSG_INTEGRATION_LINK_MORE_DETAIL"),target:'_blank'});a.oLinkMessageDialog=new D({type:x.Message,title:S.RESULT.status.toString().includes('20')?y.Success:y.Error,state:S.RESULT.status.toString().includes('20')?y.Success:y.Error,content:new G({items:[_,a1],alignItems:"Start",justifyContent:"Start",alignContent:"Start"}),beginButton:new K({type:N.Emphasized,text:"OK",press:function(){a.oLinkMessageDialog.close();}.bind(this)})});a.oLinkMessageDialog.open();}}).fail(function(){b.setBusy(false);b.close();M.show(a.getText("INTEGRATION_TARGET_MSG_STATUS_CREATE_FAILED"),n);});},onLinkExternalObjectDialogClose:function(){this.getLinkExternalObjectDialog().close();this.getLinkExternalObjectDialog().destroy();this._oLinkExternalObject=undefined;},onDelete:function(a){var b=this;var i=a.getSource();var n=b.getObjectModel();var S=C.getSystemSettingsModel().getProperty("/sap.ino.config.PPM_INTEGRATION_ACTIVE");var U=n.getProperty("/INTEGRATION_OBJECT_EXIST");var X=n.getPropertyModel().getProperty("/actions/del/customProperties/hasReward");var Y=n.getPropertyModel().getProperty("/actions/del/enabled");var Z=n.getPropertyModel().getProperty("/actions/del/customProperties/isMergeedWithVote");if(X){M.show(this.getText("MSG_IDEA_HAVE_REWARD_CANNOT_DELETE"));}else if(!Y){M.show(this.getText("OBJECT_MSG_DELETE_FAILED"));}else if(Z){M.show(this.getText("MSG_IDEA_MERGED_WITH_VOTE_CANNOT_DELETE"));}else{var _=n.getProperty("/EVALUATION_COUNT");var a1=n.getPropertyModel().getProperty("/actions/del/customProperties/isManager");if(!_||(_&&a1)){var b1="MSG_DEL_CONFIRM";if(S==="1"||U){b1="MSG_IDEA_CAMP_MANAGER_DEL_CONFIRM_HAVE_PPM_INTEGRATION";}var c1=b.executeObjectAction("del",{messages:{confirm:b1,success:"MSG_DEL_SUCCESS"}});c1.done(function(d1){if(d1&&d1.confirmationCancelled===true){if(i&&jQuery.type(i.focus)==="function"){i.focus();}return;}b.navigateTo("idealist");});}else{M.show(this.getText("MSG_IDEA_DEL_FAILED_SUBMITTER_HAVE_EVALUATION"));}}},onPressPrevious:function(){var a=this.getObjectModel().getProperty("/ID");var b=this.getView().getModel("ideaList");var S=b.getData();var U;$.each(S,function(i,n){if(n===a){U=i;return false;}});var X=S[U-1];if(X){this.setViewProperty("/PAGE_INDICATOR",U);this.navigateTo("idea-display",{id:X});}},onPressNext:function(){var a=this.getObjectModel().getProperty("/ID");var b=this.getView().getModel("ideaList");var S=b.getData();var U;$.each(S,function(i,n){if(n===a){U=i;return false;}});var X=S[U+1];if(X){this.setViewProperty("/PAGE_INDICATOR",U+2);this.navigateTo("idea-display",{id:X});}},onExit:function(){B.prototype.onExit.apply(this,arguments);},initPageIndicatorLabel:function(a){var b=this;var S,U;S=this.getViewProperty("/PAGE_INDICATOR");U=this.getViewProperty("/PAGE_SIZE");var X=sap.ui.getCore().getModel("ideaSearchParams");if(X&&X.getData()){var Y=X.getData().path;if(X.getData().path.indexOf('IdeaMediumBackofficeSearchParams')>-1){Y=Y.replace('IdeaMediumBackofficeSearchParams','IdeaMediumBackofficeSearchParamsCount');}else{Y=Y.replace('IdeaMediumSearchParams','IdeaMediumSearchParamsCount');}jQuery.ajax({url:Y,headers:{'X-CSRF-Token':'Fetch'},type:'GET',contentType:'application/json; charset=UTF-8',async:true,success:function(Z){var _=new J();var a1=$.map(Z.d.results,function(i){return i.ID;});_.setData(a1);b.getView().setModel(_,"ideaList");var b1;$.each(a1,function(i,n){if(n===parseInt(a,10)){b1=i;return false;}});var c1=b.getViewProperty("/IDEA_SECTION_CONTAINER_ID");if(b1!==undefined){b.byId("pageIndicatorPanel").setVisible(true);b.setViewProperty("/IS_IN_CURRENT_IDEA_LIST",true);if(c1){b.byId("ideaPageToolbar").setHeight("5rem");$(c1).css("top","5rem");}var d1=a1.length;if(U!==d1){b.setViewProperty("/PAGE_SIZE",d1);}if(S!==b1+1){b.setViewProperty("/PAGE_INDICATOR",b1+1);}}else{b.byId("pageIndicatorPanel").setVisible(false);if(c1){b.byId("ideaPageToolbar").setHeight("2.5rem");$(c1).css("top","2.5rem");}}},error:function(i){b.byId("pageIndicatorPanel").setVisible(false);var n=b.getViewProperty("/IDEA_SECTION_CONTAINER_ID");if(n){b.byId("ideaPageToolbar").setHeight("2.5rem");$(n).css("top","2.5rem");}}});}else{b.byId("pageIndicatorPanel").setVisible(false);}},setPageContentTopStyle:function(){var a=this.getView().getModel("ideaList");var b="#"+this.byId("ideaDisplay").getScrollDelegate()._sContainerId;this.setViewProperty("/IDEA_SECTION_CONTAINER_ID",b);if((a&&a.getData().length>0)&&this.getViewProperty("/IS_IN_CURRENT_IDEA_LIST")){this.byId("ideaPageToolbar").setHeight("5rem");$(b).css("top","5rem");}else{this.byId("ideaPageToolbar").setHeight("2.5rem");$(b).css("top","2.5rem");}}}));});
