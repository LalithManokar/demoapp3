sap.ui.define(["sap/ino/vc/idea/mixins/BaseActionMixin","sap/ino/vc/commons/BaseController","sap/ui/model/json/JSONModel","sap/ino/commons/models/object/Idea","sap/ino/commons/models/aof/PropertyModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/m/MessageToast","sap/ui/Device","sap/ui/core/ListItem","sap/m/Token","sap/ino/commons/models/object/User","sap/ui/core/MessageType","sap/ui/core/message/Message","sap/m/MessageBox","sap/ino/commons/application/Configuration","sap/ino/commons/models/object/IdeaLatest","sap/ui/core/BusyIndicator"],function(B,a,J,I,P,F,b,S,M,D,L,T,U,c,d,e,C,f,g){"use strict";var h=jQuery.extend({},B);var l={NEW_IDEAS:"SHOW_CREATED_VIEWER",NEW_UPDATES:"SHOW_UPDATED_VIEWER",NEW_STATUSES:"SHOW_STATUSCHANGE_VIEWER",NEW_COMMENTS:"SHOW_COMMENT_VIEWER"};h.onMassMarkAsRead=function(E){var s=E.getSource();if(this.getModel("markAsRead")){this.getModel("markAsRead").destroy();}var i=this.getViewProperty("/List/LATEST_UPDATE");var j=this.getList().getItems();var o={markAllRead:true,"NEW_UPDATES":true,"NEW_STATUSES":true,"NEW_COMMENTS":true};if(i&&i.length>0){jQuery.each(l,function(k,v){o[k]=i.indexOf(v)>-1?true:false;});o.markAllRead=false;}if(j.length===0){o={markAllRead:false,"NEW_UPDATES":false,"NEW_STATUSES":false,"NEW_COMMENTS":false};}var m=new J(o);this.setModel(m,"markAsRead");this._openMarkAsReadActionSheet(s);};h._openMarkAsReadActionSheet=function(s){if(!this._oMarkReadActionSheet){this._oMarkReadActionSheet=this.createFragment("sap.ino.vc.idea.fragments.MarkAsReadActionSheet",this.getView().getId());this.getView().addDependent(this._oMarkReadActionSheet);}jQuery.sap.delayedCall(0,this,function(){this._oMarkReadActionSheet.openBy(s);});};h.onMarkAllRead=function(E){this.onMarkAsReadCommon(E,'all');};h.onMarkCreatedRead=function(E){this.onMarkAsReadCommon(E,'created');};h.onMarkStatusRead=function(E){this.onMarkAsReadCommon(E,'status');};h.onMarkUpdatedRead=function(E){this.onMarkAsReadCommon(E,'updated');};h.onMarkCommentRead=function(E){this.onMarkAsReadCommon(E,'comment');};h.onMarkAsReadCommon=function(E,t){var i=[];switch(t){case'status':i.push("StatusChangeViewer");break;case'updated':i.push("UpdatedViewer");break;case'comment':i.push("CommentViewer");break;case'all':i=["CreatedViewer","UpdatedViewer","StatusChangeViewer","CommentViewer"];break;}var p=this._getFilterParameters();p.TYPE_CODE=i;var r=f.deleteViewerByObjectIdAndTypeCode(p);var j=this;g.show(0);r.done(function(R){M.show(j.getText("IDEA_OBJECT_MSG_MARK_AS_READ_SUCCESS"));g.hide();j.getIdeaFilterCount(j.getQuery());j.bindList();}).fail(function(R){M.show(j.getText("IDEA_OBJECT_MSG_MARK_AS_READ_FAIL"));});};h._getFilterParameters=function(){var o=this.getBindingParameter();var i=this._check4ManagingList();var s=this.getList().getBinding('items').sFilterParams;var j=this.getIdeaformFilters().replace(/\'/g,"").replace(/\"/g,"").split(",");var k=this.getCompanyViewFilters().replace(/\'/g,"").replace(/\"/g,"").split(",");var t=this.getViewProperty("/List/TAGS");var m={};var n=[];t.forEach(function(r,u){if(!m[r.ROOTGROUPID]){m[r.ROOTGROUPID]=[];m[r.ROOTGROUPID].push(r.ID);n.push(r.ROOTGROUPID);}else{m[r.ROOTGROUPID].push(r.ID);}});var p={searchToken:o.SearchTerm||"",tagsToken:m[n[0]]?m[n[0]].join(","):"",tagsToken1:m[n[1]]?m[n[1]].join(","):"",tagsToken2:m[n[2]]?m[n[2]].join(","):"",tagsToken3:m[n[3]]?m[n[3]].join(","):"",tagsToken4:m[n[4]]?m[n[4]].join(","):"",filterName:o.VariantFilter||"",filterBackoffice:i?"1":"0",c1:j[1].slice(3)||"",o1:j[2].slice(3)||-1,v1:unescape(j[3].slice(3))||"",c2:j[4].slice(3)||"",o2:j[5].slice(3)||-1,v2:unescape(j[6].slice(3))||"",c3:j[7].slice(3)||"",o3:j[8].slice(3)||-1,v3:unescape(j[9].slice(3))||"",cvy:k[3].slice(4)||0,cvr:k[2].slice(4)||0,cvt:decodeURIComponent(k[1].slice(4))||"",filterString:s||""};p.ideasId="";if(!i){var G=this.getGroupViewParameters(o);p.cvy=G.groupType;p.cvr=G.groupRole;p.cvt=G.groupToken;}else{p.searchType=this.getSearchType();}var q=p.filterString?(/\$filter=(.*)/gm.exec(s)[1]):"";p.filterString="$filter=("+q+")";return p;};h.onIdeaReadPress=function(E){var i=E.getSource();var o=i.getBindingContext("data");var p={},t=[];t=["CreatedViewer","UpdatedViewer","StatusChangeViewer","CommentViewer"];p.TYPE_CODE=t;p.IDEA_ID=o.getProperty("ID");var r=f.deleteViewerByObjectIdAndTypeCode(p);var j=this;r.done(function(R){M.show(j.getText("IDEA_OBJECT_MSG_MARK_AS_READ_SUCCESS"));j.getIdeaFilterCount(j.getQuery());j.bindList();}).fail(function(R){M.show(j.getText("IDEA_OBJECT_MSG_MARK_AS_READ_FAIL"));});};return h;});
