sap.ui.define(["sap/ino/vc/idea/mixins/BaseActionMixin","sap/ino/vc/commons/BaseController","sap/ui/model/json/JSONModel","sap/ino/commons/models/object/Idea","sap/ino/commons/models/aof/PropertyModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/m/MessageToast","sap/ui/Device","sap/ui/core/ListItem","sap/m/Token","sap/ino/commons/models/object/User","sap/ui/core/MessageType","sap/ui/core/message/Message","sap/m/MessageBox","sap/ino/commons/application/Configuration"],function(B,a,J,I,P,F,b,S,M,D,L,T,U,c,d,f,C){"use strict";var A=jQuery.extend({},B);A._openAssignmentActionSheet=function(s,e){if(!this._oAssignActionSheet){this._oAssignActionSheet=this.createFragment("sap.ino.vc.idea.fragments.AssignmentActionSheet",this.getView().getId());this.getView().addDependent(this._oAssignActionSheet);}this._oAssignActionSheet.data("context",e||"single");jQuery.sap.delayedCall(0,this,function(){this._oAssignActionSheet.openBy(s);});};A.onMassAssignGeneral=function(e){var s=e.getSource();if(this.getModel("assignment")){this.getModel("assignment").destroy();}var m=new J();this.setModel(m,"assignment");var o=this._computeActionAggregations();var _=function(v){return!!v;};var p={actions:{assignToMe:{enabled:o.assignToMe.every(_)},assignCoach:{enabled:o.assignCoach.every(_)&&o.campaigns.length===1},unassignCoach:{enabled:o.unassignCoach.every(_)},addExpert:{enabled:o.addExpert.every(_)},assignTag:{enabled:o.assignTag.every(_)},reassignCampaign:{enabled:o.reassignCampaign.every(_)&&o.campaigns.length===1}}};m.setProperty("/property",p);m.setProperty("/IDS",o.ideas);m.setProperty("/CAMPAIGN_IDS",o.campaigns);m.setProperty("/CAMPAIGN_ID",o.campaigns[0]);m.setProperty("/RESP_VALUE_CODES",o.respValueCode);m.setProperty("/UNASSIGN_IDS",jQuery.map(this._oSelectionMap,function(i){return i.property.actions.unassignCoach.enabled?i.ID:null;}).filter(function(v){return!!v;}));m.setProperty("/ASSIGNME_IDS",jQuery.map(this._oSelectionMap,function(i){return i.property.actions.assignToMe.enabled?i.ID:null;}).filter(function(v){return!!v;}));if(this.hasOwnProperty("_CampaignId")){this.setViewProperty("/IS_CAMPAIGN_IDEA_LIST",true);}else{this.setViewProperty("/IS_CAMPAIGN_IDEA_LIST",false);}this.setViewProperty("/IS_DIALOG",true);this._openAssignmentActionSheet(s,"mass");};A.onAssignGeneral=function(e){var s=e.getSource();var t=this;this.saveCurrentFocusBeforeActionDialogOpen();if(!this.isActionContextSingleIdeaDisplay()&&this._oAssignActionSheet){}if(!this.isActionContextSingleIdeaDisplay()){if(this.getModel("assignment")){this.getModel("assignment").destroy();}this.setModel(new J(),"assignment");var i=s.getBindingContext("data").getProperty("ID");var o={actions:["assignCoach","assignToMe","unassignCoach","addExpert","assignTag","reassignCampaign"]};var p=new P("sap.ino.xs.object.idea.Idea",i,o,false,function(g){var h=g.getSource().getData();t.getModel("assignment").setProperty("/property",h);t._openAssignmentActionSheet(s,"single");});this.getModel("assignment").setData(s.getBindingContext("data").getObject());}else{this.setModel(this.getObjectModel(),"assignment");this._openAssignmentActionSheet(s,"single");}};A._executeAssignAction=function(s,i,p,m,o){var e=Array.isArray(i);var g=this.isActionContextSingleIdeaDisplay()?this.getObjectModel():I;var O={parameters:p,messages:m,staticparameters:this.isActionContextSingleIdeaDisplay()||e?undefined:i};var h=o;if(e){O.parameters.keys=i;}h.setBusy(true);var t=this;var j=a.prototype.executeObjectAction.call(this,g,s,O);j.always(function(){h.setBusy(false);}).done(function(){t.resetActionState(e);t.restoreFocusAfterActionDialogClose();if(t.bindList){t.bindList();}});return j;};A._executeAssignCoachAction=function(i,e,s,g){var t=this;var p={IDENTITY_ID:e,CAMPAIGN_ID:g};var h=Array.isArray(i)?"massAssignCoach":"assignCoach";var m={success:function(){return t.getText("IDEA_OBJECT_MSG_COACH_ASSIGNED_SUCCESS",[s]);},error:function(){return t.getText("IDEA_OBJECT_MSG_COACH_ASSIGNED_ERROR",[s]);}};return this._executeAssignAction(h,i,p,m,this._getAssignCoachDialog());};A._executeAssignExpertAction=function(i,e,E){var t=this;var p={};var s=Array.isArray(i)?"massAddExpert":"addExpert";var m={success:function(){return t.getText("IDEA_OBJECT_MSG_EXPERT_ASSIGNED_SUCCESS",[E]);},error:function(){return t.getText("IDEA_OBJECT_MSG_EXPERT_ASSIGNED_ERROR",[E]);}};p.Experts=e;return this._executeAssignAction(s,i,p,m,this._getAssignExpertDialog());};A._executeUnassignCoachAction=function(i,s,e){var t=this;var p={CAMPAIGN_ID:e};var g=Array.isArray(i);var h=g?"massUnassignCoach":"unassignCoach";var m={success:function(){return t.getText(g?"IDEA_OBJECT_MSG_COACH_UNASSIGNED_MASS_SUCCESS":"IDEA_OBJECT_MSG_COACH_UNASSIGNED_SUCCESS",[s]);},error:function(){return t.getText(g?"IDEA_OBJECT_MSG_COACH_UNASSIGNED_MASS_ERROR":"IDEA_OBJECT_MSG_COACH_UNASSIGNED_ERROR",[s]);}};return this._executeAssignAction(h,i,p,m,this._getAssignCoachDialog());};A._getAssignCoachDialog=function(){var o=this._oAssignCoachDialog;if(!o){var _=function(s){s._oList.setMode("SingleSelectLeft");s._oList.mEventRegistry.selectionChange=[];s._oDialog.setEndButton(s._getCancelButton());};o=this.createFragment("sap.ino.vc.idea.fragments.AssignCoach",this.getView().getId());this.getView().addDependent(o);this._oAssignCoachDialog=o;_(this._oAssignCoachDialog);}return o;};A._getAssignExpertDialog=function(){var t=this;var o=this._oAssignExpertDialog;if(!o){o=this.createFragment("sap.ino.vc.idea.fragments.AssignExpert",this.getView().getId());this.getView().addDependent(o);this._oAssignExpertDialog=o;o._dialog.addButton(new sap.m.Button({text:"{i18n>BTN_ADD_FROM_CLIPBOARD}",press:[t.onAddFromClipboard,t],visible:"{=!${device>/system/phone}}",enabled:{parts:[{path:'clipboard>/changed',type:null}],formatter:function(){var e=t.getModel("clipboard");return e?e.getProperty("/enabled")&&!e.isClipboardEmpty(U):false;}}}));o._dialog.addButton(o._getOkButton());o._dialog.addButton(o._getCancelButton());}return o;};A._getAssignTagDialog=function(){var o=this._oAssignTagDialog;if(!o){o=this.createFragment("sap.ino.vc.idea.fragments.AssignTag",this.getView().getId());this.getView().addDependent(o);this._oAssignTagDialog=o;}return o;};A._getReassignCampaignDialog=function(){var o=this._oReassignCampaignDialog;if(!o){o=this.createFragment("sap.ino.vc.idea.fragments.ReassignCampaign",this.getView().getId());this.getView().addDependent(o);this._oReassignCampaignDialog=o;}return o;};A._bindAssignCoachList=function(s,i,e){var o=this._getAssignCoachDialog();if(e){o.data("context",e);}o.bindAggregation("items",{path:"data>/SearchCoach(searchToken='"+jQuery.sap.encodeURL(s||'*')+"')/Results",filters:[new F({path:"CAMPAIGN_ID",operator:b.EQ,value1:i})],sorter:new S("NAME"),template:o.getBindingInfo("items").template});return o;};A._bindAssignRespCoachList=function(s,r,i,e){var o=this._getAssignCoachDialog();if(e){o.data("context",e);}o.bindAggregation("items",{path:"data>/SearchCoach(searchToken='"+jQuery.sap.encodeURL(s||'*')+"')/Results",filters:new F({filters:[new F({path:"RESP_VALUE_CODE",operator:b.EQ,value1:r}),new F({path:"CAMPAIGN_ID",operator:b.EQ,value1:i})],and:false}),sorter:new S("NAME"),factory:function(){},template:o.getBindingInfo("items").template});return o;};A.formatIdentityCardShow=function(e){var g=this.byId("assignCoachDialog").getItems();for(var i=0;i<g.length-1;i++){var o=g[i].getContent()[0].getProperty("identityId");if(o===e){return false;}}return true;};A._bindAssignExpertList=function(s,i){var o=this._getAssignExpertDialog();i=Array.isArray(i)?i:[i];o.bindAggregation("items",{path:"data>/SearchProposedExpertParams(searchToken='"+jQuery.sap.encodeURL(s||'*')+"',ideasToken='"+i.join(",")+"')/Results",sorter:new S("NAME"),template:o.getBindingInfo("items").template});return o;};A.onAssignCoachSearch=function(e){var s=e.getParameter("value")||"*";var i=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var r=this.getModel("assignment").getProperty("/RESP_VALUE_CODES");if(this.getModel("assignment").getProperty("/RESP_VALUE_CODE")||(r&&r.length===1&&r[0]!==null)){var R=this.getModel("assignment").getProperty("/RESP_VALUE_CODE");if(!R){R=r[0];}this._bindAssignRespCoachList(s,R,i);}else{this._bindAssignCoachList(s,i);}};A.onAssignExpertSearch=function(e){var s=e.getParameter("value")||"*";var o=this._getAssignExpertDialog();var i;if(o.data("context")==="mass"){i=this.getModel("assignment").getProperty("/IDS");}else{i=this.getModel("assignment").getProperty("/ID");}this._bindAssignExpertList(s,i);};A.onAssignCoachDialogOK=function(e){var s=e.getParameter("selectedItem");var o=e.getSource();if(s){var g=s.getBindingContext("data");if(g){var i=g.getProperty("ID");var h=g.getProperty("NAME");var j=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var v;if(o.data("context")==="mass"){v=this.getModel("assignment").getProperty("/IDS");}else{v=this.getModel("assignment").getProperty("/ID");}this._executeAssignCoachAction(v,i,h,j);}}};A.onAssignExpertDialogOK=function(e){var s=e.getParameter("selectedItems");var o=e.getSource();var g=[];var E=[];if(s.length){jQuery.each(s,function(i,h){var j=h.getBindingContext("data");if(j){var k=j.getProperty("ID");var l=j.getProperty("NAME");g.push({IDENTITY_ID:k});E.push(l);}});var v;if(o.data("context")==="mass"){v=this.getModel("assignment").getProperty("/IDS");}else{v=this.getModel("assignment").getProperty("/ID");}this._executeAssignExpertAction(v,g,E.join(","));}};A.onAssignCoach=function(e){var s=e.getSource().getParent().data("context");var i=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var r=this.getModel("assignment").getProperty("/RESP_VALUE_CODES");if(this.getModel("assignment").getProperty("/RESP_VALUE_CODE")||(r&&r.length===1&&r[0]!==null)){var R=this.getModel("assignment").getProperty("/RESP_VALUE_CODE");if(!R){R=r[0];}this._bindAssignRespCoachList("*",R,i,s).open();}else{this._bindAssignCoachList("*",i,s).open();}};A.onAssignExperts=function(e){var s=e.getSource().getParent().data("context");var o=this._getAssignExpertDialog();var i;if(s){o.data("context",s);}if(s==="mass"){i=this.getModel("assignment").getProperty("/IDS");}else{i=this.getModel("assignment").getProperty("/ID");}this._bindAssignExpertList("*",i).open();};A.onassignTag=function(e){var s=e.getSource().getParent().data("context");var o=this._getAssignTagDialog();if(s){o.data("context",s);}this._INPUT_TAGS_SETTING={suggestion:{key:"ID",text:"NAME",path:"data>/SearchTagsParams(searchToken='$suggestValue')/Results",filter:[],sorter:[]},token:{key:"ID",text:"NAME"}};if(this.byId("Tags")){this.addTagMultiInputHandling(this.byId("Tags"),this._INPUT_TAGS_SETTING);}o.open();};A.addTagMultiInputHandling=function(e,s){if(!e){return;}var g=this._createSuggestHandler(s.suggestion);e.attachSuggest(g,this);e.attachTokenChange(function(E){if(!this._aIgnoreTokenChanges||this._aIgnoreTokenChanges.filter(function(o){return o.id===E.oSource.id;}).length===0){if(E.getParameter("type")==="tokensChanged"&&(E.getParameter("addedTokens").length>0||E.getParameter("removedTokens").length>0)&&s.tokenChangeCallback){s.tokenChangeCallback.apply(this,[E]);}}},this);if(s.identity){this.setMultiInputContent(e,s.identity);}};A._findFilters=function(k,g){this._INPUT_TAGS_SETTING.suggestion.filters=undefined;if(!k||k.length<=0){return;}var e=[];jQuery.each(k,function(i,K){if(g(K)){e.push(new sap.ui.model.Filter({path:"ID",operator:"NE",value1:g(K)}));}});if(e.length>0){this._INPUT_TAGS_SETTING.suggestion.filters=new sap.ui.model.Filter({filters:e,and:true});}};A.onTagValueChanged=function(e){this.resetClientMessages();var m=e.getSource();var v=e.getParameter("value");if(!v){return;}if(!e.getSource().getAggregation("tokenizer")){return;}var t=e.getSource().getAggregation("tokenizer").getAggregation("tokens");var g=v.split(",");g.forEach(function(s){s=s.trim();if(s===""){return;}var o=new T({text:s});var h;t.forEach(function(o){if(o.getProperty("text")===s){h=true;return;}});if(!h){o.bApplicationCreated=true;m.addToken(o);}});m.setValue("");};A.onTagChanged=function(e){this.resetClientMessages();var m=e.getSource();if(!e.getSource().getAggregation("tokenizer")){return;}var t=e.getSource().getAggregation("tokenizer").getAggregation("tokens");this._findFilters(t,function(o){return o.getProperty("key");});m.setValue("");};A.onReassignCampaign=function(e){var s=e.getSource().getParent().data("context");var o=this._getReassignCampaignDialog();if(s){o.data("context",s);}var m=this.getModel("assignment");m.setSizeLimit(500);var g=this.byId("reassignCampaignList");var r=this.byId("reassignCampaignRespList");this.setViewProperty("/DISPLAY_RESP_LIST",false);g.setValue("");r.setValue("");o.open();};A.onReassignCampaignDialogOK=function(){var t=this;var o=this.byId("reassignCampaignList");var r=this.byId("reassignCampaignRespList");var m=this.getModel("assignment");this.resetClientMessages();var s=o.getSelectedKey();if(this.checkReassignCampaignValidValue(o,r)){var O=this.getOldCampaignFormCode(m);var e=this.getOldCampaignAdminFormCode(m);if(O===m.getProperty("/REASSIGN_CAMPAIGN_FORM_CODE")&&e===m.getProperty("/REASSIGN_CAMPAIGN_ADMIN_FORM_CODE")){this.popConfirmMessageBox([],m,true);}else if(!m.getProperty("/REASSIGN_CAMPAIGN_FORM_CODE")&&!m.getProperty("/REASSIGN_CAMPAIGN_ADMIN_FORM_CODE")){this.popConfirmMessageBox([],m,false);}else{this.getModel("data").read("/CampaignSmall("+s+")/FormFields",{success:function(g){var h=g.results;t.getModel("data").read("/CampaignSmall("+s+")/AdminFormFields",{success:function(i){i.results.forEach(function(j){j.FORM_TYPE_CODE="ADMIN_FORM";});h=h.concat(i.results);t.popConfirmMessageBox(h,m,false);}});}});}}};A.onReassignCampaignDialogSearch=function(e){var v=jQuery.sap.encodeURL(e.getParameter("value"));var s=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var m=this.getDefaultODataModel?this.getDefaultODataModel():this.getModel("data");var V=this.getModel("assignment");m.read("/CampaignSuggestionParams(searchToken='"+v+"',filterName='allCampaignsExceptDraft')/Results",{urlParameters:{"$orderby":"SHORT_NAME","$filter":"ID ne "+s},success:function(o){V.setProperty("/campaignSuggestion",o.results);}});};A.onReassignCampaignDialogItemsSelect=function(e){var t=this;var s=e.getParameter("selectedItem").data("ID")+"";var o=this.byId("reassignCampaignList")||this.getFilterElementById("reassignCampaignList");var g=o.getSuggestionItems();for(var i=0;i<g.length;i++){if(g[i].getProperty("key")===s){o.setSelectionItem(g[i]);t.onReassignCampaignChange();break;}}};A.getOldCampaignAdminFormCode=function(m){var o=this.getModel("data").oData;var e=this._getReassignCampaignDialog();var s=e.data("context");var r=/^IdeaMediumBackofficeSearch/igm;var g=null;if(s==="mass"){if(o){for(var i in o){if(o.hasOwnProperty(i)&&r.exec(i)&&(o[i].CAMPAIGN_ID===m.getProperty("/CAMPAIGN_ID"))){g=o[i].CAMPAIGN_ADMIN_FORM_CODE;break;}}return g;}}else{return m.getProperty("/CAMPAIGN_ADMIN_FORM_CODE");}};A.getOldCampaignFormCode=function(m){var o=this.getModel("data").oData;var e=this._getReassignCampaignDialog();var s=e.data("context");var r=/^IdeaMediumBackofficeSearch/igm;var g=null;if(s==="mass"){if(o){for(var i in o){if(o.hasOwnProperty(i)&&r.exec(i)&&(o[i].CAMPAIGN_ID===m.getProperty("/CAMPAIGN_ID"))){g=o[i].CAMPAIGN_FORM_CODE;break;}}return g;}}else{return m.getProperty("/CAMPAIGN_FORM_CODE");}};A.popConfirmMessageBox=function(e,m,s){var t=this;var o=this._getReassignCampaignDialog();var g=o.data("context");var v;if(g==="mass"){v=this.getModel("assignment").getProperty("/IDS");}else{v=this.getModel("assignment").getProperty("/ID");}var E=function(n,p){switch(n){case f.Action.OK:t._executeReassignCampaignAction(v,p,m);break;case f.Action.CANCEL:break;}t.resetActionState(g==="mass");t.restoreFocusAfterActionDialogClose();t._oReassignCampaignDialog.close();if(t.getView().sViewName==="sap.ino.vc.idea.ListPage"){t.bindList();}};if(!s){var h=[];if(e.length===0){f.confirm(this.getText("IDEA_LIST_REASSIGN_CAMPAIGN_MSG_CHG_NO_FORM_FIELD"),{actions:[f.Action.OK,f.Action.CANCEL],onClose:function(n){E(n,h);}});}else{var j;var k;for(var i=0;i<e.length;i++){if(e[i].MANDATORY){j=true;k=e[i].FORM_TYPE_CODE;break;}if(e[i].FORM_TYPE_CODE==="ADMIN_FORM"){h.push({FIELD_CODE:e[i].CODE,FORM_TYPE_CODE:"ADMIN_FORM"});}else{h.push({FIELD_CODE:e[i].CODE});}}if(j){var l=k==="ADMIN_FORM"?this.getText("IDEA_LIST_REASSIGN_CAMPAIGN_MSG_NOCHG_ADMIN_FORM_FIELD"):this.getText("IDEA_LIST_REASSIGN_CAMPAIGN_MSG_NOCHG_FORM_FIELD");f.error(l,{actions:[f.Action.OK],onClose:function(n){if(n===f.Action.OK){t.resetActionState(g==="mass");t.restoreFocusAfterActionDialogClose();t._oReassignCampaignDialog.close();}}});}else{f.confirm(this.getText("IDEA_LIST_REASSIGN_CAMPAIGN_MSG_CHG_FORM_FIELD"),{actions:[f.Action.OK,f.Action.CANCEL],onClose:function(n){E(n,h);}});}}}else{t._executeReassignCampaignAction(v,undefined,m);t.resetActionState(g==="mass");t.restoreFocusAfterActionDialogClose();t._oReassignCampaignDialog.close();if(t.getView().sViewName==="sap.ino.vc.idea.ListPage"){t.bindList();}}};A.checkReassignCampaignValidValue=function(o,r){var m=this.getModel("assignment");if(!o.getSelectedItem()){var e=new d({code:"IDEA_LIST_REASSIGN_CAMPAIGN_MSG_NO_CAMPAIGN_ID",type:c.Error});this.setClientMessage(e,o);return false;}else{if(m.getProperty("/RESP_CODE")){if(!r.getSelectedItem()){var R=new d({code:"IDEA_LIST_REASSIGN_CAMPAIGN_MSG_NO_RESPLIST_VALUE",type:c.Error});this.setClientMessage(R,r);return false;}else{return true;}}else{return true;}}};A.onReassignCampaignDialogCancel=function(){this.restoreFocusAfterActionDialogClose();this._oReassignCampaignDialog.close();};A.onReassignCampaignSuggestion=function(e){var m=this.getModel("assignment");var t=this;var s=m.getProperty("/CAMPAIGN_ID");var o=this.getDefaultODataModel?this.getDefaultODataModel():this.getModel("data");var E=jQuery.extend({},e,true);var g=jQuery.sap.encodeURL(E.getParameter("suggestValue"));this.resetClientMessages();o.read("/CampaignSuggestionParams(searchToken='"+g+"',filterName='allCampaignsExceptDraft')/Results",{urlParameters:{"$orderby":"SHORT_NAME","$filter":"ID ne "+s},success:function(h){m.setProperty("/campaignSuggestion",h.results);var i=t.byId("reassignCampaignList")||t.getFilterElementById("reassignCampaignList");i.setFilterSuggests(false);}});};A.onHandleReassignCampaignHelp=function(){var t=this;var v=this.getModel("assignment");var s=v.getProperty("/CAMPAIGN_ID");var m=this.getDefaultODataModel?this.getDefaultODataModel():this.getModel("data");m.read("/CampaignSuggestionParams(searchToken='',filterName='allCampaignsExceptDraft')/Results",{urlParameters:{"$orderby":"SHORT_NAME","$filter":"ID ne "+s},success:function(o){v.setProperty("/campaignSuggestion",o.results);var e=t.byId("reassignCampaignList")||t.getFilterElementById("reassignCampaignList");e.setFilterSuggests(false);var g=t.createReassignCampaignListDialog();g.open();}});};A.createReassignCampaignListDialog=function(){if(!this._campaignDialog){this._campaignDialog=this.createFragment("sap.ino.vc.idea.fragments.ReassignCampaignSuggestionSelectList",this.getView().getId());this.getView().addDependent(this._campaignDialog);}return this._campaignDialog;};A.onReassignCampaignChange=function(){var t=this;var m=this.getModel("assignment");var r=this.byId("reassignCampaignRespList");r.setSelectedKey();var o=this.byId("reassignCampaignList");var s=o.getSelectedKey();if(o.getSelectedItem()){this.resetClientMessages();}m.setProperty("/REASSIGN_CAMPAIGN_ID",parseInt(s,10));this.getModel("data").read("/CampaignSmall("+s+")",{success:function(e){m.setProperty("/REASSIGN_CAMPAIGN_NAME",e.NAME);m.setProperty("/REASSIGN_CAMPAIGN_FORM_CODE",e.FORM_CODE);m.setProperty("/REASSIGN_CAMPAIGN_ADMIN_FORM_CODE",e.ADMIN_FORM_CODE);if(e.RESP_CODE){t.setViewProperty("/DISPLAY_RESP_LIST",true);m.setProperty("/RESP_NAME",e.RESP_NAME);m.setProperty("/RESP_CODE",e.RESP_CODE);}else{m.setProperty("/RESP_NAME","");m.setProperty("/RESP_CODE","");t.setViewProperty("/DISPLAY_RESP_LIST",false);}},error:function(e){}});};A.onRespValueChange=function(e){if(e.getSource().getSelectedItem()){this.resetClientMessages();}};A.bindingRespListValue=function(r){var o=this.byId("reassignCampaignRespList");var m=this.getModel("assignment");var t="";var e=this;this.getModel("data").read("/ResponsibilityValueSearchParams(searchToken='"+t+"',respCode='"+r+"')/Results",{urlParameters:{"$orderby":"NAME"},success:function(g){m.setProperty("/Resp_Value",g.results);o.setFilterSuggests(false);}});};A._executeReassignCampaignAction=function(i,e,m){var t=this;var r=this.byId("reassignCampaignRespList");var s=m.getProperty("/REASSIGN_CAMPAIGN_NAME");var g=[];var h=[];if(e&&e.length>0){e.forEach(function(k){if(k.FORM_TYPE_CODE&&k.FORM_TYPE_CODE==="ADMIN_FORM"){delete k.FORM_TYPE_CODE;g.push(k);}else{h.push(k);}});}var p={CAMPAIGN_ID:m.getProperty("/REASSIGN_CAMPAIGN_ID"),FieldsValue:h,AdminFieldsValue:g,RESP_VALUE_CODE:r.getSelectedKey()};var j=Array.isArray(i)?"massReassignCampaign":"reassignCampaign";var o={success:function(){return t.getText("IDEA_OBJECT_MSG_CAMPAIGN_REASSIGNED_SUCCESS",[s]);},error:function(){return t.getText("IDEA_OBJECT_MSG_CAMPAIGN_REASSIGNED_ERROR",[s]);}};return this._executeAssignAction(j,i,p,o,this._getReassignCampaignDialog());};A.onAssignCoachDialogCancel=function(e){this.restoreFocusAfterActionDialogClose();};A.onAssignExpertDialogCancel=function(e){this.restoreFocusAfterActionDialogClose();};A.onAssignTagDialogCancel=function(e){var m=this.byId("Tags");var o=this._getAssignTagDialog();if(m){m.removeAllTokens();m.setValue("");}if(this.resetInputTypeValidations){this.resetInputTypeValidations(o);}o.close();this.restoreFocusAfterActionDialogClose();};A.onAssignTagDialogOK=function(E){var m=this.byId("Tags");var s=this._getAssignTagDialog();var i;var t=this;this.resetClientMessages();if(m){var g=m.getTokens();var n=[];if(g.length===0){var o=new d({code:"IDEA_LIST_ASSIGN_TAG_MSG_NO_TAG",type:c.Error});this.setClientMessage(o,m);}if(!this.hasAnyClientErrorMessages()){g.forEach(function(h){var j={};var k=h.getKey();try{k=parseInt(h.getKey(),10);}catch(e){}j.TAG_ID=k;j.NAME=h.getText();n.push(j);});if(s.data("context")==="mass"){i=t.getModel("assignment").getProperty("/IDS");}else{i=t.getModel("assignment").getProperty("/ID");}t._executeAssignTagAction(i,n);s.close();this.resetActionState(s.data("context")==="mass");this.restoreFocusAfterActionDialogClose();this.bindList();}}};A._executeAssignTagAction=function(i,n){var t=this;var p={};var s=Array.isArray(i)?"massAssignTag":"assignTag";var m=this.byId("Tags");var o={success:function(){m.removeAllTokens();m.setValue("");return t.getText("IDEA_OBJECT_MSG_TAG_ASSIGNED_SUCCESS");},error:function(){return t.getText("IDEA_OBJECT_MSG_TAG_ASSIGNED_ERROR");}};p.Tags=n;return this._executeAssignAction(s,i,p,o,this._getAssignTagDialog());};A.onAssignMeAsCoach=function(e){var s=e.getSource().getParent().data("context");var u=this.getModel("user");var i=u.getProperty("/data/USER_ID");var m=u.getProperty("/data/NAME");var g=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var v;if(s==="mass"){v=this.getModel("assignment").getProperty("/ASSIGNME_IDS");}else{v=this.getModel("assignment").getProperty("/ID");}this._executeAssignCoachAction(v,i,m,g);};A.onUnassignCoach=function(e){var s=e.getSource().getParent().data("context");var g=this.getModel("assignment").getProperty("/COACH_NAME")||undefined;var i=this.getModel("assignment").getProperty("/CAMPAIGN_ID");var v;if(s==="mass"){v=this.getModel("assignment").getProperty("/UNASSIGN_IDS");}else{v=this.getModel("assignment").getProperty("/ID");}this._executeUnassignCoachAction(v,g,i);};A.onMassAssign=function(e){if(this.getViewProperty("/List/SELECT_ALL")){var o=this.getBindingParameter();var i=this._check4ManagingList();var s=this.getList().getBinding('items').sFilterParams;var t=this.getViewProperty("/List/TAGS");var g={};var h=[];t.forEach(function(l,m){if(!g[l.ROOTGROUPID]){g[l.ROOTGROUPID]=[];g[l.ROOTGROUPID].push(l.ID);h.push(l.ROOTGROUPID);}else{g[l.ROOTGROUPID].push(l.ID);}});var p={searchToken:o.SearchTerm||"",tagsToken:g[h[0]]?g[h[0]].join(","):"",tagsToken1:g[h[1]]?g[h[1]].join(","):"",tagsToken2:g[h[2]]?g[h[2]].join(","):"",tagsToken3:g[h[3]]?g[h[3]].join(","):"",tagsToken4:g[h[4]]?g[h[4]].join(","):"",filterName:o.VariantFilter||"",filterBackoffice:i?"1":"0",filterString:s||""};if(this.setQueryObjectIdeaformFilters){this.setQueryObjectIdeaformFilters(p);}if(this.getCampaignFormQuery){p.ideaFormId=this.getCampaignFormQuery()||"";}if(this.getSearchType){p.searchType=this.getSearchType();}if(this.setQueryObjectCompanyViewFilters){this.setQueryObjectCompanyViewFilters(p);}var j=this;var O=jQuery.extend({},e);var k=e.getSource();k.setEnabled(false);jQuery.ajax({url:C.getBackendRootURL()+"/sap/ino/xs/rest/common/select_all_ideas.xsjs",data:p,success:function(r){k.setEnabled(true);if(r.Ideas.length===0){f.show(j.getText("NO_IDEAS_AND_RELOAD_PAGE"),{icon:f.Icon.INFORMATION,actions:[sap.m.MessageBox.Action.OK],onClose:function(){j.bindList();}});return;}j._oSelectionMap={};jQuery.each(r.Ideas,function(l,m){if(!j._oDeselectionMap[m.ID]){m.property=j._createPropertyData(m);j._oSelectionMap[m.ID]=m;}});j.onMassAssignGeneral(O);},error:function(r){M.show(j.getText(r.responseJSON.messageKey));}});}else{this.onMassAssignGeneral(e);}};A.convertToHierarchy=function(o,k,p){var n=this.createStructure(o,p);var t=n.root;this.arrToHierarchy(t,n,k);return t;};A.createStructure=function(n,p){var o={root:[]};for(var i=0;i<n.length;i++){var s="Sub_"+n[i][p];if(!n[i].children||!jQuery.isArray(n[i].children)){n[i].children=[];}if(isNaN(parseInt(n[i][p],10))){o.root.push(n[i]);}else{if(!o.hasOwnProperty(s)){o[s]=[];}o[s].push(n[i]);}}return o;};A.arrToHierarchy=function(t,n,k){if(!t||t.length===0){return;}for(var i=0;i<t.length;i++){var p="Sub_"+t[i][k];if(n.hasOwnProperty(p)){t[i].children=n[p];this.arrToHierarchy(t[i].children,n,k);}}};A.onRespListSuggestion=function(e){var t=this;var m=this.getModel("assignment");var E=jQuery.extend({},e,true);var s=jQuery.sap.encodeURL(E.getParameter("suggestValue"));this.resetClientMessages();this.getModel("data").read("/ResponsibilityValueSearchParams(searchToken='"+s+"',respCode='"+m.getProperty("/RESP_CODE")+"')/Results",{urlParameters:{"$orderby":"NAME"},success:function(o){m.setProperty("/Resp_Value",o.results);t.byId("reassignCampaignRespList").setFilterSuggests(false);}});};A.createRespListHierarchyDialog=function(){if(!this._oRespListTreeDialog){this._oRespListTreeDialog=this.createFragment("sap.ino.vc.idea.fragments.ReassignCampaignResponsibilityListValue",this.getView().getId());this.getView().addDependent(this._oRespListTreeDialog);}return this._oRespListTreeDialog;};A.onHandleRespListValueHelp=function(e){var t=this;var r=t.createRespListHierarchyDialog();r.open();r.setBusy(true);var o=t.byId('respValueTreeTable');var R=t.byId('reassignCampaignRespList');var m=this.getModel("assignment");this.getModel("data").read("/ResponsibilityValueSearchParams(searchToken='',respCode='"+m.getProperty("/RESP_CODE")+"')/Results",{urlParameters:{"$orderby":"NAME"},success:function(g){r.setBusy(false);m.setProperty("/Resp_Value",g.results);var h=t.convertToHierarchy(g.results,"ID","PARENT_VALUE_ID");m.setProperty("/Resp_Value_Tree",h);t.setViewProperty("/ENABLE_OK_BTN",false);t.resetClientMessages();t.byId('reassignCampaignRespList')._closeSuggestionPopup();o.attachBrowserEvent("dblclick",function(){if(o.isIndexSelected(t._treeTableIndex)){o.removeSelectionInterval(t._treeTableIndex,t._treeTableIndex);}else{o.addSelectionInterval(t._treeTableIndex,t._treeTableIndex);}if(t._treeTableIndex>-1){var s=o.getContextByIndex(t._treeTableIndex).getPath();R.setSelectedKey(m.getProperty(s+"/CODE"));R.setValue(m.getProperty(s+"/NAME"));if(t._oRespListTreeDialog){t._oRespListTreeDialog.close();t._oRespListTreeDialog.destroy();t._oRespListTreeDialog=undefined;}}t._treeTableIndex=-1;});},error:function(g){m.setProperty("/Resp_Value_Tree",[]);r.setBusy(false);M.show(g.message);}});};A.onRespValueDialogClose=function(){if(this._oRespListTreeDialog){this._oRespListTreeDialog.close();this._oRespListTreeDialog.destroy();this._oRespListTreeDialog=undefined;}};A.onSelectedItem=function(e){var t=this;var m=this.getModel("assignment");var r=t.byId("respValueTreeTable");var R=t.byId('reassignCampaignRespList');var i=r.getSelectedIndex();if(i>-1){var s=r.getContextByIndex(i).getPath();R.setSelectedKey(m.getProperty(s+"/CODE"));R.setValue(m.getProperty(s+"/NAME"));}if(this._oRespListTreeDialog){this._oRespListTreeDialog.close();this._oRespListTreeDialog.destroy();this._oRespListTreeDialog=undefined;}};A.onRespRowSelectionChange=function(e){var t=this;var r=t.byId("respValueTreeTable");var i=r.getSelectedIndex();if(i>-1){this.setViewProperty("/ENABLE_OK_BTN",true);this._treeTableIndex=i;}else{this.setViewProperty("/ENABLE_OK_BTN",false);}};return A;});
