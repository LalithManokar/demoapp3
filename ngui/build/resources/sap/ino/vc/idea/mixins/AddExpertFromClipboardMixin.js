sap.ui.define(["sap/ino/vc/idea/mixins/BaseActionMixin","sap/m/MessageToast","sap/ino/vc/commons/BaseController","sap/m/MessageBox","sap/ino/commons/models/object/User","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/commons/models/object/Idea"],function(B,M,a,b,U,F,c,I){"use strict";var A=jQuery.extend({},B);A.onAddFromClipboard=function(){var d=this.getAddFromClipboardDialog();d.open();this._bindFromClipboard();};A._bindFromClipboard=function(){var l=this.byId("AddExpertList");var t=this._getClipboardListItem();var e=this._getClipboardExpertIds();if(e.length>0){var f=this._getClipboardItemsFilter(e);l.bindAggregation("items",{path:"data>/SearchIdentity(searchToken='*')/Results",template:t,filters:f,parameters:{select:"ID,NAME,ORGANIZATION,IMAGE_ID"}});}else{l.unbindAggregation("items");}this.aSelectedExperts=[];this.getModel("view").setProperty("/CLIPBOARD_ITEM_SELECT_COUNTER",this.view.CLIPBOARD_ITEM_SELECT_COUNTER+1);};A._getClipboardListItem=function(){if(!this._oClipboardListItem){this._oClipboardListItem=this.createFragment("sap.ino.vc.idea.fragments.AddExpertFromClipboardListItem");}return this._oClipboardListItem;};A._getClipboardExpertIds=function(){var C=this._getClipboardModel();return C.getObjectKeys(U);};A._getClipboardItemsFilter=function(C){var f=[];jQuery.each(C,function(i,e){var o=new F({path:"ID",operator:c.EQ,value1:e});f.push(o);});return(f.length===0)?[]:[new F(f,false)];};A.getAddFromClipboardDialog=function(){if(!this._oAddFromClipboardDialog){this._oAddFromClipboardDialog=this.createFragment("sap.ino.vc.idea.fragments.AddExpertFromClipboard");this.getView().addDependent(this._oAddFromClipboardDialog);}return this._oAddFromClipboardDialog;};A.onAddFromClipboardDialogSelectAll=function(){var t=this;this.aSelectedExperts=[];var l=this.byId("AddExpertList");var L=l.getAggregation("items")||[];jQuery.each(L,function(i,o){var e={id:o.getBindingContext("data").getProperty("ID"),name:o.getBindingContext("data").getProperty("NAME")};t.aSelectedExperts.push(e);});this.getModel("view").setProperty("/CLIPBOARD_ITEM_SELECT_COUNTER",this.getModel("view").getProperty("/CLIPBOARD_ITEM_SELECT_COUNTER")+1);};A.onAddFromClipboardItemSelected=function(e){var C=e.getSource();var s=C.getSelected();var E=C.data("id");var m=jQuery.grep(this.aSelectedExperts,function(o){return o.id===E;});if(s&&m.length===0){var o={id:E,name:C.data("name")};this.aSelectedExperts.push(o);}else if(!s&&m.length!==0){this.aSelectedExperts=jQuery.grep(this.aSelectedExperts,function(o){return o.id!==E;});}};A.isClipboardItemEnabled=function(e,C){var i=this.isActionContextSingleIdeaDisplay()||this.getViewProperty("/IS_EVALUATION_REQUEST")?this.getObjectModel().getProperty("/Experts"):[];return jQuery.grep(i,function(o){return o.IDENTITY_ID===e;}).length===0;};A.isClipboardItemSelected=function(e,C){var i=this.isActionContextSingleIdeaDisplay()||this.getViewProperty("/IS_EVALUATION_REQUEST")?this.getObjectModel().getProperty("/Experts"):[];var E=jQuery.grep(i,function(o){return o.IDENTITY_ID===e;});if(E.length>0){return false;}var m=jQuery.grep(this.aSelectedExperts,function(o){return o.id===e;});return m.length>0;};A.onAddFromClipboardDialogCancel=function(){var d=this.getAddFromClipboardDialog();d.close();};A.onAddFromClipboardDialogOK=function(){var t=this;var e=[];jQuery.each(this.aSelectedExperts,function(i,E){if(t.getViewProperty("/IS_EVALUATION_REQUEST")){e.push({IDENTITY_ID:E.id,NAME:E.name});}else{e.push({IDENTITY_ID:E.id});}});if(e.length>0){t._addExpert(e);}var d=this.getAddFromClipboardDialog();d.close();if(this._oAssignExpertDialog){d=this._oAssignExpertDialog;d._dialog.close();d.destroy();this._oAssignExpertDialog=undefined;this.resetActionState(d.data("context")==="mass");this.restoreFocusAfterActionDialogClose();}};A._addExpert=function(e,E){var t=this;var m=this.isActionContextSingleIdeaDisplay()||this.getViewProperty("/IS_EVALUATION_REQUEST")?this.getObjectModel():I;if(this.getViewProperty("/IS_EVALUATION_REQUEST")){if(Array.isArray(e)&&e.length){jQuery.each(e,function(i,g){m.addExpert(g);});}}else{var v,s;if(this.isActionContextSingleIdeaDisplay()){v=this.getObjectModel().getKey();}else{if(this.getModel("assignment")&&this.getModel("assignment").getProperty("/IDS")){v=this.getModel("assignment").getProperty("/IDS");}else if(this.getModel("assignment")&&this.getModel("assignment").getProperty("/ID")){v=this.getModel("assignment").getProperty("/ID");}}var d=Array.isArray(v);var p={};p.Experts=e;var o={success:function(){return E?t.getText("IDEA_OBJECT_MSG_EXPERT_ASSIGNED_SUCCESS",[E]):t.getText("IDEA_OBJECT_MSG_EXPERTS_ASSIGNED_SUCCESS");},error:function(){return E?t.getText("IDEA_OBJECT_MSG_EXPERT_ASSIGNED_ERROR",[E]):t.getText("IDEA_OBJECT_MSG_EXPERTS_ASSIGNED_ERROR");}};var O={parameters:p,messages:o,staticparameters:this.isActionContextSingleIdeaDisplay()||d?undefined:v};if(d){O.parameters.keys=v;s="massAddExpert";}else{s="addExpert";}var f=a.prototype.executeObjectAction.call(this,m,s,O);return f;}};A._removeExpert=function(e,E){var t=this;var m=this.getObjectModel();if(this.getViewProperty("/IS_EVALUATION_REQUEST")){m=this.getObjectModel();m.removeExpert(e[0].IDENTITY_ID);}else{b.confirm(this.getText("MSG_DEL_CONFIRM"),{onClose:function(d){if(d!==b.Action.OK){return;}else{var p={};p.Experts=e;var o={success:function(){return t.getText("IDEA_OBJECT_MSG_EXPERT_UNASSIGNED_SUCCESS",[E]);},error:function(){return t.getText("IDEA_OBJECT_MSG_EXPERT_UNASSIGNED_ERROR",[E]);}};var O={parameters:p,messages:o,staticparameters:undefined};a.prototype.executeObjectAction.call(t,m,'removeExpert',O);}}});}};A.isActionContextSingleIdeaDisplay=function(){return!!(this.getObjectModel&&this.getObjectModel()&&this.getObjectModel().getMetadata&&this.getObjectModel().getMetadata().getName()==="sap.ino.commons.models.object.Idea");};return A;});
