sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/commons/models/object/Idea","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ino/commons/models/aof/PropertyModel","sap/m/CheckBox"],function(F,a,I,J,M,P,C){"use strict";var D=function(){throw"Mixin may not be instantiated directly";};D._getMarkDuplicateFromClipboardDialog=function(){if(!this._oAddMarkDuplicateFromClipboardDialog){this._oAddMarkDuplicateFromClipboardDialog=this.createFragment("sap.ino.vc.idea.fragments.AddDuplicateIdeaFromClipboard");this.getView().addDependent(this._oAddMarkDuplicateFromClipboardDialog);this._sResizeDuplicateDialog=this.attachListControlResized(this.byId("AddDuplicateIdeaList"));}return this._oAddMarkDuplicateFromClipboardDialog;};D.onAfterClose=function(){var d=this._getMarkDuplicateFromClipboardDialog();this.detachListControlResized(this._sResizeDuplicateDialog);this.getView().removeDependent(d);d.destroy();this._oAddMarkDuplicateFromClipboardDialog=undefined;this.getModel("duplicate").destroy();};D.getDuplicateItemTemplate=function(){if(!this._oIdeaDupClipboardListItemTemplate){this._oIdeaDupClipboardListItemTemplate=this.createFragment("sap.ino.vc.idea.fragments.FlatListItem",this.getView().getId()+"--duplicate");var A=sap.ui.core.Fragment.byId(this.getView().getId()+"--duplicate","flatListIdeaActions");var c=new C({selected:{parts:[{path:"data>ID"},{path:"duplicate>/selectedDupIdeas"}],formatter:this.isClipboardIdeaSelected},select:this.onAddFromClipboardIdeaSelected.bind(this)});A.addItem(c);}return this._oIdeaDupClipboardListItemTemplate;};D.onMarkDuplicateFromClipboard=function(){var d=this._getMarkDuplicateFromClipboardDialog();var o=new J();o.setProperty("/selectedDupIdeas",[]);this.getView().setModel(o,"duplicate");this._bindFromClipboard();d.open();};D.onAddFromClipboardDialogCancel=function(e){this._getMarkDuplicateFromClipboardDialog().close();};D.onAddFromClipboardDialogOK=function(e){var s=this.getModel("duplicate").getProperty("/selectedDupIdeas");if(s&&s.length>0){var t=this;var v=this.getView();v.setBusy(true);var i=t.getObjectModel().getProperty("/ID");var m=s.map(function(o){return I.markAsDuplicate(o.id,[i]);});jQuery.when.apply(jQuery,m).always(function(){v.setBusy(false);t._getMarkDuplicateFromClipboardDialog().close();}).done(function(){t.rebindRelatedItemsList();}).fail(function(){M.show(t.getText("IDEA_RELATED_TIT_MARK_AS_DUPLICATE_FAILED"));});}};D.onAddFromClipboardDialogSelectAll=function(e){var s=[];var l=this.byId("AddDuplicateIdeaList");var L=l.getAggregation("items")||[];jQuery.each(L,function(i,o){s.push({id:o.getBindingContext("data").getProperty("ID")});});this.getModel("duplicate").setProperty("/selectedDupIdeas",s);};D._bindFromClipboard=function(){var l=this.byId("AddDuplicateIdeaList");var c=this._getClipboardModel().getObjectKeys(I);var i=this.getObjectModel().getProperty("/ID");c=c.filter(function(b){return b!==i;});var t=this;if(c.length>0){var m=c.map(function(b){var p=new P("sap.ino.xs.object.idea.Idea",b,{actions:[{"markAsDuplicate":[i]},{"unmarkAsDuplicate":[i]}]},false);return p.getDataInitializedPromise();});var u=[];jQuery.when.apply(jQuery,m).done(function(){jQuery.each(arguments,function(b,d){if(d&&d.actions&&d.actions.markAsDuplicate.enabled){u.push(c[b]);}});c=jQuery.grep(c,function(b){return u.indexOf(b)>-1;});var f=t._getClipboardItemsFilter(c);if(f.length>0){l.bindAggregation("items",{path:"data>/IdeaMedium",template:t.getDuplicateItemTemplate(),filters:f});}else{l.unbindAggregation("items");}});}else{l.unbindAggregation("items");}};D._getClipboardItemsFilter=function(c){var f=[];jQuery.each(c,function(i,b){f.push(new F({path:"ID",operator:a.EQ,value1:b}));});return(f.length===0)?[]:[new F(f,false)];};D.isClipboardIdeaSelected=function(i){var s=this.getModel("duplicate").getProperty("/selectedDupIdeas");if(!s){return false;}var m=jQuery.grep(s,function(o){return o.id===i;});return m.length>0;};D.onAddFromClipboardIdeaSelected=function(e){var s=e.getSource();var S=e.getParameter("selected");var i=s.getBindingContext("data").getProperty("ID");var b=this.getModel("duplicate").getProperty("/selectedDupIdeas").slice(0);var m=jQuery.grep(b,function(o){return o.id===i;});if(S&&m.length===0){b.push({id:i});}else if(!S&&m.length!==0){b=jQuery.grep(b,function(o){return o.id!==i;});}this.getModel("duplicate").setProperty("/selectedDupIdeas",b);};D.onDuplicate=function(e){var t=this;var s=e.getSource();var d=e.getSource()&&e.getSource().getBindingContext("data")&&e.getSource().getBindingContext("data").getProperty("ID");var i=this.getObjectModel().getProperty("/ID");var p=new P("sap.ino.xs.object.idea.Idea",d,{actions:[{"markAsDuplicate":[i]},{"unmarkAsDuplicate":[i]}]},false);p.getDataInitializedPromise().done(function(o){if(o&&o.actions&&o.actions.markAsDuplicate&&o.actions.unmarkAsDuplicate){t.setModel(new J(o),"duplicate");t.getModel("duplicate").setProperty("/duplicateIdeaId",d);t._openDuplicateActionSheet(s);}});};D._openDuplicateActionSheet=function(s){if(!this._oDuplicateActionSheet){this._oDuplicateActionSheet=this.createFragment("sap.ino.vc.idea.fragments.DuplicateActionSheet",this.getView().getId());this.getView().addDependent(this._oDuplicateActionSheet);}jQuery.sap.delayedCall(0,this,function(){this._oDuplicateActionSheet.openBy(s);});};D.onUnmarkAsDuplicate=function(){this.onMark(I.unmarkAsDuplicate,this.getText("IDEA_RELATED_TIT_UNMARK_AS_DUPLICATE_FAILED"));};D.onMarkAsDuplicate=function(){this.onMark(I.markAsDuplicate,this.getText("IDEA_RELATED_TIT_MARK_AS_DUPLICATE_FAILED"));};D.onMark=function(m,t){var i=this.getObjectModel().getProperty("/ID");var d=this.getModel("duplicate")&&this.getModel("duplicate").getProperty("/duplicateIdeaId");var b=this;if(d){m(d,[i]).done(function(){b.rebindRelatedItemsList();}).fail(function(){M.show(t);});}};D.rebindRelatedItemsList=function(){var l=this.byId("idealist-related");l.bindItems(l.getBindingInfo("items"));};return D;});
