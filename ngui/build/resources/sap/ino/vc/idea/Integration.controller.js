sap.ui.define(["sap/ino/commons/models/aof/ApplicationObjectChange","sap/ino/vc/commons/BaseObjectController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/Dialog","sap/m/DialogType","sap/ui/core/ValueState","sap/m/Button","sap/m/ButtonType","sap/m/Text","sap/ino/commons/models/object/IdeaObjectIntegration","sap/m/MessageBox","sap/m/FlexBox","sap/m/Link","sap/ino/commons/application/Configuration"],function(A,B,J,M,D,a,V,b,c,T,I,d,F,L,C){"use strict";return B.extend("sap.ino.vc.idea.Integration",{onInit:function(){B.prototype.onInit.apply(this,arguments);var i=new J();this._initHandleIdeaObjectIntegrationAOChange();this.getView().setModel(i,"integration");this._oRouter=this.getOwnerComponent().getRouter();this._oRouter.attachRouteMatched(this._getIntegrationObjectList,this);},visibleLink:function(f){if(f&&f.indexOf('URL')>-1){return true;}else{return false;}},visibleText:function(f){if(f&&f.indexOf('URL')>-1){return false;}else{return true;}},visibleField:function(f){if(f){return true;}else{return false;}},onAfterRendering:function(){var i=this.getModel("integration");var t=this;var o=this.getObjectModel();var r=this.getOwnerComponent().getRouter().getContext();if(o&&o.getProperty("/ID")&&r.indexOf("sectionIntegration")>-1){this.getView().setBusy(true);I.getIdeaIntegrationList({IDEA_ID:o.getProperty("/ID"),CAMPAIGN_ID:o.getProperty("/CAMPAIGN_ID")}).done(function(e){i.setData(e.RESULT);t.getView().setBusy(false);});}},_getIntegrationObjectList:function(){var i=this.getModel("integration");var t=this;var r=this.getOwnerComponent().getRouter().getContext();if(this.getCurrentRoute()==="idea-display"&&r.indexOf("sectionIntegration")>-1){var o=this.getObjectModel();if(o&&o.getProperty("/ID")){this.getView().setBusy(true);I.getIdeaIntegrationList({IDEA_ID:o.getProperty("/ID"),CAMPAIGN_ID:o.getProperty("/CAMPAIGN_ID")}).done(function(e){i.setData(e.RESULT);t.getView().setBusy(false);});}}},visibleRefresh:function(v){return v;},enableRemove:function(e){return true;},formatDate:function(v,f){if(f&&(f.indexOf('CREATED_AT')>-1||f.indexOf('LAST_REFRESHED_AT')>-1||f.indexOf('DATE')>-1)){var u=new Date(v);var m=u.getTimezoneOffset();var o=u.getTime()+(-m*60*1000);var e=new Date(o);if(!e.getTime()){return v;}else{var g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MMM d, yyyy HH:mm:ss"});return g.format(e);}}else{return v;}},enableLink:function(l){if(!l){return false;}l=l.trim();if(!l||l===""){return false;}if(l&&l.indexOf("http://")!==0&&l.indexOf("https://")!==0&&l.indexOf("mailto:")!==0){l="http://"+l;}return jQuery.sap.validateUrl(l);},onPressRefresh:function(e){var s=e.getSource();s.setBusy(true);var t=this;var o=s.getBinding("enabled");var p=o.getContext().sPath;var i=this.getModel("integration");var f=this.getObjectModel();var r={IDEA_ID:f.getProperty("/ID"),CAMPAIGN_ID:f.getProperty("/CAMPAIGN_ID"),API_TECH_NAME:i.getProperty(p+"/API_TECHNICAL_NAME"),INTEGRATION_OBJECT_UUID:i.getProperty(p+"/INTEGRATION_OBJECT_UUID")};var P=I.queryObject(r);P.done(function(g){s.setBusy(false);var h=g.RESULT.status.toString().includes('20')?'Your request to refresh the integration object has been sent successfully.':'Your request to refresh the integration object has been failed.';var S=h+'The request ID is '+(g.RESULT.generatedId?g.RESULT.generatedId[-1]:'')+' and message status is: '+(g.RESULT.status?g.RESULT.status:'')+'.';var j=new T({text:S});var l=new L({href:C.getBackendRootURL()+'/sap/ino/config#integrationMonitorList',text:'For more detail, please navigate to Innovation Office->Monitor->Integration',target:'_blank'});if(!this.oSuccessMessageDialog){this.oSuccessMessageDialog=new D({type:a.Message,title:g.RESULT.status.toString().includes('20')?V.Success:V.Error,state:g.RESULT.status.toString().includes('20')?V.Success:V.Error,content:new F({items:[j,l],alignItems:"Start",justifyContent:"Start",alignContent:"Start"}),beginButton:new b({type:c.Emphasized,text:"OK",press:function(){this.oSuccessMessageDialog.close();}.bind(this)})});}this.oSuccessMessageDialog.open();});P.fail(function(m){s.setBusy(false);if(m.MESSAGES.length>0){M.show(m.MESSAGES[0].MESSAGE_TEXT);}else{M.show(t.getText("IDEA_OBJECT_INTEGRATION_REFRESH_FAIL"));}});},onPressRemove:function(e){var s=e.getSource();var t=this;var o=s.getBinding("enabled");var p=o.getContext().sPath;var i=this.getModel("integration");var O=i.getProperty(p+"/INTEGRATION_OBJECT_UUID");d.confirm(t.getText("IDEA_OBJECT_INTEGRATION_MSG_CONFIRM_REMOVE"),{title:t.getText("IDEA_OBJECT_INTEGRATION_REMOVE_POP_TITLE"),icon:d.Icon.WARNING,actions:[d.Action.OK,d.Action.CANCEL],onClose:function(f){if(f===d.Action.OK){I.removeObject({INTEGRATION_OBJECT_UUID:O}).done(function(){M.show(t.getText("IDEA_OBJECT_INTEGRATION_REMOVE_SUCCESS"));}).fail(function(){M.show(t.getText("IDEA_OBJECT_INTEGRATION_REMOVE_FAIL"));});}}});},_initHandleIdeaObjectIntegrationAOChange:function(){var t=this;var f=function(e){var s=e&&e.getParameter("actionName");var o=e.getParameter("changeRequest");if(e.getParameter("object").getMetadata().getName()==="sap.ino.commons.models.object.IdeaObjectIntegration"){if(s&&["createObject","queryObject","removeObject","linkExistedObject"].indexOf(s)>-1){var i=t.getObjectModel();var g=t.getModel("integration");I.getIdeaIntegrationList({IDEA_ID:i.getProperty("/ID"),CAMPAIGN_ID:i.getProperty("/CAMPAIGN_ID")}).done(function(r){g.setData(r.RESULT);});}}};A.attachChange(A.Action.Action,f);},rebindList:function(l){if(l){var o=l.getBindingInfo("items");l.bindItems(o);}}});});
