sap.ui.getCore().loadLibrary("sap.ino.wall");sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/wall/util/WallFactory","sap/ino/wall/WallPreview","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/ino/controls/IFrame","sap/ui/core/CustomData","sap/m/Label","sap/m/Link","sap/ino/controls/Image","sap/m/Text","sap/ui/core/mvc/XMLView","sap/ui/core/mvc/ViewType","sap/m/HBox","sap/ui/core/HTML","sap/ino/controls/IdentityActionCard","sap/ino/commons/models/core/ClipboardModel","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/commons/models/object/User","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/idea/mixins/VolunteerMixin","sap/ino/commons/models/core/CodeModel"],function(B,O,W,a,C,J,I,b,L,c,d,T,X,V,H,e,f,g,R,U,h,F,j,k){"use strict";return B.extend("sap.ino.vc.idea.Activities",jQuery.extend({},R,h,F,j,{formatter:O,DISPLAY_EVENTS_IDEA:["CREATED_sap.ino.config.COPIED_SOURCE","CREATED_sap.ino.config.COPIED_TARGET","CREATED_sap.ino.config.DUPLICATE_SOURCE","CREATED_sap.ino.config.DUPLICATE_TARGET","CREATED_sap.ino.config.MERGED_SOURCE","CREATED_sap.ino.config.MERGED_TARGET","DELETED_sap.ino.config.DUPLICATE_SOURCE","DELETED_sap.ino.config.DUPLICATE_TARGET"],DISPLAY_EVENTS_CAMPAIGN:["IDEA_CAMPAIGN_REASSIGN","STATUS_ACTION_SUBMIT"],DISPLAY_EVENTS_WALL:["WALL_ASSIGNED","WALL_UNASSIGNED"],DISPLAY_EVENTS_EVAL:["STATUS_ACTION_sap.ino.config.EVAL_PUB_COMMUNITY","STATUS_ACTION_sap.ino.config.EVAL_PUB_SUBMITTER","STATUS_ACTION_sap.ino.config.EVAL_SUBMIT"],DISPLAY_EVENTS_DIFFTEXT:["IDEA_NAME_CHANGED","IDEA_NAME_DESCRIPTION_CHANGED"],DISPLAY_EVENTS_ATTACHMENT:["ATTACHMENT_ASSIGNED","ATTACHMENT_UNASSIGNED"],DISPLAY_EVENTS_TITLEIMG:["IDEA_TITLE_IMAGE_ASSIGNED","IDEA_TITLE_IMAGE_CHANGED"],DISPLAY_EVENTS_PERSON:["IDEA_COACH_CREATED","IDEA_COACH_DELETED","IDEA_CONTRIBUTOR_CREATED","IDEA_CONTRIBUTOR_DELETED","IDEA_EXPERT_CREATED","IDEA_EXPERT_DELETED"],DISPLAY_EVENTS_LINK:["LINK_CREATED"],DISPLAY_EVENTS_EVAL_REQ:["EVAL_REQ_CREATED","EVAL_REQ_UPDATED","EVAL_REQ_DELETED","EVAL_REQ_EXPIRED","EVAL_REQ_ITEM_CLARIFICATION_SENT","EVAL_REQ_EXPERT_FORWARDED","EVAL_REQ_CHECKED"],onInit:function(){B.prototype.onInit.apply(this,arguments);this.DISPLAY_EVENTS_EXPANDABLE=[].concat(this.DISPLAY_EVENTS_IDEA,this.DISPLAY_EVENTS_CAMPAIGN,this.DISPLAY_EVENTS_WALL,this.DISPLAY_EVENTS_PERSON,this.DISPLAY_EVENTS_DIFFTEXT,this.DISPLAY_EVENTS_ATTACHMENT,this.DISPLAY_EVENTS_LINK,this.DISPLAY_EVENTS_EVAL,this.DISPLAY_EVENTS_TITLEIMG,this.DISPLAY_EVENTS_EVAL_REQ);var A=this.getView().byId("ideaActivitiesList");A.addEventDelegate({onAfterRendering:this._applyGroupingHeaders.bind(this,A)});this._sResizeActivityList=this.attachListControlResized(A);},onBeforeRendering:function(){var A=this.getView().byId("ideaActivitiesList");var o=A.getBindingInfo("items");A.bindItems(o);},onAfterRendering:function(){var A=this.getView().byId("ideaActivitiesList");var o=A.getBinding("items");var t=this;if(o){o.attachDataReceived(function(){t._applyGroupingHeaders(A);},this);}},onExit:function(){B.prototype.onExit.apply(this,arguments);this.detachListControlResized(this._sResizeActivityList);},msgformatter:function(v){var r,m,p,P,s;if(v&&v.CHANGE_EVENT){m="ACTIVITIES_MSG_"+v.CHANGE_EVENT;if(v.CHANGE_CODE==="AUTO_COACH_ASSIGNED"){m+="_AUTO_COACH_ASSIGNED";}p=v.PARAM_0;P=v.PARAM_1;s=v.CAMPAIGN_NAME;if(v.CHANGE_EVENT.indexOf("STATUS_ACTION_")===0){p=this.formatter.ideaPhase(p);}if(v.CHANGE_EVENT.indexOf("CAMPAIGN_")===0){p=this.formatter.ideaPhase(p);P=this.formatter.ideaStatus(P);}if(v.CHANGE_EVENT.indexOf("IDEA_RESP_VALUE_CODE")===0){p=k.getText('sap.ino.xs.object.subresponsibility.ResponsibilityStage.RespValues',p);P=k.getText('sap.ino.xs.object.subresponsibility.ResponsibilityStage.RespValues',P);}r=this.getText(m,["",p,P,s]);if(v.CHANGE_EVENT.indexOf("IDEA_CAMPAIGN_REASSIGN")>-1){var S=this.formatter.ideaStatus(v.STATUS_CODE);var i=this.getText(m+"_STATUS",[S]);r=r+i;}if(r===m){if(v.CHANGE_EVENT.indexOf("STATUS_ACTION_")===0){var l=this.formatter.ideaStatusAction(v.PARAM_1);var n=this.formatter.ideaStatus(v.STATUS_CODE);r=this.getText("ACTIVITIES_MSG_STATUS_ACTION_GENERIC",["",l,n,s]);}else{r=this.getText("ACTIVITIES_MSG_GENERIC_CHANGE_EVENT",[v.CHANGE_EVENT]);}}}return r;},isExpandable:function(o){var E=o.CHANGE_EVENT;if(this.DISPLAY_EVENTS_EXPANDABLE.indexOf(E)!==-1){return true;}else if((E.indexOf("STATUS_ACTION_")===0)&&(o.PARAM_0_ID)&&(E.indexOf("EVAL_REWORK")===-1&&E.indexOf("EVAL_UNPUBLISH")===-1)){return true;}return false;},_createPanelIdea:function(s,i){var S=s;var o;if(i){o=this.getFragment("sap.ino.vc.idea.fragments.FlatListItem").clone();o.addStyleClass("sapMListBGSolid");o.data("source-type","idea");o.bindElement({path:"data>/IdeaMedium("+i+")/"});}else{o=new L({text:this.getText("ACTIVITIES_MSG_IDEA_NON_EXISTENT")});}S.addContent(o);},_createPanelIdentity:function(s,i,u,l,o,r){var m;if(i){m=new f({identityId:i,userImageUrl:l?this.formatter.userImage(l):null,userOrganization:o,userName:u,userRole:r?this.formatter.multipleRoleCodes(r):null,actionable:false,pinnable:this.getModel("clipboard").getProperty("/enabled"),isPinned:this.formatIsUserInClipboard(i),pinPressed:[this.onUserPinPressed,this],identityPress:[this.onOpenIdentityQuickView,this]});}s.addContent(m);},_createPanelCampaign:function(s,i){var o,w,l;if(i){w=this.formatter.widthCampaignCard(this.getModel("device"));o=this.getFragment("sap.ino.vc.campaign.fragments.CardListItem").clone();l=new sap.m.HBox({width:w}).addItem(o);o.getContent()[0].data("source-type","campaign");o.bindElement("data>/CampaignFull("+i+")/");}s.addContent(l);},_createPanelWall:function(s,w){if(w){var u=C.getBackendRootURL()+C.getApplicationObject("sap.ino.xs.object.wall.Wall")+"/"+w;var m=new J(u);m.attachRequestCompleted({controller:this,wallId:w},this._onWallLoaded,s);}},_createPanelTextDiff:function(s,o,n){var i="<div class=\"ideaActivityDiff\">"+this.getText("ACTIVITIES_MSG_TITLE_DIFF",[o&&o.trim()||"",n&&n.trim()||""])+"</div>";var l=new e({content:i,sanitizeContent:true});s.addContent(l);},_createPanelAttachment:function(s,A){var o;if(A){o=this.createView({viewName:"sap.ino.vc.attachment.Attachment",type:V.XML});o.data("editable",false);o.byId("Attachments").setNoDataText(this.getText("ACTIVITIES_MSG_ATTACHMENT_NON_EXISTENT"));o.bindElement("data>/Attachment("+A+")/");}s.addContent(o);},_createPanelTitleImg:function(s,i,l){var o;if(i){var u=C.getAttachmentDownloadURL(i);o=new d({src:u,objectId:i,objectName:l,alt:this.getText("ACTIVITIES_MSG_IMG_NON_EXISTENT")});}s.addContent(o);},_createPanelLink:function(s,u,t){var o;if(u){o=new c({text:t?t:u,target:"_blank",href:u});}s.addContent(o);},_createPanelEvalLink:function(s,E){var o;if(E){o=new c({text:this.getText("ACTIVITIES_MSG_LINK_EVALUATION"),press:[this.onOpenEvaluation,this]});}s.addContent(o);},_createPanelDecision:function(s,D){var o;if(D){o=this.createFragment("sap.ino.vc.idea.fragments.DecisionPanel");o.bindElement("data>/IdeaStatusDecision("+D+")/");}s.addContent(o);},decisionMadeByFormatter:function(D){return this.getText("ACTIVITIES_MSG_DECISION_MADE_BY",[D]);},decisionReasonFormatter:function(r){return this.getText("ACTIVITIES_MSG_DECISION_REASON_COMMENTS",[r]);},decisionReasonCodeFormatter:function(r){var s=this.formatter.valueOption(r);return this.getText('ACTIVITIES_MSG_DECISION_REASON_CODE',[s]);},onDecisionLinkPress:function(E){var o=E.getSource().getBindingContext("data");var u=C.getMailPreviewURL({DECISION:o.getProperty("ID")});var m=new J(u);m.attachRequestCompleted(this.onMailTextLoaded,this);},onMailTextLoaded:function(E){var o=new I({content:E.getSource().getData().TEXT});if(!this._oMailViewDialog){this._oMailViewDialog=this.createFragment("sap.ino.vc.idea.fragments.MailPreviewDialog");this.getView().addDependent(this._oMailViewDialog);}this._oMailViewDialog.addContent(o);this._oMailViewDialog.open();},onMailViewClose:function(E){if(this._oMailViewDialog){this._oMailViewDialog.close();this._oMailViewDialog.destroyContent();}},_createPanelEvalReqText:function(s,E,t){var o;if(E){var l=new L({text:this.getText("ACTIVITIES_MSG_EVAL_REQ_DESCRIPTION")});var i=new T({text:t,maxLines:2});o=new sap.m.HBox({}).addItem(l).addItem(i);}s.addContent(o);},onExpand:function(E){var s=E.getSource();var o=s.getBindingContext("data");if(E.getParameter("expand")&&o){s.toggleStyleClass("sapInoActivityExpanded");var D=o.getObject();var i=D.CHANGE_EVENT;if(this.DISPLAY_EVENTS_IDEA.indexOf(i)!==-1){this._createPanelIdea(s,D.PARAM_0_ID);}else if(this.DISPLAY_EVENTS_PERSON.indexOf(i)!==-1){this._createPanelIdentity(s,D.PARAM_0_ID,D.PARAM_0,D.PARAM_1_ID,D.PARAM_1);}else if(this.DISPLAY_EVENTS_CAMPAIGN.indexOf(i)!==-1){this._createPanelCampaign(s,D.CAMPAIGN_ID);}else if(this.DISPLAY_EVENTS_WALL.indexOf(i)!==-1){this._createPanelWall(s,D.PARAM_0_ID);}else if(this.DISPLAY_EVENTS_DIFFTEXT.indexOf(i)!==-1){this._createPanelTextDiff(s,D.PARAM_1,D.PARAM_0);}else if(this.DISPLAY_EVENTS_ATTACHMENT.indexOf(i)!==-1){this._createPanelAttachment(s,D.PARAM_0_ID);}else if(this.DISPLAY_EVENTS_TITLEIMG.indexOf(i)!==-1){this._createPanelTitleImg(s,D.PARAM_0_ID,D.PARAM_0);}else if(this.DISPLAY_EVENTS_LINK.indexOf(i)!==-1){this._createPanelLink(s,D.PARAM_1,D.PARAM_0);}else if(this.DISPLAY_EVENTS_EVAL.indexOf(i)!==-1){this._createPanelEvalLink(s,D.PARAM_0_ID);}else if(this.DISPLAY_EVENTS_EVAL_REQ.indexOf(i)!==-1){this._createPanelEvalReqText(s,D.PARAM_0_ID,D.PARAM_1);}else if((i.indexOf("STATUS_ACTION_")===0)&&D.PARAM_0_ID){this._createPanelDecision(s,D.PARAM_0_ID,D.PARAM_1_ID);}}else{s.toggleStyleClass("sapInoActivityExpanded");s.removeAllContent();}},_onWallLoaded:function(E,p){var s=E.getSource();var D=s.oData;if(D&&D.ID&&p.controller){var w=W.createWallFromInoJSON(D);var o=new a({owner:D.CREATED_BY_NAME,hits:D.VIEW_COUNT,press:[p,p.controller.onOpenWall,p.controller]});o.setWall(w);this.addContent(o);}else{this.addContent(new T({text:{path:"i18n>ACTIVITIES_MSG_WALL_NON_EXISTENT"}}));}},onOpenEvaluation:function(E){var i=E.getSource().getBindingContext("data").getProperty("PARAM_0_ID");if(i){this.navigateTo("evaluation-display",{id:i});}},onOpenWall:function(E,p){var w=p.wallId;if(w){this.navigateToWall("wall",{id:w});}},onOpenIdea:function(E){var i=E.getSource().getBindingContext("data").getProperty("ID");if(i){this.navigateTo("idea-display",{id:i});}},onItemPress:function(E){var s=E.getSource();var n;switch(s.data("source-type")){case"idea":n="idea-display";break;case"campaign":n="campaign";break;default:break;}var i=E.getSource().getBindingContext("data").getProperty("ID");if(n&&i){this.navigateTo(n,{id:i});}},_applyGroupingHeaders:function(E){var s=E.getSource&&E.getSource()||E;var l=s.getItems(),m,p,P,o;for(var i=0;i<l.length;++i){o=l[i];m=o.getBindingContext("data").getProperty("PHASE_CODE");if(m!==p){P=this.formatter.ideaPhase(m);if(P){o.$().attr("data-actgroup-title",this.getText("ACTIVITIES_TIT_PHASE_GROUP",P));o.$().attr("aria-label",this.getText("ACTIVITIES_TIT_PHASE_GROUP",P));}}else{o.$().removeAttr("data-actgroup-title");o.$().removeAttr("aria-label");}p=m;}}}));});
