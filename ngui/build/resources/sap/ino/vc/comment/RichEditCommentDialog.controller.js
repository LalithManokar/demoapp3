sap.ui.define(["sap/ino/vc/commons/BaseObjectModifyController","sap/ino/vc/comment/RichCommentCntrlMixin","sap/ino/vc/comment/RichCommentAttachmentMixin","sap/ui/core/mvc/ViewType","sap/m/MessageToast","sap/ino/vc/comment/RichCommentMixin"],function(C,R,a,V,M,b){"use strict";return C.extend("sap.ino.vc.comment.RichEditCommentDialog",jQuery.extend({},R,a,b,{_cId:"richEditCommentDialog",_dicODataPaths:{"sap.ino.commons.models.object.IdeaComment":{"Parent":"IdeaComment","Child":"IdeaChildrenComment","Prefix":"COMMENT"},"sap.ino.commons.models.object.InternalNote":{"Parent":"IdeaInternalNote","Child":"IdeaInternalNoteChildrenComment","Prefix":"INTERNALNOTE"}},open:function(i,p,m,v){this._open(i,p,m,v);},_open:function(i,p,m,v){this.setViewProperty("/parentId",p);this.setViewProperty("/id",i);this.setViewProperty("/type",m);this._iId=i;this._modelObjectType=m;this._commentMixinSettings=jQuery.extend(true,{},v);this._commentMixinSettings.commentContainerId="rteCommentReplyContainer";this._commentMixinSettings.type="comment_reply";var t=this;var s={actions:["update","del"],continuousUse:true,readSource:{model:this.getDefaultODataModel()}};var c={height:"300px"};jQuery.sap.require(m);var d=jQuery.sap.getObject(m,0);var o=new d(i,s);this.addSomeMethodIntoModel(o);t.setModel(o,"comment");var D=o.getReadSourceModel();D.read("/"+this._dicODataPaths[m][!p?"Parent":"Child"]+"("+i+")/CommentAttachments",{success:function(f){o.setProperty("/Attachments",f.results);}});var e=t.getView();this._initRTE(c);this.richAttachmentMixinInit();o.getDataInitializedPromise().done(function(f){e.byId(t._cId).open();});},onDeletePressed:function(e){var c=e.getSource().getCustomData();var i=c[0].getValue();var p=c[1].getValue();var m=this.getViewProperty("/type");var v=this.getView();var o=this;var d=this.richCommentMixinOnDel(i,p,m);d.done(function(r){if(r&&r.confirmationCancelled===true){return;}else{o._clearData();v.getParent().getController()._commentMixinRefresh();v.byId(o._cId).close();}});},onCloseDialog:function(){var c=this;var v=this.getView();c._clearData();v.byId(c._cId).close();},onUpdatePressed:function(){var c=this;var d=c.getModel("comment");if(!d.getProperty("/COMMENT")){M.show(this.getText(this._commentMixinSettings.validateMsgKey));return;}d.setProperty("/Imgs",this._getImgIds(d.getProperty("/COMMENT")));var m=this.executeObjectAction("update",{objectModelExt:d,messages:{success:c._commentMixinSettings.updateMsgKey}});var v=this.getView();m.done(function(){c._clearData();v.getParent().getController()._commentMixinRefresh();v.byId(c._cId).close();});},onReplyPressed:function(){var c=this;var d=c.getModel("comment");if(!d.getProperty("/COMMENT")){M.show(this.getText(this._commentMixinSettings.validateMsgKey));return;}d.setProperty("/Imgs",this._getImgIds(d.getProperty("/COMMENT")));d.setProperty("/PARENT_ID",c.getViewProperty("/parentId"));d.setProperty("/OBJECT_ID",this.getModel("object").getProperty("/ID"));var m=this.executeObjectAction("create",{objectModelExt:d,messages:{success:c._commentMixinSettings.createReplyMsgKey,error:function(s){if(s&&s.MESSAGES&&s.MESSAGES.length>0){M.show(s.MESSAGES[0].MESSAGE_TEXT);}}}});var v=this.getView();m.done(function(){c._clearData();v.byId(c._cId).close();v.byId(c._commentReplyControlId).destroy();v.getParent().getController()._commentMixinRefresh();});},onCancelPressed:function(){var v=this.getView();this.resetInputTypeValidations();this._clearData();v.byId(this._cId).close();},_clearData:function(){this.getViewProperty("/parentId",null);this.getViewProperty("/id",null);this._iId=null;this._modelObjectType=null;},formatTitle:function(i,p,t){if(!t){return"";}var T=this._dicODataPaths[t].Prefix;if(i>0){if(!p){T+="_EDIT_OBJECT_TIT";}else{T+="_EDIT_REPLY_OBJECT_TIT";}}else{T+="_CREATE_REPLY_OBJECT_TIT";}return this.getText(T);}}));});
