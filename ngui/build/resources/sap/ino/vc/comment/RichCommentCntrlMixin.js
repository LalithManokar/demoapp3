/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ino/controls/CommentRichTxtEditor","sap/m/Text","sap/ino/commons/application/Configuration"],function(C,T,a){"use strict";var R=function(){throw"Mixin may not be instantiated directly";};R._DIC_NEW_TITLE_LIST_={"sap.ino.commons.models.object.IdeaComment":{"title":"COMMENT_OBJECT_NEW_COMMENT_TIT"}};R._destroyRTECtrl=function(c){var r=this.byId(c);if(r){r.destroy();}};R._initRTE=function(s){var c=this;var r=c._getRTEContainer();var o;if(c._commentMixinSettings.type==="comment"){if(r&&r.getItems().length>1){r.removeItem(r.getItems()[1]);}this._destroyRTECtrl(this._commentControlId);this._commentControlId="commentControl"+new Date().getTime();o=new C({id:c.createId(this._commentControlId),editable:{parts:[{path:'data>COMMENT_HAS_PRIVILEGE'},{path:'data>PARTICIPANT_CAN_COMMENT'},{path:'data>OPEN_STATUS_SETTING'}],formatter:function(i,b,O){return c.formatter.commentEnabled(i,b,O);}},height:"200px"});}else if(c._commentMixinSettings.type==="comment_reply"){if(r&&r.getItems().length>0){r.removeItem(r.getItems()[0]);}this._destroyRTECtrl(this._commentReplyControlId);this._commentReplyControlId="commentReplyControl"+new Date().getTime();o=new C({id:c.createId(this._commentReplyControlId),editable:{parts:[{path:'data>COMMENT_HAS_PRIVILEGE'},{path:'data>PARTICIPANT_CAN_COMMENT'},{path:'data>OPEN_STATUS_SETTING'}],formatter:function(i,b,O){return c.formatter.commentEnabled(i,b,O);}},height:"200px"});}else{if(r&&r.getItems().length>0){r.removeItem(r.getItems()[0]);}this._destroyRTECtrl(this._internalControlId);this._internalControlId="internalControl"+new Date().getTime();o=new C({id:c.createId(this._internalControlId),height:"200px"});}o.attachReady(function onRTEReady(){c.commentMixinForceInitCommentModel();this.bindProperty("value",{model:"comment",path:"/COMMENT"});c._changePosHandleForTinyMce();});if(!c._TITLE_TXT&&c.getBlockView().data("modelObjectType")&&c._DIC_NEW_TITLE_LIST_[c.getBlockView().data("modelObjectType")]){r.insertItem(new T({text:c.getText(c._DIC_NEW_TITLE_LIST_[c.getBlockView().data("modelObjectType")].title)}),0);c._TITLE_TXT=true;}r.addItem(o);};R._getRTEContainer=function(){return this.byId(this._commentMixinSettings.commentContainerId);};R._getImgIds=function(c){if(!c){return[];}var u=this._getAttachmentDownloadUrl();if(!u){return[];}var r=new RegExp(u.substr(u.lastIndexOf("/")+1)+"/(\\d+)","ig");var b=[];var m=r.exec(c);while(m){b.push({ATTACHMENT_ID:Number(m[1])});m=r.exec(c);}return b;};R._getAttachmentDownloadUrl=function(){var u=a.getSystemSetting("sap.ino.config.URL_PATH_XS_ATTACHMENT_DOWNLOAD");if(u){return u.substr(u.lastIndexOf("/")+1);}return"";};R._changePosHandleForTinyMce=function(){var c=this;if(window.tinyMCE&&window.tinyMCE.dom&&window.tinyMCE.dom.DOMUtils&&window.tinyMCE.dom.DOMUtils.prototype.getPos){window.tinyMCE.dom.DOMUtils.prototype.getPos=function(e,r){return c._getPosForTinyMce.call(window.tinyMCE.dom.DOMUtils.DOM,e,r);};}};R._getPosForTinyMce=function(e,r){var s=this,x=0,y=0,o,d=s.doc,b=d.body,p,t="none";e=s.get(e);r=r||b;if(e){if(r===b&&e.getBoundingClientRect&&$(b).css('position')==='static'){p=e.getBoundingClientRect();r=s.boxModel?d.documentElement:b;x=p.left+(d.documentElement.scrollLeft||b.scrollLeft)-r.clientLeft;y=p.top+(d.documentElement.scrollTop||b.scrollTop)-r.clientTop;return{x:x,y:y};}o=e;while(o&&o!==r&&o.nodeType){x+=o.offsetLeft||0;y+=o.offsetTop||0;if(o.translate&&getComputedStyle(o).transform!=="none"){t=getComputedStyle(o).transform.split("(")[1].split(")")[0].split(",");x+=Number(t[4])||0;y+=Number(t[5])||0;}o=o.offsetParent;}o=e.parentNode;while(o&&o!==r&&o.nodeType){x-=o.scrollLeft||0;y-=o.scrollTop||0;o=o.parentNode;}}return{x:x,y:y};};return R;});
