sap.ui.define(["sap/ui/core/mvc/ViewType","sap/ino/vc/commons/BaseObjectController","sap/ino/commons/models/object/IdeaFollow","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel"],function(V,B,I,C,J){"use strict";var a=function(){throw"Mixin may not be instantiated directly";};a.commentMixinInit=function(s){this._commentMixinSettings=s;this.setViewProperty("/USER_IMAGE_ID",this.getOwnerComponent().getCurrentUserImageId());this._commentMixinResetCommentModel();};a._commentMixinResetCommentModel=function(){this._commentMixinSetCommentModel(null);this._commentMixinGetCommentModel();};a._commentMixinInitCommentModel=function(o){var s={continuousUse:true,readSource:{model:this.getDefaultODataModel()}};var m=this.getView().data("modelObjectType");jQuery.sap.require(m);var b=jQuery.sap.getObject(m,0);var M=new b({OBJECT_ID:o},s);this._commentMixinSetCommentModel(M);};a._commentMixinSetCommentModel=function(m){this.getView().setModel(m,"comment");};a._commentMixinGetCommentModel=function(){if(!this.getView().getModel("comment")){var o=this.getView().data("object_id")||(this.getModel("object")&&this.getModel("object").getProperty("/ID"));if(o>0){this._commentMixinInitCommentModel(o);}}return this.getView().getModel("comment");};a.commentMixinSubmit=function(e){var b=e.getSource();b.setEnabled(false);var v=this.getView();var m=this._commentMixinGetCommentModel();var t=v.data("modelObjectType");var s=this._commentMixinSettings.successMessageKey;v.setBusy(true);var c=B.prototype.executeObjectAction.call(this,"create",{messages:{success:s},objectModelExt:m});var d=this;c.done(function(){d._commentMixinResetCommentModel();d._commentMixinRefresh();d.onVotedFollow(t);});c.always(function(){v.setBusy(false);b.setEnabled(true);});};a.onVotedFollow=function(t){var b=this;var i=this.getModel("object");if(i&&i.getProperty("/AUTO_FOLLOW")){var A=i.getProperty("/AUTO_FOLLOW");var f=i.getProperty("/FOLLOW");var c=i.getProperty("/SubmitterContributorsCoach");var p=c.filter(function(s){return s.IDENTITY_ID===C.getCurrentUser().USER_ID;});if(t==="sap.ino.commons.models.object.IdeaComment"&&A&&!f&&!p.length){var d=i.getProperty("/ID");var F=I.follow(d,"IDEA",0);F.done();}}};a.commentMixinOnUserPressed=function(e){var s=e.getSource();var d=e.getParameter("domRef");var c=s.getBindingContext("data");var i=c.getProperty("CHANGED_BY_ID");if(d){var r=sap.ui.getCore().byId(d.id);}if(!this.oIdentityCardView){this.oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});this.getView().addDependent(this.oIdentityCardView);}if(r){this.oIdentityCardView.getController().open(r,i);}else{this.oIdentityCardView.getController().open(s,i);}};a.commentMixinOnDetailPress=function(e){this._commentMixinResetCommentModel();var m=this.getView().data("modelObjectType");if(!this.oEditDialog){var v=this._commentMixinSettings.editDialogViewName;this.oEditDialog=this.createView({type:V.XML,viewName:v});this.getView().addDependent(this.oEditDialog);}var b=e.getSource().getBindingContext("data");var i=b.getProperty(b.sPath).ID;this.oEditDialog.getController().open(i,m);};a._commentMixinRefresh=function(){var l=this._commentMixinSettings.commentListId;var b=this.getView().byId(l).getBindingInfo("items");this.getView().byId(l).bindItems(b);};return a;});
