/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.require("sap.ino.apps.ino.Component");sap.ui.define(["sap/ino/vc/commons/BaseController","sap/ui/core/ComponentContainer","sap/ui/core/routing/History","sap/ui/unified/Menu","sap/ui/core/MessageType","sap/ui/Device","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/ui/core/mvc/ViewType","sap/ui/core/Item","sap/ui/core/CustomData","sap/m/MessageBox","sap/m/MessageToast","sap/m/GroupHeaderListItem","sap/ino/commons/formatters/ObjectListFormatter","sap/ui/core/format/NumberFormat","sap/ino/commons/models/core/ClipboardModel","sap/ino/commons/formatters/BaseFormatter","sap/ino/commons/models/core/CodeModel","sap/ino/vc/commons/mixins/UserGroupMixin","sap/ino/commons/models/object/PersonalizeSetting","sap/ino/vc/commons/mixins/GlobalSearchMixin"],function(C,b,H,M,c,D,d,J,V,I,e,f,g,G,O,N,h,B,i,U,P,j){"use strict";var n=30000;var k={Theme:{HCB:"sap_hcb"},Mail:{Active:"active",Inactive:"inactive"}};return C.extend("sap.ino.vc.shell.InoShell",jQuery.extend({},U,j,{formatter:jQuery.extend({helpMenuButton:function(s){return s.phone;},fullScreenToggle:function(s){return!s.desktop&&window.location.protocol==="https:";},displayTermsConditions:function(){return d.isComponentActive("sap.ino.config.DISPLAY_TERMS_CONDITIONS");},termsConditions:function(s){if(s===null||s===undefined){return undefined;}var m=this.getView().getModel("module");return m.getProperty(s);},version:function(){return this._i18n.getResourceBundle().getText("ABOUT_VERSION_FLD",[this._oComponent.getVersion(),this._oComponent.getVersionTimestamp()]);},text:function(t){return this._i18n.getResourceBundle().getText(t);},icon:function(s){if(jQuery.isNumeric(s)){s=d.getAttachmentTitleImageDownloadURL(s);}else if(s){s="/"+s;}else{s="sap-icon://error";}return s;},groupHeader:function(o){return new G({title:this._i18n.getResourceBundle().getText("MENU_TIT_"+o.key)});},visibleWithSearch:function(s,p,l){return(p!==undefined&&!p)||!s||(l!==undefined&&!l);},visibleAppTitle:function(p,t){if(t.length===0||t.match(/^\s+$/g)){var a=true;}return(p!==undefined&&!p)&&(a===undefined||!a);},generateMailURL:function(m){return sap.m.URLHelper.normalizeEmail(m);},notificationTooltip:function(a){if(a){var o=N.getIntegerInstance({style:"short"});var l=o.format(a);if(l===0){return this._i18n.getResourceBundle().getText("SHELL_EXP_NOTIFICATION_EMPTY");}else if(l===1){return this._i18n.getResourceBundle().getText("SHELL_EXP_NOTIFICATION_SINGLE");}else{return this._i18n.getResourceBundle().getText("SHELL_EXP_NOTIFICATION_COUNT",[o.format(a)]);}}return this._i18n.getResourceBundle().getText("SHELL_EXP_NOTIFICATION_EMPTY");},notificationCountFormatter:function(a){if(a&&a>999){return 999;}return a;},notificationText:function(t){return t.split("{").join("").split("}").join("");},clipboardObjectName:function(s){return s?this._i18n.getResourceBundle().getText("CLIPBOARD_OBJECT_NAME_"+s):"";},navigationItemSelected:function(r,s){if(!r||!s){return false;}if(r===s||r===s+"variant"||r+"list"===s){return true;}var a=jQuery.grep(this.menu.Navigation,function(t){return r===t.TO||r===t.TO+"variant"||r+"list"===t.TO;});if(a.length===0&&r.indexOf("-")>-1){var R=r.split("-");if(R[1]===s||R[1]===s+"variant"){return true;}var S=jQuery.grep(this.menu.Navigation,function(t){return R[1]===t.TO||R[1]===t.TO+"variant";});if(S.length===0&&r.split("-")[0]+'list'===s){return true;}}return false;},navigationItemVisible:function(a,F,m,p,s){var v=(!p||(p&&m))&&(F||(!F&&a));if(s==="evalreqlist"){return v&&d.getSystemSetting("sap.ino.config.EVAL_REQ_ACTIVE")==="1";}if(s==="rewardlist"){return v&&(this.getModel("user").getProperty("/privileges/sap.ino.ui::campaign_manager")||this.getModel("user").getProperty("/privileges/sap.ino.xs.rest.admin.application::execute"))&&d.getSystemSetting("sap.ino.config.REWARD_ACTIVE")==="1";}if(s==="expertfinder"){return v&&(this.getView().getModel("config").oData["sap.ino.config.EXPERT_FINDER_ACTIVE"]==="1");}if(s==="peoplelist"){return v&&(this.getView().getModel("config").oData["sap.ino.config.PEOPLE_MENU_FOR_ALL_ACTIVE"]==="1");}if(s==="leaderboard"){return v&&!!this.getView().getModel("config").oData.ENABLE_GAMIFICATION&&!!this.getView().getModel("config").oData.ENABLE_LEADERBOARD;}return v;},historyEnable:function(a){return Number(a)>=1;},historyTooltip:function(a,l){if(a.length){return this.getText("PAGE_TIT_"+(!a[0].title?"HOME":a[0].title.toUpperCase()));}else{return"";}},historyMenu:function(t){return this.getText("PAGE_TIT_"+(!t?"HOME":t.toUpperCase()));},historyMenuDetail:function(t,s){var a=this.getOwnerComponent().getModel("historyDetail").getProperty("/HashList");var l=null;a.forEach(function(m,o){if(s===m.hash){l=m.detailTitle;}});return l?l:this.getText("PAGE_TIT_"+(!t?"HOME":t.toUpperCase()));},formatChangeLogValue:function(s,a,l){if(l){return B.toDate(l);}else if(a){return a;}else if(s){return s;}else{return"";}},formatIdentityCode:function(s){return i.getFormatter("sap.ino.xs.object.iam.IdentityLogSetting.Root")(s);}},C.prototype.formatter),objectListFormatter:O,menu:{"Navigation":[{"ICON":"sap-icon://InoIcons/idea-add","TITLE":"MENU_MIT_CREATE_IDEA","TO":"idea-create","GROUP":"ACTION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://home","TITLE":"MENU_MIT_HOME","TO":"home","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://InoIcons/campaign","TITLE":"MENU_MIT_CAMPAIGNS","TO":"campaignlist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://lightbulb","TITLE":"MENU_MIT_IDEAS","TO":"idealist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://person-placeholder","TITLE":"MENU_MIT_IDENTITIES","TO":"peoplelist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://InoIcons/wall","TITLE":"MENU_MIT_WALLS","TO":"walllist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://tags","TITLE":"MENU_MIT_TAGS","TO":"taglist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://feed","TITLE":"MENU_MIT_FEEDS","TO":"feedlist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":true},{"ICON":"sap-icon://employee-lookup","TITLE":"MENU_MIT_EXPERT_FINDER","TO":"expertfinder","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":false,"MOBILE_ENABLED":false},{"ICON":"sap-icon://bar-chart","TITLE":"MENU_MIT_REPORTS","TO":"reportlist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":false,"MOBILE_ENABLED":false},{"ICON":"sap-icon://clinical-tast-tracker","TITLE":"MENU_MIT_EVALUATION_REQUEST","TO":"evalreqlist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":false},{"ICON":"sap-icon://competitor","TITLE":"MENU_MIT_REWARDS_MANAGEMENT","TO":"rewardlist","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":false,"MOBILE_ENABLED":false},{"ICON":"sap-icon://InoIcons/leaderboard_fire","TITLE":"MENU_MIT_GAMEFICATION_LEADERBOARD","TO":"leaderboard","GROUP":"NAVIGATION","FRONTOFFICE_ENABLED":true,"MOBILE_ENABLED":false}]},view:{"Picker":{"VARIANT":"templates"},"Search":{"LIMITED_SPACE":D.orientation.portrait}},list:{"Variants":{"Values":[{"TEXT":"WALL_LIST_MIT_MY_TEMPLATES","ACTION":"templates","FILTER":"myWallTemplates"},{"TEXT":"WALL_LIST_MIT_SHARED_TEMPLATES","ACTION":"sharedtemplates","FILTER":"sharedWallTemplates"}]}},requestQueue:[],onInit:function(){C.prototype.onInit.apply(this,arguments);var o=this;var u=sap.ui.getCore().getConfiguration();var a=d.getCurrentUser();if(a){u.setLanguage(a.LOCALE);}if(!a){return;}jQuery.each(d.getStylePaths()||[],function(q,S){jQuery.sap.includeStyleSheet(S);});var s=d.getComponentName();if(("sap.ino.ngui."+s)!=gSAPInoAppName){jQuery.sap.registerModulePath(s,"/"+s.replace(/\./g,"/"));}var l=new b({id:this.createId("componentcontainer"),name:s,height:"100%",width:"100%"});var t=this.byId("toolPage");t.addAggregation("mainContents",l);f._rb=sap.ui.getCore().getLibraryResourceBundle("sap.m");this.setViewData(this.view);if(a){var m=new J({"USER_ID":a.USER_ID,"NAME":a.NAME,"IMAGE_ID":a.IDENTITY_IMAGE_ID});m.setDefaultBindingMode("TwoWay");this.getView().setModel(m,"userData");}if(!D.system.desktop&&(D.system.phone||D.system.tablet)){t.mAggregations.mainContents[0].attachBrowserEvent("click",function(){if(t.getSideExpanded()&&!h.sharedInstance().clipboardVisible){t.setSideExpanded(false);}});}D.orientation.attachHandler(this._onOrientationChange,this);var p=this;h.sharedInstance().attachEvent("objectAdded",function(){p.toggleClipboard(true);});this.getPersonalizeSetting();},updateModel:function(){var a=1;},onExit:function(){D.orientation.detachHandler(this._onOrientationChange,this);},onBeforeRendering:function(){var t=this;var o=d.getSystemSetting('sap.ino.config.OPEN_GROUP_FOR_COMMUNITY_USER')*1;t.setModel(new J(o),'identityData>/open_group');if(o){if(!this.requestQueue.length){this.requestQueue.push(this.getMemberGroups());this.requestQueue[0].done(function(a){t.setModel(new J(a),'identityData>/groups');if(!a||!a.length){t.openUserGroupDialog();}});}}},onAfterRendering:function(){var u=d.getTheme();var s=sap.ui.getCore().getConfiguration().getTheme();if(u&&s!==u){sap.ui.getCore().applyTheme(u);}var o=d.getCurrentUser();var S=d.setupCompleted();if(!o||!S){var a=sap.ui.view({viewName:"sap.ino.vc.commons.BootStrapError",type:sap.ui.core.mvc.ViewType.XML});a.placeAt("content","only");return;}var v=this.getView();var l=this.byId("componentcontainer");this._oShell=this.byId("mainShell");this._oComponent=l.getComponentInstance();var t=this._oComponent.getModel("i18n");this.updatePageLanguage(t.getResourceBundle().sLocale);var m="overflow-y: hidden;"+l.$().attr("style");l.$().attr("style",m);this._i18n=this._oComponent.getModel("i18n");v.setModel(this._i18n,"i18n");var p=this._oComponent.getModel("device");v.setModel(p,"device");var q=this._oComponent.getModel("user");v.setModel(q,"user");var r=this._oComponent.getModel("navigation");v.setModel(r,"navigation");var w=this._oComponent.getModel("config");v.setModel(w,"config");var x=this._oComponent.getModel("module");v.setModel(x,"module");var y=this._oComponent.getModel("code");v.setModel(y,"code");var z=this._oComponent.getModel("data");v.setModel(z,"data");var A=this._oComponent.getModel("notifications");v.setModel(A,"notifications");var E=this._oComponent.getModel("search");v.setModel(E,"search");var F=this._oComponent.getModel("clipboard");v.setModel(F,"clipboard");var r=new J(this.menu);this._oSideNavigation=this.byId("sideNavigation");this._oSideNavigation.setModel(r,"navigationList");var K=this._oComponent.getModel("history");v.setModel(K,"history");jQuery(".sapInoInnoMgmtShell #main--split-canvas").before(jQuery(".sapInoInnoMgmtShell #main--split-pane"));this.byId("openMenu").focus();this.setCategroyData();this.listenRouteMatch();},updatePageLanguage:function(l){var a=jQuery("html");if(l&&!a.attr("lang")){l=l.replace("_","-");a.attr("lang",l);}},_onOrientationChange:function(){var v=this.getModel("view");v.setProperty("/Search/LIMITED_SPACE",D.orientation.portrait);},onToggleFullScreen:function(){var a=window.document;var l=a.documentElement;var r=l.requestFullscreen||l.mozRequestFullScreen||l.webkitRequestFullScreen||l.msRequestFullscreen;var m=a.exitFullscreen||a.mozCancelFullScreen||a.webkitExitFullscreen||a.msExitFullscreen;if(!a.fullscreenElement&&!a.mozFullScreenElement&&!a.webkitFullscreenElement&&!a.msFullscreenElement){r.call(l);}else{m.call(a);}},onShowNotification:function(E){if(!this._oNotificationPopover){this._oNotificationPopover=this.createFragment("sap.ino.vc.shell.fragments.Notifications");this.getView().addDependent(this._oNotificationPopover);}if(!this._oNotificationPopover.isOpen()){this.getModel("notifications").updateNotifications();this._oNotificationPopover.openBy(this.byId("notification"));}else{this.closeNotifications();}},closeNotifications:function(){if(this._oNotificationPopover&&this._oNotificationPopover.isOpen()){this._oNotificationPopover.close();}},onRemoveNotification:function(E){var o=E.getSource();var a=o.getParent().getParent();var l=a.data("notification_id");var m=this.getModel("notifications");m.markNotificationAsRead(l).done(function(){m.updateNotifications();});},onRemoveAllNotifications:function(E){var o=E.getSource();var a=o.data("latest_notification_id");if(a>0){var l=this.getModel("notifications");l.markNotificationsAsRead(a);}this.closeNotifications();},onNotificationNavigate:function(E){var o=E.getSource();var t=o.data("object_type_code");var s=o.data("object_id");var a=o.data("notification_code");if(D.system.phone){this._oNotificationPopover.close();}if(a==="IDEA_DELETED"){return null;}switch(t){case"IDEA":if(a==="COMMENT_CREATED"||a==="COMMENT_DELETED"){this.navigateTo("idea-display",{id:s,query:{section:"sectionComments"}});}else if(a==="EXPERT_ASSIGNED"||a==="EXPERT_UNASSIGNED"){this.navigateTo("idea-display",{id:s,query:{section:"sectionExperts"}});}else if(a==="STATUS_ACTION_sap.ino.config.EVAL_SUBMIT"||a==="STATUS_ACTION_sap.ino.config.EVAL_PUB_SUBMITTER"||a==="STATUS_ACTION_sap.ino.config.EVAL_PUB_COMMUNITY"){this.navigateTo("idea-display",{id:s,query:{section:"sectionEvaluations"}});}else{this.navigateTo("idea-display",{id:s});}break;case"CAMPAIGN":this.navigateTo("campaign",{id:s});break;case"REGISTRATION_REQUEST":if(a==='CAMP_REGISTER_CREATED'){this.navigateTo("registerapprovallist");}else{this.navigateTo("campaign",{id:s});}break;case"EVAL_REQUEST_ITEM":this.navigateTo("evaluationrequest-item",{id:s});break;case"EVAL_REQUEST":this.navigateTo("evaluationrequest-display",{id:s});break;default:break;}this.closeNotifications();},showMenu:function(s){if(this._oSplitContainer){if(D.system.phone){this.byId("openMenu").setSelected(s);this.byId("menutoolbar").setProperty("visible",false);this._oSplitContainer.setSecondaryContentSize("100%");}else{this._oSplitContainer.setSecondaryContentSize("250px");}this._oSplitContainer.setShowSecondaryContent(s);}},onShowMenu:function(E){if(h.sharedInstance().clipboardVisible){this.toggleClipboard(false);if(!this._oToolPage){this._oToolPage=this.byId("toolPage");}this._oToolPage.setSideExpanded(!this._oToolPage.getSideExpanded());}else{if(!this._oToolPage){this._oToolPage=this.byId("toolPage");}this._oToolPage.setSideExpanded(!this._oToolPage.getSideExpanded());if(D.system.phone){this._oToolPage.getAggregation('sideContent').setExpanded(this._oToolPage.getSideExpanded());}E.getSource().setTooltip(this._oToolPage.getSideExpanded()?this._i18n.getResourceBundle().getText("SHELL_EXP_MENU_COLLAPSE"):this._i18n.getResourceBundle().getText("SHELL_EXP_MENU_EXPAND"));}},onLogoIcon:function(E){this._oComponent.navigateTo("home");},onNavigate:function(E){var o=E.getSource();var s=o.data("TO");if(s&&s!==""){var a=this.getModel("navigation").getProperty("/Route");if(a!==s){this.getModel("navigation").setProperty("/Route",s);var l=o.getBindingContext("navigationList").getObject().ON_NAV;if(l){l(this,o,s);}else{this._oComponent.navigateTo(s);}}}else{this._oComponent.showMessage(c.Error,this._i18n.getResourceBundle().getText("NAVIGATION_EXP_UNKNOWN_TARGET"));}if(D.system.phone){var t=this.byId("toolPage");t.setSideExpanded(false);}var m=!!o.getBindingContext("navigationList").getObject().KEEP_MENU_OPEN;this.showMenu(m);},onNavFooterPressed:function(E){var o=E.getSource();switch(o.data("ITEM")){case"HELP_CLIPBOARD":this.openHelpScreen("HELP_EXP_CLIPBOARD");break;case"HELP":this.openHelpScreen();break;case"CLIPBOARD":this.toggleClipboard(true);break;default:break;}},onLogout:function(){this._oComponent.logout();},onUserOpen:function(E){var t=this;var o=E.getSource();if(!this._oUserActionSheet){this._oUserActionSheet=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.UserAction",this);this._oUserActionSheet.addStyleClass("sapInoMobileCancel");this._oUserActionSheet.attachAfterClose(function(){if(!t._getUserDataDialog().isOpen()&&!t._getSettingsDialog().isOpen()&&!t._getTermsDialog().isOpen()&&!t._getAboutDialog().isOpen()){o.focus();}},this);this.getView().addDependent(this._oUserActionSheet);}this._oUserActionSheet.openBy(o);},onBackBtnPress:function(){var o=this.getModel("history");var a=o.getProperty("/HashList");var l=a[0];var m=l;var u=location.href.split("#")[0]+"#/"+l.hash;a.shift();o.setProperty("/CurrentHash",m);o.setProperty("/HashList",a);o.setProperty("/Count",a.length);this._oComponent.navigateToByURL(u);},onBackMenuPress:function(E){var s=E.getSource();var a=s.getBindingContext("history").getProperty("hash");var u=location.href.split("#")[0]+"#/"+a;var o=this.getModel("history");var l=o.getProperty("/HashList");var m=s.getBindingContext("history").sPath.split("/");var p=Number(m[m.length-1]);var q=l[p];l=l.slice(p+1);o.setProperty("/CurrentHash",q);o.setProperty("/HashList",l);o.setProperty("/Count",l.length);this._oComponent.navigateToByURL(u);},onBackMenuOpen:function(E){var o=E.getSource();var a=$(o.getDomRef()).next("a");if(this.getOwnerComponent().getModel("historyDetail").getProperty("/HashList").length>10000){var l=this.getOwnerComponent().getModel("historyDetail").getProperty("/HashList");var u=jQuery.extend([],this.getModel("history").getProperty("/HashList"));u.push(this.getModel("history").getProperty("/CurrentHash"));var m=[];l.forEach(function(p,q){if(u.find(function(r,q){return r.hash===p.hash;})){m.push(p);}});this.getOwnerComponent().getModel("historyDetail").setProperty("/HashList",m);}if(!this._oBackActionSheet){this._oBackActionSheet=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.BackAction",this);this._oBackActionSheet.addStyleClass("sapInoMobileCancel sapUiBackActionSheet");this.getView().addDependent(this._oBackActionSheet);}this._oBackActionSheet.attachAfterClose(function(){a.focus();o._toggleIcon(a,"sap-icon://slim-arrow-down");},this);this._oBackActionSheet.openBy(a);},_getUserDataDialog:function(){var t=this;if(!this._oUserDataDialog){this._oUserDataDialog=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.UserDataDialog",this);this.getView().addDependent(this._oUserDataDialog);if(!D.system.phone){this._oUserDataDialog.getContent()[0].addStyleClass("sapUiSmallMargin sapInoUserDataDialog");}var a=t._oComponent.getCurrentUserId();t._oIdentityModel=new J();if(d.getUserProfileByTextURL(a)){t._oIdentityModel.loadData(d.getUserProfileByTextURL(a),{"USER_ID":a},true,"GET");t._oIdentityModel.attachRequestCompleted(null,function(){var l=t._oIdentityModel.getData();l['open_group']=d.getSystemSetting('sap.ino.config.OPEN_GROUP_FOR_COMMUNITY_USER')*1;t._oIdentityModel.setData(l);t._oUserDataDialog.setModel(t._oIdentityModel,"identityData");if(sap.ui.getCore().byId("identityLogList")){sap.ui.getCore().byId("identityLogList").bindItems({path:"data>/Identity("+a+")/IdentityLog",sorter:new sap.ui.model.Sorter("CHANGED_AT",true),template:this.getFragment("sap.ino.vc.iam.fragments.IdentityLogTemplate")});}},t);}this._oUserDataDialog.attachAfterClose(function(){t._oShell.getUser().focus();});}return this._oUserDataDialog;},onUserData:function(){var t=this;var o=t._getUserDataDialog();jQuery.sap.delayedCall(0,this,function(){o.open();if(this.byId("changeHistoryLog")){this.byId("changeHistoryLog").bindItems({path:"data>/Identity("+t._oComponent.getCurrentUserId()+")/IdentityLog/Results"});}this.getMemberGroups().done(function(a){t.setModel(new J(a),'identityData>/groups');});});},onUserDataClose:function(){var a=this._getUserDataDialog();a.close();},openHelpPressed:function(){this.openHelpScreen();},openHelpScreen:function(t){this._oComponent.getRootController().openHelpScreen(t);},toggleClipboard:function(s){var S=this.byId("sideNavigation");var t=this.byId("toolPage");if(!this._oClipboardFragment){this._oNavigationFragment=S.getItem();this._oNavigationFooterFragment=S.getFixedItem();this._oClipboardFragment=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.Clipboard",this);this._oClipboardFooterFragment=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.ClipboardFooter",this);}if(s){S.setItem(this._oClipboardFragment);S.setFixedItem(this._oClipboardFooterFragment);if(!t.getSideExpanded()){t.setSideExpanded(true);}h.sharedInstance().clipboardOpened();}else{S.setItem(this._oNavigationFragment);S.setFixedItem(this._oNavigationFooterFragment);if(t.getSideExpanded()){t.setSideExpanded(false);}h.sharedInstance().clipboardClosed();}},onCloseClipboard:function(){var t=this.byId("toolPage");t.setSideExpanded(false);this.toggleClipboard(false);},onRemoveAllClipboardObjects:function(){h.sharedInstance().remove();},onRemoveClipboardObject:function(E){var s=E.getSource();var o=s.data("OBJECT_NAME");var K=s.data("OBJECT_KEY");var a=h.loadObject(o);h.sharedInstance().remove(a,K);},onOpenClipboardObject:function(E){var s=E.getSource();var o=s.data("OBJECT_NAME");var K=s.data("OBJECT_KEY");switch(o){case"sap.ino.commons.models.object.Idea":this.navigateTo("idea-display",{id:K});break;case"sap.ino.commons.models.object.User":if(!this.oIdentityCardView||this.oIdentityCardView.getController()===null){this.oIdentityCardView=sap.ui.xmlview({viewName:"sap.ino.vc.iam.IdentityCard"});s.addDependent(this.oIdentityCardView);}this.oIdentityCardView.getController().open(s,K);break;default:break;}},_getSettingsDialog:function(){var t=this;if(!this._oSettingsDialog){this._oSettingsController=sap.ui.controller("sap.ino.vc.shell.Settings");var u=this.getView()&&this.getView().getModel("userData");if(u&&this._oSettingsController.setUserDataModel){this._oSettingsController.setUserDataModel(u);}this._oSettingsView=sap.ui.view({type:V.XML,viewName:"sap.ino.vc.shell.Settings",controller:this._oSettingsController});this._oSettingsDialog=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.SettingsDialog",this);this.getView().addDependent(this._oSettingsDialog);this._oSettingsDialog.addContent(this._oSettingsView);this._oSettingsDialog.attachAfterClose(function(){t._oShell.getUser().focus();});}return this._oSettingsDialog;},onSettings:function(){this._getSettingsDialog().open();},_cropImage:function(o){var t=this;var a=jQuery.Deferred();var F=o.crop();if(F){jQuery.sap.require("sap.ino.commons.models.object.Attachment");var A=sap.ino.commons.models.object.Attachment;A.uploadFile(F).done(function(r){var l=t._oSettingsController.getObjectModel();l.setUserImage({"ATTACHMENT_ID":r.attachmentId,"FILE_NAME":r.fileName,"MEDIA_TYPE":r.mediaType});a.resolve({messages:[{"TYPE":"I","MESSAGE":"SETTINGS_MSG_USER_IMAGE_CROP","MESSAGE_TEXT":t.getText("SETTINGS_MSG_USER_IMAGE_CROP"),"REF_FIELD":""}]});}).fail(function(){g.show(t.getText("SETTINGS_MSG_USER_IMAGE_CROP_FAILED"));a.reject();});}else{a.resolve();}return a.promise();},_openRestartDialog:function(){var m=this.getText("SETTINGS_RESTART_MESSAGE");var t=this.getText("SETTINGS_RESTART_TITLE");var r=function(a){if(a===f.Action.YES){location.reload();}};f.confirm(m,{icon:f.Icon.ERROR,title:t,actions:[f.Action.YES,f.Action.NO],onClose:r,styleClass:"sapUiSizeCompact"});},onSettingsOk:function(){throw new Error("obsolete method.");var t=this;var _=function(){var v=t._oSettingsView;var a=t._oSettingsController.getObjectModel();var l=v.byId("settingLOCALE");var m=v.byId("settingMAIL");var p=v.byId("settingHCB");var s=p.getSelected()?k.Theme.HCB:"";t._sHCBPropOLD=a._oBeforeData.Settings.THEME;t._sHCBPropOLD=(t._sHCBPropOLD===null)?"":t._sHCBPropOLD;t._sLocalePropOLD=a._oBeforeData.Settings.LOCALE;t._sLocalePropOLD=(t._sLocalePropOLD===null)?"":t._sLocalePropOLD;var r=a.updateUserSettings([{SECTION:"locale",KEY:"locale",VALUE:l.getSelectedKey()},{SECTION:"notification",KEY:"mail",VALUE:m&&m.getSelected()?k.Mail.Active:k.Mail.Inactive},{SECTION:"ui",KEY:"theme",VALUE:s}]);a.modify();r.always(function(){var q=a.getProperty("/Settings/THEME");q=(q===null)?"":q;var L=a.getProperty("/Settings/LOCALE");L=(L===null)?"":L;var R=(L!==t._sLocalePropOLD)||(q!==t._sHCBPropOLD);if(R){t._openRestartDialog();}});r.done(function(){d.refreshBackendConfiguration();});};var o=this._oSettingsView.byId("imageSettingCropping");this._cropImage(o).done(_);},onSettingsCancel:function(){this._getSettingsDialog().close();},_getTermsDialog:function(){var t=this;if(!this._oTermsDialog){this._oTermsDialog=this.getTermsDialog(this);d.getUserModel().setProperty("/data/TERMACTION",false);d.getUserModel().setProperty("/data/USER_ACCEPTED",1);this._oTermsDialog.attachAfterClose(function(){t._oShell.getUser().focus();});}return this._oTermsDialog;},onTermsConditions:function(){this._getTermsDialog().open();},_getAboutDialog:function(){var t=this;if(!this._oAboutDialog){this._oAboutDialog=sap.ui.xmlfragment("sap.ino.vc.shell.fragments.AboutDialog",this);this.getView().addDependent(this._oAboutDialog);this._oAboutDialog.attachAfterClose(function(){t._oShell.getUser().focus();});}return this._oAboutDialog;},onAbout:function(){this._getAboutDialog().open();},onAboutClose:function(){this._getAboutDialog().close();},selectGroupTab:function(a){var s=this;var p=a.getParameters();if(p.selectedKey==='userDataGroupPage'){var l=this._bindUserGroupModel();var t=p.selectedItem.getContent()[0];t.getBinding('rows').filter([]);l.attachRequestCompleted(function(){s.reBindSelectedData(t);});}},_getUserGroupDialog:function(){if(!this._userGroupDialog){this._userGroupDialog=sap.ui.xmlfragment('sap.ino.vc.shell.fragments.UserGroupDialog',this);this._bindUserGroupModel(this._userGroupDialog);this.getView().addDependent(this._userGroupDialog);}return this._userGroupDialog;},openUserGroupDialog:function(){var a=this._getUserGroupDialog();return a.open();},onSubmitSelectedGroups:function(){var s=this;var a=this.putGroupSelected(this._getUserGroupDialog().getContent()[0],true);if(a){a.done(function(){g.show(s.getText('USER_GROUP_SELECT_SUCCESS'));s._getUserGroupDialog().close();});}},onPersonalize:function(){var s=this;var a=d.getPersonalize();s.getView().setModel(new J(a),'PERSONALIZE');return this._getPersonalizeDialog().open();},closePersonalize:function(){return this._getPersonalizeDialog().close();},_getPersonalizeDialog:function(){if(!this._personalizeDialog){this._personalizeDialog=sap.ui.xmlfragment('sap.ino.vc.shell.fragments.Personalize',this);this.getView().addDependent(this._personalizeDialog);}return this._personalizeDialog;},getPersonalizeSetting:function(){var a=P.defaultPesonalize;return $.extend(a,d.getPersonalize());},personalizeSave:function(){var s=this;var p=s.getView().getModel('PERSONALIZE');var a=p.getData();P.updateSettings({personalize:a}).done(function(){g.show(s.getText("PERSONALIZE_CHANGE_SUCCESS"));s.getView().setModel(new J(a),'PERSONALIZE');s._getPersonalizeDialog().close();});},onPersonalSetting:function(){this.navigateTo('mySetting');},formatterLatestNotificationId:function(a){if(a&&a.length>0){return a.sort(function(p,o){return o.ID-p.ID;})[0].ID;}}}));});
