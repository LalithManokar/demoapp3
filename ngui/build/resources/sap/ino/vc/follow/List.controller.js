sap.ui.define(["sap/ino/vc/commons/BaseVariantListController","sap/ui/Device","sap/ui/model/Sorter","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ino/commons/application/Configuration","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/commons/mixins/TagCardMixin","sap/ino/controls/OrientationType","sap/m/MessageToast","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/vc/idea/mixins/VoteMixin","sap/ino/vc/idea/mixins/VolunteerMixin"],function(B,D,S,J,F,a,C,O,T,b,c,d,M,R,V,f){"use strict";var o={ASC:"ASC",DESC:"DESC"};var s={NAME:"NAME",CREATED_AT:"FOLLOW_DATE"};var v={CAMPAIGN:"campaign",IDEA:"idea",TAG:"tag"};var m={NONE:undefined};var l={ADJUSTMENT_TITLE:"FOLLOWED_OBJECT_LIST_TIT_ADJUSTMENT",Filter:{},Sequence:['campaign','idea','tag'],Sorter:{Values:[{TEXT:"SORT_MIT_NAME",ACTION:s.NAME,DEFAULT_ORDER:o.ASC},{TEXT:"SORT_MIT_FOLLOW",ACTION:s.CREATED_AT,DEFAULT_ORDER:o.ASC}]},Order:{Values:[{TEXT:"ORDER_MIT_ASC",ACTION:o.ASC},{TEXT:"ORDER_MIT_DESC",ACTION:o.DESC}]},Variants:{DEFAULT_VARIANT:v.CAMPAIGN,TITLE:"FOLLOWED_OBJECT_LIST_TIT_VARIANTS",Values:[{TEXT:"FOLLOWED_OBJECT_LIST_MIT_CAMPAIGN",ACTION:v.CAMPAIGN,FILTER:m.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true,OBJECT_COUNT:undefined},{TEXT:"FOLLOWED_OBJECT_LIST_MIT_IDEA",ACTION:v.IDEA,FILTER:m.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true,OBJECT_COUNT:undefined},{TEXT:"FOLLOWED_OBJECT_LIST_MIT_TAG",ACTION:v.TAG,FILTER:m.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true,OBJECT_COUNT:undefined}]}};var L={FOLLOW:"followlist",FOLLOW_VARIANT:"followlistvariant"};var g=B.extend("sap.ino.vc.follow.List",jQuery.extend({},T,R,b,c,V,f,{routes:["followlist","followlistvariant"],initialFocus:"mainFilterButton",list:l,formatter:O,view:{"List":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.CAMPAIGN,"Default":{"SORT":s.NAME,"ORDER":undefined,"VARIANT":v.CAMPAIGN}},"ORIENTATION":d.LANDSCAPE},onInit:function(){B.prototype.onInit.apply(this,arguments);this.oViewModel=this.getModel("view")||new J({});this.oViewModel.setData(this.view,true);this.getList().attachUpdateFinished(this.onListUpdateFinished,this);},onRouteMatched:function(e,h){var q;var i;if(e&&e.getParameter){var A=e.getParameter("arguments");this._sRoute=e.getParameter("name");q=A["?query"];i=A.variant;}else{this._sRoute=e;q=h;i=h.variant;}var j=this.getListProperty("/Variants/DEFAULT_VARIANT");this.setViewProperty("/List/VARIANT",i||j);i=this.getViewProperty("/List/VARIANT");var k;var n=this.getVariant(i);var p=this.getList().isBound("items");if(!q||!q.sort){var r=n.DEFAULT_SORT;var t=this.getSort(r).DEFAULT_ORDER;q=q||{};q.sort=q.sort||r;q.sort=q.sort+" "+(q.order||t);}var u=this.hasStateChanged(this._sRoute,i,q,D.orientation.portrait);if(!p||u){this.setParameters(q,n);k=this.getSort(this.getViewProperty("/List/SORT"));this.setSorter(k);var w=this.getViewProperty("/ORIENTATION");this.onOrientationChange(D.system.desktop?w:D.orientation);this.setSortIcon(this.byId("panelFilterFragment--sortreverse"),this.getViewProperty("/List/ORDER"));this.bindList();this.initialSorterItems();}this._bInnerViewNavigation=true;if(D.system.desktop&&this._bAutoOpenFilter!==false){this.onShowFilterBar(true);this._bAutoOpenFilter=false;}this.setHelp("FOLLOW_LIST");},bindList:function(){var e=this.getViewProperty("/List/VARIANT");this.saveState();this.setPath("data>/"+this.getBindingPath(e));B.prototype.bindList.apply(this);},getBindingPath:function(e){if(e==="campaign"){return"MyCampaignFollow";}else if(e==="idea"){return"MyIdeaFollow";}else{return"MyTagFollow";}},getVariantNumer:function(e){var h=this.getListProperty("/Sequence");return h&&h.indexOf(e);},getList:function(){return this.byId("objectlist");},onListUpdateFinished:function(e){var h=this.getViewProperty("/List/VARIANT");this.setListProperty("/Variants/Values/"+this.getVariantNumer(h)+'/OBJECT_COUNT',e.getParameter('total'));},getItemTemplate:function(){var e=this.getViewProperty("/List/VARIANT");if(e==='tag'){return this.getFragment("sap.ino.vc.tag.fragments.CardListItem");}var r;if((!D.system.desktop&&D.orientation.landscape)||(D.system.desktop&&this.getViewProperty("/ORIENTATION")===d.LANDSCAPE)){r="Landscape";}else{r="Portrait";}var t;switch(r){case"Landscape":t=this.getFragment("sap.ino.vc."+e+".fragments.FlatListItem");break;case"Portrait":t=this.getFragment("sap.ino.vc."+e+".fragments.CardListItem");break;default:break;}return t;},onOrientationChange:function(e){if(this.getList()){var h=this.getViewProperty("/List/VARIANT");if(h==='tag'){if(this.getPortraitStyle){this.getList().addStyleClass(this.getPortraitStyle());}if(this.getLandscapeStyle){this.getList().removeStyleClass(this.getLandscapeStyle());}this.getList().setWrapping(true);return;}if(e===d.LANDSCAPE||e.landscape){if(this.getPortraitStyle){this.getList().removeStyleClass(this.getPortraitStyle());}if(this.getLandscapeStyle){this.getList().addStyleClass(this.getLandscapeStyle());}}else{if(this.getPortraitStyle){this.getList().addStyleClass(this.getPortraitStyle());}if(this.getLandscapeStyle){this.getList().removeStyleClass(this.getLandscapeStyle());}}this.getList().setWrapping(!(e===d.LANDSCAPE||e.landscape));}},setParameters:function(q,e){B.prototype.setParameters.apply(this,arguments);},getDefaultVariantValue:function(){return[{TEXT:"FOLLOWED_OBJECT_LIST_MIT_CAMPAIGN",ACTION:v.CAMPAIGN,FILTER:m.NONE,DEFAULT_SORT:s.NAME,VISIBLE:true}];},onOpenIdea:function(E){var i;if(E.getParameter("ideaId")){i=E.getParameter("ideaId");}else{try{if(E.getSource().getProperty("objectId")){i=E.getSource().getProperty("objectId");}}catch(e){i=E.getSource().getBindingContext("data").getProperty("ID");}}if(i){this.navigateTo("idea-display",{id:i});}},onOpenCampaign:function(e){this.navigateTo("campaign",{id:e.getParameter("campaignId")});},onItemPress:function(e){var i=e.getSource();var h=i.getBindingContext("data");var j=e.getSource().getBindingContext("data").getProperty("CAMPAIGN_ID");if(j){this.navigateTo("idea-display",{id:e.getSource().getBindingContext("data").getProperty("ID")});}else if(h){this.navigateTo("campaign",{id:h.getProperty("ID")});}},onCreateIdea:function(e){this.navigateTo("idea-create",{query:{campaign:e.getParameter("campaignId")}});},onIdeaCommentPress:function(E){var i;if(E.getParameter("ideaId")){i=E.getParameter("ideaId");}else{try{if(E.getSource().getProperty("objectId")){i=E.getSource().getProperty("objectId");}}catch(e){i=E.getSource().getBindingContext("data").getProperty("ID");}}if(i){this.navigateTo("idea-display",{id:i,query:{section:"sectionComments"}});}}}));g.list=l;g.listContext=L;return g;});
