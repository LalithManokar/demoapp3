sap.ui.define(["sap/ino/vc/blog/List.controller","sap/ino/vc/commons/TopLevelPageFacet","sap/ui/Device","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/ino/commons/models/aof/PropertyModel","sap/ino/vc/commons/mixins/TagGroupMixin"],function(B,T,D,C,J,P,a){"use strict";return B.extend("sap.ino.vc.campaign.CampaignBlogList",jQuery.extend({},T,a,{routes:["campaign-bloglist","campaign-bloglistvariant"],onInit:function(){B.prototype.onInit.apply(this,arguments);this.setViewProperty("/HIDE_CAMPAIGN_FILTER",true);this.setViewProperty("/List/IS_FILTER_SUBPAGE",false);},onRouteMatched:function(e){this.setGlobalFilter([]);var A=e.mParameters.arguments;var q=A["?query"]||{};q.campaign=A.id;q.variant=A.variant;var t=this;var v=this.getView();var I=function(){t.updateBackgroundColor(v.getBindingContext("data").getProperty("COLOR_CODE"));t.show((this.getRoute()==="campaign-bloglist")?"bloglist":"bloglistvariant",q);};var s=function(E){var p=E.getSource();var V=t.getModel("list").getProperty("/Variants/Values");for(var i=0;i<V.length;i+=1){var b=V[i];var c=b.MANAGE||false;var d=!c||(c&&p.getProperty("/nodes/Root/customProperties/backofficeCampaignPrivilege"));t.getModel("list").setProperty("/Variants/Values/"+i+"/VISIBLE",d);}p.destroy();};this._iCampaignId=parseInt(A.id,10);if(C.hasCurrentUserPrivilege("sap.ino.ui::backoffice.access")){var o=new P("sap.ino.xs.object.campaign.Campaign",this._iCampaignId,{nodes:["Root"]},false,s);}this.bindCampaignODataModel(this._iCampaignId,I);},hasBackgroundImage:function(){return false;},onVariantPress:function(v){if(!D.system.desktop){return;}var q=this.getQuery();this.removeInvalidFilters(q);delete q.campaign;if(v){this.navigateTo(this.getRoute(true),{id:this._iCampaignId,variant:v,query:q},true,true);}else{this.navigateTo(this.getRoute(false),{id:this._iCampaignId,query:q},true,true);}},navigateIntern:function(q,r){var v=this.getViewProperty("/List/VARIANT");this.navigateTo(this.getCurrentRoute(),{"variant":v,"query":q,"id":this._iCampaignId},r,true);},bindTagCloud:function(){var b=this.getBindingParameter();var p=C.getBackendRootURL()+"/sap/ino/xs/rest/common/tagcloud_blogs.xsjs";var c=this;var d=[];if(this._iCampaignId){d.push("CAMPAIGN="+this._iCampaignId);}if(!this.includeDrafts()){d.push("EXCL_STATUS=sap.ino.config.CAMP_DRAFT");}if(b&&b.TagIds){jQuery.each(b.TagIds,function(k,v){d.push("TAG="+v);});}if(b.SearchTerm&&b.SearchTerm.length>0){d.push("SEARCHTERM="+b.SearchTerm);}if(b.VariantFilter){d.push("FILTERNAME="+b.VariantFilter);}if(d.length>0){p=p+"?"+d.join("&");}if(this._lastTagServicePath!==p){var t=new J(p);var o=this.getText("BLOG_LIST_MIT_FILTER_TAG_OTHER");t.attachRequestCompleted(null,function(){var r=t.getData().RANKED_TAG;var e=c.groupByTagGroup(r,c.getViewProperty("/List/TAGS"),o);c.setTagCloudProperty(e,t.getData().WITHOUT_GROUP!=="X");t.setData({"RANKED_TAG":e},false);this.setFilterModel(t,"tag");},this);}this._lastTagServicePath=p;},bindCampaignODataModel:function(i,c){var t=this;var e="CampaignFull";if(i>0){this.getView().bindElement({path:"data>/"+e+"("+i+")",events:{dataRequested:function(){jQuery.each(t.getBusyControls(),function(I,b){if(jQuery.type(b.setBusy)==="function"){b.setBusy(true);}});},dataReceived:function(){jQuery.each(t.getBusyControls(),function(I,b){if(jQuery.type(b.setBusy)==="function"){b.setBusy(false);}});if(typeof c==="function"){c.apply(t);}}}});if(typeof c==="function"){var o=this.getView().getBindingContext("data");if(o&&o.getPath()===("/"+e+"("+i+")")){c.apply(t);}}}}}));});
