sap.ui.define(["sap/ino/vc/commons/BaseObjectController","sap/ui/Device","sap/ui/model/json/JSONModel","sap/ino/vc/commons/TopLevelPageFacet","sap/ino/commons/application/Configuration","sap/ui/core/ResizeHandler","sap/ino/commons/formatters/ObjectListFormatter","sap/ino/vc/commons/mixins/FollowMixin","sap/ino/vc/campaign/mixins/RegistrationMixin","sap/ino/vc/campaign/mixins/CampaignProfileMixin","sap/ino/vc/campaign/mixins/MilestoneMixin","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(C,D,J,T,a,R,O,F,b,c,M,S,d,e){"use strict";var l={XS:{centerProfileContainer:"RegistrationProfileFragment--registrationProfile",centerCampaignManagerContainer:"CampaignManagersFragment--CampaignManagers"},S:{leftProfileContainer:"RegistrationProfileFragment--registrationProfile",leftCampaignManagerContainer:"CampaignManagersFragment--CampaignManagers"},M:{leftProfileContainer:"RegistrationProfileFragment--registrationProfile",leftrCampaignManagerContainer:"CampaignManagersFragment--CampaignManagers"},L:{leftProfileContainer:"RegistrationProfileFragment--registrationProfile",leftCampaignManagerContainer:"CampaignManagersFragment--CampaignManagers"},XL:{leftProfileContainer:"RegistrationProfileFragment--registrationProfile",leftCampaignManagerContainer:"CampaignManagersFragment--CampaignManagers"}};return C.extend("sap.ino.vc.campaign.RegistrationHome",jQuery.extend({},F,b,c,M,{formatter:jQuery.extend({},this.formatter,O),onInit:function(){C.prototype.onInit.apply(this,arguments);this.aBusyControls=[this.getView()];},show:function(p){this._oParentView=p;var f=this.byId('campaignBannerList');f.addEventDelegate({onAfterRendering:function(){$(".sapMCrslInner.sapMCrslBottomOffset").height($('#'+f.getActivePage()).parents('.sapMCrslItem').height()+"px");$('#'+f.getActivePage()).parents('.sapMCrslItem ').fadeIn();}});this.getView().setModel(new J({ID:this.getView().getBindingContext("data").getProperty("ID"),NAME:this.getView().getBindingContext("data").getProperty("SHORT_NAME"),_OBJECT_TYPE_CODE:"CAMPAIGN"}),"contextObject");this.bindMilestone(this.getCampaignId());this._bindAdjustCampaignManagerList();},_bindBlogs:function(){if(this.getCampaignId()){var i=this.getModel("device").getProperty("/system/phone");var p="data>/BlogSearchParams(searchToken='',"+"tagsToken='',"+"filterName='publishedBlogs')/Results";var B={path:p,template:this.getFragment("sap.ino.vc.blog.fragments.ListItemHome"),sorter:new S("PUBLISHED_AT",true),filters:[new d("CAMPAIGN_ID","EQ",this.getCampaignId())],length:4,top:4};var t=this;if(i){var o=this.byId("blogsFragment--blogsCarousel");o.bindAggregation("pages",B);}else{var L=this.byId("blogsFragment--blogsList");if(L){L.bindItems(B);L.attachEventOnce("updateFinished",function(){t.onResizeLayoutChange(null,t._sCurrentLayout);});}}var f=this.byId("blogsFragment--panelBlogTitle");f.setText(this.getText("HOMEPAGE_PANEL_CAMPAIGN_BLOGS"));}},getLayout:function(L){return l[L];},getCampaignId:function(){return this.getView().getBindingContext("data")?this.getView().getBindingContext("data").getProperty("ID"):undefined;},_bindBannerList:function(){var B=this.byId("campaignBannerList");if(B.getAggregation("pages")&&B.getAggregation("pages").length&&B.getAggregation("pages")[0]){var o=B.getBindingInfo("pages");B.bindAggregation("pages",o);}},onNavigateToManagers:function(E){this.navigateTo("campaign-managerlist",{id:this.getCampaignId()});},onAfterShow:function(){this._bindBannerList();},onChangePage:function(f){var p=f.getParameters();var n=p.newActivePageId;$(".sapMCrslInner.sapMCrslBottomOffset").height($('#'+n).parents('.sapMCrslItem').height()+"px");$('#'+n).parents('.sapMCrslItem').fadeIn().siblings().hide().fadeIn();},_bindAdjustCampaignManagerList:function(){var h=!!this.getView().getBindingContext("data").getProperty("MANAGER_HAS_DISPLAY_HOMEPAGE_SETTING");var o=this.byId("CampaignManagersFragment--CampaignManagersList").getBindingInfo("items");if(h){o.sorter=[];var f=new d("DISPLAY_HOMEPAGE","EQ",1);o.filters=f;}this.byId("CampaignManagersFragment--CampaignManagersList").bindItems(o);}}));});
