sap.ui.define(["sap/ino/vc/commons/BaseController","sap/ui/model/json/JSONModel","sap/ino/commons/models/aof/PropertyModel","sap/ino/commons/application/Configuration","sap/ino/controls/Milestone","sap/ui/core/ResizeHandler"],function(B,J,P,C,M,R){"use strict";var m=function(){throw"Mixin may not be instantiated directly";};m.bindResize=function(){var s=this;this._sResizeRegId=R.register(this.getView(),function(){return s._onResize(s);});};m._onResize=function(){this.buildMilestone();};m.bindMilestone=function(c){var s=this;var p=C.getBackendRootURL()+"/sap/ino/xs/rest/common/campaign_task_milestone.xsjs";var a=[];if(c){a.push("CAMPAIGN_ID="+c);}if(a.length>0){p=p+"?"+a.join("&");}this.destroyMilestone();var b=new J(p);this.getView().setModel(b,"milestoneTask");b.attachRequestCompleted(null,function(){var d=b.getData();s.renderData(d);s.buildMilestone();},b);};m.renderData=function(d){if(!d){return false;}if(!d.Tasks||!d.Tasks.results||!d.Tasks.results.length){return false;}var s=this;var t=d.Tasks.results;var a=s.getText("MILESTONE_ATTACHMENT_DOWNLOAD");for(var i=0;i<t.length;i++){t[i].Milestones=t[i].Milestones.results;t[i].END_DATE=new Date(t[i].END_DATE);t[i].START_DATE=new Date(t[i].START_DATE);if(!t[i].Milestones||!t[i].Milestones.length){continue;}for(var x=0;x<t[i].Milestones.length;x++){t[i].Milestones[x].MILESTONE_DATE=new Date(t[i].Milestones[x].MILESTONE_DATE);t[i].Milestones[x].Attachment=t[i].Milestones[x].Attachment.results;if(!t[i].Milestones[x].Attachment||!t[i].Milestones[x].Attachment.length){continue;}for(var j=0;j<t[i].Milestones[x].Attachment.length;j++){t[i].Milestones[x].Attachment[j].LABEL=a;t[i].Milestones[x].Attachment[j].ATTACHMENT_URL=C.getAttachmentDownloadURL(t[i].Milestones[x].Attachment[j].ATTACHMENT_ID);}}}this.tasks=t;};m.buildMilestone=function(){if(!this.tasks||!this.tasks.length){return false;}var t=this.tasks;for(var i=0;i<t.length;i++){var s=t[i].START_DATE.getTime()+t[i].START_DATE.getTimezoneOffset()*60*1000;t[i].START_DATE=new Date(s);var e=t[i].END_DATE.getTime()+t[i].END_DATE.getTimezoneOffset()*60*1000;t[i].END_DATE=new Date(e);}var v=this.getView();var a=v.byId('milestoneContainer');a.destroyItems();a.addItem(new sap.ino.controls.Milestone({tasks:this.tasks,visible:true}));if(!this._sResizeRegId){this.bindResize();}};m.destroyMilestone=function(){var v=this.getView();var a=v.byId('milestoneContainer');a.destroyItems();this.tasks=[];};return m;});
