/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ino/commons/models/aof/ApplicationObject","sap/ino/commons/models/core/ReadSource","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ino/commons/application/Configuration","sap/ino/controls/BlogStatusType"],function(A,R,M,a,C,B){"use strict";var b=A.extend("sap.ino.commons.models.object.Blog",{objectName:"sap.ino.xs.object.blog.Blog",readSource:R.getDefaultODataSource("CampaignBlogsFull",{excludeNodes:["Relations"]}),invalidation:{entitySets:["CampaignBlogsFull"]},actionImpacts:{},determinations:{onCreate:_},actions:{submit:{execute:k},majorPublishSubmit:{execute:l},publishSubmit:{execute:m},unPublishSubmit:{execute:j}},setData:c,setProperty:d,addTag:g,addAttachment:h,removeAttachment:i});function _(D,o){var t=jQuery.map(D.Tags||[],function(T){return{ID:o.getNextHandle(),NAME:T};});var p=C.getCurrentUser();return{"TITLE":D.TITLE||"","DESCRIPTION":D.DESCRIPTION||"","CREATED_AT":new Date(),"CREATED_BY_NAME":p.NAME,"STATUS_CODE":B.Draft,"OBJECT_TYPE_CODE":"CAMPAIGN","OBJECT_ID":D.OBJECT_ID||0,"Tags":t};}function c(D){A.prototype.setData.apply(this,arguments);if(D.OBJECT_ID>0){this.setProperty("/OBJECT_ID",D.OBJECT_ID);}}function d(p,v,o,q){var s=false;s=A.prototype.setProperty.apply(this,arguments);e.call(this,p,v,o,q);return s;}function e(p,v,o,q){var P=(p[0]==="/"?p.substring(1):p);if(P!=="OBJECT_ID"){return;}var D=this.getReadSourceModel();var r=this;var s=v;if(s===""||s==="0"){s=0;A.prototype.setProperty.apply(r,[p,s,o,q]);return;}if(s===0){f.call(r,{NAME:"",SHORT_NAME:"",COLOR_CODE:"",PHASE_COUNT:4,IDEA_DESCRIPTION_TEMPLATE:""});return;}D.read("/CampaignSmall("+s+")",{success:function(t){f.call(r,t);}});}function f(o){this.setProperty("/CAMPAIGN_NAME",o.NAME);this.setProperty("/CAMPAIGN_SHORT_NAME",o.SHORT_NAME);this.setProperty("/CAMPAIGN_COLOR",o.COLOR_CODE);this.setProperty("/STEPS",o.PHASE_COUNT);this.setProperty("/CAMPAIGN_BACKGROUND_IMAGE_ID",o.CAMPAIGN_BACKGROUND_IMAGE_ID);this.setProperty("/CAMPAIGN_SMALL_BACKGROUND_IMAGE_ID",o.CAMPAIGN_SMALL_BACKGROUND_IMAGE_ID);this.setProperty("/CAMPAIGN_VOTE_TYPE_CODE",o.VOTE_TYPE_CODE);}function g(N){var o;var t=this.getProperty("/Tags");if(!N.NAME||jQuery.trim(N.NAME).length===0){o=new M({key:"MSG_INVALID_EMPTY_TAG",type:a.Error,group:"TAG"});return o;}N.NAME=jQuery.trim(N.NAME);if(!N.TAG_ID&&N.NAME){N.TAG_ID=this.getNextHandle();}var p=jQuery.grep(t,function(T){return T.NAME.toLowerCase()===N.NAME.toLowerCase();});if(p.length===0){this.addChild(N,"Tags");}else{return new M({key:"MSG_DUPLICATE_TAG",type:a.Error});}}function h(N){N.ROLE_TYPE_CODE="ATTACHMENT";this.addChild(N,"Attachments");}function i(I){var o=jQuery.grep(this.getProperty("/Attachments")||[],function(p){return p.ATTACHMENT_ID===I;});var F=o&&o[0];if(F){this.removeChild(F);}}function j(K,o,p,q,s){var D=new jQuery.Deferred();var u=o.unPublish(s);u.fail(D.reject);u.done(D.resolve);return D.promise();}function k(K,o,p,q,s){return n.call(this,K,o,p,q,s);}function l(K,o,p,q,s){return n.call(this,K,o,p,q,s,"majorPublish");}function m(K,o,p,q,s){return n.call(this,K,o,p,q,s,"publish");}function n(K,o,p,q,s,r){var D=new jQuery.Deferred();var t=o.modify(s);t.fail(D.reject);if(!r){t.done(D.resolve);}else{t.done(function(){var S=o[r](p,s);S.fail(D.reject);S.done(D.resolve);});}return D.promise();}return b;});
