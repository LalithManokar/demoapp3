/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ino/commons/models/aof/ApplicationObject","sap/ui/core/message/Message","sap/ui/core/MessageType","sap/ino/commons/models/core/ReadSource","sap/ino/commons/util/DateUtil"],function(A,M,a,R,D){"use strict";var E=A.extend("sap.ino.commons.models.object.EvaluationRequest",{objectName:"sap.ino.xs.object.evaluation.EvaluationRequest",readSource:R.getDefaultODataSource("EvaluationRequest",{}),invalidation:{},determinations:{onCreate:_,onRead:d},actionImpacts:{"create":[{"objectName":"sap.ino.commons.models.object.Idea","objectKey":"IDEA_ID","impactedAttributes":["EvaluationRequests","IDEA_HAS_INCOMPLETED_EVAL_REQ"]}],"del":[{"objectName":"sap.ino.commons.models.object.Idea","objectKey":"IDEA_ID","impactedAttributes":["EvaluationRequests","IDEA_HAS_INCOMPLETED_EVAL_REQ"]}]},addExpert:e,removeExpert:r,onNormalizeData:function(o){o.ACCEPT_DATE=D.convertToUtcString(o.ACCEPT_DATE);o.COMPLETE_DATE=D.convertToUtcString(o.COMPLETE_DATE);return o;}});function _(){var g=new Date();g.setDate(g.getDate()+1);var C=new Date();C.setDate(C.getDate()+7);return{"STATUS":"sap.ino.config.EVAL_REQ_DEFAULT"};}function f(g){var h={"Data":g[0],"Index":0};jQuery.each(g,function(i,j){if(h.Data.CREATED_AT>j.CREATED_AT){h.Data=j;h.Index=i;}});return h;}function b(g){return["ITEM_ID_"+g.EVAL_REQ_ITEM_ID+"_CREATED_BY_ID_"+g.CREATED_BY_ID+"_TO_IDENTITY_"+g.TO_IDENTITY,"ITEM_ID_"+g.EVAL_REQ_ITEM_ID+"_CREATED_BY_ID_"+g.TO_IDENTITY+"_TO_IDENTITY_"+g.CREATED_BY_ID];}function c(o){var g=[];if(!o||o.length===0){return g;}var G={};jQuery.each(o,function(i,h){var k=b(h);if(G.hasOwnProperty(k[0])){G[k[0]].push(h);}else if(G.hasOwnProperty(k[1])){G[k[1]].push(h);}else{G[k[0]]=[];G[k[0]].push(h);}});jQuery.each(G,function(i,h){var F=f(h);h.splice(F.Index,1);g.push({"CLARIFICATION_ENABLED":F.Data.CLARIFICATION_ENABLED,"CREATED_BY_ID":F.Data.CREATED_BY_ID,"EVAL_REQ_ITEM_ID":F.Data.EVAL_REQ_ITEM_ID,"TO_IDENTITY":F.Data.TO_IDENTITY,"CREATED_BY_NAME":F.Data.CREATED_BY_NAME,"CREATED_BY_IMAGE_ID":F.Data.CREATED_BY_IMAGE_ID,"CONTENT":F.Data.CONTENT,"CREATED_AT":F.Data.CREATED_AT,"Communications":h});});return g;}function d(o){var g=o;if(!(g.ACCEPT_DATE instanceof Date)){g.ACCEPT_DATE=new Date(o.ACCEPT_DATE);}else{g.ACCEPT_DATE=D.convertToLocalDate(o.ACCEPT_DATE);}if(!(g.COMPLETE_DATE instanceof Date)){g.COMPLETE_DATE=new Date(o.COMPLETE_DATE);}else{g.COMPLETE_DATE=D.convertToLocalDate(o.COMPLETE_DATE);}if(g.Clarifications){g.ExpertsClarifications=c(g.Clarifications);}return g;}function e(n){var m;if(!n.NAME||jQuery.trim(n.NAME).length===0){m=new M({key:"MSG_IDEA_INVALID_EMPTY_EXPERT",type:a.Error,group:"EXPERT"});return m;}if(!n.IDENTITY_ID){m=new M({key:"MSG_IDEA_INVALID_EXPERT",type:a.Error,group:"EXPERT"});return m;}var g=this.getProperty("/Experts");var h=jQuery.grep(g,function(o){return o.IDENTITY_ID===n.IDENTITY_ID;});if(h.length===0){this.addChild(n,"Experts");}}function r(i){var g=this.getProperty("/Experts");var m=jQuery.grep(g,function(h){return h.IDENTITY_ID===i;});var o=m[0];if(o){this.removeChild(o,"Experts");}}return E;});
