/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["./ApplicationObjectChange","./MetaModel","./PropertyModel","./MessageParser","sap/ino/commons/application/Configuration","sap/ui/model/json/JSONModel","sap/ui/model/json/JSONListBinding","sap/ui/model/json/JSONPropertyBinding","sap/ui/model/PropertyBinding","sap/ui/model/BindingMode","sap/ino/commons/models/types/IntegerType","sap/ino/commons/models/types/FloatType","sap/ino/commons/models/types/IntBooleanType","sap/ui/model/type/String","sap/ui/model/type/Date","sap/ui/model/type/DateTime","sap/ui/model/type/Time","sap/ino/commons/models/core/ModelSynchronizer"],function(A,M,P,a,C,J,b,c,d,B,I,F,f,S,D,g,T,h){"use strict";var O={Standard:"STANDARD",Configuration:"CONFIGURATION",Stage:"STAGE",SystemConfiguration:"SYSTEM_CONFIGURATION"};var N={Root:"Root"};var j={Create:"create",Copy:"copy",Update:"update",Del:"del",Modify:"modify"};var k=J.extend("sap.ino.commons.models.aof.ApplicationObject",{constructor:function(e,i){J.apply(this,[]);this._initKey=e;this._isDeleted=false;this._continuousUse=(i&&i.continuousUse)||false;this._oSettings=i;this._oReadSourceSettings=i&&i.readSource;this._bLastBackendSyncSuppressed=false;this._oMessageParser=new a();this._oMessageParser.setProcessor(this);if(e===undefined||(jQuery.isNumeric(e)&&e<=0)){e={};}var r1;if(!e||m(e)){if(m(e)){r1=e;}f1(this,r1);h1(e,this,{actions:i&&i.actions,staticActions:i&&i.staticActions,nodes:i&&i.nodes},r1,i&&i.propertyDefaults);}else{g1(this,e);r1={};var s1=this.getApplicationObjectMetadata();r1[s1.nodes.Root.primaryKey]=e;h1(e,this,{actions:i&&i.actions,staticActions:i&&i.staticActions,nodes:i&&i.nodes},r1,i&&i.propertyDefaults);h.putApplicationObject(e,this);}}});k.ObjectType=O;k.Action=j;k.Node=N;var l=k.extend;k.extend=function(e,i){var r1=M.getApplicationObjectMetadata(i.objectName);if(!r1){l.call(this,e,i);return;}var s1=l.call(this,e,i);s1.prototype.getApplicationObject=function(){return s1;};s1.getApplicationObjectMetadata=function(){return r1;};s1.getObjectName=function(){return i.objectName;};s1.getEndpointURL=s1.prototype.getEndpointURL=function(){return M.getEndpoint(i.objectName);};s1.readData=function(v1,w1){if(s1.readSource){return s1.readSource(v1,s1.getObjectName(),s1.getApplicationObjectMetadata(),w1);}return null;};var t1=0;s1.beginAction=function(){t1++;};s1.endAction=function(){t1--;};s1.isInitiatingAction=function(){return t1===1;};s1.process=u;s1.parseResponse=w;s1.registerDirtyObject=x;var u1=t(s1);jQuery.extend(s1.prototype,u1.instanceMethods);jQuery.extend(s1,u1.staticMethods,i);return s1;};function m(e){if(!e){return false;}return e.constructor===Object;}function n(e){if(typeof e==="object"){return Object.keys(e)[0];}return e;}function v(e,i,r1,s1,t1){if(!m(e)){return;}r1(e,i,s1,t1);var u1=jQuery.extend(true,{},t1,{parentNodeName:i,parentData:e});jQuery.each(e,function(v1,w1){if(jQuery.isArray(w1)){jQuery.each(w1,function(x1,y1){v(y1,v1,r1,w1,u1);});}else{v(w1,i,r1,s1,u1);}});}function o(e,i,r1,s1,t1){if(!m(e)&&!jQuery.isArray(e)){return;}r1(jQuery.isArray(e)?e:[e],i,s1,t1);if(m(e)){var u1=jQuery.extend(true,{},t1,{parentNodeName:i,parentData:e});jQuery.each(e,function(v1,w1){if(jQuery.isArray(w1)){o(w1,v1,r1,e,u1);}});}else if(jQuery.isArray(e)){jQuery.each(e,function(v1,w1){jQuery.each(w1,function(x1,y1){if(jQuery.isArray(y1)){var u1=jQuery.extend(true,{},t1,{parentNodeName:i,parentData:e});o(y1,x1,r1,w1,u1);}});});}}function p(e,i,r1,s1){if(r1===N.Root&&i[e.nodes.Root.primaryKey]===s1){return i;}var t1;v(i,N.Root,function(u1,v1,w1){if(v1===r1&&e.nodes[v1]&&u1[e.nodes[v1].primaryKey]===s1){t1=u1;}});return t1;}function q(e,i,r1){if(r1===N.Root){return[i];}var s1;o(i,N.Root,function(t1,u1,v1){if(u1===r1){s1=t1;}});return s1;}function r(e,i){if(i===N.Root&&e){return true;}var r1=false;v(e,N.Root,function(s1,t1,u1){if(t1===i){r1=true;}});return r1;}function s(e,i,r1,s1,t1){var u1=e.getApplicationObjectMetadata();function v1(y1){var z1=jQuery.extend(true,{},y1);v(z1,N.Root,function(A1,B1){jQuery.each(A1,function(C1){var D1=u1.nodes[B1]&&u1.nodes[B1].attributes[C1];var E1=u1.nodes[C1];if(!s1&&!D1&&!E1){delete A1[C1];return;}if(!s1&&D1&&D1.readOnly&&!D1.isPrimaryKey){delete A1[C1];return;}if(!s1&&E1&&E1.readOnly){delete A1[C1];return;}if(D1){A1[C1]=m1(A1[C1],D1);}});});return z1;}if(e.determinations&&e.determinations.onNormalizeData){r1=jQuery.extend(true,{},r1);r1=e.determinations.onNormalizeData(r1,t1);i=jQuery.extend(true,{},i);i=e.determinations.onNormalizeData(i,t1);}var w1=v1(r1);var x1=v1(i);if(!s1){v(w1,N.Root,function(y1,z1){var A1=u1.nodes[z1].primaryKey;var B1=y1[A1];var i=p(u1,x1,z1,B1);if(y1[A1]<=0){return;}jQuery.each(y1,function(C1,D1){var E1=i&&i[C1];if(jQuery.sap.equal(E1,D1)&&C1!==A1){delete y1[C1];}});});}return w1;}function t(e){var i={instanceMethods:{create:E(e),copy:K(e),update:R(e),modify:V(e),del:Y(e)},staticMethods:{create:G(e),copy:L(e),update:U(e),modify:W(e),del:Z(e)}};function r1(u1){return jQuery.map(j,function(v1){return v1;}).indexOf(u1)>=0;}var s1=e.getApplicationObjectMetadata();var t1=jQuery.extend({},s1.actions||{});jQuery.each(e.prototype.actions||[],function(u1,v1){if(!s1.actions[u1]&&v1.execute&&jQuery.isFunction(v1.execute)){t1[u1]={name:u1};}});jQuery.each(t1,function(u1,v1){if(r1(u1)){return;}if(v1.isStatic===true){i.staticMethods[u1]=c1(e,v1);}else{i.instanceMethods[u1]=a1(e,v1);i.staticMethods[u1]=b1(e,v1);}var w1=u1+"Model";var x1=d1(e,v1);i.instanceMethods[w1]=x1;i.staticMethods[w1]=x1;});return i;}function u(e){var i=new jQuery.Deferred();var r1=[];if(C.isExtensionsDisabled()){r1.push("$disableExtensions=true");}if(C.isBackendTraceActive()){r1.push("$trace=true");}if(r1.length>0){e.url+="?"+r1.join("&");}var s1=jQuery.ajax(e);s1.done(function(t1,u1,v1){i.resolve(t1,u1,v1);});s1.fail(function(t1){var u1=C.validateXSRFToken(t1);if(!u1){s1=jQuery.ajax(e);s1.done(function(t1,v1,w1){i.resolve(t1,v1,w1);});s1.fail(function(t1){i.reject(w(t1));});}else{i.reject(w(t1));}});return i.promise();}function w(i){var r1={};if(!i.responseText){r1=i;}else{try{r1=JSON.parse(i.responseText);}catch(e){var s1=i.responseText;if(s1){s1=s1.replace(/<(.|\n)*?>/g," ").replace(/\s+/g," ").trim();}r1.MESSAGES=[{MESSAGE:i.status===403?"MSG_GENERIC_AUTH_ERROR":"MSG_GENERIC_ERROR",TYPE:"E",PARAMETERS:[s1]}];}}if(i.status===412){r1.concurrencyConflict=true;}r1.getHeader=jQuery.proxy(i.getResponseHeader,i);return r1;}function x(e,i){var r1=this;var s1=new Date();jQuery.each(e,function(t1,u1){var v1={object:r1,key:u1,actionName:i};A.fireChange(v1);});}function y(e,i){return function(r1){var s1=r1.getHeader("ETag");e.setConflictConcurrencyToken(s1);i.reject(r1);};}function z(e,i,r1,s1){var t1=e.getEndpointURL();var u1=e.getApplicationObjectMetadata();if(!i[u1.nodes.Root.primaryKey]){i[u1.nodes.Root.primaryKey]=-1;}r1=r1||{};return e.process({url:t1,type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(i),headers:r1,async:!s1});}function E(e){var i=e.getApplicationObjectMetadata();if(!i.actions.create){return undefined;}return function(r1){e.beginAction();var s1=(r1&&r1.suppressBackendSync)?true:false;var t1=(r1&&r1.processSync)?true:false;var u1=this;var v1=this.getChangeRequest();var w1=z(e,v1,u1.processHeaders(),t1);var x1=new jQuery.Deferred();w1.always(function(){u1._parseMessages.apply(u1,arguments);});w1.done(function(y1){if(y1.GENERATED_IDS){i1(u1,y1.GENERATED_IDS);u1._isNew=false;}e1(e,u1.getKey(),v1,u1,i.actions.create,s1);if(!s1){delete u1._oDeterminationData;}u1._bLastBackendSyncSuppressed=s1;u1._resolveAfterInitialize(x1,y1,true);});w1.fail(e.endAction,x1.reject);return x1.promise();};}function G(e){var i=e.getApplicationObjectMetadata();if(!i.actions.create){return undefined;}return function(r1){e.beginAction();var s1=z(e,r1);s1.done(function(t1){var u1;if(t1.GENERATED_IDS){u1=t1.GENERATED_IDS[r1[i.nodes.Root.primaryKey]];}e1(e,u1,r1,undefined,i.actions.create);});s1.fail(e.endAction);return s1;};}function H(e,i,r1,s1,t1){var u1=e.getEndpointURL();var v1=e.getApplicationObjectMetadata();if(!r1[v1.nodes.Root.primaryKey]){r1[v1.nodes.Root.primaryKey]=-1;}s1=s1||{};return e.process({url:u1+"/"+i+"/copy",type:"POST",contentType:"application/json; charset=UTF-8",data:JSON.stringify(r1),headers:s1,async:!t1});}function K(e){var i=e.getApplicationObjectMetadata();if(!i.actions.copy){return undefined;}return function(r1,s1){e.beginAction();var t1=this;var u1=this.getKey();if(this.isNew()){jQuery.sap.log.error("Backend copy cannot be done on new objects");return;}var v1=(s1&&s1.processSync)?true:false;var w1=jQuery.extend({},this._oSettings);var x1=(r1&&r1[i.nodes.Root.primaryKey])||-1;var y1=H(e,u1,r1,t1.processHeaders(),v1);var z1=new jQuery.Deferred();y1.done(function(A1){var B1=new e(A1.GENERATED_IDS[x1],w1);e1(e,B1.getInitKey(),r1,B1,i.actions.copy);z1.resolve(B1);});y1.fail(e.endAction,z1.reject);return z1.promise();};}function L(e){var i=e.getApplicationObjectMetadata();if(!i.actions.copy){return undefined;}return function(r1,s1){e.beginAction();var t1=H(e,r1,s1);t1.done(function(u1){e1(e,u1.GENERATED_IDS[-1],s1,undefined,i.actions.copy);});t1.fail(e.endAction);return t1;};}function Q(e,i,r1,s1,t1,u1){var v1=e.getEndpointURL();var w1=e.getApplicationObjectMetadata();if(!r1[w1.nodes.Root.primaryKey]){r1[w1.nodes.Root.primaryKey]=i;}var x1={};x1[w1.nodes.Root.primaryKey]=i;if(jQuery.sap.equal(r1,x1)){var y1=new jQuery.Deferred();y1.resolve({});return y1.promise();}t1=t1||{};if(s1){t1["If-Match"]=s1;}return e.process({url:v1+"/"+i,type:"PUT",contentType:"application/json; charset=UTF-8",data:JSON.stringify(r1),headers:t1,async:!u1});}function R(e){var i=e.getApplicationObjectMetadata();if(!i.actions.update){return undefined;}return function(r1){e.beginAction();var s1=(jQuery.isPlainObject(r1)&&r1.suppressBackendSync)?r1.suppressBackendSync:false;var t1=(jQuery.isPlainObject(r1))?r1.bIgnoreConcurrencyConflict:r1;var u1=(jQuery.isPlainObject(r1)&&r1.processSync)?r1.processSync:false;var v1=this;var w1=new jQuery.Deferred();var x1=this.getKey();var y1=this.getChangeRequest();this.applyConflictConcurrencyToken(t1);var z1=Q(e,x1,y1,v1._sConcurrencyToken,v1.processHeaders(),u1);z1.always(function(){v1._parseMessages.apply(v1,arguments);});z1.done(function(A1){if(A1.GENERATED_IDS){if(!v1._continuousUse){i1(v1,A1.GENERATED_IDS);}}e1(e,v1.getKey(),y1,v1,i.actions.update,s1);v1._bLastBackendSyncSuppressed=s1;v1._resolveAfterInitialize(w1,A1);});z1.fail(y(v1,w1),e.endAction);return w1.promise();};}function U(e){var i=e.getApplicationObjectMetadata();if(!i.actions.update){return undefined;}return function(r1,s1){e.beginAction();var t1=Q(e,r1,s1);t1.done(function(){e1(e,r1,s1,undefined,i.actions.update);});t1.fail(e.endAction);return t1;};}function V(e){var i=e.getApplicationObjectMetadata();if(!i.actions.create&&!i.actions.update){return undefined;}return function(r1){if(this.isNew()){return this.create(r1);}else{return this.update(r1);}};}function W(e){var i=e.getApplicationObjectMetadata();if(!i.actions.create&&!i.actions.update){return undefined;}return function(r1,s1){var t1;if(r1===undefined||(jQuery.isNumeric(r1)&&r1<=0)){e.beginAction();t1=z(e,s1);t1.done(function(u1){var r1;if(u1.GENERATED_IDS){r1=u1.GENERATED_IDS[s1[i.nodes.Root.primaryKey]];}e1(e,r1,s1,undefined,i.actions.create);});t1.fail(e.endAction);return t1;}else{e.beginAction(e,i.actions.update);t1=Q(e,r1,s1);t1.done(function(){e1(e,r1,s1,undefined,i.actions.update);});t1.fail(e.endAction);return t1;}};}function X(e,i,r1,s1,t1){var u1=e.getEndpointURL();s1=s1||{};if(r1){s1["If-Match"]=r1;}return e.process({url:u1+"/"+i,type:"DELETE",headers:s1,async:!t1});}function Y(e){var i=e.getApplicationObjectMetadata();if(!i.actions.del){return undefined;}return function(r1,s1){var t1=this;if(this.isNew()){var u1=new jQuery.Deferred();u1.resolve({MESSAGES:[]});return u1.promise();}e.beginAction();var v1=(s1&&s1.processSync)?true:false;var w1=new jQuery.Deferred();this._oDataInitPromise.done(function(){t1.applyConflictConcurrencyToken(r1);var x1=X(e,t1.getKey(),t1._sConcurrencyToken,t1.processHeaders(),v1);x1.always(function(){t1._parseMessages.apply(t1,arguments);});x1.done(function(){t1.revertChanges();var y1;var z1=e&&e.actionImpacts&&e.actionImpacts.del;if(z1){y1={};jQuery.each(z1,function(A1,B1){if(t1.oData.hasOwnProperty(B1.objectKey)){y1[B1.objectKey]=t1.getProperty("/"+B1.objectKey);}});if(y1==={}){y1=undefined;}}e1(e,t1.getKey(),y1,t1,i.actions.del);w1.resolve.apply(undefined,arguments);});x1.fail(y(t1,w1),e.endAction);});return w1.promise();};}function Z(e){var i=e.getApplicationObjectMetadata();if(!i.actions.del){return undefined;}return function(r1,s1){e.beginAction();var t1=X(e,r1);t1.done(function(){e1(e,r1,s1,undefined,i.actions.del);});t1.fail(e.endAction);return t1;};}function $(e,i,r1,s1,t1,u1,v1){var w1=e.getEndpointURL();var x1={url:w1+"/"+r1+"/"+i.name,type:"POST",};if(s1){x1.contentType="application/json; charset=UTF-8";x1.data=JSON.stringify(s1);}u1=u1||{};if(t1){u1["If-Match"]=t1;}x1.headers=u1;x1.async=!v1;return e.process(x1);}function _(e,i,r1,s1){e.beginAction();var t1=e.getEndpointURL();var u1={url:t1+"/"+i.name,type:"POST",};if(r1){u1.contentType="application/json; charset=UTF-8";u1.data=JSON.stringify(r1);}s1=s1||{};var v1=e.process(u1);v1.always(e.endAction);var w1;v1.done(function(){if(i.isMassAction){jQuery.each(r1.keys,function(x1,y1){w1={object:e,key:y1,actionName:i.name};A.fireChange(w1);});}else{w1={object:e,changeRequest:r1,actionName:i.name};A.fireChange(w1);}});return v1;}function a1(e,i){var r1=function(s1,t1){e.beginAction();var u1=e.getApplicationObjectMetadata();var v1=(jQuery.isPlainObject(t1)&&t1.suppressBackendSync)?t1.suppressBackendSync:false;var w1=(jQuery.isPlainObject(t1))?t1.bIgnoreConcurrencyConflict:t1;var x1=(jQuery.isPlainObject(t1)&&t1.processSync)?t1.processSync:false;var y1=this;var z1=this.getKey();var A1=new jQuery.Deferred();var B1;var C1=!!u1.actions[i.name];if(C1){y1.applyConflictConcurrencyToken(w1);B1=$(e,i,z1,s1,y1._sConcurrencyToken,y1.processHeaders(),x1);B1.fail(e.endAction,y(y1,A1));B1.done(function(G1,H1,I1){var J1=I1.getResponseHeader("ETag");y1.setConcurrencyToken(J1);});}else{var D1=this.actions[i.name].execute;B1=D1(z1,y1,s1,i,t1);if(B1&&jQuery.isFunction(B1.done)){B1.fail(e.endAction,A1.reject);}else{var E1=new jQuery.Deferred();var F1=B1;B1=E1.promise();E1.resolve(F1);}}B1.always(function(){y1._parseMessages.apply(y1,arguments);});B1.done(function(G1){z1=y1.getKey();e1(e,z1,s1,y1,i,v1||!C1);y1._bLastBackendSyncSuppressed=v1;y1._resolveAfterInitialize(A1,G1);});return A1.promise();};r1.isCustomAction=true;return r1;}function b1(e,i){return function(r1,s1){var t1;var u1=e.getApplicationObjectMetadata();e.beginAction();if(u1.actions[i.name]){var v1=e.getEndpointURL();var w1={url:v1+"/"+r1+"/"+i.name,type:"POST",};if(s1){w1.contentType="application/json; charset=UTF-8";w1.data=JSON.stringify(s1);}t1=$(e,i,r1,s1);}else{var x1=new jQuery.Deferred();var y1=e.prototype.actions[i.name].execute;var z1=y1(r1,undefined,s1,i);if(z1&&jQuery.isFunction(z1.done)){z1.done(x1.resolve);z1.fail(x1.reject);}else{x1.resolve(z1);}t1=x1.promise();}t1.done(function(){e1(e,r1,s1,undefined,i);});t1.fail(e.endAction);return t1;};}function c1(e,i){return function(r1){return _(e,i,r1);};}function d1(e,i){return function(){var r1=new J();var s1={};var t1=e.prototype.actions[i.name].initParameter;if(t1){t1.apply(undefined,[s1].concat(jQuery.makeArray(arguments)));}r1.setData(s1);return r1;};}function e1(e,i,r1,s1,t1,u1){var v1=new Date();var w1=s1&&s1._continuousUse&&t1.name!=j.Del&&!u1;if(w1&&s1._oPropertyModel){s1._oPropertyModel.sync(i);}if(w1){g1(s1,i);}if(s1&&u1){s1._oBeforeData=jQuery.extend(true,{},s1.getData());}if(e.determinations&&e.determinations.onPersist){var x1=function(e,i,z1){};e.determinations.onPersist(i,r1,s1&&s1.getData(),t1,x1,s1);}var y1={object:e,key:i,actionName:t1.name,changeRequest:r1,instance:s1};if(w1){s1.getDataInitializedPromise().done(function(z1){y1.dataUpdate=z1;if(e.isInitiatingAction()){A.fireChange(y1);}e.endAction();});s1.getDataInitializedPromise().fail(function(){if(e.isInitiatingAction()){A.fireChange(y1);}e.endAction();});}else{if(e.isInitiatingAction()){A.fireChange(y1);}e.endAction();}}function f1(e,i){function r1(x1){if(j1[x1.dataType]==="sap.ui.model.type.String"){return"";}else{return null;}}var s1=e.getApplicationObjectMetadata();var t1={};jQuery.each(s1.nodes.Root.attributes,function(x1,y1){t1[x1]=r1(y1);});jQuery.each(s1.nodes,function(x1,y1){if(y1.parentNode&&y1.parentNode===N.Root){var z1=e.readSource&&e.readSource.settings&&e.readSource.settings(e._oReadSourceSettings);if(!(z1&&z1.excludeNodes&&z1.excludeNodes.indexOf(y1.name)>-1)){t1[y1.name]=[];}}});jQuery.extend(t1,i);var u1=new jQuery.Deferred();e._oDataInitPromise=u1.promise();e._isNew=true;function v1(x1){if(x1){jQuery.extend(t1,x1);}t1[s1.nodes.Root.primaryKey]=e.getNextHandle();e.setData(t1);t1=e.getData();e._oDeterminationData=jQuery.extend(true,{},t1);u1.resolve(t1);}if(e.determinations&&e.determinations.onCreate){var w1=e.determinations.onCreate(t1,e);if(w1&&jQuery.isFunction(w1.done)){w1.done(v1);}else{v1(w1);}}else{v1({});}}function g1(e,i,r1){var s1=e.getApplicationObjectMetadata();var t1=new jQuery.Deferred();e._oDataInitPromise=t1.promise();e._isNew=false;if(e.readSource){e._lastReadDate=new Date();var u1=e.readSource(i,e.getObjectName(),s1,e._oReadSourceSettings);u1.done(function(v1,w1){var x1;if(!v1){jQuery.sap.log.error("Object "+i+" does not exist ("+e.getObjectName()+")");return;}if(r1){x1=v1;v1=e._mergeConcurrentChanges(v1);}k1(v1,e.getApplicationObject());function y1(A1){if(A1){jQuery.extend(v1,A1);}v1[s1.nodes.Root.primaryKey]=i;e.setData(v1);e._oBeforeData=jQuery.extend(true,{},x1||v1);e.setConcurrencyToken(w1);t1.resolve(v1);}if(e.determinations&&e.determinations.onRead){var z1=e.determinations.onRead(v1,e);if(z1&&jQuery.isFunction(z1.done)){z1.done(y1);}else{y1(z1);}}else{y1({});}});u1.fail(function(){jQuery.sap.log.error("Reading object "+i+" failed ("+e.getObjectName()+")");t1.reject();});}else{var v1={};v1[s1.nodes.Root.primaryKey]=i;e.setData(v1);e._oBeforeData=jQuery.extend(true,{},v1);t1.resolve(v1);}}function h1(e,i,r1,s1,t1){if(!r1.nodes&&!r1.actions&&!r1.staticActions){return;}var u1=i.getApplicationObjectMetadata();var v1={nodes:[],actions:[],staticActions:[]};if(r1.nodes){jQuery.each(r1.nodes,function(G1,H1){if(u1.nodes[H1]){v1.nodes.push(H1);}});}var w1=[];if(r1.actions){jQuery.each(r1.actions,function(G1,H1){var I1=n(H1);if(u1.actions[I1]&&I1!=j.Create){v1.actions.push(H1);}w1.push(I1);});}var x1=[];if(r1.staticActions){jQuery.each(r1.staticActions,function(G1,H1){var I1=n(H1);if(u1.actions[I1]){v1.staticActions.push(H1);}x1.push(I1);});}var y1=w1.indexOf(j.Modify);if(y1>=0){if(w1.indexOf(j.Update)<0){v1.actions.push(j.Update);}}var z1=w1.indexOf(j.Create);var A1=x1.indexOf(j.Create);if(i._isNew&&(y1>=0||z1>=0)&&A1<0){var B1={};B1[j.Create]=s1;v1.staticActions.push(B1);}var C1=new jQuery.Deferred();i._oPropertyModelInitPromise=C1.promise();function D1(G1){var F1=G1.getSource();i._oPropertyModel=F1;i.getDataInitializedPromise().done(function(){if(y1>=0){var H1;if(i._isNew){H1=F1.getProperty("/actions/create/enabled");}else{H1=F1.getProperty("/actions/update/enabled");}if(H1!==undefined){F1.setPropertyInternal("/actions/modify",{enabled:H1});}}jQuery.each((r1.actions||[]).concat(r1.staticActions||[]),function(I1,J1){var K1=n(J1);var L1=i.actions&&i.actions[K1]&&i.actions[K1].enabledCheck;if(L1){var M1="/actions/"+K1;var N1=F1.getProperty(M1+"/enabled");var O1=L1(i,N1);if(O1!==undefined){F1.setPropertyInternal(M1,{enabled:O1});}}});C1.resolve(F1.getData());});F1.fireEvent("modelModified");}var E1={actions:{modify:{enabled:false}}};jQuery.each((r1.actions||[]).concat(r1.staticActions||[]),function(G1,H1){var I1=n(H1);var J1=i.actions&&i.actions[I1]&&i.actions[I1].execute;if(J1){E1.actions[I1]={enabled:false};}});if(t1){E1=jQuery.extend(true,E1,t1);}var F1=new P(i.getObjectName(),e,v1,false,D1,E1);i._oPropertyModel=F1;}function i1(e,i){var r1=e.getApplicationObjectMetadata();var s1=e.getApplicationObject();var t1=e.getProperty("/");if(s1.determinations&&s1.determinations.onUpdateHandles){t1=s1.determinations.onUpdateHandles(t1,i);}else{v(t1,N.Root,function(t1,u1){var v1=r1.nodes[u1];if(!v1){return;}var w1=v1.primaryKey;var x1=t1[w1];if(i[x1]){t1[w1]=i[x1];h.putApplicationObject(t1[w1],e);}});}e.setData(t1);}var j1={"NVARCHAR":"sap.ui.model.type.String","NCLOB":"sap.ui.model.type.String","VARCHAR":"sap.ui.model.type.String","CHAR":"sap.ui.model.type.String","NCHAR":"sap.ui.model.type.String","INTEGER":"sap.ui.model.type.Integer","INT":"sap.ui.model.type.Integer","TINYINT":"sap.ui.model.type.Integer","SMALLINT":"sap.ui.model.type.Integer","BIGINT":"sap.ui.model.type.Integer","SMALLDECIMAL":"sap.ui.model.type.Float","DECIMAL":"sap.ui.model.type.Float","DOUBLE":"sap.ui.model.type.Float","REAL":"sap.ui.model.type.Float","FLOAT":"sap.ui.model.type.Float","DATE":"sap.ui.model.type.Date","SECONDDATE":"sap.ui.model.type.DateTime","TIMESTAMP":"sap.ui.model.type.DateTime","TIME":"sap.ui.model.type.Time"};function k1(e,i){var r1=i.getApplicationObjectMetadata();v(e,N.Root,function(s1,t1){jQuery.each(s1,function(u1){var v1=r1.nodes[t1]&&r1.nodes[t1].attributes[u1];if(v1){s1[u1]=l1(s1[u1],v1);}});});}function l1(e,i){if(e!==null){return e;}if(!i){return e;}var r1=j1[i.dataType];if(!r1){return null;}switch(r1){case"sap.ui.model.type.String":return"";default:return null;}}function m1(e,i){if(!i){return e;}var r1=j1[i.dataType];if(!r1){return e;}switch(r1){case"sap.ui.model.type.String":return(e==="")?null:e;default:return e;}}function n1(e,i){var r1=e.getPath();var s1=e.getContext();if(s1&&s1.getPath()!=="/"){r1=s1.getPath();}else{r1=(r1[0]==="/")?r1:"/"+r1;}var t1=r1.split("/");var u1=t1.shift();if(p1(u1)){return undefined;}var v1=t1.pop();var w1;if(t1.length===0){w1=N.Root;}if(t1.length===1){w1=t1.pop();}if(t1.length>1){w1=t1.pop()&&t1.pop();}jQuery.sap.log.debug(w1,"getBindingType could not retrieve node for "+r1);if(i.nodes[w1]===undefined){return undefined;}var x1=i.nodes[w1].attributes[v1];if(!x1){return undefined;}var y1=j1[x1.dataType];if(!y1){return undefined;}var z1;switch(y1){case"sap.ui.model.type.String":z1=new S(null,{minLength:(x1.required?1:undefined),maxLength:(x1.maxLength||undefined)});break;case"sap.ui.model.type.Integer":if(x1.dataType==="TINYINT"){z1=new f();}else{z1=new I({groupingEnabled:false,minFractionDigits:0,maxFractionDigits:0},{minimum:x1.minValue!=x1.maxValue?x1.minValue:undefined,maximum:x1.maxValue!=x1.minValue?x1.maxValue:undefined});}break;case"sap.ui.model.type.Float":z1=new F({groupingEnabled:false,minFractionDigits:0},{minimum:x1.minValue!=x1.maxValue?x1.minValue:undefined,maximum:x1.maxValue!=x1.minValue?x1.maxValue:undefined});break;case"sap.ui.model.type.Date":z1=new D({source:{pattern:"yyyy-MM-dd"},style:"medium"},{minimum:x1.required?"1970-01-01":undefined});break;case"sap.ui.model.type.DateTime":z1=new g({style:"medium"},{minimum:x1.required?"1970-01-01T00:00:00Z":undefined});break;case"sap.ui.model.type.Time":z1=new T({style:"medium"},{minimum:x1.required?"00:00:00":undefined});break;default:break;}return z1;}var o1={Meta:"meta",Property:"property"};function p1(e){return jQuery.map(o1,function(e){return e;}).indexOf(e)>=0;}function q1(e,i){if(i){var r1=i[0]==="/";var s1=i.split("/");if(!r1){s1.splice(0,0,"");}if(s1.length>2){var t1=s1[1];if(t1===o1.Meta){var u1=e.getObjectName();var v1=[u1].concat(s1.slice(2));var w1=(r1?"/":"")+v1.join("/");return{model:M,path:w1};}if(t1===o1.Property){var x1=(r1?"/":"")+s1.slice(2).join("/");if(!e._oPropertyModel){jQuery.sap.log.error("Scope for property binding needs to be defined when creating the object");}return{model:e._oPropertyModel,path:x1};}}}return undefined;}k.prototype.bindProperty=function(e,i,r1){var s1=q1(this,e);if(!s1||!s1.model){return J.prototype.bindProperty.apply(this,arguments);}return new c(s1.model,s1.path,i,r1);};k.prototype.bindList=function(e,i,r1,s1,t1){var u1=q1(this,e);if(!u1||!u1.model){return J.prototype.bindList.apply(this,arguments);}return new b(u1.model,u1.path,i,r1,s1,t1);};k.prototype.getProperty=function(e,i){var r1=q1(this,e);if(!r1||!r1.model){return J.prototype.getProperty.apply(this,arguments);}return r1.model.getProperty(r1.path);};k.prototype.getPropertyModel=function(){return this._oPropertyModel;};k.prototype.addBinding=function(e){J.prototype.addBinding.apply(this,arguments);if(e instanceof sap.ui.model.PropertyBinding&&e.getBindingMode()===B.TwoWay){var i=e.getType();if(i===undefined){var r1=n1(e,this.getApplicationObjectMetadata());if(r1){e.setType(r1,e.sInternalType);}}}};k.prototype.process=u;k.prototype.calculateChangeRequest=s;k.prototype.processHeaders=function(){return null;};k.prototype.parseResponse=w;k.prototype.readData=function(e){return this.getApplicationObject().readData(this.getKey(),e);};k.prototype.getLastReadDate=function(){return this._lastReadDate;};k.prototype.getKey=function(){var e=this.getData();var i=this.getApplicationObjectMetadata();var r1=e[i.nodes.Root.primaryKey];if(!r1){return this.getInitKey();}return r1;};k.prototype.getInitKey=function(){return this._initKey;};k.prototype.getApplicationObjectMetadata=function(){return this.getApplicationObject().getApplicationObjectMetadata();};k.prototype.getObjectName=function(){return this.getApplicationObject().getObjectName();};k.prototype.getDataInitializedPromise=function(){return this._oDataInitPromise;};k.prototype.getPropertyModelInitializedPromise=function(){return this._oPropertyModelInitPromise;};k.prototype.hasPendingChanges=function(){var e=this.getApplicationObjectMetadata();var i=this.getUserChanges();delete i[e.nodes.Root.primaryKey];var r1=!jQuery.sap.equal(i,{});if(r1){jQuery.sap.log.info("Pending changes: user change:"+JSON.stringify(i));}return r1;};k.prototype.getChangeRequest=function(e){return this.calculateChangeRequest(this.getApplicationObject(),this._oBeforeData||{},this.getData(),e,this);};k.prototype.getUserChanges=function(){var e={};var i=this.getApplicationObjectMetadata();var r1;if(this._oDeterminationData){r1=this.calculateChangeRequest(this.getApplicationObject(),{},this._oDeterminationData,false,this);}var s1=this.getChangeRequest();e=s1;if(r1){if(jQuery.sap.equal(r1,s1)){return{};}v(e,N.Root,function(t1,u1,v1){var w1=p(i,r1,u1,t1[i.nodes[u1].primaryKey]);if(w1){jQuery.each(t1,function(x1,y1){if(jQuery.isArray(y1)){return;}if(jQuery.sap.equal(w1[x1],y1)){delete t1[x1];}});}});o(e,N.Root,function(t1,u1,v1){if(u1!=N.Root){var w1=q(i,r1,u1);if(w1){if(t1.length==w1.length){var x1=false;jQuery.each(t1,function(y1,z1){if(!jQuery.isEmptyObject(z1)){x1=true;return false;}return true;});if(!x1){delete v1[u1];}}}}});}return e;};k.prototype._parseMessages=function(e){this._oMessageParser.parse(e);};k.prototype.getMessageParser=function(){return this._oMessageParser;};k.prototype._resolveAfterInitialize=function(e){var i=this.getDataInitializedPromise();var r1=Array.prototype.slice.call(arguments,1);if(i){i.done(function(){e.resolve.apply(e,r1);});i.fail(function(){e.resolve.apply(e,r1);});}else{e.resolve.apply(e,r1);}};k.prototype._mergeConcurrentChanges=function(e){var r1=this;var s1=this.getApplicationObjectMetadata();var t1=this.getApplicationObject();var u1=this.getUserChanges();var v1=this.getChangeRequest(true);var w1=jQuery.extend(true,{},e);var x1=r1._oBeforeData;if(t1.determinations&&t1.determinations.onNormalizeData){x1=jQuery.extend(true,{},x1);x1=t1.determinations.onNormalizeData(x1,this);}v(w1,N.Root,function(e,y1,z1){if(!s1.nodes[y1]){return;}var A1=s1.nodes[y1].primaryKey;var B1=e[A1];var C1=r(u1,y1);if(C1){var D1=p(s1,u1,y1,B1);if(D1){jQuery.each(e,function(F1,G1){if(jQuery.isArray(G1)){return;}if(D1[F1]!==undefined){e[F1]=D1[F1];}});}else{var E1=p(s1,x1,y1,B1);if(E1){for(var i=0;i<z1.length;i++){if(z1[i][A1]===B1){z1.splice(i,1);return;}}}}}});v(u1,N.Root,function(e,i,y1,z1){var A1=s1.nodes[i].primaryKey;var B1=s1.nodes[i].parentNode;var C1=B1&&s1.nodes[B1].primaryKey;var D1=p(s1,w1,i,e[A1]);if(!D1){if(Object.keys(e).length===1&&e[A1]){return;}var E1=jQuery.extend(true,{},e);var F1=p(s1,v1,i,E1[A1]);if(F1){E1=jQuery.extend(true,{},F1);}if(E1[A1]>=0){E1[A1]=r1.getNextHandle();}var G1=z1.parentData[C1];var H1=p(s1,w1,B1,G1);if(H1){H1[i]=H1[i]||[];H1[i].push(E1);}else{jQuery.sap.log.fatal("Merging may only be enabled for objects where deleting parents is impossible");}}});if(t1.determinations&&t1.determinations.onMergeConcurrentChanges){w1=t1.determinations.onMergeConcurrentChanges(w1,u1);}return w1;};k.prototype.isNew=function(){if(this._isNew===undefined){this._isNew=true;}return this._isNew;};k.prototype.isDeleted=function(){return this._isDeleted;};k.prototype.setProperty=function(e,i,r1){return J.prototype.setProperty.apply(this,arguments);};k.prototype.revertChanges=function(){if(this.isNew()){this.setData({});}else{this.setData(jQuery.extend(true,{},this._oBeforeData)||{});}};k.prototype.sync=function(){if(this._oPropertyModel){this._oPropertyModel.sync(this.getKey());}g1(this,this.getKey());};k.prototype.mergeConcurrentChanges=function(){g1(this,this.getKey(),true);};k.prototype.setConcurrencyToken=function(e){if(this._oSettings&&this._oSettings.concurrencyEnabled){this._sConcurrencyToken=e;}};k.prototype.setConflictConcurrencyToken=function(e){if(this._oSettings&&this._oSettings.concurrencyEnabled){this._sConflictConcurrencyToken=e;}};k.prototype.applyConflictConcurrencyToken=function(i){if(i){this._sConcurrencyToken=this._sConflictConcurrencyToken;}this._sConflictConcurrencyToken=undefined;};k.prototype.resolveConflictManually=function(){this.applyConflictConcurrencyToken(true);};k.prototype.updateNode=function(e,i){var r1=this.getApplicationObject().getApplicationObjectMetadata();var s1=r1.nodes[i];if(!s1){jQuery.sap.log.error(i+" in "+this.getObjectName()+" is not known");return;}v(this.getData(),"Root",function(t1,u1,v1){if(u1===i&&t1[s1.primaryKey]===e[s1.primaryKey]){t1=jQuery.extend(t1,e);}});this.checkUpdate(true);};k.prototype.addChild=function(e,i){var r1=this.getApplicationObject().getApplicationObjectMetadata();var s1=r1.nodes[i];if(!s1){jQuery.sap.log.error(i+" in "+this.getObjectName()+" is not known");return 0;}if(s1.parentNode!==N.Root){jQuery.sap.log.error("addChild only works for subnodes of Root");return 0;}var t1=this.getNextHandle();e[s1.primaryKey]=t1;var u1=this.getProperty("/"+i);if(!u1){u1=[];this.setProperty("/"+i,u1);}u1.push(e);this.checkUpdate(true);return t1;};k.prototype.removeChild=function(e){v(this.getData(),N.Root,function(i,r1,s1){if(i===e){if(!s1||!jQuery.isArray(s1)){jQuery.sap.log.error("No parent available to remove child");return;}var t1=s1.indexOf(e);if(t1>=0){s1.splice(t1,1);}else{jQuery.sap.log.error("Child not found");}}});this.checkUpdate(true);};k.prototype.getReadSourceModel=function(){return this._oReadSourceSettings?this._oReadSourceSettings.model:undefined;};k.prototype.setAfterInitChanges=function(){if(this.isNew()){this._oDeterminationData=jQuery.extend(true,{},this.getData());}else{this._oBeforeData=jQuery.extend(true,{},this.getData());}};k.prototype.getNextHandle=function(){if(!this._iNextHandle){this._iNextHandle=-1;}return this._iNextHandle--;};k.prototype.getBeforeData=function(){return this._oBeforeData;};k.setMetaModel=function(e){M=e;};k.prototype.releaseFromSyncMode=function(){h.removeApplicationObject(this.getKey(),this);};k.prototype.destroy=function(){if(this._oPropertyModel){this._oPropertyModel.destroy();}return J.prototype.destroy.apply(this,arguments);};return k;});
