/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ino/commons/application/Configuration"],function(C){"use strict";var W={Readonly:"Readonly",Write:"Write"};var _=function(v){return v?v+"px":"0px";};var a=function(v){return parseInt(v,10);};var b=function(v){return e[v];};var c=function(u){return u?parseInt(u.substring(u.lastIndexOf("/")+1),10):undefined;};var d=function(I){return C.getAttachmentDownloadURL(I);};var e={"Yellow":"FCF294","FCF294":"Yellow","Pink":"E5B0E8","E5B0E8":"Pink","Cyan":"87E0FD","87E0FD":"Cyan","Green":"D2FF52","D2FF52":"Green","Neutral":"FFFFFF","FFFFFF":"Neutral","Orange":"FFA84C","FFA84C":"Orange","Red":"FF3019","FF3019":"Red","Rose":"F9D6D6","F9D6D6":"Rose","Lavender":"C4C6FF","C4C6FF":"Lavender","Black":"45484D","45484D":"Black"};var f=function(v){if(v.length===7&&v[0]==="#"){return v.substr(1);}else if(v.length===4&&v[0]==="#"){return v[1]+v[1]+v[2]+v[2]+v[3]+v[3];}return undefined;};var g=function(v){if(v.length===6){return"#"+v;}else if(v.length===3){return"#"+v[1]+v[1]+v[2]+v[2]+v[3]+v[3];}return undefined;};var h={"sap.ino.config.GROUP":"sap.ino.wall.WallItemGroup","sap.ino.wall.WallItemGroup":"sap.ino.config.GROUP","sap.ino.config.ATTACHMENT":"sap.ino.wall.WallItemAttachment","sap.ino.wall.WallItemAttachment":"sap.ino.config.ATTACHMENT","sap.ino.config.DOCUMENT":"sap.ino.wall.WallItemDocument","sap.ino.wall.WallItemDocument":"sap.ino.config.DOCUMENT","sap.ino.config.HEADLINE":"sap.ino.wall.WallItemHeadline","sap.ino.wall.WallItemHeadline":"sap.ino.config.HEADLINE","sap.ino.config.IMAGE":"sap.ino.wall.WallItemImage","sap.ino.wall.WallItemImage":"sap.ino.config.IMAGE","sap.ino.config.LINE":"sap.ino.wall.WallItemLine","sap.ino.wall.WallItemLine":"sap.ino.config.LINE","sap.ino.config.LINK":"sap.ino.wall.WallItemLink","sap.ino.wall.WallItemLink":"sap.ino.config.LINK","sap.ino.wall.WallItemPerson":"sap.ino.config.PERSON","sap.ino.config.PERSON":"sap.ino.wall.WallItemPerson","sap.ino.config.SPRITE":"sap.ino.wall.WallItemSprite","sap.ino.wall.WallItemSprite":"sap.ino.config.SPRITE","sap.ino.config.STICKER":"sap.ino.wall.WallItemSticker","sap.ino.wall.WallItemSticker":"sap.ino.config.STICKER","sap.ino.config.TEXT":"sap.ino.wall.WallItemText","sap.ino.wall.WallItemText":"sap.ino.config.TEXT","sap.ino.config.VIDEO":"sap.ino.wall.WallItemVideo","sap.ino.wall.WallItemVideo":"sap.ino.config.VIDEO","sap.ino.config.ARROW":"sap.ino.wall.WallItemArrow","sap.ino.wall.WallItemArrow":"sap.ino.config.ARROW"};var i={"WALL":{"storageId":{property:"ID"},"title":{property:"NAME"},"backgroundImage":{property:"BACKGROUND_IMAGE_URL"},"backgroundImageZoom":{property:"BACKGROUND_IMAGE_ZOOM",formatter:function(v){var V=parseInt(v,10);return isNaN(V)?1:V;}},"backgroundImageTiled":{property:"BACKGROUND_IMAGE_REPEAT",formatter:function(t){return t?1:0;}},"backgroundColor":{property:"BACKGROUND_COLOR"},"mode":{property:"IS_LOCKED",formatter:function(M){return M==W.Readonly?1:0;}},"type":{property:"WALL_TYPE_CODE",formatter:function(t){return t==="Template"?"sap.ino.config.TEMPLATE":"sap.ino.config.WALL";}},"actionCode":{property:"ACTION_CODE"}},"INO":{"ID":{property:"storageId"},"NAME":{property:"title"},"BACKGROUND_IMAGE_URL":{property:"backgroundImage"},"BACKGROUND_IMAGE_ZOOM":{property:"backgroundImageZoom",formatter:function(v){var V=parseInt(v,10);return isNaN(V)?1:V;}},"BACKGROUND_IMAGE_REPEAT":{property:"backgroundImageTiled",formatter:function(r){return r==1;}},"BACKGROUND_COLOR":{property:"backgroundColor"},"CREATED_BY_NAME":{property:"owner"},"IS_LOCKED":{property:"mode",formatter:function(I){return I==1?W.Readonly:W.Write;}},"WALL_TYPE_CODE":{property:"type",formatter:function(w){return w==="sap.ino.config.TEMPLATE"?"Template":"Wall";}},"ACTION_CODE":{property:"actionCode"}}};var j={"WALL":{"storageId":{property:"ID"},"id":{initial:true,property:"ID"},"parentId":{property:"PARENT_WALL_ITEM_ID",formatter:function(P){return(P!=="0")?P:null;}},"w":{property:"WIDTH",formatter:function(v){return a(v)||0;}},"h":{property:"HEIGHT",formatter:function(v){return a(v)||0;}},"depth":{property:"ZINDEX"},"className":{property:"WALL_ITEM_TYPE_CODE",formatter:function(s){return h[s];}},"title":{parent:"CONTENT",property:"TEXT"},"position":{children:{"x":{property:"POSITION_X",formatter:a},"y":{property:"POSITION_Y",formatter:a}}},"actionCode":{property:"ACTION_CODE"}},"INO":{"ID":{property:"storageId"},"PARENT_WALL_ITEM_ID":{property:"parentId"},"NAME":{property:"title"},"CONTENT":{children:{"TEXT":{property:"title"}}},"WIDTH":{property:"w",formatter:_},"HEIGHT":{property:"h",formatter:_},"ZINDEX":{property:"depth"},"WALL_ITEM_TYPE_CODE":{property:"className",formatter:function(s){return h[s];}},"POSITION_X":{parent:"position",property:"x",formatter:_},"POSITION_Y":{parent:"position",property:"y",formatter:_},"ACTION_CODE":{property:"actionCode"}}};var k={"WALL":{"sap.ino.wall.WallItemHeadline":{"size":{parent:"CONTENT",property:"SIZE"},"type":{parent:"CONTENT",property:"STYLE"}},"sap.ino.wall.WallItemLink":{"description":{parent:"CONTENT",property:"URL"},"type":{parent:"CONTENT",property:"ICON"}},"sap.ino.wall.WallItemSticker":{"color":{parent:"CONTENT",property:"COLOR",formatter:b},"description":{parent:"CONTENT",property:"TEXT"}},"sap.ino.wall.WallItemGroup":{"color":{parent:"CONTENT",property:"COLOR",formatter:f}},"sap.ino.wall.WallItemImage":{"content":{children:{"image":{parent:"Image",array:true,property:"ATTACHMENT_ID",formatter:c},"preview":{initial:true,parent:"Image",array:true,property:"ATTACHMENT_ID",formatter:c},"assignmentId":{parent:"Image",array:true,property:"ID"},"showAsIcon":{parent:"CONTENT",property:"SHOW_AS_ICON"}}},"title":{parent:"CONTENT",property:"CAPTION"}},"sap.ino.wall.WallItemText":{"description":{parent:"CONTENT",property:"TEXT"},"title":{parent:"CONTENT",property:"CAPTION"}},"sap.ino.wall.WallItemLine":{"orientation":{parent:"CONTENT",property:"ORIENTATION"},"thickness":{parent:"CONTENT",property:"THICKNESS"},"style":{parent:"CONTENT",property:"STYLE"},"color":{parent:"CONTENT",property:"COLOR",formatter:f},"title":{property:"NAME"}},"sap.ino.wall.WallItemSprite":{"color":{parent:"CONTENT",property:"COLOR",formatter:f},"type":{parent:"CONTENT",property:"SHAPE"}},"sap.ino.wall.WallItemPerson":{"title":{parent:"CONTENT",property:"NAME"},"content":{children:{"image":{parent:"Image",array:true,property:"ATTACHMENT_ID",formatter:c},"phone":{parent:"CONTENT",property:"PHONE"},"email":{parent:"CONTENT",property:"EMAIL"},"originId":{parent:"CONTENT",property:"ORIGIN_ID"},"requestImage":{parent:"CONTENT",property:"REQUEST_IMAGE"},"assignmentId":{parent:"Image",array:true,property:"ID"}}}},"sap.ino.wall.WallItemVideo":{"content":{children:{"video":{parent:"CONTENT",property:"URL"},"preview":{initial:true,parent:"CONTENT",property:"URL"}}},"title":{parent:"CONTENT",property:"CAPTION"}},"sap.ino.wall.WallItemDocument":{"title":{parent:"CONTENT",property:"CAPTION"},"description":{parent:"CONTENT",property:"URL"},"type":{parent:"CONTENT",property:"DOC_TYPE"}},"sap.ino.wall.WallItemAttachment":{"title":{parent:"CONTENT",property:"CAPTION"},"content":{children:{"URL":{parent:"Attachment",array:true,property:"ATTACHMENT_ID",formatter:c},"assignmentId":{parent:"Attachment",array:true,property:"ID"},"type":{parent:"CONTENT",property:"TYPE"},"fileName":{parent:"CONTENT",property:"FILE_NAME"}}}},"sap.ino.wall.WallItemArrow":{"thickness":{parent:"CONTENT",property:"THICKNESS"},"style":{parent:"CONTENT",property:"STYLE"},"headStyle":{parent:"CONTENT",property:"HEAD_STYLE"},"color":{parent:"CONTENT",property:"COLOR",formatter:f},"title":{parent:"CONTENT",property:"TEXT"},"x1":{parent:"CONTENT",property:"X1"},"y1":{parent:"CONTENT",property:"Y1"},"x2":{parent:"CONTENT",property:"X2"},"y2":{parent:"CONTENT",property:"Y2"}}},"INO":{"sap.ino.config.HEADLINE":{"CONTENT":{children:{"SIZE":{property:"size"},"STYLE":{property:"type"},"TEXT":{property:"title"}}}},"sap.ino.config.LINK":{"CONTENT":{children:{"URL":{property:"description"},"ICON":{property:"type"},"TEXT":{property:"title"}}}},"sap.ino.config.STICKER":{"CONTENT":{children:{"COLOR":{property:"color",formatter:b},"TEXT":{property:"description"}}}},"sap.ino.config.GROUP":{"CONTENT":{children:{"COLOR":{property:"color",formatter:g},"TEXT":{property:"title"}}}},"sap.ino.config.IMAGE":{"CONTENT":{children:{"CAPTION":{property:"title"},"SHOW_AS_ICON":{parent:"content",property:"showAsIcon"}}},"Image":{children:{"ATTACHMENT_ID":{parent:"content",property:["image","preview"],formatter:d},"ID":{parent:"content",property:"assignmentId"}}}},"sap.ino.config.TEXT":{"CONTENT":{children:{"CAPTION":{property:"title"},"TEXT":{property:"description"}}}},"sap.ino.config.LINE":{"CONTENT":{children:{"ORIENTATION":{property:"orientation"},"THICKNESS":{property:"thickness"},"STYLE":{property:"style"},"COLOR":{property:"color",formatter:g}}},"NAME":{property:"title"}},"sap.ino.config.SPRITE":{"CONTENT":{children:{"COLOR":{property:"color",formatter:g},"SHAPE":{property:"type"},"TEXT":{property:"title"}}}},"sap.ino.config.PERSON":{"CONTENT":{children:{"NAME":{property:"title"},"IMAGE":{property:"image",parent:"content"},"PHONE":{property:"phone",parent:"content"},"EMAIL":{property:"email",parent:"content"},"ORIGIN_ID":{property:"originId",parent:"content"},"REQUEST_IMAGE":{property:"requestImage",parent:"content"}}},"Image":{children:{"ATTACHMENT_ID":{parent:"content",property:["image","preview"],formatter:d},"ID":{parent:"content",property:"assignmentId"}}}},"sap.ino.config.VIDEO":{"CONTENT":{children:{"URL":{parent:"content",property:["video","preview"]},"CAPTION":{property:"title"}}}},"sap.ino.config.DOCUMENT":{"CONTENT":{children:{"URL":{property:"description"},"CAPTION":{property:"title"},"DOC_TYPE":{property:"type"}}}},"sap.ino.config.ATTACHMENT":{"CONTENT":{children:{"CAPTION":{property:"title"},"TYPE":{property:"type",parent:"content"},"FILE_NAME":{property:"fileName",parent:"content"}}},"Attachment":{children:{"ATTACHMENT_ID":{property:"URL",parent:"content",formatter:d},"ID":{property:"assignmentId",parent:"content"}}}},"sap.ino.config.ARROW":{"CONTENT":{children:{"THICKNESS":{property:"thickness"},"STYLE":{property:"style"},"HEAD_STYLE":{property:"headStyle"},"COLOR":{property:"color",formatter:g},"TEXT":{property:"title"},"X1":{property:"x1"},"Y1":{property:"y1"},"X2":{property:"x2"},"Y2":{property:"y2"}}}}}};var l=function(I,P,F,o,v){if(P){if(jQuery.type(P)=="array"){P.forEach(function(s){if(!o||!I[s]){I[s]=F?F(v):v;}});}else{if(!o||!I[P]){I[P]=F?F(v):v;}}}};var m=function(I,P,s,F,o,v,A){if(P){if(s){if(!I[s]){if(A){I[s]=[];}else{I[s]={};}}if(A&&I[s].length===0){I[s].push({});}var O=A?I[s][0]:I[s];l(O,P,F,o,v);if(A&&JSON.stringify(O)==="{}"){I[s].pop();}}else{l(I,P,F,o,v);}}};var n=function(I,M,v){var V=(jQuery.type(v)==="array")?v[0]:v;var F,P,s,A,o;if(V!==undefined){if(M.children){for(var q in M.children){F=M.children[q].formatter;P=M.children[q].property;s=M.children[q].parent;A=M.children[q].array;o=M.children[q].initial;m(I,P,s,F,o,V[q],A);}}else{F=M.formatter;P=M.property;s=M.parent;A=M.array;o=M.initial;m(I,P,s,F,o,V,A);}}};var p={};p.mapItemToIno=function(w){var I={};var s=w.className;var D=j.WALL;var S=k.WALL[s];for(var o in w){if(w.hasOwnProperty(o)){if(S&&S[o]){n(I,S[o],w[o]);}else if(D[o]){n(I,D[o],w[o]);}}}return I;};p.mapItemsFromIno=function(I,D){var M=function(o){var v={};var w=o.WALL_ITEM_TYPE_CODE;var x=j.INO;var S=k.INO[w];for(var t in o){if(o.hasOwnProperty(t)){if(S&&S[t]){n(v,S[t],o[t]);}else if(x[t]){n(v,x[t],o[t]);}}}return v;};var q=[];var r=jQuery.type(I)=="array"?I:[I];if(D){r.forEach(function(o){q.push(M(o));});}else{var P=[];var s={};r.forEach(function(o){var v=M(o);P.push(v);if(v.parentId>0){if(!s[v.parentId]){s[v.parentId]=[];}s[v.parentId].push(v);}else{q.push(v);}});for(var t in s){if(s.hasOwnProperty(t)){var u=P.filter(function(o){return o.storageId==t;});if(u&&u.length>0){u[0].childs=s[t];}}}}return q;};p.setInoProperty=function(w,I,v){if(jQuery.sap.startsWith(I,"/")){I=I.substring(1);}var M=i.INO[I];if(M&&M.property){var s="set"+M.property.substring(0,1).toUpperCase()+M.property.substring(1);if(typeof w[s]==="function"){w[s].apply(w,[M.formatter?M.formatter(v):v]);}else{w.setProperty(M.property,M.formatter?M.formatter(v):v);w._notifyChanged(M.property);}return true;}else{jQuery.sap.log.warning("no mapping available for property '"+I+"'",undefined,"WallMapper");return false;}};p._checkWallPrivilege=function(G,u){if(u===undefined){u=C.getCurrentUser().USER_ID;}if(G&&jQuery.type(G==="array")){var o=G.filter(function(I){return I.IDENTITY_ID===u;});if(o.length>0){return true;}}return false;};p.mapWallFromIno=function(I,D){var w;if(I){w={};for(var o in I){if(I.hasOwnProperty(o)&&i.INO[o]&&i.INO[o].property){w[i.INO[o].property]=i.INO[o].formatter?i.INO[o].formatter(I[o]):I[o];}}w.hits=0;w.favorite=false;w.timestamp=new Date(I.CHANGED_AT).getTime();var u=C.getCurrentUser().USER_ID;var M=p._checkWallPrivilege(I.Owner,u);var s="owner";if(!M){M=p._checkWallPrivilege(I.Admins,u);s="admin";}if(!M){M=p._checkWallPrivilege(I.Writers,u);s="write";}if(!M){M=p._checkWallPrivilege(I.Readers,u);s="read";}if(!M){s="none";}w.strongestAuth=s;var q=[];w.numberOfItems=I.Items?I.Items.length:0;if(w.numberOfItems>0){q=p.mapItemsFromIno(I.Items,D);}w.items=q;}return w;};p.mapWallToIno=function(w){var J=w.formatToJSON();var I=[];var o={};for(var q in J){if(J.hasOwnProperty(q)&&i.WALL[q]&&i.WALL[q].property){o[i.WALL[q].property]=i.WALL[q].formatter?i.WALL[q].formatter(J[q]):J[q];}}var r=w.getItems();if(jQuery.type(r)==="array"){r.forEach(function(s){I=I.concat(p.mapWallToInoItem(s));});}o.Items=I;return o;};p.mapWallToInoItem=function(I){var o=p.mapItemToIno(I.formatToJSON());var q=[o];if(I.getChilds().length>0){I.getChilds().forEach(function(r){q=q.concat(p.mapWallToInoItem(r));});}return q;};return p;});
