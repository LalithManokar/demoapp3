/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
sap.ui.define(["sap/ino/commons/models/core/CodeModel","sap/ino/commons/application/Configuration"],function(C,a){"use strict";var R={};R.ReportViewType={Graphical:"GRAPHIC",Table:"TABLE"};R.getViewConfiguration=function(c){return c.Views[c.SelectedView];};R.getPropertyVisibility=function(v,p){if(v.Dimensions.indexOf(p)>-1||(v.SecondaryDimensions&&v.SecondaryDimensions.indexOf(p)>-1)||v.Measures.indexOf(p)>-1||(v.SecondaryMeasures&&v.SecondaryMeasures.indexOf(p)>-1)){return true;}return false;};R.createFilter=function(c,p,v){p=p===undefined?true:p;v=v===undefined?true:v;var V=this.getViewConfiguration(c);var f=[];if(p&&c.Parameters){var P=c.Parameters;jQuery.each(P,function(I,b){var d=[];for(var i=0;i<b.Selection.length;i++){d.push(new sap.ui.model.Filter(b.Key,"EQ",b.Selection[i]));}if(d.length>0){f.push(new sap.ui.model.Filter(d,false));}});}if(v&&V.Filter!==null&&V.Filter!==undefined){for(var F in V.Filter){var s=V.Filter[F];var o=new sap.ui.model.Filter(F,"EQ",s);f.push(o);}}return f;};R.checkMandatoryParameters=function(c){if(!c.Parameters){return true;}var m=true;jQuery.each(c.Parameters,function(i,p){if(p.Mandatory===true&&(p.Selection===undefined||p.Selection===null||p.Selection.length===0)){m=false;return;}});return m;};R.getRequestedAttributes=function(v,g){var r=[];if(g&&v.Graphic&&v.Graphic==="map"){r.push(v.Map.Longitude);r.push(v.Map.Latitude);r.push(v.Map.Granularity);}r=r.concat(v.Dimensions);if(v.SecondaryDimensions){r=r.concat(v.SecondaryDimensions);}r=r.concat(v.Measures);if(v.SecondaryMeasures){r=r.concat(v.SecondaryMeasures);}if(v.Sorters&&v.Sorters.length>=1){jQuery.each(v.Sorters,function(i,s){if(r.indexOf(s.columnKey)===-1){r.unshift(s.columnKey);}});}return r;};R.parseConfigToObject=function(r){if(r.CONFIG!==undefined&&r.CONFIG!==null){if(typeof r.CONFIG==="string"){r.CONFIG=JSON.parse(r.CONFIG);}}else{return r;}if(r.CAMPAIGN_ID){if(r.CONFIG.Parameters&&r.CONFIG.Parameters.Campaign){r.CONFIG.Parameters.Campaign.Selection=[r.CAMPAIGN_ID];r.CONFIG.Parameters.Campaign.SelectionString=r.CAMPAIGN_NAME;}}var g=sap.ino.commons.models.core.CodeModel.getFormatter("sap.ino.xs.object.analytics.ReportTemplate.Root");if(!r.CONFIG.Title){if(r.REPORT_TEMPLATE_CODE){r.CONFIG.Title=g(r.REPORT_TEMPLATE_CODE);}else if(r.CODE){r.CONFIG.Title=g(r.CODE);}else if(r.DEFAULT_TEXT){r.CONFIG.Title=r.DEFAULT_TEXT;}}if(!r.CONFIG.Description){if(r.REPORT_TEMPLATE_CODE){r.CONFIG.Description=g(r.REPORT_TEMPLATE_CODE);}else if(r.CODE){r.CONFIG.Description=g(r.CODE);}else if(r.DEFAULT_LONG_TEXT){r.CONFIG.Description=r.DEFAULT_LONG_TEXT;}}if(r.CONFIG.Views){R.deleteSorterInConfig(r.CONFIG);}return r;};R.deleteSorterInConfig=function(c){if(c&&c.Views){jQuery.each(c.Views,function(i,v){if(v.Sorter){v.Sorters=[{columnKey:v.Sorter.Path,operation:v.Sorter.Descending?"Descending":"Ascending"}];delete v.Sorter;}});}};R.parseConfigToString=function(r){if(r.CONFIG!==undefined&&r.CONFIG!==null){r.CAMPAIGN_ID=null;if(r.CONFIG.Parameters){var c=r.CONFIG.Parameters.Campaign.Selection;if(c!==undefined&&c!==null&&c.length===1){r.CAMPAIGN_ID=parseInt(c[0],10);}}if(typeof r.CONFIG==="object"){r.CONFIG=JSON.stringify(r.CONFIG);}}return r;};R.getAnnotationXML=function(c){var o=c.ODataPath||a.getApplicationPath("sap.ino.config.URL_PATH_OD_ANALYTICS");var v=c.Views[c.SelectedView];var s;try{s=v.Chart.Type.split("/")[1];s=s.charAt(0).toUpperCase()+s.slice(1);}catch(e){s="Column";}var x="<?xml version=\"1.0\" encoding=\"utf-8\"?>"+"<edmx:Edmx xmlns:edmx=\"http://docs.oasis-open.org/odata/ns/edmx\" Version=\"4.0\">"+"<edmx:Reference Uri=\"/"+o+"/$metadata\">"+"<edmx:Include Alias=\"ANALYTICSODATA\" Namespace=\"sap.ino.rest\" />"+"</edmx:Reference>"+"<edmx:DataServices>"+"<Schema xmlns=\"http://docs.oasis-open.org/odata/ns/edm\" Namespace=\"sap.ino.rest\">"+"<Annotations Target=\"sap.ino.rest."+c.DataSource+"Type\">"+"<Annotation Term=\"com.sap.vocabularies.UI.v1.Chart\">"+"<Record>"+"<PropertyValue Property=\"Title\" String=\""+v.DisplayName+"\" />"+"<PropertyValue Property=\"ChartType\" EnumMember=\"com.sap.vocabularies.UI.v1.ChartType/"+s+"\" />"+"<PropertyValue Property=\"Dimensions\">"+"<Collection>";jQuery.each(v.Dimensions,function(i,d){x+="<PropertyPath>"+d+"</PropertyPath>";});if(v.SecondaryDimensions){jQuery.each(v.SecondaryDimensions,function(i,d){x+="<PropertyPath>"+d+"</PropertyPath>";});}x+="</Collection>"+"</PropertyValue>"+"<PropertyValue Property=\"Measures\">"+"<Collection>";jQuery.each(v.Measures,function(i,m){x+="<PropertyPath>"+m+"</PropertyPath>";});if(v.SecondaryMeasures){jQuery.each(v.SecondaryMeasures,function(i,m){x+="<PropertyPath>"+m+"</PropertyPath>";});}x+="</Collection>"+"</PropertyValue>"+"</Record>"+"</Annotation>"+"</Annotations>"+"</Schema>"+"</edmx:DataServices>"+"</edmx:Edmx>";return x;};return R;});
