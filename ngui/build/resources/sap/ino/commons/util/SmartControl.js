sap.ui.define(["sap/ui/base/ManagedObject","sap/ino/commons/models/aof/MetaModel","sap/ino/commons/models/core/CodeModel","sap/ino/commons/util/UIObjectConfig","sap/ui/core/ListItem","sap/m/Label"],function(M,b,C,U,L,c){"use strict";var S=function(){throw"May not be instantiated directly";};function g(n,a){if(!n||n==="Root"){return"/"+a;}else{return"/"+n+"/0/"+a;}}function d(m,n,a){if(m==="data"||!n||n==="Root"){return m+">"+a;}else{return m+">"+n+"/0/"+a;}}function e(o,n,a,A){if(A){return b.getProperty("/"+o+"/nodes/"+n+"/attributes/"+a+"/"+A.replace(/\./,"/"));}else{return b.getProperty("/"+o+"/nodes/"+n+"/attributes/"+a);}}function f(m,n,a,A){return m+">/meta/nodes/"+n+"/attributes/"+a+"/"+A.replace(/\./,"/");}function h(m,n,a,A){return m+">/property/nodes/"+n+"/attributes/"+a+"/"+A.replace(/\./,"/");}S.getCodeFormatter=function(o,n,a){var s=e(o,n,a,"foreignKeyTo");return C.getFormatter(s);};S.getCodeLongTextFormatter=function(o,n,a){var s=e(o,n,a,"foreignKeyTo");return C.getLongTextFormatter(s);};S.getValueOptionListFormatter=function(o,n,a){var v=e(o,n,a,"customProperties.valueOptionList");var s="sap.ino.xs.object.basis.ValueOptionList.Root_"+v;return C.getFormatter(s);};S.getValueOptionListLongTextFormatter=function(o,n,a){var v=e(o,n,a,"customProperties.valueOptionList");var s="sap.ino.xs.object.basis.ValueOptionList.Root_"+v;return C.getLongTextFormatter(s);};S.getOpenObjectFormatter=function(o,O,n,a){var F=e(O,n,a,"foreignKeyTo");var u=U.getDefinition(F);return function(k){if(k&&u.navigation&&u.navigation.path&&u.navigation.key&&o.getOwnerComponent()){var p={};p[u.navigation.key]=k;return o.getOwnerComponent().getNavigationLink(u.navigation.path,p);}else{return"javascript:void(0);";}};};S.getQuickViewPressedHandler=function(o,m,O,n,a){var F=e(O,n,a,"foreignKeyTo");var u=U.getDefinition(F);var q;return function(E){if(!u.quickView){return;}var s=E.getSource();if(s){var v=s.getBindingContext(m)&&s.getBindingContext(m).getProperty(a);if(v!==undefined&&!q){q=sap.ui.xmlview({viewName:u.quickView});o.getView().addDependent(q);}if(q&&q.getController()){q.getController().open(s,v);}}};};S.bindToCode=function(o,a,m,O,n,A){var r=e(O,n,A,"required");var s=e(O,n,A,"foreignKeyTo");var N=e(O,n,A,"customProperties.noEmptyCode");_(o,a,m,O,n,A,s,!r&&!N);};S.bindToValueOptionList=function(o,a,m,O,n,A){var r=e(O,n,A,"required");var v=e(O,n,A,"customProperties.valueOptionList");var N=e(O,n,A,"customProperties.noEmptyCode");var s="sap.ino.xs.object.basis.ValueOptionList.Root_"+v;_(o,a,m,O,n,A,s,!r&&!N);};function _(o,a,m,O,n,A,s,i){if(a.getMetadata().getAllProperties().selectedKey){if(!a.getBindingInfo("selectedKey")){var I=new L({key:{path:"code>CODE"},text:{path:"code>CODE",formatter:C.getFormatter(s)},tooltip:{path:"code>CODE",formatter:C.getLongTextFormatter(s)}});a.bindProperty("selectedKey",{path:d(m,n,A)});a.bindAggregation("items",{path:"code>/"+s,template:I,sorter:{path:'CODE'},parameters:i?{includeEmptyCode:true}:undefined});}}else if(a.getMetadata().getAllProperties().text){if(!a.getBindingInfo("text")){a.bindProperty("text",{path:d(m,n,A),formatter:C.getFormatter(s)});}}};S.bindToForeignKey=function(o,a,m,O,n,A){var D=o.getModel("data")||(o.getOwnerComponent()&&o.getOwnerComponent().getModel("data"))||a.getModel("data");var F=e(O,n,A,"foreignKeyTo");var u=U.getDefinition(F);if(a.getMetadata().getAllProperties().value){if(!a.getBindingInfo("value")){var s=g(n,A);a.bindProperty("value",{path:d(m,n,A),formatter:function(v){var r="";if(v){jQuery.ajax({url:D.sServiceUrl+"/"+u.instancePath+"("+v+")"+"/"+u.selectionField+"/$value",async:false,success:function(i){r=i;}});}return r;}});a.setShowSuggestion(true);a.bindProperty("placeholder","i18n>GENERIC_CONTROL_TYPE_TO_SELECT");a.setFilterFunction(function(v,i){return true;});a.attachSuggest(function(E){var v=E.getParameter("suggestValue");var t=new L({text:"{data>"+u.selectionField+"}",additionalText:"{data>"+u.secondarySelectionField+"}",key:"{data>"+u.selectionKey+"}"});E.getSource().bindAggregation("suggestionItems",{path:"data>"+U.getSearchPath(F,v),template:t,parameters:u.parameters});});a.attachLiveChange(function(E){a.getModel(m).setProperty(s,null);});a.attachSuggestionItemSelected(function(E){var i=E.getParameters().selectedItem;if(!i){var r=jQuery.grep(a.getSuggestionItems(),function(j){return j.getText()===a.getValue();});if(r.length>0){i=r[0];}}if(i){var k=i&&parseInt(i.getKey(),10);a.getModel(m).setProperty(s,k);var N=i.getText();a.setValue(N);}else{a.setValue("");}a.focus();});a.attachSubmit(function(E){var i;var r=jQuery.grep(a.getSuggestionItems(),function(j){return j.getText()===E.getParameter("value");});if(r.length>0){i=r[0];}if(i){var k=i&&parseInt(i.getKey(),10);a.getModel(m).setProperty(s,k);}else{a.getModel(m).setProperty(s,null);a.setValue("");}a.focus();});a.addEventDelegate({onfocusout:function(E){if(a.getModel(m).getProperty(s)===null){var i;var r=jQuery.grep(a.getSuggestionItems(),function(j){return j.getText()===a.getValue();});if(r.length>0){i=r[0];}if(i){var k=i&&parseInt(i.getKey(),10);a.getModel(m).setProperty(s,k);}else{a.setValue("");}}}});}}else if(a.getMetadata().getAllProperties().text){if(!a.getBindingInfo("text")){a.bindProperty("text",{path:d(m,n,A),formatter:function(v){var r="";if(v){jQuery.ajax({url:D.sServiceUrl+"/"+u.instancePath+"("+v+")"+"/"+u.selectionField+"/$value",async:false,success:function(i){r=i;}});}return r;}});}if(typeof a.attachPress==="function"&&u.quickView){a.attachPress(S.getQuickViewPressedHandler(o,m,O,n,A));}else if(a.getMetadata().getAllProperties().href&&!a.getBindingInfo("href")){if(u.navigation&&u.navigation.path&&u.navigation.key){a.bindProperty("href",{path:d(m,n,A),formatter:S.getOpenObjectFormatter(o,O,n,A)});}}}};S.bindAll=function(o,j,m,O,N){function F(k,m,O,N){for(var n in k.mAggregations){var a=k.mAggregations[n];if(jQuery.isArray(a)){for(var i=0;i<a.length;i++){v(a[i],m,O,N);}}else if(a instanceof M){v(a,m,O,N);}}}function v(j,m,O,N){if(j.data("aofModel")){m=j.data("aofModel");}if(j.data("aofObject")){O=j.data("aofObject");}if(j.data("aofNode")){N=j.data("aofNode");}S.bind(o,j,m,O,N);F(j,m,O,N);}v(j,m,O,N);};S.bind=function(o,a,m,O,n){if(!a.data("aofAttribute")){return;}var i=o.getModel("i18n")||(o.getOwnerComponent()&&o.getOwnerComponent().getModel("i18n"))||a.getModel("i18n");var j;if(i){j=i.getResourceBundle();}if(a.data("aofModel")){m=a.data("aofModel");}m=m||"data";if(a.data("aofObject")){O=a.data("aofObject");}if(a.data("aofNode")){n=a.data("aofNode");}n=n||"Root";var A=a.data("aofAttribute");var u=a.data("aofUseValue");var l=a.data("aofColon");if(a.getMetadata().getAllProperties().required&&m!=="data"){a.bindProperty("required",{path:f(m,n,A,"required")});}if(j&&typeof a.setTooltip==="function"){a.setTooltip(j.getText(O+"."+n+"."+A));}var F=e(O,n,A,"foreignKeyTo");if(F&&(a.getMetadata().getAllProperties().value||a.getMetadata().getAllProperties().selectedKey||(a.getMetadata().getAllProperties().text&&!(a instanceof c&&!u)))){if(!!U.getDefinition(F)){S.bindToForeignKey(o,a,m,O,n,A);}else{S.bindToCode(o,a,m,O,n,A);}}else{var v=e(O,n,A,"customProperties.valueOptionList");if(v&&(a.getMetadata().getAllProperties().selectedKey||(a.getMetadata().getAllProperties().text&&!(a instanceof c&&!u)))){S.bindToValueOptionList(o,a,m,O,n,A);}else{if(a.getMetadata().getAllProperties().selected&&!a.getBindingInfo("selected")){a.bindProperty("selected",{path:d(m,n,A)});}else if(a.getMetadata().getAllProperties().text&&!a.getBindingInfo("text")){if(a instanceof c&&!u){a.bindProperty("text",{path:"i18n>"+O+"."+n+"."+A,formatter:function(t){return t+(l?": ":"");}});a.addStyleClass("sapInoLabelSpace");}else{a.bindProperty("text",{path:d(m,n,A),});}}else if(a.getMetadata().getAllProperties().value&&!a.getBindingInfo("value")){a.bindProperty("value",{path:d(m,n,A)});}if(m!=="data"){if(a.getMetadata().getAllProperties().maxLength&&!a.getBindingInfo("maxLength")){a.bindProperty("maxLength",{path:f(m,n,A,"maxLength")});}if(a.getMetadata().getAllProperties().min&&!a.getBindingInfo("min")){a.bindProperty("min",{path:f(m,n,A,"minValue")});}if(a.getMetadata().getAllProperties().max&&!a.getBindingInfo("max")){a.bindProperty("max",{path:f(m,n,A,"maxValue")});}}}}if(m!=="data"){if(a.getMetadata().getAllProperties().enabled){if(!a.getBindingInfo("enabled")){a.bindProperty("enabled",{path:h(m,n,A,"changeable")});}}else if(a.getMetadata().getAllProperties().editable){if(!a.getBindingInfo("editable")){a.bindProperty("editable",{path:h(m,n,A,"changeable")});}}}};return S;});
