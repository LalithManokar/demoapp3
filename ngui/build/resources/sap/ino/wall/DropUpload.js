/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.DropUpload");(function(){"use strict";sap.ui.core.Control.extend("sap.ino.wall.DropUpload",{metadata:{properties:{"size":{type:"string",group:"Misc",defaultValue:'M'},"icon":{type:"sap.ui.core.URI",group:"Appearance",defaultValue:'sap-icon://add-photo'},"accept":{type:"string",group:"Behavior",defaultValue:'image/*'},"tooltip":{type:"string",group:"Misc",defaultValue:"{i18n>WALL_DROPUPLOAD_STATUSMSG_DROP}"}},aggregations:{"_icon":{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"}},events:{"change":{}}}});sap.ino.wall.DropUpload.M_EVENTS={'change':'change'};sap.ino.wall.DropUpload.prototype.init=function(){this._onclickProxy=jQuery.proxy(this._onclick,this);this._onkeydownProxy=jQuery.proxy(this._onkeydown,this);this._ondropProxy=jQuery.proxy(this._ondrop,this);this._onchangeProxy=jQuery.proxy(this._onchange,this);};sap.ino.wall.DropUpload.prototype.exit=function(){this._onclickProxy=null;this._onkeydownProxy=null;this._ondropProxy=null;this._onchangeProxy=null;};sap.ino.wall.DropUpload.prototype.onBeforeRendering=function(){this.$().find("#"+this.getId()+"-fileDrop").unbind('drop.dropupload',this._ondropProxy);this.$().find("#"+this.getId()+"-fileDrop").unbind('keydown.dropupload',this._onkeydownProxy);this.$().find("#"+this.getId()+"-fileDrop").unbind('click.dropupload',this._onclickProxy);this.$().find("#"+this.getId()+"-fileUpload").unbind("change.dropupload",this._onchangeProxy);};sap.ino.wall.DropUpload.prototype.onAfterRendering=function(){var m,s;this.$().find("#"+this.getId()+"-fileDrop").bind('drop.dropupload',this._ondropProxy);this.$().find("#"+this.getId()+"-fileDrop").bind('click.dropupload',this._onclickProxy);this.$().find("#"+this.getId()+"-fileDrop").bind('keydown.dropupload',this._onkeydownProxy);this.$().find("#"+this.getId()+"-fileUpload").bind("change.dropupload",this._onchangeProxy);if(!jQuery.support.hasFlexBoxSupport||sap.ui.Device.browser.safari||sap.ui.Device.browser.internet_explorer&&sap.ui.Device.browser.version===10){this.$().addClass("sapUiNoFlex");m=-24;s=this.getSize();if(s==="S"){m=-15;}else if(s==="L"){m=-30;}}};sap.ino.wall.DropUpload.prototype.setSize=function(s){var S=48,i=this._getIcon();this.setProperty("size",s,true);if(s==="S"){S=30;}else if(s==="L"){S=66;}i.setSize(S+"px");i.setWidth(S+"px");i.setHeight((S+10)+"px");};sap.ino.wall.DropUpload.prototype._onclick=function(e){this.$().find("#"+this.getId()+"-fileUpload").trigger('click');if(e){e.preventDefault();e.stopPropagation();}};sap.ino.wall.DropUpload.prototype._onkeydown=function(e){if(e){if(e.keyCode===jQuery.sap.KeyCodes.ENTER||e.keyCode===jQuery.sap.KeyCodes.SPACE){this.$().find("#"+this.getId()+"-fileUpload").trigger('click');e.preventDefault();e.stopPropagation();}}};sap.ino.wall.DropUpload.prototype._ondrop=function(e){this.fireChange({mode:"Drop",files:e.originalEvent.dataTransfer.files});if(e){e.preventDefault();e.stopPropagation();}};sap.ino.wall.DropUpload.prototype._onchange=function(e){var $=this.$().find("#"+this.getId()+"-fileUpload");this.fireChange({mode:"Select",files:this.$().find("#"+this.getId()+"-fileUpload")[0].files});$.replaceWith($.clone(true));};sap.ino.wall.DropUpload.prototype._getIcon=function(){var c=this.getAggregation("_icon"),s=this.getSize(),S=40;if(s==="S"){S=22;}else if(s==="L"){S=58;}if(!c){c=new sap.ui.core.Icon({src:this.getIcon(),size:S+"px",width:S+"px",height:(S+10)+"px",decorative:true,tooltip:this.getTooltip()});this.setAggregation("_icon",c,true);}c.setSrc(this.getIcon());return c;};})();
