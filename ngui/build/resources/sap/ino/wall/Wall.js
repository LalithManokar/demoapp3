/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.Wall");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallMode");jQuery.sap.require("sap.ino.wall.WallConfig");jQuery.sap.require("sap.ino.wall.WallItemGroup");jQuery.sap.require("sap.ino.wall.util.Helper");jQuery.sap.require("sap.ino.wall.util.Formatter");jQuery.sap.require("sap.ino.wall.util.Logger");jQuery.sap.require("sap.ino.wall.config.Config");jQuery.sap.require("sap.ino.wall.WallItemAttachment");jQuery.sap.require("sap.ino.wall.WallItemImage");jQuery.sap.require("sap.ino.wall.WallItemLink");jQuery.sap.require("sap.ino.wall.WallItemVideo");jQuery.sap.require("sap.ino.wall.WallItemPerson");jQuery.sap.require("sap.ino.wall.WallItemNote");jQuery.sap.require("sap.ino.wall.WallItemSticker");jQuery.sap.require("sap.ino.wall.WallItemText");jQuery.sap.require("sap.ino.wall.WallItemHeadline");jQuery.sap.require("sap.ino.wall.WallItemLine");jQuery.sap.require("sap.ino.wall.WallItemDocument");jQuery.sap.require("sap.ino.wall.WallItemSprite");jQuery.sap.require("sap.ino.wall.WallItemArrow");jQuery.sap.require("sap.ino.wall.Pos");jQuery.sap.require("sap.ino.wall.Hoverable");jQuery.sap.require("sap.ino.wall.ColorPicker");jQuery.sap.require("sap.ino.commons.models.object.Attachment");jQuery.sap.require("sap.ino.commons.application.Configuration");var C=sap.ino.commons.application.Configuration;jQuery.sap.require("sap.ino.wall.util.WallPatches");var W=sap.ino.wall.util.WallPatches;jQuery.sap.require("sap.m.MessageBox");jQuery.sap.require("sap.m.MessageToast");sap.ui.core.Control.extend("sap.ino.wall.Wall",{metadata:{publicMethods:["toggleEnableItems"],properties:{"editable":{type:"boolean",group:"Behavior",defaultValue:null},"backgroundImage":{type:"string",group:"Appearance",defaultValue:null},"backgroundImageZoom":{type:"int",group:"Appearance",defaultValue:100},"backgroundImageTiled":{type:"boolean",group:"Appearance",defaultValue:false},"backgroundColor":{type:"string",group:"Appearance",defaultValue:null},"mouseX":{type:"float",group:"Appearance",defaultValue:null},"mouseY":{type:"float",group:"Appearance",defaultValue:null},"touchPosition":{type:"any",group:"Misc",defaultValue:null},"zoom":{type:"float",group:"Behavior",defaultValue:100},"viewPoint":{type:"any",group:"Misc",defaultValue:null},"title":{type:"string",group:"Appearance",defaultValue:null},"storageId":{type:"int",group:"Identification",defaultValue:-1},"type":{type:"string",group:"Misc",defaultValue:'Wall'},"mode":{type:"sap.ino.wall.WallMode",group:"Misc",defaultValue:sap.ino.wall.WallMode.Write},"owner":{type:"string",group:"Identification",defaultValue:null},"headerHeight":{type:"int",group:"Appearance",defaultValue:63},"footerHeight":{type:"int",group:"Appearance",defaultValue:31}},aggregations:{"items":{type:"sap.ui.core.Control",multiple:true,singularName:"item"}},events:{"itemAdd":{},"itemDelete":{},"zoomChange":{},"itemChange":{},"change":{},"hover":{},"sync":{},"syncModeChange":{},}}});sap.ino.wall.Wall.M_EVENTS={'itemAdd':'itemAdd','itemDelete':'itemDelete','zoomChange':'zoomChange','itemChange':'itemChange','change':'change','hover':'hover'};sap.ino.wall.Wall.createWallItemFromJSON=function(I){I=jQuery.extend(true,{},I);var n=null,c=I.className,o=I.content||{},j=I.childs||[],i=0;delete I.content;delete I.childs;delete I.parentId;delete I.className;delete I.actionCode;if(I.title){I.title=sap.ino.wall.util.Formatter.escapeBindingCharacters(sap.ino.wall.util.Formatter.escapeNetworkPaths(I.title));}if(I.description){I.description=sap.ino.wall.util.Formatter.escapeBindingCharacters(sap.ino.wall.util.Formatter.escapeNetworkPaths(I.description));}I.x=I.position.x;I.y=I.position.y;delete I.position;switch(c){case"sap.ino.wall.WallItemAttachment":n=new sap.ino.wall.WallItemAttachment(I);if(o.URL){n.setURL(o.URL);}if(o.type){n.setType(o.type);}if(o.fileName){n.setFileName(o.fileName);}if(o.assignmentId){n.setAssignmentId(o.assignmentId);}break;case"sap.ino.wall.WallItemImage":n=new sap.ino.wall.WallItemImage(I);if(o.preview){n.setPreview(o.preview);}if(o.image){n.setImage(o.image);}if(o.assignmentId){n.setAssignmentId(o.assignmentId);}if(o.showAsIcon){n.setShowAsIcon(o.showAsIcon);}break;case"sap.ino.wall.WallItemLink":n=new sap.ino.wall.WallItemLink(I);break;case"sap.ino.wall.WallItemVideo":n=new sap.ino.wall.WallItemVideo(I);if(o.preview){n.setPreview(o.preview);}if(o.video){n.setVideo(o.video);}break;case"sap.ino.wall.WallItemPerson":n=new sap.ino.wall.WallItemPerson(I);if(o.phone){n.setPhone(o.phone);}if(o.email){n.setEmail(o.email);}if(o.image){n.setImage(o.image);}if(o.requestImage){n.setRequestImage(o.requestImage);}if(o.assignmentId){n.setAssignmentId(o.assignmentId);}break;case"sap.ino.wall.WallItemNote":n=new sap.ino.wall.WallItemNote(I);break;case"sap.ino.wall.WallItemSticker":if(I.description){I.title=I.description;}delete I.description;n=new sap.ino.wall.WallItemSticker(I);break;case"sap.ino.wall.WallItemText":n=new sap.ino.wall.WallItemText(I);break;case"sap.ino.wall.WallItemHeadline":n=new sap.ino.wall.WallItemHeadline(I);break;case"sap.ino.wall.WallItemLine":n=new sap.ino.wall.WallItemLine(I);break;case"sap.ino.wall.WallItemDocument":n=new sap.ino.wall.WallItemDocument(I);break;case"sap.ino.wall.WallItemSprite":n=new sap.ino.wall.WallItemSprite(I);break;case"sap.ino.wall.WallItemGroup":n=new sap.ino.wall.WallItemGroup(I);break;case"sap.ino.wall.WallItemArrow":n=new sap.ino.wall.WallItemArrow(I);break;default:break;}if(n!==null){for(;i<j.length;i++){I=sap.ino.wall.Wall.createWallItemFromJSON(j[i]);n.addChild(I);}return n;}};sap.ino.wall.Wall.createWallFromJSON=function(j){var J=j.items,w,I,i=0;delete j.items;j.title=sap.ino.wall.util.Formatter.escapeBindingCharacters(j.title);j.type=sap.ino.wall.util.Formatter.capitalizeFirstLetter(j.type);delete j.lastUpdate;delete j.ownerLastName;delete j.timestamp;delete j.hits;delete j.ownerEMail;delete j.numberOfItems;delete j.favorite;delete j.ownerFirstName;delete j.strongestAuth;delete j.auth;delete j.actionCode;sap.ino.wall.util.Formatter.mapNullToInitialValues(j);w=new sap.ino.wall.Wall(j);if(j.strongestAuth==="read"||j.strongestAuth==="none"){w.setMode("Readonly");}if(!J){return w;}for(;i<J.length;i++){I=sap.ino.wall.Wall.createWallItemFromJSON(J[i]);w._nextDepth=Math.max(w._nextDepth,I.getDepth());w.addItem(I);if(I instanceof sap.ino.wall.WallItemPerson){if(I.getRequestImage()){I._requestIdentity(I.getEmail()||I.getTitle());}}}return w;};sap.ino.wall.Wall.prototype.init=function(){this.setTouchPosition(new sap.ino.wall.Pos());this.setViewPoint(new sap.ino.wall.Pos({x:5000,y:5000}));this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.wall");this._followHandlers=[];this._bIsInDOM=undefined;this._iWallSaveDelay=sap.ino.wall.config.Config.getWallSaveDelay();this._iWallSaveDelayTimer=0;this._iWallItemsSaveDelayTimer=0;this._iWallSyncDelay=0;this._iWallSyncDelayTimer=0;this._iWallSyncMode=false;this._oItemsChanged={};this._oPropertiesChanged={};this._touchStartMousePositionX=null;this._touchStartMousePositionY=null;this._bMoving=false;this._bTextSelectionCleared=false;this._nextDepth=sap.ino.wall.WallConfig._MIN_DEPTH;sap.ino.wall.util.Logger.info('Wall "'+this.getId()+'" is initializing');};sap.ino.wall.Wall.prototype.setWallSaveDelay=function(w){this._iWallSaveDelay=w;};sap.ino.wall.Wall.prototype.setWallSyncDelay=function(w){var t=this;this._iWallSyncDelay=w;clearInterval(this._iWallSyncDelayTimer);this._iWallSyncDelayTimer=0;if(this._iWallSyncDelay>0){this._iWallSyncDelayTimer=setInterval(function(){t.fireSync();},this._iWallSyncDelay);}};sap.ino.wall.Wall.prototype.setWallSyncMode=function(w){this._iWallSyncMode=w;this.fireSyncModeChange({value:this._iWallSyncMode});};sap.ino.wall.Wall.prototype.getWallSyncMode=function(){return this._iWallSyncMode;};sap.ino.wall.Wall.prototype.updateWallFromJSON=function(j){var w=this;sap.ino.wall.util.Formatter.mapNullToInitialValues(j);this.setWallAttributesFromJSON(j);jQuery.each(w.getItems()||[],function(i,I){w.removeItemWithoutRendering(I);});jQuery.each(j.items||[],function(i,J){var I=sap.ino.wall.Wall.createWallItemFromJSON(J);w.addItemWithoutRendering(I);});this.clearAllPendingChanges();this.clearAllPendingItemChanges();return this;};sap.ino.wall.Wall.prototype.deltaUpdateWallFromJSON=function(j){var w=this;sap.ino.wall.util.Formatter.mapNullToInitialValues(j);var c=this.setWallAttributesFromJSON(j);function r(i){var p=i.getParent()instanceof sap.ino.wall.WallItemBase?i.getParent():null;if(!p){w.removeItemWithoutRendering(i);}else{p.removeChildWithoutRendering(i);}c=true;return i;}function a(J){var i=sap.ino.wall.Wall.createWallItemFromJSON(J);if(J.parentId>0){var p=w.getItemById(J.parentId,true);if(p){p.addChildWithoutRendering(i,true);}}else{w.addItemWithoutRendering(i);}c=true;return i;}function u(i,J){delete J.childs;var n=sap.ino.wall.Wall.createWallItemFromJSON(J);b(i,"title",n.getTitle());b(i,"x",n.getX());b(i,"y",n.getY());b(i,"w",n.getW());b(i,"h",n.getH());b(i,"depth",n.getDepth());jQuery.each(i.getMetadata().getProperties(),function(P,o){b(i,P,n.getProperty(P));});var p=i.getParent()instanceof sap.ino.wall.WallItemBase?i.getParent():null;if(p&&!J.parentId){p.removeChildWithoutRendering(i);w.addItemWithoutRendering(i);}else if(!p&&J.parentId>0){w.removeItemWithoutRendering(i);p=w.getItemById(J.parentId,true);if(p){p.addChildWithoutRendering(i,true);}}i.invalidate();c=true;return i;}function b(i,p,v){var s="set"+p.substring(0,1).toUpperCase()+p.substring(1);if(typeof i[s]==="function"){i[s].apply(i,[v]);}else{i.setProperty(p,v,true);}}function h(J){var i=null;if(J.storageId>0){i=w.getItemById(J.storageId,true);}if(i&&(i.getFlipped()||i.$().hasClass("dragCursor"))){return;}if(i&&J.actionCode=="DELETED"){r(i);}else if(!i&&(J.actionCode=="CREATED"||J.actionCode=="UPDATED")){a(J);}else if(i&&J.actionCode=="UPDATED"){var d=i.getChilds();r(i);var n=a(J);jQuery.each(d,function(e,o){var E=jQuery.grep(n.getChilds(),function(g){return g.getStorageId()==o.getStorageId();});var f;if(!E.length){n.addChildWithoutRendering(o,true);f=o;}else{f=E[0];}jQuery.each(o.getChilds(),function(e,g){if(jQuery.grep(f.getChilds(),function(k){return k.getStorageId()==g.getStorageId();}).length==0){f.addChildWithoutRendering(g,true);}});});}}jQuery.each(j.items||[],function(i,J){h(J);c=true;});this.clearAllPendingChanges();this.clearAllPendingItemChanges();return c;};sap.ino.wall.Wall.prototype.setWallAttributesFromJSON=function(j){var w=this;var c=false;if(j.title&&w.getTitle()!=sap.ino.wall.util.Formatter.escapeBindingCharacters(j.title)){w.setTitle(sap.ino.wall.util.Formatter.escapeBindingCharacters(j.title));c=true;}if(j.backgroundImage&&w.getBackgroundImage()!=j.backgroundImage){w.setBackgroundImage(j.backgroundImage);c=true;}if(j.backgroundImageZoom&&w.getBackgroundImageZoom()!=j.backgroundImageZoom){w.setBackgroundImageZoom(j.backgroundImageZoom);c=true;}if(j.backgroundImageTiled&&w.getBackgroundImageTiled()!=j.backgroundImageTiled){w.setBackgroundImageTiled(j.backgroundImageTiled);c=true;}if(j.backgroundColor&&w.getBackgroundColor()!=j.backgroundColor){w.setBackgroundColor(j.backgroundColor);c=true;}if(j.mode&&w.getMode()!=j.mode){w.setMode(j.mode);c=true;}if((j.strongestAuth==="read"||j.strongestAuth==="none")&&w.getMode()!="Readonly"){w.setMode("Readonly");c=true;}return c;};sap.ino.wall.Wall.prototype.getItemById=function(w,i){return this._getItemById(this.getItems(),w,i);};sap.ino.wall.Wall.prototype._getItemById=function(i,w,I){var t=this;var r=null;jQuery.each(i,function(a,o){if(o.getStorageId()==w){r=o;}else if(I&&o.getChilds()&&o.getChilds().length>0){r=t._getItemById(o.getChilds(),w,true);}return!r;});return r;};sap.ino.wall.Wall.prototype.exit=function(){this.deregisterWallEvents();this._ondragenterProxy=null;this._ondragoverProxy=null;this._ondragleaveProxy=null;this._ondragendProxy=null;this._onmousewheelProxy=null;this._onpasteProxy=null;this._onkeydownProxy=null;this._onkeyupProxy=null;this._orientationChangeProxy=null;this._onmousemoveProxy=null;this._touchendProxy=null;this._touchmoveProxy=null;this._bIsInDOM=null;this._iWallSaveDelay=sap.ino.wall.config.Config.getWallSaveDelay();clearTimeout(this._iWallSaveDelayTimer);this._iWallSaveDelayTimer=0;clearTimeout(this._iWallItemsSaveDelayTimer);this._iWallItemsSaveDelayTimer=0;this._iWallSyncDelay=0;clearTimeout(this._iWallSyncDelayTimer);this._iWallSyncDelayTimer=0;this._iWallSyncMode=false;this._oItemsChanged=null;this._oPropertiesChanged=null;if(this._oHLTrashAbove){this._oHLTrashAbove.destroy();this._oHLTrashAbove=null;}if(this._oHLTrash){this._oHLTrash.destroy();this._oHLTrash=null;}if(this._oSelectionRectangle){this._oSelectionRectangle.destroy();this._oSelectionRectangle=null;}if(this._oLock){this._oLock.destroy();this._oLock=null;}if(this._oTemplateIndicator){this._oTemplateIndicator.destroy();this._oTemplateIndicator=null;}};sap.ino.wall.Wall.prototype.onBeforeRendering=function(){if(!this._bFirstRenderCall){this._createTrashBin();this._createSelectionRectangle();this._createLock();this._createTemplateIndicator();this._bFirstRenderCall=true;}this.deregisterWallEvents();};sap.ino.wall.Wall.prototype.onAfterRendering=function(){this.registerWallEvents();this.updateViewport();this._oTemplateIndicator.$().toggleClass("sapInoWallInvisible",this.getType()!=="Template");};sap.ino.wall.Wall.prototype.setupWallEvents=function(){if(!this._onmousewheelProxy){this._ondragenterProxy=jQuery.proxy(this._ondragenter,this);this._ondragoverProxy=jQuery.proxy(this._ondragover,this);this._ondragleaveProxy=jQuery.proxy(this._ondragleave,this);this._ondragendProxy=jQuery.proxy(this._ondragend,this);this._onmousewheelProxy=jQuery.proxy(this._onmousewheel,this);this._onpasteProxy=jQuery.proxy(this._onpaste,this);this._onkeydownProxy=jQuery.proxy(this._onkeydown,this);this._onkeyupProxy=jQuery.proxy(this._onkeyup,this);this._orientationChangeProxy=jQuery.proxy(this._onOrientationChange,this);this._touchendProxy=jQuery.proxy(this._ontouchend,this);this._touchmoveProxy=jQuery.proxy(this._ontouchmove,this);this._onmousemoveProxy=jQuery.proxy(this._onmousemove,this);}};sap.ino.wall.Wall.prototype.registerWallEvents=function(){this.setupWallEvents();jQuery(window.document).bind("dragenter.wall",this._ondragenterProxy);jQuery(window.document).bind("dragover.wall",this._ondragoverProxy);jQuery(window.document).bind("dragleave.wall",this._ondragleaveProxy);jQuery(window.document).bind("dragend.wall",this._ondragendProxy);jQuery(window.document).bind(!!sap.ui.Device.browser.firefox?"DOMMouseScroll.wall":"mousewheel.wall",this._onmousewheelProxy);jQuery(window.document).bind("paste.wall",this._onpasteProxy);jQuery(window.document).bind("keydown.wall",this._onkeydownProxy);jQuery(window.document).bind("keyup.wall",this._onkeyupProxy);jQuery(window.document).bind("touchmove.wall mousemove.wall",this._onmousemoveProxy);sap.ui.Device.orientation.attachHandler(this._orientationChangeProxy);};sap.ino.wall.Wall.prototype.deregisterWallEvents=function(){jQuery(window.document).unbind("dragenter.wall",this._ondragenterProxy);jQuery(window.document).unbind("dragover.wall",this._ondragoverProxy);jQuery(window.document).unbind("dragleave.wall",this._ondragleaveProxy);jQuery(window.document).unbind("dragend.wall",this._ondragendProxy);jQuery(window.document).unbind(!!sap.ui.Device.browser.firefox?"DOMMouseScroll.wall":"mousewheel.wall",this._onmousewheelProxy);jQuery(window.document).unbind("paste.wall",this._onpasteProxy);jQuery(window.document).unbind("keydown.wall",this._onkeydownProxy);jQuery(window.document).unbind("keyup.wall",this._onkeyupProxy);jQuery(document).unbind("touchmove.wall mousemove.wall",this._onmousemoveProxy);sap.ui.Device.orientation.detachHandler(this._orientationChangeProxy);};sap.ino.wall.Wall.prototype._onpaste=function(e){if(this._wallInteractionPossible(e.target)){var t=e.originalEvent.clipboardData.getData(e.originalEvent.clipboardData.items[0].type);if(t){this._processTextDrop(t,false,sap.ino.wall.WallConfig._ADD_MODE_COPYPASTE);}}};sap.ino.wall.Wall.prototype.ondrop=function(e){var t=this,d=e.originalEvent.dataTransfer,f=d.files,F,a,r,m,T,l,E=false,i=0,j=0,M=0;e.preventDefault();e.stopPropagation();jQuery("drag").css("display","none");this.$("inner").removeClass("dragCursor");if(this.getMode()==="Readonly"){return;}if(sap.ui.Device.browser.name==="ie"&&sap.ui.Device.browser.version<10&&f===undefined&&e.originalEvent.dataTransfer.getData("text")===null){return;}var o=this.$("inner").offset();var z=100/this.getZoom();var x;var y;if(!sap.ino.wall.config.Config.getZoomCapable()){x=((sap.ino.wall.util.Helper.getEventX(e)+Math.abs(o.left))*z);y=((sap.ino.wall.util.Helper.getEventY(e)+Math.abs(o.top))*z);}else{x=(sap.ino.wall.util.Helper.getEventX(e)*z-o.left);y=(sap.ino.wall.util.Helper.getEventY(e)*z-o.top+5);}if(f&&f.length!==0){for(;i<f.length;i++){F=f[i];if(!!F.type.match(/image\.*/)){j++;}}M=(j-1)*sap.ino.wall.WallConfig._MULTI_OFFSET;var b=function(F,O,I){var s=F.name;var n;if(I){n=new sap.ino.wall.WallItemImage({status:"Busy",title:t._oRB.getText("WALL_IMAGE_UPLOAD_TITLE"),storageId:-2});}else{n=new sap.ino.wall.WallItemAttachment({status:"Busy",title:t._oRB.getText("WALL_ITEMATTACHMENT_NEW_TEXT"),storageId:-2});}var h=parseInt(n.getH())||0;var w=parseInt(n.getW())||0;var X=(x+O-(w/2))+"px";var Y=(y+O-(h/2))+"px";n.setXY(X,Y);t.addItemWithoutRendering(n);sap.ino.commons.models.object.Attachment.uploadFile(F).done(function(R){var S=R.attachmentId;var s=R.fileName;if(I){n.setPreview(C.getAttachmentDownloadURL(S),true);n.setImage(C.getAttachmentDownloadURL(S));n.setTitle(s);n.setStatus("Normal");}else{setTimeout(function(){n.setURL(C.getAttachmentDownloadURL(S));n.setTitle(s);n.setType(R.mediaType);n.setFileName(s);n.updateIcon();n.setStatus("Normal");},500);}}).fail(function(R){t.removeItem(n);});};for(i=f.length-1;i>=0;i--){F=f[i];b(F,M,!!F.type.match(/image\.*/));M-=sap.ino.wall.WallConfig._MULTI_OFFSET;}}else{T=e.originalEvent.dataTransfer.getData("text");l=T.trim().split("\n");for(;i<l.length;i++){if(l[i].length>sap.ino.wall.WallConfig._MAX_STICKY_NOTE_CREATION_LENGTH*(1+l.length/30)||(l[i].trim().length===0&&i!==0&&i!==l.length-1)){E=true;break;}}if(l.length>=3&&!E){sap.m.MessageBox.confirm(this._oRB.getText("WALL_DIALOG_BATCH_STICKY_NOTES"),{onClose:function(A){t._processTextDrop(T,A===sap.m.MessageBox.Action.OK,sap.ino.wall.WallConfig._ADD_MODE_DROP,x,y);}});}else{this._processTextDrop(T,false,sap.ino.wall.WallConfig._ADD_MODE_DROP,x,y);}}};sap.ino.wall.Wall.prototype._processTextDrop=function(t,m,M,x,y){var a=this,n=null,r=/^(ftp|http|https):\/\/[^ "]+$/,R=/.+@.+\..+/,I,b=0,i=0,j=0,T,N,e,l;var A=function(o,O){var h=parseInt(o.getH())||0;var w=parseInt(o.getW())||0;if(isNaN(x)||isNaN(y)){a.placeItemInCurrentViewPoint(o,true,O);}else{var X=(x+O-(w/2))+"px";var Y=(y+O-(h/2))+"px";o.setXY(X,Y);a.addItemWithoutRendering(o);}};t=sap.ino.wall.util.Formatter.escapeBindingCharacters(t);t=t.substring(0,4000);if(r.test(t)){if(/www\.youtube\.com\/watch\?v=/.test(t)||/youtu\.be\//.test(t)){n=new sap.ino.wall.WallItemVideo({title:a._oRB.getText("WALL_ITEMVIDEO_NEW_TEXT"),video:t});}else{n=new sap.ino.wall.WallItemLink({title:a._oRB.getText("WALL_ITEMLINK_NEW_TEXT"),description:t});}}else if(R.test(t)&&t.length<((t.match(/[\w\.]+@[\w\.]+\.\w+/g)||[]).length)*100){if(/<[\w\.]+@[\w\.]+\.\w+>/.test(t)){I=t.split(";");b=0;i=0;j=0;for(;i<I.length;i++){if(I[i]){j++;}}b=(j-1)*sap.ino.wall.WallConfig._MULTI_OFFSET;for(i=I.length-1;i>=0;i--){if(I[i]){T=I[i].split("<");N=T[0].trim();e=T[1].replace(">","");(function(){var n=new sap.ino.wall.WallItemPerson({title:N});n.setEmail(e,false,true);A(n,b);b-=sap.ino.wall.WallConfig._MULTI_OFFSET;})();}}return;}else{I=t.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);b=0;i=0;j=0;for(;i<I.length;i++){if(I[i]){j++;}}b=(j-1)*sap.ino.wall.WallConfig._MULTI_OFFSET;for(i=I.length-1;i>=0;i--){if(I[i]){(function(){var n=new sap.ino.wall.WallItemPerson({title:a._oRB.getText("WALL_ITEMPERSON_NEW_TEXT"),});n.setEmail(I[i],false,true);A(n,b);b-=sap.ino.wall.WallConfig._MULTI_OFFSET;})();}}return;}}else{if(t&&m){l=t.split("\n");b=0;i=0;j=0;for(;i<l.length;i++){if(l[i].trim().length){j++;}}b=(j-1)*sap.ino.wall.WallConfig._MULTI_OFFSET;for(i=l.length-1;i>=0;i--){if(l[i].trim().length){n=new sap.ino.wall.WallItemSticker({title:l[i]});A(n,b);b-=sap.ino.wall.WallConfig._MULTI_OFFSET;}}return;}else if(t&&t.length<=sap.ino.wall.WallConfig._MAX_STICKY_NOTE_CREATION_LENGTH){n=new sap.ino.wall.WallItemSticker({title:t});}else{n=new sap.ino.wall.WallItemText({title:a._oRB.getText("WALL_ITEMTEXT_NEW_TEXT"),description:t});}}A(n,b);};sap.ino.wall.Wall.prototype._ondragenter=function(e){var d,a,b;if(this.getMode()==="Readonly"){return;}d=this.getZoom()/2;clearTimeout(this._iDragHideTimer);a=jQuery.sap.byId(this.getId()+"-drag");a.css("display","inline");b=a.children();b.css("width",d).css("height",d);b.css("box-shadow","0px 0px "+d+"px");this.$("inner").addClass("dragCursor");if(sap.ino.wall.config.Config.getDebugPositioning()){jQuery.sap.byId(this.getId()+"-dragIndicator").css("display","inline");}};sap.ino.wall.Wall.prototype._ondragover=function(e){var a;a=this.$("drag");a.css("left",sap.ino.wall.util.Helper.getEventX(e)).css("top",sap.ino.wall.util.Helper.getEventY(e)-60);clearTimeout(this._iDragHideTimer);this._iDragHideTimer=setTimeout(function(){this.$("drag").css("display","none");}.bind(this),5000);if(sap.ino.wall.config.Config.getDebugPositioning()){this.$("dragIndicator").css("display","inline").css("left",sap.ino.wall.util.Helper.getEventX(e)).css("top",sap.ino.wall.util.Helper.getEventY(e));}};sap.ino.wall.Wall.prototype._ondragend=function(e){jQuery.sap.byId(this.getId()+"-drag").css("display","none");if(sap.ino.wall.config.Config.getDebugPositioning()){jQuery.sap.byId(this.getId()+"-dragIndicator").css("display","none");}};sap.ino.wall.Wall.prototype._ondragleave=function(e){sap.ino.wall.util.Logger.warning('ondragleave');if(e.srcControl){jQuery.sap.byId(this.getId()+"-drag").css("display","none");}if(sap.ino.wall.config.Config.getDebugPositioning()){jQuery.sap.byId(this.getId()+"-dragIndicator").css("display","none");}e.preventDefault();e.stopPropagation();};sap.ino.wall.Wall.prototype._onmousemove=function(e){var w=this.getId(),o=this.$("inner").offset(),t=this.getTouchPosition();if(o&&sap.ino.wall.util.Helper.getEventX(e)&&sap.ino.wall.util.Helper.getEventY(e)){t.setX(sap.ino.wall.util.Helper.getEventX(e)-o.left);t.setY(sap.ino.wall.util.Helper.getEventY(e)-o.top+25);this.setTouchPosition(t);if(sap.ino.wall.config.Config.getDebugPositioning()){jQuery.sap.byId(w+"-pointerIndicator").css("display","inline");jQuery.sap.byId(w+"-pointerIndicator").css("left",sap.ino.wall.util.Helper.getEventX(e)).css("top",sap.ino.wall.util.Helper.getEventY(e)-20);}}};sap.ino.wall.Wall.prototype._placeFollowHandlerItems=function(){var i=0;if(this._hasFollowCursorItems()){for(;i<this._followHandlers.length;i++){if(this._followHandlers[i][1].getX()===""||this._followHandlers[i][1].getY()===""){continue;}jQuery(document).unbind("touchmove mousemove",this._followHandlers[i][0]);if(this._followHandlers[i][2]!==sap.ino.wall.WallConfig._ADD_MODE_DROP&&this._followHandlers[i][2]!==sap.ino.wall.WallConfig._ADD_MODE_CLONE&&this._followHandlers[i][2]!==sap.ino.wall.WallConfig._ADD_MODE_DETACHCHILD&&this._followHandlers[i][2]!==sap.ino.wall.WallConfig._ADD_MODE_DETACHGROUPITEM){this._followHandlers[i][1].setFlipped(true);}this.fireItemAdd({item:this._followHandlers[i][1],mode:this._followHandlers[i][2]});this._followHandlers.splice(i,1);i--;}this._updateBoundingBox();return;}};sap.ino.wall.Wall.prototype.ontouchstart=function(e){if(sap.ino.wall.ColorPicker.INSTANCE){sap.ino.wall.ColorPicker.INSTANCE.close();}var o,a;this._placeFollowHandlerItems();if(e.isMarked("_sapInoWallInnerItemMove")){return;}if(e.srcControl instanceof sap.m.TextArea||e.srcControl instanceof sap.m.Input||e.srcControl instanceof sap.ino.wall.TextEditor){return;}e.setMarked();jQuery(document).on("touchend touchcancel mouseup",this._touchendProxy);jQuery(document).on("touchmove mousemove",this._touchmoveProxy);if(e.shiftKey){o=this.$("inner").parent().offset().top;a=this.$("selectionRectangle");this._touchMode=sap.ino.wall.WallConfig._TOUCHMODE_SELECT;this.$("inner").addClass("selectCursor");a.css("display","block");a.css("left",sap.ino.wall.util.Helper.getEventX(e));a.css("top",sap.ino.wall.util.Helper.getEventY(e)-o);a.css("z-index",this._getNextDepth());}else{this._touchMode=sap.ino.wall.WallConfig._TOUCHMODE_MOVE;this.$("inner").addClass("dragCursor");this._clearSelection();}this._touchStartMousePositionX=sap.ino.wall.util.Helper.getEventX(e);this._touchStartMousePositionY=sap.ino.wall.util.Helper.getEventY(e);this._touchMoveMousePositionX=sap.ino.wall.util.Helper.getEventX(e);this._touchMoveMousePositionY=sap.ino.wall.util.Helper.getEventY(e);this._bTextSelectionCleared=false;};sap.ino.wall.Wall.prototype._ontouchmove=function(e){var d,D,z,s,S,v,a,w,h,o,b;if(e.isMarked()){return;}if(e.touches&&e.touches.length>1){var x=Math.abs(e.touches[0].pageX-e.touches[1].pageX)-this._touchZoomXScale;var y=Math.abs(e.touches[0].pageY-e.touches[1].pageY)-this._touchZoomYScale;if(x||y){var Z=this.getZoom()+(x?x/3:0)+(y?y/3:0);this.setZoom(Z);}this._touchZoomXScale=Math.abs(e.touches[0].pageX-e.touches[1].pageX);this._touchZoomYScale=Math.abs(e.touches[0].pageY-e.touches[1].pageY);}else{d=sap.ino.wall.util.Helper.getEventX(e)-this._touchMoveMousePositionX;D=sap.ino.wall.util.Helper.getEventY(e)-this._touchMoveMousePositionY;z=100/this.getZoom();s=Math.abs(d/50*z);S=Math.abs(D/50*z);v=this.getViewPoint();a=this.$("inner");this._touchMoveMousePositionX=sap.ino.wall.util.Helper.getEventX(e);this._touchMoveMousePositionY=sap.ino.wall.util.Helper.getEventY(e);if(d||D){if(!this._bTextSelectionCleared){sap.ino.wall.util.Helper.deselectAllText();this._bTextSelectionCleared=true;}if(this._touchMode===sap.ino.wall.WallConfig._TOUCHMODE_SELECT){w=this._touchMoveMousePositionX-this._touchStartMousePositionX;h=this._touchMoveMousePositionY-this._touchStartMousePositionY;o=this.$("inner").parent().offset().top;b=this.$("selectionRectangle");if(w>=0){b.css("left",this._touchStartMousePositionX);b.css("width",w);}else{b.css("left",this._touchStartMousePositionX+w);b.css("width",Math.abs(w));}if(h>=0){b.css("top",this._touchStartMousePositionY-o);b.css("height",h);}else{b.css("top",this._touchStartMousePositionY-o+h);b.css("height",Math.abs(h));}}else{this._bMoving=true;this.$("inner").addClass("dragCursor");if(s<1){s=1;}else if(s>50){s=50;}if(S<1){S=1;}else if(S>50){S=50;}d*=Math.log(s)+1;D*=Math.log(S)+1;v.setX(v.getX()-d);v.setY(v.getY()-D);this.setViewPoint(v);if(!sap.ino.wall.config.Config.getZoomCapable()){a.css("margin","-"+(v.getY()+(v.getY()-5000)*((this.getZoom()/100)-1))+"px 0 0 -"+(v.getX()+(v.getX()-5000)*((this.getZoom()/100)-1))+"px");}else{a.css("margin","-"+v.getY()+"px 0 0 -"+v.getX()+"px");}}}}};sap.ino.wall.Wall.prototype._ontouchend=function(e){var t=this,a;this._touchZoomXScale=undefined;this._touchZoomYScale=undefined;if(this._iItemClonePosition){if(Math.abs(sap.ino.wall.util.Helper.getEventX(e)-this._iItemClonePosition[0])>5||Math.abs(sap.ino.wall.util.Helper.getEventY(e)-this._iItemClonePosition[1])>5){this._placeFollowHandlerItems();}}else{this._placeFollowHandlerItems();}this._iItemClonePosition=undefined;if(this._bMovingItem){jQuery(document).unbind("touchend touchcancel mouseup",this._touchendProxy);jQuery(document).unbind("touchmove mousemove",this._touchmoveProxy);return;}if(this._touchMode===sap.ino.wall.WallConfig._TOUCHMODE_SELECT){a=this.$("selectionRectangle");this._calculateAndTriggerSelection(a.position().left,a.position().top,a.outerWidth(),a.outerHeight());a.css("display","none");a.css("width","0px");a.css("height","0px");this.$("inner").removeClass("selectCursor");}else{this.$("inner").removeClass("dragCursor");setTimeout(function(){t._bMoving=false;},0);}this._touchMode=undefined;jQuery(document).unbind("touchend touchcancel mouseup",this._touchendProxy);jQuery(document).unbind("touchmove mousemove",this._touchmoveProxy);};sap.ino.wall.Wall.prototype.ontouchcancel=sap.ino.wall.Wall.prototype.ontouchend;sap.ino.wall.Wall.prototype._onmousewheel=function(e){var o=e.originalEvent,w=o.detail?o.detail:o.wheelDelta*(-1)/40.0,z=this.getZoom();var p=jQuery(e.target).parents();var i=false;var s=false;for(var a=0;a<p.length;a++){if(jQuery(p[a]).hasClass("flippable")||jQuery(p[a]).hasClass("sapInoWallWIB")){continue;}if(jQuery(p[a]).hasClass("sapInoWallWOuter")||jQuery(p[a]).hasClass("sapInoWallWInner")){i=true;break;}if(!i&&jQuery(p[a]).get(0).scrollHeight>jQuery(p[a]).outerHeight(true)){s=true;}}if(this._wallInteractionPossible(e.target)&&i&&!s){z+=w*(-1)*z/100.0;this.setZoom(z);e.preventDefault();e.stopPropagation();return false;}};sap.ino.wall.Wall.prototype._onOrientationChange=function(e){this.updateViewport();};sap.ino.wall.Wall.prototype._onkeydown=function(e,c){var t=this,s=0,S,f;var w=(sap.ino.wall.WallMode.Write==this.getMode());if(c){e=c;}if(e.keyCode===32){this._bSpacePressed=true;clearTimeout(s);s=setTimeout(function(){t._bSpacePressed=false;},2000);}if(w&&e.ctrlKey&&e.keyCode===jQuery.sap.KeyCodes.A){if(this._wallInteractionPossible(e.target)){this._selectAll();sap.m.MessageToast.show(this._oRB.getText("WALL_TOOLTIP_SELECT_ALL"));return false;}}else if(w&&e.ctrlKey&&e.keyCode===jQuery.sap.KeyCodes.D){if(this._wallInteractionPossible(e.target)){this._clearSelection();sap.m.MessageToast.show(this._oRB.getText("WALL_TOOLTIP_UNSELECT_ALL"));return false;}}else if(e.ctrlKey&&e.altKey&&(e.keyCode===jQuery.sap.KeyCodes.MINUS||e.keyCode===jQuery.sap.KeyCodes.NUMPAD_MINUS||e.ctrlKey&&e.keyCode===189)){if(this._wallInteractionPossible(e.target)){this.setZoom(this.getZoom()-10);}if(e.keyCode===189){e.preventDefault();e.stopPropagation();}}else if(e.ctrlKey&&e.altKey&&(e.keyCode===jQuery.sap.KeyCodes.PLUS||e.keyCode===jQuery.sap.KeyCodes.NUMPAD_PLUS||e.ctrlKey&&e.keyCode===187)){if(this._wallInteractionPossible(e.target)){this.setZoom(this.getZoom()+10);}if(e.keyCode===187){e.preventDefault();e.stopPropagation();}}else if(e.ctrlKey&&e.keyCode===jQuery.sap.KeyCodes.HOME){if(this._wallInteractionPossible(e.target)){this.updateViewport();sap.m.MessageToast.show(this._oRB.getText("WALL_TOOLTIP_VIEWPORT_UPDATE"));}}else if(w&&e.keyCode===jQuery.sap.KeyCodes.DELETE){if(this._wallInteractionPossible(e.target)){S=(this._getSelection()||[]).length;f=function(B){if(B===sap.m.MessageBox.Action.OK){t._deleteSelection();}};if(S){if(S===1){sap.m.MessageBox.confirm(this._oRB.getText("WALL_DIALOG_CONFIRM_DELETE_ITEM",[sap.ino.wall.util.Formatter.escapeBindingCharacters(sap.ino.wall.util.Helper.stripTags(this._getSelection()[0].getTitle()))]),f);}else{sap.m.MessageBox.confirm(this._oRB.getText("WALL_DIALOG_CONFIRM_DELETE_ITEMS_MULTIPLE",[S]),f);}}else{var i=sap.ui.getCore().getElementById(jQuery(e.target)[0].id);if(i){f=function(B){if(B===sap.m.MessageBox.Action.OK){t.deleteItems([i]);}};sap.m.MessageBox.confirm(this._oRB.getText("WALL_DIALOG_CONFIRM_DELETE_ITEM",[sap.ino.wall.util.Formatter.escapeBindingCharacters(sap.ino.wall.util.Helper.stripTags(i.getTitle()))]),f);}else{sap.m.MessageToast.show(this._oRB.getText("WALL_TOOLTIP_DELETE_ONLY_WITH_SELECTION"));}}}}else if(e.keyCode===jQuery.sap.KeyCodes.ARROW_DOWN||e.keyCode===jQuery.sap.KeyCodes.ARROW_UP||e.keyCode===jQuery.sap.KeyCodes.ARROW_LEFT||e.keyCode===jQuery.sap.KeyCodes.ARROW_RIGHT||e.keyCode===jQuery.sap.KeyCodes.ARROW_NUMPAD_2||e.keyCode===jQuery.sap.KeyCodes.ARROW_NUMPAD_4||e.keyCode===jQuery.sap.KeyCodes.ARROW_NUMPAD_6||e.keyCode===jQuery.sap.KeyCodes.ARROW_NUMPAD_8){if(jQuery(e.target).hasClass("sapInoWallSelector")){var a=50;if(e.ctrlKey){a=10;}var I=this.$().children().filter(".sapInoWallWInner");var v=this.getViewPoint();switch(e.keyCode){case jQuery.sap.KeyCodes.ARROW_DOWN:case jQuery.sap.KeyCodes.ARROW_NUMPAD_2:a=(v.getY()+a>10000)?10000:v.getY()+a;v.setY(a);break;case jQuery.sap.KeyCodes.ARROW_UP:case jQuery.sap.KeyCodes.ARROW_NUMPAD_8:a=(v.getY()-a<0)?0:v.getY()-a;v.setY(a);break;case jQuery.sap.KeyCodes.ARROW_LEFT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_4:a=(v.getX()-a<0)?0:v.getX()-a;v.setX(a);break;case jQuery.sap.KeyCodes.ARROW_RIGHT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_6:a=(v.getX()+a>10000)?10000:v.getX()+a;v.setX(a);break;default:break;}if(!sap.ino.wall.config.Config.getZoomCapable()){I.css("margin","-"+(v.getY()+(v.getY()-5000)*((this.getZoom()/100)-1))+"px 0 0 -"+(v.getX()+(v.getX()-5000)*((this.getZoom()/100)-1))+"px");}else{I.css("margin","-"+v.getY()+"px 0 0 -"+v.getX()+"px");}this.setViewPoint(v);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}else if(w&&jQuery(e.target).hasClass("sapInoWallWIB")){var i=sap.ui.getCore().getElementById(jQuery(e.target)[0].id);var a=10;if(i){i.setFocusVisible();i.setDepth(this._getNextDepth(i.getDepth()));if(e.shiftKey){if(e.ctrlKey){a=2;}if(i.getResizable()){switch(e.keyCode){case jQuery.sap.KeyCodes.ARROW_DOWN:case jQuery.sap.KeyCodes.ARROW_NUMPAD_2:var b=parseInt(i.getH(),10);i.setH((parseInt(i.getH(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)-a);var A=parseInt(i.getH(),10);i.setY(parseInt(i.getY(),10)+(b-A)/2);break;case jQuery.sap.KeyCodes.ARROW_UP:case jQuery.sap.KeyCodes.ARROW_NUMPAD_8:var b=parseInt(i.getH(),10);i.setH((parseInt(i.getH(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)+a);var A=parseInt(i.getH(),10);i.setY(parseInt(i.getY(),10)-(A-b)/2);break;case jQuery.sap.KeyCodes.ARROW_LEFT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_4:var b=parseInt(i.getW(),10);i.setW((parseInt(i.getW(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)-a);var A=parseInt(i.getW(),10);i.setX(parseInt(i.getX(),10)+(b-A)/2);break;case jQuery.sap.KeyCodes.ARROW_RIGHT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_6:var b=parseInt(i.getW(),10);i.setW((parseInt(i.getW(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)+a);var A=parseInt(i.getW(),10);i.setX(parseInt(i.getX(),10)-(A-b)/2);break;default:break;}var d=i.getChilds()||[];if(d.length){var g=i.$("childs");i._adjustChildContainerPositioning(g);}if(i._onResize){i._onResize();}}}else{if(e.ctrlKey){a=1;}switch(e.keyCode){case jQuery.sap.KeyCodes.ARROW_DOWN:case jQuery.sap.KeyCodes.ARROW_NUMPAD_2:if(!jQuery(e.target).hasClass("sapInoWallWILineVERTICAL")){i.setY(parseInt(i.getY(),10)+a);}break;case jQuery.sap.KeyCodes.ARROW_UP:case jQuery.sap.KeyCodes.ARROW_NUMPAD_8:if(!jQuery(e.target).hasClass("sapInoWallWILineVERTICAL")){i.setY(parseInt(i.getY(),10)-a);}break;case jQuery.sap.KeyCodes.ARROW_LEFT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_4:if(!jQuery(e.target).hasClass("sapInoWallWILineHORIZONTAL")){i.setX(parseInt(i.getX(),10)-a);}break;case jQuery.sap.KeyCodes.ARROW_RIGHT:case jQuery.sap.KeyCodes.ARROW_NUMPAD_6:if(!jQuery(e.target).hasClass("sapInoWallWILineHORIZONTAL")){i.setX(parseInt(i.getX(),10)+a);}break;default:break;}}this._notifyItemChanged(i);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}}else if(w&&e.keyCode===jQuery.sap.KeyCodes.G&&e.ctrlKey&&e.shiftKey){if(jQuery(e.target).hasClass("sapInoWallWIB")){var i=sap.ui.getCore().getElementById(jQuery(e.target)[0].id);if(i&&!(i instanceof sap.ino.wall.WallItemGroup)){var G=false;var h=i.getChilds();if(h&&h.length>0){G=true;}var j=this._calculateAllCollisions(i,sap.ino.wall.WallConfig._COLLISION_ALL);if(j&&j.length>0&&j[0].length>0){var T=-1;var o;for(var k=0;k<j[0].length;++k){if(j[0][k].getDepth()>T&&j[0][k].getEnabled()){if(G&&!(j[0][k]instanceof sap.ino.wall.WallItemGroup)){continue;}T=j[0][k].getDepth();o=j[0][k];}}if(o){this.removeAggregation("items",i,true);o.addChildWithoutRendering(i);this._notifyItemChanged(i);this._notifyItemChanged(o);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();setTimeout(function(){o.setFocusVisible();o.focus();},100);}}}}}else if(w&&e.keyCode===jQuery.sap.KeyCodes.H&&e.ctrlKey&&e.shiftKey){if(jQuery(e.target).hasClass("sapInoWallWIB")){var i=sap.ui.getCore().getElementById(jQuery(e.target)[0].id);if(i){var d=i.getChilds();var x=parseInt(i.getX(),10)||5000;var y=parseInt(i.getY(),10)||5000;var O=sap.ino.wall.WallConfig._MULTI_OFFSET;if(d&&d.length>0){for(var k=0;k<d.length;++k){d[k].setX(x+O);d[k].setY(y+O);O+=sap.ino.wall.WallConfig._MULTI_OFFSET;i.removeChildWithoutRendering(d[k]);t.addItemWithoutRendering(d[k]);this._notifyItemChanged(d[k]);}this._notifyItemChanged(i);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}}}else if(e.keyCode===jQuery.sap.KeyCodes.ESCAPE){var l=jQuery(e.target).parents(".sapInoWallWInner");if(l&&l.length>0&&jQuery(e.target).parents(".sapInoWallWIB").length===0){jQuery("#"+this.getId()+"-wall-selector").focus();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}else if(e.keyCode===jQuery.sap.KeyCodes.ENTER||e.keyCode===jQuery.sap.KeyCodes.F2){var m=jQuery(e.target).parents(".sapInoWallWOuter");if(m&&m.length>0&&jQuery(e.target).parents(".sapInoWallWIB").length===0){var n=jQuery(e.target)[0].id;if(n===this.getId()+"-wall-selector"){var p=this.getItemsByPosition(undefined,true);this._aTabItems=p.filter(function(i){return i.getEnabled();});if(this._aTabItems&&this._aTabItems.length>0){this.showItems([this._aTabItems[0]]);this._aTabItems[0].setFocusVisible();this._aTabItems[0].focus();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}}}else if(e.keyCode===jQuery.sap.KeyCodes.TAB){var m=jQuery(e.target).parents(".sapInoWallWOuter");if(m&&m.length>0&&jQuery(e.target).parents(".sapInoWallWIB").length===0){var n=jQuery(e.target)[0].id;var q=-1;if(n===this.getId()+"-wall-selector"){var r=jQuery(document).find("[tabindex='0']");if(e.shiftKey){q=r.index(jQuery("#"+this.getId()+"-wall-selector-begin"));q--;if(q<0){q=r.length-1;}}else{q=r.index(jQuery("#"+this.getId()+"-wall-selector-end"));q++;if(q>=r.length){q=0;}}r[q].focus();}else{var p=this.getItemsByPosition(undefined,true);this._aTabItems=p.filter(function(i){return i.getEnabled();});if(this._aTabItems&&this._aTabItems.length===1){this.showItems([this._aTabItems[0]]);this._aTabItems[0].setFocusVisible();this._aTabItems[0].focus();}else if(this._aTabItems&&this._aTabItems.length>1){var F=jQuery(e.target);var u;if(F){u=sap.ui.getCore().getElementById(F.attr("id"));}var z=this._aTabItems.indexOf(u);if(!u||z===-1){this.showItems([this._aTabItems[0]]);this._aTabItems[0].setFocusVisible();this._aTabItems[0].focus();}else{if(e.shiftKey){z--;if(z===-1){z=this._aTabItems.length-1;}}else{z++;if(z>=this._aTabItems.length){z=0;}}this.showItems([this._aTabItems[z]]);this._aTabItems[z].setFocusVisible();this._aTabItems[z].focus();}}}e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}};sap.ino.wall.Wall.prototype._onkeyup=function(e){var t=this;if(e.keyCode===32){this._bSpacePressed=false;}var o=jQuery(e.target).parents(".sapInoWallWOuter");if(o&&o.length>0){var T=jQuery(e.target)[0].id;if((T===this.getId()+"-wall-selector-end"&&e.keyCode===jQuery.sap.KeyCodes.TAB&&e.shiftKey)||(T===this.getId()+"-wall-selector-begin"&&e.keyCode===jQuery.sap.KeyCodes.TAB)){jQuery("#"+t.getId()+"-wall-selector").focus();e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}}};sap.ino.wall.Wall.prototype.followCursor=function(i,m,o){var t=this,M=function(){var a=Array.prototype.slice.call(arguments);a.unshift(o);a.unshift(i);t._onmousemoveItemUpdate.apply(t,a);};this._followHandlers.push([M,i,m,o]);jQuery(document).on("touchmove mousemove",M);return this;};sap.ino.wall.Wall.prototype.editAll=function(t){var I=this.getItems(),i=0;for(;i<I.length;i++){I[i].setFlipped(t);}return this;};sap.ino.wall.Wall.prototype.addItem=function(i){this.addAggregation("items",i);return this;};sap.ino.wall.Wall.prototype.addAndSaveItem=function(i){this.addAggregation("items",i);this._notifyItemChanged(i);};sap.ino.wall.Wall.prototype.addItemWithoutRendering=function(i){this.addAggregation("items",i,true);this._renderItemIntoContainer(i,false,true);return this;};sap.ino.wall.Wall.prototype.removeItemWithoutRendering=function(i){this.removeAggregation("items",i,true);i.$().remove();return this;};sap.ino.wall.Wall.prototype.placeItem=function(i,f,o,b){if(!o){o=0;}if(o===0&&!b){o+=this._followHandlers.length*sap.ino.wall.WallConfig._MULTI_OFFSET;}i.setDepth(this._getNextDepth());this.addItemWithoutRendering(i,false);this.followCursor(i,f,o);jQuery(document).on("touchend touchcancel mouseup",this._touchendProxy);return this;};sap.ino.wall.Wall.prototype.placeItemInCurrentViewPoint=function(i,f,o){var v=this.getViewPoint();var I=(parseInt(i.getW(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)/2;var a=(parseInt(i.getH(),10)||sap.ino.wall.WallConfig._ITEM_MIN_SIZE)/2;i.setXY(v.getX()-I+(o||0),v.getY()-a+(o||0));i.setDepth(this._getNextDepth());this.addItemWithoutRendering(i,false);this._notifyItemChanged(i);this.fireItemAdd({item:i,mode:sap.ino.wall.WallConfig._ADD_MODE_MANUAL});setTimeout(function(){i.setFocusVisible();i.focus();i.setFlipped(true);},100);return this;};sap.ino.wall.Wall.prototype.setZoom=function(v,s){var a=this.$("inner"),V;if(isNaN(v)){sap.ino.wall.util.Logger.error("ZoomFactor could not be calculated");return;}v=Math.min(v,200);v=Math.max(v,20);if(sap.ui.Device.system.tablet){v=Math.max(v,30);}v=Math.round(v)*1.0;this.setProperty("zoom",v,true);if(this._isRendered()){if(!s){this._notifyChanged("zoom");}if(sap.ui.Device.browser.internet_explorer){a.css("-ms-transform","scale("+(v/100)+")");}else if(sap.ui.Device.browser.firefox){a.css("-moz-transform","scale("+(v/100)+")");}else if(sap.ui.Device.browser.safari){a.css("-webkit-transform","scale("+(v/100)+")");}else{a.css("zoom",v+"%");}}if(!sap.ino.wall.config.Config.getZoomCapable()){V=this.getViewPoint();a.css("margin","-"+(V.getY()+(V.getY()-5000)*((this.getZoom()/100)-1))+"px 0 0 -"+(V.getX()+(V.getX()-5000)*((this.getZoom()/100)-1))+"px");}this.fireZoomChange({zoom:this.getZoom()});sap.ino.wall.util.Logger.info("Zoom factor set to "+this.getZoom());return this;};sap.ino.wall.Wall.prototype.setTitle=function(v,s){if(this.getTitle()!==v){var d=this.$("wall-description");this.setProperty("title",v,true);if(this._isRendered()){d.text(this._oRB.getText("CRTL_WALL_DESCRIPTION",[v]));if(!s){this._notifyChanged("title");}}}};sap.ino.wall.Wall.prototype.setBackgroundImage=function(n,s){var a=this.$("inner");if(this.getBackgroundImage()!==n){this.setProperty("backgroundImage",n,true);this.setProperty("backgroundColor","",true);if(this._isRendered()){if(!s){this._notifyChanged("backgroundImage");this._notifyChanged("backgroundColor");}a.css("background-color","transparent");if(this.getBackgroundImage().indexOf("http://")===0||this.getBackgroundImage().indexOf("https://")===0){a.css("background-image","url("+this.getBackgroundImage()+")");if(this.getBackgroundImageTiled()){a.css("background-position","initial");a.css("background-repeat","repeat");}else{a.css("background-position","50% 50%");a.css("background-repeat","no-repeat");}}else{a.css("background-image",(n?"url(/sap/ino/ngui/sap/ino/assets/img/wall/bg/"+this.getBackgroundImage()+")":"none"));a.css("background-position","0% 0%");a.css("background-repeat","repeat");a.css("background-size","auto");}}}};sap.ino.wall.Wall.prototype.setBackgroundImageZoom=function(p,s){var a=this.$("inner");if(this.getBackgroundImageZoom()!==p){this.setProperty("backgroundImageZoom",p,true);if(this._isRendered()){if(!s){this._notifyChanged("backgroundImageZoom");}if(this.getBackgroundImage().indexOf("http://")===0||this.getBackgroundImage().indexOf("https://")===0){a.css("background-size",p+"%");}}}};sap.ino.wall.Wall.prototype.setBackgroundImageTiled=function(t,s){var a=this.$("inner");if(this.getBackgroundImageTiled()!==t){this.setProperty("backgroundImageTiled",t,true);if(this._isRendered()){if(!s){this._notifyChanged("backgroundImageTiled");}if(!this.getBackgroundImageTiled()&&(this.getBackgroundImage().indexOf("http://")===0||this.getBackgroundImage().indexOf("https://")===0)){a.css("background-position","50% 50%");a.css("background-repeat","no-repeat");}else{a.css("background-position","initial");a.css("background-repeat","repeat");}}}};sap.ino.wall.Wall.prototype.setBackgroundColor=function(c,s){var a=this.$("inner");if(this.getBackgroundColor()!==c){this.setProperty("backgroundImage","",true);this.setProperty("backgroundColor",c,true);if(this._isRendered()){if(!s){this._notifyChanged("backgroundImage");this._notifyChanged("backgroundColor");}a.css("background-color","#"+c);a.css("background-image",sap.ino.wall.util.Helper.addBrowserPrefix("linear-gradient(top, "+sap.ino.wall.util.Helper.shadeColor(c,10)+" 0%, "+sap.ino.wall.util.Helper.shadeColor(c,-10)+" 100%)"));a.css("background-position","initial");a.css("background-repeat","no-repeat");a.css("background-size","initial");}}};sap.ino.wall.Wall.prototype.setStorageId=function(v){this.setProperty("storageId",v,true);};sap.ino.wall.Wall.prototype.setOwner=function(v){this.setProperty("owner",v,true);};sap.ino.wall.Wall.prototype.setMode=function(m){this.setProperty("mode",m,true);if(this._oLock){this._oLock.toggleStyleClass("sapInoWallInvisible",m!==sap.ino.wall.WallMode.Readonly);}};sap.ino.wall.Wall.prototype.getItemsByPosition=function(I,w){var c,s=[],i=0;if(!I){I=this._getSelection();}if(!I){I=this.getItems();}c=this._calculateItemClusters(I);c=this._swimLaneSort(c);for(;i<c.length;i++){s=s.concat(this._swimLaneSort(c[i].items));}return s;};sap.ino.wall.Wall.prototype.updateViewport=function(){var t=this;if(this.getItems().length){this._updateBoundingBox();}function _(){if(t._boundingBox){t._adoptZoomFactorToBoundingBox();t._adoptViewPointToBoundingBox();}}if(this.getBackgroundImage()&&(this.getBackgroundImage().indexOf("http://")===0||this.getBackgroundImage().indexOf("https://")===0)&&!this.getBackgroundImageTiled()){var i=this._calculateBoundingBox();var w=this.$("inner");var f=w.width();var a=w.height();var b=new Image();b.src=w.css("background-image").replace(/url\(|\)$|"/ig,'');b.onload=function(){var s=parseInt(t.getBackgroundImageZoom())/100.0;var l=f*(1-s)/2.0;var T=a*(1-s)/2.0;var r=b.width/b.height;if(r>1){T+=(a*s-f*s/r)/2.0;}else if(r<1){T-=a*s-f*s*r;}var R=f-l;var B=a-T;if(i){l=Math.min(l,i[0].getX());T=Math.min(T,i[0].getY());R=Math.max(R,i[1].getX());B=Math.max(B,i[1].getY());}var u=new sap.ino.wall.Pos({x:l,y:T});var L=new sap.ino.wall.Pos({x:R,y:B});t._boundingBox=[u,L];_();};}else{_();}return this;};sap.ino.wall.Wall.prototype.showItems=function(i,a){this._adoptViewPointToBoundingBox(this._calculateBoundingBox(i));if(a){this._adoptZoomFactorToBoundingBox();}return this;};sap.ino.wall.Wall.prototype._calculateAverageItemHeight=function(I){var i=0,h,a,b=0,H=0.0;for(;i<I.length;i++){if(I[i]instanceof sap.ino.wall.WallItemBase){if(I[i]instanceof sap.ino.wall.WallItemLine){continue;}a=I[i].$();if(a.length){h=a.find(".front").outerHeight();}else{h=I[i].getH();if(h){h=parseInt(h,10);}if(!h){h=160;}}}else{h=I[i].boundingBox[1].getY()-I[i].boundingBox[0].getY();}H+=h;b++;}return H/b;};sap.ino.wall.Wall.prototype._swimLaneSort=function(I,w){var B=0,f,l,r=[],c,L=this._calculateAverageItemHeight(I),i=0;I=I.sort(function(a,b){var y,d;if(a instanceof sap.ino.wall.WallItemBase){y=parseInt(a.getY(),10);}else{y=a.boundingBox[0].getY();}if(b instanceof sap.ino.wall.WallItemBase){d=parseInt(b.getY(),10);}else{d=b.boundingBox[0].getY();}return y-d;});while(B<I.length){if(I[B]instanceof sap.ino.wall.WallItemBase){f=parseInt(I[B].getY(),10);}else{f=parseInt(I[B].boundingBox[0].getY(),10);}l=[];for(i=B;i<I.length;i++){B=i;if(!w){if(I[i]instanceof sap.ino.wall.WallItemLine){B++;continue;}}if(I[i]instanceof sap.ino.wall.WallItemBase){c=parseInt(I[i].getY(),10);}else{c=parseInt(I[i].boundingBox[0].getY(),10);}if(isNaN(c)){B++;break;}if(c<f+L){B++;l.push(I[i]);}else{break;}}l=l.sort(function(a,b){var x,d;if(a instanceof sap.ino.wall.WallItemBase){x=parseInt(a.getX(),10);}else{x=a.boundingBox[0].getX();}if(b instanceof sap.ino.wall.WallItemBase){d=parseInt(b.getX(),10);}else{d=b.boundingBox[0].getX();}return x-d;});r=r.concat(l);}return r;};sap.ino.wall.Wall.prototype.toggleEnableItems=function(e){var I=this.getItems(),i=0;for(;i<I.length;i++){I[i].setEnabled(e);}};sap.ino.wall.Wall.prototype._getSelection=function(){return this._aSelectedItems;};sap.ino.wall.Wall.prototype._toggleSelection=function(I,s){var i=0;if(!I){return;}if(!(I instanceof Array)){I=[I];}for(;i<I.length;i++){if(s===true){I[i].setSelected(true);}else if(s===false){I[i].setSelected(false);}else{I[i].setSelected(!I[i].getSelected());}}this._aSelectedItems=[];I=this.getItems();for(i=0;i<I.length;i++){if(I[i].getSelected()){this._aSelectedItems.push(I[i]);}}return this;};sap.ino.wall.Wall.prototype._selectAll=function(){var I=this.getItems(),i=0;this._aSelectedItems=[];for(;i<I.length;i++){if(I[i]instanceof sap.ino.wall.WallItemLine){continue;}this._aSelectedItems.push(I[i]);I[i].setSelected(true);}return this;};sap.ino.wall.Wall.prototype._clearSelection=function(){var I=this.getItems(),i=0;for(;i<I.length;i++){I[i].setSelected(false);}this._aSelectedItems=null;return this;};sap.ino.wall.Wall.prototype._deleteSelection=function(){var s=this._getSelection()||[];this.deleteItems(s);this._aSelectedItems=null;return this;};sap.ino.wall.Wall.prototype.deleteItems=function(I){var t=this;var r=[];function a(I){for(var i=0;i<I.length;i++){var o=I[i];r.push(o);a(o.getChilds()||[]);t.clearPendingItemChange(o,true);t.removeItemWithoutRendering(o);}}a(I);this.fireItemDelete({items:r});return this;};sap.ino.wall.Wall.prototype.formatToJSON=function(w){var I=this.getItems(),r={"title":this.getTitle(),"id":this.getId(),"backgroundColor":this.getBackgroundColor(),"backgroundImage":this.getBackgroundImage(),"backgroundImageZoom":this.getBackgroundImageZoom(),"backgroundImageTiled":this.getBackgroundImageTiled(),"storageId":this.getStorageId()},i=0;if(w){r.items=[];for(;i<I.length;i++){r.items.push(I[i].formatToJSON());}}return r;};sap.ino.wall.Wall.prototype._onmousemoveItemUpdate=function(i,c,e){var o=this.$("inner").offset(),z=100/this.getZoom(),I=c||0;if(!this.$().length){sap.ino.wall.util.Logger.warning('_onmousemoveItemUpdate failed, wall is not rendered');return;}if(!sap.ino.wall.config.Config.getZoomCapable()){i.setXY(((sap.ino.wall.util.Helper.getEventX(e)+Math.abs(o.left))*z+I)+"px",((sap.ino.wall.util.Helper.getEventY(e)+Math.abs(o.top))*z+I)+"px");}else{i.setXY((sap.ino.wall.util.Helper.getEventX(e)*z-o.left+I)+"px",(sap.ino.wall.util.Helper.getEventY(e)*z-o.top+I+5)+"px");}if(i instanceof sap.ino.wall.WallItemLine){if(i.getOrientation()==="HORIZONTAL"){i.setX("0px");}else if(i.getOrientation()==="VERTICAL"){i.setY("0px");}}};sap.ino.wall.Wall.prototype._updateBoundingBox=function(){var b=this._calculateBoundingBox(),c,a,d,e,i=0;if(b){this._boundingBox=b;if(sap.ino.wall.config.Config.getDebugPositioning()){sap.ino.wall.util.Logger.info("new bounding box: ul ("+b[0].getX()+"px/"+b[0].getY()+"px), lr ("+b[1].getX()+"px/"+b[1].getY()+"px)");a=jQuery.sap.byId(this.getId()+"-boundingBox");a.css("display","block");a.css("left",Math.floor(b[0].getX())).css("top",Math.floor(b[0].getY()));a.width(Math.floor(b[1].getX()-b[0].getX()));a.height(Math.floor(b[1].getY()-b[0].getY()));a.text("ul ("+b[0].getX()+"px/"+b[0].getY()+"px), lr ("+b[1].getX()+"px/"+b[1].getY()+"px)");c=this._calculateItemClusters(this.getItems());sap.ino.wall.util.Logger.info("new cluster calculation: "+c.length+" clusters identified");d=jQuery.sap.byId(this.getId()+"-clusterBox");d.css("display","block");d.empty();for(;i<c.length;i++){b=c[i].boundingBox;e=jQuery('<div id="'+this.getId()+'"-clusterBox" class="saUiWallWCB"></div>');e.css("left",Math.floor(b[0].getX())).css("top",Math.floor(b[0].getY()));e.width(Math.floor(b[1].getX()-b[0].getX()));e.height(Math.floor(b[1].getY()-b[0].getY()));e.text("cluster "+i+": ul ("+b[0].getX()+"px/"+b[0].getY()+"px), lr ("+b[1].getX()+"px/"+b[1].getY()+"px)");d.append(e);}}}return this;};sap.ino.wall.Wall.prototype._calculateBoundingBox=function(I){var i=0,u=null,l=null,a,p,o,O,f=true;if(!I){I=this.getItems();}for(;i<I.length;i++){if(I[i]instanceof sap.ino.wall.WallItemLine){continue;}a=I[i].$();if(a.length){o=a.find(".front").outerWidth();O=a.find(".front").outerHeight();}else{o=I[i].getW();O=I[i].getH();if(o){o=parseInt(o,10);}if(O){O=parseInt(O,10);}if(!o){o=160;}if(!O){O=160;}}p={left:parseFloat(I[i].getX(),10),top:parseFloat(I[i].getY(),10)};if(!(I[i].getParent()instanceof sap.ino.wall.WallItemGroup)&&(p.left<=0||p.top<=0)){continue;}if(p.left===""||p.top===""||isNaN(p.left)||isNaN(p.top)){continue;}if(f){u=new sap.ino.wall.Pos({x:p.left,y:p.top});l=new sap.ino.wall.Pos({x:p.left+o,y:p.top+O});f=false;}else{if(p.left<u.getX()){u.setX(p.left);}if(p.top<u.getY()){u.setY(p.top);}if((p.left+o)>l.getX()){l.setX(p.left+o);}if((p.top+O)>l.getY()){l.setY(p.top+O);}}}if(!u){return;}u.floorify();l.floorify();return[u,l];};sap.ino.wall.Wall.prototype._adoptZoomFactorToBoundingBox=function(){var t=this,w=this.getParent().$().width(),i=$(document).height()-this.getHeaderHeight()-this.getFooterHeight(),u=this._boundingBox[0],l=this._boundingBox[1],d,D,z,Z,f;d=(l.getX()-u.getX());D=(l.getY()-u.getY());z=w/d;Z=i/D;f=Math.min(z,Z)*100.0;f=Math.min(f,180);t.setZoom(Math.floor(f));return this;};sap.ino.wall.Wall.prototype._adoptViewPointToBoundingBox=function(b){var b=b||this._boundingBox,a=this.$("inner"),v=this.getViewPoint(),w=this.getParent().$().width(),i=jQuery(document).height()-this.getHeaderHeight()-this.getFooterHeight(),u=b[0],l=b[1],d,c,z=this.getZoom()/100;d=w-(l.getX()-u.getX())*z;c=i-(l.getY()-u.getY())*z;d=Math.max(d,32);c=Math.max(c,32);v.setX(u.getX()+(w-d)*1/(z*2));v.setY(u.getY()+(i-c)*1/(z*2));if(!sap.ino.wall.config.Config.getZoomCapable()){a.css("margin","-"+(v.getY()+(v.getY()-5000)*((this.getZoom()/100)-1))+"px 0 0 -"+(v.getX()+(v.getX()-5000)*((this.getZoom()/100)-1))+"px");}else{a.css("margin","-"+v.getY()+"px 0 0 -"+v.getX()+"px");}this.setViewPoint(v);return this;};sap.ino.wall.Wall.prototype._calculateAndTriggerSelection=function(l,t,w,h){var o=this.$("inner").offset(),z=100/this.getZoom();var T=this.$("inner").parent().offset().top;if(!sap.ino.wall.config.Config.getZoomCapable()){l=(l+Math.abs(o.left))*z;t=(t+Math.abs(o.top))*z+T*z;w=w*z;h=h*z;}else{l=l*z-o.left;t=t*z-o.top+T*z;w=w*z;h=h*z;}this._toggleSelection(this._calculateAllCollisions([l,t,w,h],sap.ino.wall.WallConfig._COLLISION_INTERSECTIONS)[0]);};sap.ino.wall.Wall.prototype._calculateAllCollisions=function(i,m,s){var I=this.getItems();return this._calculateCollisions(I,i,m,s);};sap.ino.wall.Wall.prototype._calculateCollisions=function(I,o,m,s,c){var a=[],n=[],i=0,t=c||sap.ino.wall.config.Config.getWallCollisionThreshold(),b=null,d,e,f,g,h,j,O,k,l;if(o instanceof sap.ino.wall.WallItemLine){return[a,n];}if(I.length){if(o instanceof sap.ino.wall.WallItemBase){b=o.$();if(b.length){O=b.find(".front").outerWidth();k=b.find(".front").outerHeight();d=new sap.ino.wall.Pos({x:parseInt(b.css("left"),10),y:parseInt(b.css("top"),10)});e=new sap.ino.wall.Pos({x:d.getX()+O,y:d.getY()+k});}else{O=160;k=160;d=new sap.ino.wall.Pos({x:parseInt(o.getX(),10),y:parseInt(o.getY(),10)});e=new sap.ino.wall.Pos({x:d.getX()+O,y:d.getY()+k});}}else{d=new sap.ino.wall.Pos({x:o[0],y:o[1]});e=new sap.ino.wall.Pos({x:o[0]+o[2],y:o[1]+o[3]});}if(sap.ino.wall.config.Config.getDebugPositioning()&&o instanceof sap.ino.wall.WallItemBase&&!c){if(b){b.find(".sapInoWallWIBIntersectionBox").css("background-color","");b.find(".sapInoWallWIBNeighbourBox").css("background-color","");}for(;i<I.length;i++){I[i].$().find(".sapInoWallWIBIntersectionBox").css("background-color","");I[i].$().find(".sapInoWallWIBNeighbourBox").css("background-color","");}}for(i=0;i<I.length;i++){f=I[i];if(f===o||f===s){continue;}if(f instanceof sap.ino.wall.WallItemLine){continue;}if(f instanceof sap.ino.wall.WallItemArrow){continue;}if(f instanceof sap.ino.wall.WallItemBase){g=f.$();if(g.length){O=g.find(".front").outerWidth();k=g.find(".front").outerHeight();h=new sap.ino.wall.Pos({x:parseInt(g.css("left"),10),y:parseInt(g.css("top"),10)});j=new sap.ino.wall.Pos({x:h.getX()+O,y:h.getY()+k});if(isNaN(h.getX())||isNaN(h.getY())||isNaN(j.getX())||isNaN(j.getY())){continue;}}else{O=160;k=160;h=new sap.ino.wall.Pos({x:parseInt(f.getX(),10),y:parseInt(f.getY(),10)});j=new sap.ino.wall.Pos({x:h.getX()+O,y:h.getY()+k});}if(h.getX()===0&&h.getY()===0){continue;}}else{h=new sap.ino.wall.Pos({x:f[0],y:f[1]});j=new sap.ino.wall.Pos({x:f[0]+f[2],y:f[1]+f[3]});}if((m===sap.ino.wall.WallConfig._COLLISION_ALL||m===sap.ino.wall.WallConfig._COLLISION_INTERSECTIONS)&&!((e.getY()<h.getY())||(d.getY()>j.getY())||(d.getX()>j.getX())||(e.getX()<h.getX()))){if(f instanceof sap.ino.wall.WallItemBase){a.push(I[i]);}else{a.push(f[4]);}if(sap.ino.wall.config.Config.getDebugPositioning()&&!c){sap.ino.wall.util.Logger.info("Item \""+o+"\" collides with item \""+I[i]+"\"");if(o instanceof sap.ino.wall.WallItemBase){o.$().find(".sapInoWallWIBIntersectionBox").css("background-color","rgba(255,0,0,0.6)");}if(f instanceof sap.ino.wall.WallItemBase){I[i].$().find(".sapInoWallWIBIntersectionBox").css("background-color","rgba(255,0,0,0.6)");}}}else if((m===sap.ino.wall.WallConfig._COLLISION_ALL||m===sap.ino.wall.WallConfig._COLLISION_NEIGHBOURS)&&!((e.getY()+t<h.getY()-t)||(d.getY()-t>j.getY()+t)||(d.getX()-t>j.getX()+t)||(e.getX()+t<h.getX()-t))){if(f instanceof sap.ino.wall.WallItemBase){n.push(I[i]);}else{n.push(f[4]);}if(sap.ino.wall.config.Config.getDebugPositioning()&&!c){sap.ino.wall.util.Logger.info("Item \""+o+"\" is neighbour of item \""+I[i]+"\"");if(o instanceof sap.ino.wall.WallItemBase){o.$().find(".sapInoWallWIBNeighbourBox").css("background-color","rgba(255,125,0,0.6)");}if(f instanceof sap.ino.wall.WallItemBase){I[i].$().find(".sapInoWallWIBNeighbourBox").css("background-color","rgba(255,125,0,0.6)");}}}}}return[a,n];};sap.ino.wall.Wall.prototype._calculateItemClusters=function(I){var c=[],i=0,j,a,b,d,m=false,A,e,f,g,n,s=0;while(I.length>0){if(I[0]instanceof sap.ino.wall.WallItemLine){I.splice(0,1);continue;}a=this._calculateCollisions(I,I[0],sap.ino.wall.WallConfig._COLLISION_ALL,null,100);a=a[0].concat(a[1]);a.push(I[0]);d=this._calculateBoundingBox(a);if(d){c.push({id:jQuery.sap.uid(),boundingBox:d,items:a});}b=a.map(function(o){return o.getId();});I=I.filter(function(o){return(b.indexOf(o.getId())===-1);});}do{m=false;s++;for(i=0;i<c.length;i++){A=c.slice(0);A.splice(i,1);e=[];for(j=0;j<A.length;j++){e.push([A[j].boundingBox[0].getX(),A[j].boundingBox[0].getY(),A[j].boundingBox[1].getX()-c[i].boundingBox[0].getX(),A[j].boundingBox[1].getY()-c[i].boundingBox[0].getY(),A[j].id]);}a=this._calculateCollisions(e,[c[i].boundingBox[0].getX(),c[i].boundingBox[0].getY(),c[i].boundingBox[1].getX()-c[i].boundingBox[0].getX(),c[i].boundingBox[1].getY()-c[i].boundingBox[0].getY(),c[i].id],sap.ino.wall.WallConfig._COLLISION_ALL,null,70);a=a[0].concat(a[1]);if(a.length>0){b=a.map(function(o){return(o.getId?o.getId():o);});f=c.filter(function(o){return(b.indexOf(o.id)!==-1);});f.push(c[i]);n={id:jQuery.sap.uid(),boundingBox:[],items:[]};for(j=0;j<f.length;j++){n.items=n.items.concat(f[j].items);}n.boundingBox=this._calculateBoundingBox(n.items);g=f.map(function(o){return o.id;});for(j=0;j<c.length;j++){if(g.indexOf(c[j].id)!==-1){c.splice(j,1);j--;}}c.push(n);m=true;break;}}if(s>90){jQuery.sap.log.error("something went wrong when calculating the clusters!");}}while(m&&c.length!==1&&s<99);return c;};sap.ino.wall.Wall.prototype._getNextDepth=function(d){if(d!=undefined&&this._nextDepth===d){return this._nextDepth;}if(this._nextDepth+sap.ino.wall.WallConfig._DEPTH_STEP>sap.ino.wall.WallConfig._MAX_DEPTH){this._reduceItemDepth();}this._nextDepth+=sap.ino.wall.WallConfig._DEPTH_STEP;return this._nextDepth;};sap.ino.wall.Wall.prototype._reduceItemDepth=function(){var I=this.getItems(),c=I.sort(function(a,b){if(a.getDepth()<b.getDepth()){return-1;}else if(a.getDepth()>b.getDepth()){return 1;}else{return 0;}}),i=0;this._nextDepth=sap.ino.wall.WallConfig._MIN_DEPTH;for(;i<c.length;i++){c[i].setDepth(this._getNextDepth());}};sap.ino.wall.Wall.prototype._renderItemIntoContainer=function(i,d,I){var D=this.$("inner")[0];sap.ino.wall.util.Helper.renderItemIntoContainer(D,i,d,I);return this;};sap.ino.wall.Wall.prototype._isRendered=function(){if(this._bIsInDOM===undefined||this._bIsInDOM===0){this._bIsInDOM=jQuery.sap.byId(this.getId()+"-inner").length;}return this._bIsInDOM;};sap.ino.wall.Wall.prototype._hasFollowCursorItems=function(){return this._followHandlers.length>0;};sap.ino.wall.Wall.prototype._notifyItemChanged=function(i){var t=this;if(this.getMode()==="Readonly"){return;}if(i.getStorageId()>0){if(i){this._oItemsChanged[i.getId()]=i;}clearTimeout(this._iWallItemsSaveDelayTimer);this._iWallItemsSaveDelayTimer=setTimeout(function(){t.fireItemChange({items:t._oItemsChanged});t._oItemsChanged={};},this._iWallSaveDelay);}return this;};sap.ino.wall.Wall.prototype._wallInteractionPossible=function(t){if(this.getParent()&&!(jQuery(t).control()[0]instanceof sap.ino.wall.TextEditor)&&jQuery(t).filter('input,textarea,select').length===0){return true;}return false;};sap.ino.wall.Wall.prototype._notifyChanged=function(p){var t=this;if(this.getMode()==="Readonly"){return;}if(p){this._oPropertiesChanged[p]=true;}clearTimeout(this._iWallSaveDelayTimer);this._iWallSaveDelayTimer=setTimeout(function(){t.fireChange({properties:t._oPropertiesChanged});t._oPropertiesChanged={};},this._iWallSaveDelay);return this;};sap.ino.wall.Wall.prototype.forceSyncFireChange=function(){var t=this;var p=[];if(!jQuery.isEmptyObject(t._oPropertiesChanged)){var d=jQuery.Deferred();t.fireChange({properties:t._oPropertiesChanged,sync:true,deferred:d});p.push(d.promise());}t.clearAllPendingChanges();if(!jQuery.isEmptyObject(t._oItemsChanged)){var d=jQuery.Deferred();t.fireItemChange({items:t._oItemsChanged,sync:true,deferred:d});p.push(d.promise());}t.clearAllPendingItemChanges();return jQuery.when.apply(undefined,p);};sap.ino.wall.Wall.prototype.clearAllPendingItemChanges=function(){clearTimeout(this._iWallItemsSaveDelayTimer);this._oItemsChanged={};};sap.ino.wall.Wall.prototype.clearAllPendingChanges=function(){clearTimeout(this._iWallSaveDelayTimer);this._oPropertiesChanged={};};sap.ino.wall.Wall.prototype.clearPendingItemChange=function(I,w){var i=0,c;delete this._oItemsChanged[I.getId()];if(Object.keys(this._oItemsChanged).length===0){clearTimeout(this._iWallItemsSaveDelayTimer);}if(w){c=I.getChilds();for(;i<c.length;i++){this.clearPendingItemChange(c[i],true);}}};sap.ino.wall.Wall.prototype.hasPendingChanges=function(){return!!Object.keys(this._oPropertiesChanged).length;};sap.ino.wall.Wall.prototype.hasPendingItemChanges=function(){return!!Object.keys(this._oItemsChanged).length;};sap.ino.wall.Wall.prototype._createTrashBin=function(){var t=this;if(sap.ui.Device.browser.chrome){this._oHLTrashAbove=new sap.ui.layout.HorizontalLayout(this.getId()+"-trashAbove",{content:[new sap.ino.wall.Hoverable({enter:function(){var a;if(t.getMode()===sap.ino.wall.WallMode.Readonly||t._bMovingItem){return;}t.fireHover({element:"Trash",interaction:"Enter",tooltip:this.getContent().getTooltip()});a=t.$("trash");a.clearQueue().css("opacity",1);a.css("z-index",10000);},leave:function(){var a;if(t.getMode()===sap.ino.wall.WallMode.Readonly||t._bMovingItem){return;}t.fireHover({element:"Trash",interaction:"Leave",tooltip:null});a=t.$("trash");a.clearQueue().css("opacity",0);},content:sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-trashbinAbove",tooltip:"{i18n>WALL_STATUSMSG_TRASH}",src:sap.ui.core.IconPool.getIconURI("delete")}).addStyleClass("sapInoWallWTrashBin above")})]}).addStyleClass("sapInoWallWTrash above");this.addDependent(this._oHLTrashAbove);}this._oHLTrash=new sap.ui.layout.HorizontalLayout(this.getId()+"-trash",{content:[new sap.ino.wall.Hoverable({enter:function(){var a;if(t.getMode()===sap.ino.wall.WallMode.Readonly||t._bMovingItem){return;}t.fireHover({element:"Trash",interaction:"Enter",tooltip:this.getContent().getTooltip()});a=t.$("trash");a.clearQueue().css("opacity",1);a.css("z-index",10000);},leave:function(){var a;if(t.getMode()===sap.ino.wall.WallMode.Readonly||t._bMovingItem){return;}t.fireHover({element:"Trash",interaction:"Leave",tooltip:null});a=t.$("trash");a.clearQueue().css("opacity",0);},content:sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-trashbin",tooltip:"{i18n>WALL_STATUSMSG_TRASH}",src:sap.ui.core.IconPool.getIconURI("delete")}).addStyleClass("sapInoWallWTrashBin")})]}).addStyleClass("sapInoWallWTrash");this.addDependent(this._oHLTrash);};sap.ino.wall.Wall.prototype._createSelectionRectangle=function(){this._oSelectionRectangle=new sap.ui.core.HTML(this.getId()+"-selectionRectangle",{content:'<div class="sapInoWallWSelectionRectangle sapInoWallWNoSelection"></div>',sanitizeContent:true});};sap.ino.wall.Wall.prototype._createLock=function(){this._oLock=new sap.ui.layout.HorizontalLayout(this.getId()+"-lock",{content:[new sap.ino.wall.Hoverable({content:sap.ui.core.IconPool.createControlByURI({id:this.getId()+"-lockIcon",src:sap.ui.core.IconPool.getIconURI("locked")}).bindProperty("tooltip","i18n>WALL_STATUSMSG_LOCK").addStyleClass("sapInoWallWLockIcon")})]}).addStyleClass("sapInoWallWLock");this.addDependent(this._oLock);if(this.getMode()!==sap.ino.wall.WallMode.Readonly){this._oLock.addStyleClass("sapInoWallInvisible");}};sap.ino.wall.Wall.prototype._createTemplateIndicator=function(){this._oTemplateIndicator=new sap.ui.core.HTML(this.getId()+"-templateIndicator",{content:'<div class="sapInoWallWTemplateIndicator sapInoWallInvisible" title="'+this._oRB.getText("WALL_STATUSMSG_TEMPLATE")+'"><div class="sapInoWallWTemplateIndicatorInner">'+this._oRB.getText("WALL_TEMPLATE_INDICATOR")+'</div></div>',sanitizeContent:true});this.addDependent(this._oTemplateIndicator);};})();
