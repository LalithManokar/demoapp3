/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.WallItemSprite");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallItemBase");jQuery.sap.require("sap.ino.wall.util.Helper");jQuery.sap.require("sap.ino.wall.SpriteDesign");jQuery.sap.require("sap.ino.wall.ColorPicker");jQuery.sap.require("sap.ino.wall.WallConfig");sap.ino.wall.WallItemBase.extend("sap.ino.wall.WallItemSprite",{metadata:{properties:{"color":{type:"string",group:"Appearance",defaultValue:'#cc0000'},"type":{type:"string",group:"Appearance",defaultValue:'ROUND'}},aggregations:{"_textAreaDescription":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_checkboxMulti":{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"},"_buttonColorSelector":{type:"sap.m.Button",multiple:false,visibility:"hidden"},"_colorPicker":{type:"sap.ino.wall.ColorPicker",multiple:false,visibility:"hidden"},"_iconSelect":{type:"sap.ino.wall.ColorPicker",multiple:false,visibility:"hidden"},"_selectType":{type:"sap.m.Select",multiple:false,visibility:"hidden"}}}});sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_UPPERCASE=0;sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_LOWERCASE=1;sap.ino.wall.WallItemSprite.TITLE_MODE_NUMBER=2;sap.ino.wall.WallItemSprite.getNextTitle=function(){var r="!";if(!sap.ino.wall.WallItemSprite._iTitleCount){sap.ino.wall.WallItemSprite._iTitleMode=sap.ino.wall.util.Helper.randomMinMax(0,2);sap.ino.wall.WallItemSprite._iTitleCount=0;}switch(sap.ino.wall.WallItemSprite._iTitleMode){case sap.ino.wall.WallItemSprite.TITLE_MODE_NUMBER:sap.ino.wall.WallItemSprite._iTitleCount++;r=String(sap.ino.wall.WallItemSprite._iTitleCount);break;case sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_LOWERCASE:r=String.fromCharCode(97+sap.ino.wall.WallItemSprite._iTitleCount%26);sap.ino.wall.WallItemSprite._iTitleCount++;break;case sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_UPPERCASE:default:r=String.fromCharCode(65+sap.ino.wall.WallItemSprite._iTitleCount%26);sap.ino.wall.WallItemSprite._iTitleCount++;break;}return r;};sap.ino.wall.WallItemSprite.updateNextTitle=function(t){var n;t=t.trim();if(/^[0-9]+$/.test(t)){n=parseInt(t,10);sap.ino.wall.WallItemSprite._iTitleMode=sap.ino.wall.WallItemSprite.TITLE_MODE_NUMBER;sap.ino.wall.WallItemSprite._iTitleCount=n;}else if(/^[A-Z]$/.test(t)){sap.ino.wall.WallItemSprite._iTitleMode=sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_UPPERCASE;sap.ino.wall.WallItemSprite._iTitleCount=t.charCodeAt(0)-65+1;}else if(/^[a-z]$/.test(t)){sap.ino.wall.WallItemSprite._iTitleMode=sap.ino.wall.WallItemSprite.TITLE_MODE_CHAR_LOWERCASE;sap.ino.wall.WallItemSprite._iTitleCount=t.charCodeAt(0)-97+1;}};sap.ino.wall.WallItemSprite.prototype.init=function(){sap.ino.wall.WallItemBase.prototype.init.call(this);this.setResizable(true);};sap.ino.wall.WallItemSprite.prototype.setFlipped=function(f){var c=this._getColorPicker();if(c.isOpen()){c.close();}sap.ino.wall.WallItemBase.prototype.setFlipped.apply(this,arguments);if(this.getFlipped()){this._bCorrectPositioningAfterFlip=true;}return this;};sap.ino.wall.WallItemSprite.prototype.onAfterRendering=function(){var l=sap.ino.wall.util.Helper.getColorLuminance(this.getColor()),b=sap.ui.getCore().byId(this.getId()+"-buttonColorSelector");sap.ino.wall.WallItemBase.prototype.onAfterRendering.apply(this,arguments);if(b){sap.ui.getCore().byId(this.getId()+"-buttonColorSelector").$().find(".sapMBtnInner").css("background-color",this.getColor());}if(l<=0.6){this._getButtonColorSelector().addStyleClass("sapInoWallWISpriteColorSelectorButtonBright").removeStyleClass("sapInoWallWISpriteColorSelectorButtonNormal");}else{this._getButtonColorSelector().addStyleClass("sapInoWallWISpriteColorSelectorButtonNormal").removeStyleClass("sapInoWallWISpriteColorSelectorButtonBright");}};sap.ino.wall.WallItemSprite.prototype.setTitle=function(t,s){if(t!==this.getTitle()){this.setProperty("title",t,true);sap.ino.wall.WallItemSprite.updateNextTitle(t);if(this._isRendered()){this.$().children(".flippable").find(".front .sapInoWallWITitleText").html(jQuery.sap.encodeHTML(this.getProperty("title")));this._adjustFontSize();}if(this.getParent()&&!s){this.getParent()._notifyItemChanged(this);}}return this;};sap.ino.wall.WallItemSprite.prototype.setColor=function(c,s){var l,$=this.$().children(".flippable").find(".front");if(c!==this.getColor()){this.setProperty("color",c,true);if(this._isRendered()){l=sap.ino.wall.util.Helper.getColorLuminance(c);$.css("border-color",sap.ino.wall.util.Helper.shadeColor(c,-10));$.css("background-color",c);$.css("color",(l<=0.6?"#F5F5F5":"#232323"));$.css("background-image",sap.ino.wall.util.Helper.addBrowserPrefix("linear-gradient(top, "+sap.ino.wall.util.Helper.shadeColor(c,5)+" 0%, "+sap.ino.wall.util.Helper.shadeColor(c,-5)+" 100%)"));sap.ui.getCore().byId(this.getId()+"-buttonColorSelector").$().find(".sapMBtnInner").css("background-color",c);if(l<=0.6){this._getButtonColorSelector().addStyleClass("sapInoWallWISpriteColorSelectorButtonBright").removeStyleClass("sapInoWallWISpriteColorSelectorButtonNormal");}else{this._getButtonColorSelector().addStyleClass("sapInoWallWISpriteColorSelectorButtonNormal").removeStyleClass("sapInoWallWISpriteColorSelectorButtonBright");}}if(this.getParent()&&!s){this.getParent()._notifyItemChanged(this);}}};sap.ino.wall.WallItemSprite.prototype.setType=function(t){if(t!==this.getType()){this.$().children(".flippable").find(".front").toggleClass("sapInoWallWISprite"+this.getType(),false);this.setProperty("type",t,true);this.$().children(".flippable").find(".front").toggleClass("sapInoWallWISprite"+this.getType(),true);if(this.getParent()){this.getParent()._notifyItemChanged(this);}}return this;};sap.ino.wall.WallItemSprite.prototype._adjustFontSize=function(){var t=this.getTitle().length||1;if(t>1){t-=t/4;}this.$().children(".flippable").find(".sapInoWallWITitleText.sapInoWallWISpriteText").css("line-height",this.getH()).css("font-size",(Math.min(parseInt(this.getW(),10),parseInt(this.getH(),10)*1.5)-10)/t);};sap.ino.wall.WallItemSprite.prototype._onResize=function(s,d,D){var c=parseInt(this.getW(),10),C=parseInt(this.getH(),10);if(this.getFlipped()&&(c<sap.ino.wall.WallConfig._ITEM_MIN_SIZE||this._bAddDeltaWhenResizing)){if(d<0&&!this._fDeltaWidthWhenResizing){this._fDeltaWidthWhenResizing=Math.abs(d+sap.ino.wall.WallConfig._ITEM_MIN_SIZE-c);}this._bAddDeltaWhenResizing=true;this.setW(Math.max(sap.ino.wall.WallConfig._ITEM_MIN_SIZE,sap.ino.wall.WallConfig._ITEM_MIN_SIZE+d+(this._fDeltaWidthWhenResizing||0))+"px");if(this._bCorrectPositioningAfterFlip){this.setX(parseInt(this.getX(),10)-Math.abs(c-parseInt(this.getW(),10))+"px");this._bCorrectPositioningAfterFlip=false;}}if(this.getFlipped()&&(C<sap.ino.wall.WallConfig._ITEM_MIN_SIZE||this._bAddDeltaWhenResizing)){if(D<0&&!this._fDeltaHeightWhenResizing){this._fDeltaHeightWhenResizing=Math.abs(D+sap.ino.wall.WallConfig._ITEM_MIN_SIZE-C);}this._bAddDeltaWhenResizing=true;this.setH(Math.max(sap.ino.wall.WallConfig._ITEM_MIN_SIZE,sap.ino.wall.WallConfig._ITEM_MIN_SIZE+D+(this._fDeltaHeightWhenResizing||0))+"px");}this._adjustTShirtSize();this._adjustFontSize();if(!jQuery.support.hasFlexBoxSupport||sap.ui.Device.browser.internet_explorer&&sap.ui.Device.browser.version===10){var f=this.$().find(".sapInoWallWISpritePickerContainer").outerHeight()+this.$().find(".sapInoWallWISpriteMulti").outerHeight();this.$().children(".flippable").find(".back .sapInoWallWISpriteText").height(this.$().find(".back").height()-f-10);this.$().children(".flippable").find(".sapInoWallWISpriteTextTA").css("padding-bottom","10px");}};sap.ino.wall.WallItemSprite.prototype._onResizeEnd=function(){this._bAddDeltaWhenResizing=false;this._fDeltaWidthWhenResizing=0;this._fDeltaHeightWhenResizing=0;};sap.ino.wall.WallItemSprite.prototype.formatToJSON=function(){var j=sap.ino.wall.WallItemBase.prototype.formatToJSON.call(this);j.color=this.getColor();j.type=this.getType();j.bgcolor="";j.icon="";j.image="";return j;};sap.ino.wall.WallItemSprite.prototype._getInputTitle=function(){var i=sap.ino.wall.WallItemBase.prototype._getInputTitle.apply(this,arguments);i.setProperty("maxLength",10,true);return i;};sap.ino.wall.WallItemSprite.prototype._getButtonColorSelector=function(){var t=this,c=this.getAggregation("_buttonColorSelector");if(!c){c=new sap.m.Button(this.getId()+"-buttonColorSelector",{tooltip:this._oRB.getText("WALL_ITEMLINE_STATUSMSG_COLOR_SELECT"),press:function(e){var C=t._getColorPicker();if(C.isOpen()){C.close();}else{C.openBy(c,0,0);}},icon:"sap-icon://palette"}).addStyleClass("noflip").addStyleClass("sapInoWallWISpriteColorSelectorButton").addStyleClass("sapInoWallWISpriteColorSelectorButtonNormal");this.setAggregation("_buttonColorSelector",c,true);}return c;};sap.ino.wall.WallItemSprite.prototype._getColorPicker=function(){var t=this,c=this.getAggregation("_colorPicker");if(!c){c=new sap.ino.wall.ColorPicker(this.getId()+"-colorPicker",{color:this.getColor(),change:function(e){t.setColor(e.getParameter("color"));}});c.setPlacement(sap.m.PlacementType.Vertical);this.setAggregation("_colorPicker",c,true);}return c;};sap.ino.wall.WallItemSprite.prototype._getSelectType=function(){var t=this,c=this.getAggregation("_selectType"),s=null,I,a,T=this.getType(),k=null,i=0;if(!c){c=new sap.m.Select(this.getId()+"-type",{width:"100%",change:function(e){t.setType(e.getParameter("selectedItem").getKey());}}).addStyleClass("sapInoWallWIBSelect").addStyleClass("noflip");for(k in sap.ino.wall.SpriteDesign){if(sap.ino.wall.SpriteDesign.hasOwnProperty(k)){I=new sap.ui.core.Item({key:sap.ino.wall.SpriteDesign[k],text:this._oRB.getText("WALL_ITEMSPRITE_TYPE_"+sap.ino.wall.SpriteDesign[k])});c.addItem(I);if(T===k&&!s){s=I.getId();}}}c.setSelectedItem(s);this.setAggregation("_selectType",c,true);}else{a=c.getItems();for(;i<a.length;i++){if(a[i].getKey()===T){c.setSelectedItem(a[i]);break;}}}return c;};})();
