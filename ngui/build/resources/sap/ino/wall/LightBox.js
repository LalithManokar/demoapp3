/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.LightBox");(function(){"use strict";jQuery.sap.require("sap.ino.wall.util.Helper");sap.ui.core.Control.extend("sap.ino.wall.LightBox",{metadata:{publicMethods:["open"],properties:{"title":{type:"string",group:"Appearance",defaultValue:null},"image":{type:"sap.ui.core.URI",group:"Data",defaultValue:null},"alt":{type:"string",group:"Data",defaultValue:null}},aggregations:{"_dialog":{type:"sap.m.Dialog",multiple:false,visibility:"hidden"},"_busyDialog":{type:"sap.m.BusyDialog",multiple:false,visibility:"hidden"}}}});sap.ino.wall.LightBox.prototype.init=function(){this._oRB=sap.ui.getCore().getLibraryResourceBundle("sap.ino.wall");};sap.ino.wall.LightBox.prototype.exit=function(){this._oImage.destroy();this._oImage=null;sap.ui.Device.resize.detachHandler(this._getBoundResizeHandler());};sap.ino.wall.LightBox.prototype._getDialog=function(){var t=this,c=this.getAggregation("_dialog"),C=function(){sap.ui.Device.resize.detachHandler(t._getBoundResizeHandler());jQuery("#sap-ui-blocklayer-popup").off("click",C);c.close();},o=function(){jQuery("#sap-ui-blocklayer-popup").on("click",C);};if(!c){var i=this._getImage().clone();i.attachPress(C);c=new sap.m.Dialog({stretch:sap.ui.Device.system.phone,showHeader:false,verticalScrolling:false,horizontalScrolling:false,afterClose:C,afterOpen:o,content:[i,new sap.m.Label({textAlign:(sap.ui.Device.system.phone?"Center":"Left"),text:this.getTitle(),design:sap.m.LabelDesign.Bold}).addStyleClass("sapInoWallLightBoxTitle")]}).addEventDelegate({ontap:C}).addStyleClass("sapInoWallLightBoxDialog");this.setAggregation("_dialog",c,true);}return c;};sap.ino.wall.LightBox.prototype._getBusyDialog=function(){var c=this.getAggregation("_busyDialog");if(!c){c=new sap.m.BusyDialog();this.setAggregation("_busyDialog",c,true);}return c;};sap.ino.wall.LightBox.prototype._getImage=function(){if(!this._oImage){this._oImage=new sap.m.Image(this.getId()+"-image",{src:this.getImage(),alt:this.getAlt()});}return this._oImage;};sap.ino.wall.LightBox.prototype._adjustImageSizeToScreen=function(i,I){var d=this._getDialog(),w=sap.ui.Device.resize.width,W=sap.ui.Device.resize.height,t,T;if(!i||!I){return;}if(!d.getStretch()){w-=2*64+2*16;W-=2*8+2*16+48;}else{w-=2*16;W-=2*16+24;}if(i>w){t=w;I=(t/i)*I;i=t;if(!sap.ui.Device.system.phone){T=Math.max(i,368);I=(T/i)*I;i=T;}}if(I>W){t=W;i=(t/I)*i;if(!sap.ui.Device.system.phone){i=Math.max(i,368);}I=t;I=Math.max(I,1);}return[i,I];};sap.ino.wall.LightBox.prototype._getBoundResizeHandler=function(){if(!this._onResizeHandler){this._onResizeHandler=this._onResize.bind(this);}return this._onResizeHandler;};sap.ino.wall.LightBox.prototype._onResize=function(){var d=this._getDialog(),i=d.getContent()[0],s=this._adjustImageSizeToScreen(this._iImageWidth,this._iImageHeight);if(s){i.setWidth(s[0]+"px").setHeight((s[1]-50)+"px");}};sap.ino.wall.LightBox.prototype.open=function(){var t=this,d=this._getDialog(),b=this._getBusyDialog(),p=new Image();b.open();p.src=this.getImage();p.onload=function(){var s,i=d.getContent()[0];t._iImageWidth=this.width;t._iImageHeight=this.height;s=t._adjustImageSizeToScreen(t._iImageWidth,t._iImageHeight);b.close();if(s){i.setWidth(s[0]+"px").setHeight((s[1]-50)+"px");}sap.ui.Device.resize.attachHandler(t._getBoundResizeHandler());d.open();};p.onerror=function(){b.close();sap.ino.wall.util.Helper.showErrorUnexpected(t._oRB.getText("WALL_LIGHTBOX_IMAGE_LOAD_ERROR",[p.src]));};};})();
