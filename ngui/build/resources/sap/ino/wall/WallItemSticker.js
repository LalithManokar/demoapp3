/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.WallItemSticker");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallItemBase");jQuery.sap.require("sap.ino.wall.util.Formatter");jQuery.sap.require("sap.ino.wall.util.Helper");jQuery.sap.require("sap.ino.wall.config.Config");jQuery.sap.require("sap.ino.wall.TextEditor");jQuery.sap.require("sap.ino.wall.StickerColor");jQuery.sap.require("sap.ino.wall.TShirtSize");sap.ino.wall.WallItemBase.extend("sap.ino.wall.WallItemSticker",{metadata:{properties:{"color":{type:"sap.ino.wall.StickerColor",group:"Appearance",defaultValue:sap.ino.wall.StickerColor.Yellow},"multiLine":{type:"boolean",group:"Misc",defaultValue:true}},aggregations:{"_textAreaDescription":{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},"_checkboxMulti":{type:"sap.m.CheckBox",multiple:false,visibility:"hidden"}}}});sap.ino.wall.WallItemSticker.prototype.init=function(){sap.ino.wall.WallItemBase.prototype.init.call(this);this.setResizable(true);};sap.ino.wall.WallItemSticker.prototype.setColor=function(c,s){if(c!==this.getColor()){this.$().children(".flippable").find(".front, .back").toggleClass("sapInoWallWISticker"+this.getColor(),false);this.setProperty("color",c,true);this.$().children(".flippable").find(".front, .back").toggleClass("sapInoWallWISticker"+this.getColor(),true);var a=this.$().children(".flippable").find(".sapInoWallStickerColorPicker");a.removeClass("active");a.attr("aria-pressed","false");var A=this.$().children(".flippable").find(".sapInoWallStickerColorPicker.sapInoWallWISticker"+c);A.addClass("active");A.attr("aria-pressed","true");this._updateAssistiveTechnologyDescription();if(this.getParent()&&!s){this.getParent()._notifyItemChanged(this);}}return this;};sap.ino.wall.WallItemSticker.prototype.setTitle=function(t,s){if(this.getTitle()!==t){this.setProperty("title",t,true);if(sap.ino.wall.config.Config.getEnableRichtTextEditing()){this.$().children(".flippable").find(".front .sapInoWallWITitleText").html(sap.ino.wall.util.Formatter.nl2br(sap.ino.wall.util.Helper.stripTags(this.getProperty("title"),"<div><br><b><strong><u><i><em><ol><ul><li><font>")));}else{this.$().children(".flippable").find(".front .sapInoWallWITitleText").html(sap.ino.wall.util.Formatter.nl2br(jQuery.sap.encodeHTML(this.getProperty("title"))));}this._updateAssistiveTechnologyDescription();if(this.getParent()&&!s){this.getParent()._notifyItemChanged(this);}}return this;};sap.ino.wall.WallItemSticker.prototype.setMultiLine=function(m,s){this.setProperty("multiLine",m,true);return this;};sap.ino.wall.WallItemSticker.prototype.setFlipped=function(f,v){var t=sap.ui.getCore().byId(this.getId()+"-textEditor");if(t&&jQuery.type(t._getColorPicker)==="function"){var c=t._getColorPicker();if(c.isOpen()){c.close();}}sap.ino.wall.WallItemBase.prototype.setFlipped.apply(this,arguments);};sap.ino.wall.WallItemSticker.prototype.ontouchend=function(e){var t=sap.ui.getCore().byId(this.getId()+"-textEditor");if(t&&jQuery.type(t._getColorPicker)==="function"){var c=t._getColorPicker();if(c.isOpen()){c.close();}}if(sap.ino.wall.WallItemBase.prototype.ontouchend){sap.ino.wall.WallItemBase.prototype.ontouchend.apply(this,arguments);}};sap.ino.wall.WallItemSticker.prototype.onkeydown=function(e){if(!e.keyCode){return;}var t=sap.ui.getCore().byId(this.getId()+"-textEditor");if(t&&jQuery.type(t._getColorPicker)==="function"){var c=t._getColorPicker();if(c.isOpen()){c.close();}}if(jQuery(e.target).hasClass("sapInoWallStickerColorPicker")){if(e.keyCode===jQuery.sap.KeyCodes.ENTER||e.keyCode===jQuery.sap.KeyCodes.SPACE){var C=e.target.dataset.sapColor;this.setColor(C);e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();return;}}sap.ino.wall.WallItemBase.prototype.onkeydown.apply(this,arguments);if(!e.isDefaultPrevented()&&!e.isPropagationStopped()&&sap.ino.wall.config.Config.getEnableRichtTextEditing()){if(!jQuery(e.target).hasClass("nicEdit-main")){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();$(e.target).trigger("keydown",[e]);}}};sap.ino.wall.WallItemSticker.prototype._onResize=function(s,d,D){var S=this._adjustTShirtSize(),e=this._getTextareaDescription(),f,l,L;L=28;switch(S){case sap.ino.wall.TShirtSize.M:L=33;break;case sap.ino.wall.TShirtSize.L:case sap.ino.wall.TShirtSize.XL:L=53;break;default:break;}if(e instanceof sap.ino.wall.TextEditor){e.setControlDetails(S);}if(!jQuery.support.hasFlexBoxSupport||sap.ui.Device.browser.safari||sap.ui.Device.browser.firefox||sap.ui.Device.browser.internet_explorer&&sap.ui.Device.browser.version>=10){f=this.$().children(".flippable").find(".sapInoWallWIStickerPickerContainer").outerHeight()+this.$().find(".sapInoWallWIStickerMulti").outerHeight();this.$().children(".flippable").find(".back .sapInoWallWIStickerText").height(this.$().find(".back").height()-f-10);this.$().children(".flippable").find(".back .sapInoWallTextEditorContent").height(this.$().find(".back").height()-f-this.$().children(".flippable").find(".sapInoWallTextEditorControls").children().outerHeight()-30);this.$().children(".flippable").find(".sapInoWallWIStickerTextTA").css("padding-bottom","10px");}else{l=this.$().children(".flippable").find(".sapInoWallWIStickerPickerContainer").children().last().position().top-this.$().children(".flippable").find(".sapInoWallWIStickerPickerContainer").position().top;this.$().children(".flippable").find(".sapInoWallWIStickerPickerContainer").css("min-height",((Math.floor((l)/L)+1)*L)+"px");}};sap.ino.wall.WallItemSticker.prototype._getTextareaDescription=function(){var t=this,c=this.getAggregation("_textAreaDescription");if(!c){if(sap.ino.wall.config.Config.getEnableRichtTextEditing()){c=new sap.ino.wall.TextEditor(this.getId()+"-textEditor",{value:(this.getTitle()===this._oRB.getText("WALL_ITEMSTICKER_NEW_TEXT")?"<b></b>":sap.ino.wall.util.Formatter.escapeBindingCharacters(this.getTitle())),change:function(e){t.setTitle(e.getParameter("value"));}}).addStyleClass("noflip").addStyleClass("sapInoWallWIStickerTextTA");}else{c=new sap.m.TextArea({value:(this.getTitle()===this._oRB.getText("WALL_ITEMSTICKER_NEW_TEXT")?"":sap.ino.wall.util.Formatter.escapeBindingCharacters(this.getTitle())),change:function(e){t.setTitle(e.getParameter("value"));}}).addStyleClass("noflip").addStyleClass("sapInoWallWIStickerTextTA");}c.addEventDelegate({onsapenter:function(e){var T=sap.ui.getCore().byId(this.getId()+"-textEditor");if(!this.getMultiLine()){if(sap.ino.wall.config.Config.getEnableRichtTextEditing()){T.blur();e.preventDefault();}else{this.$().find("textarea").blur();}return false;}}.bind(this)});this.setAggregation("_textAreaDescription",c,true);}return c;};sap.ino.wall.WallItemSticker.prototype._updateAssistiveTechnologyDescription=function(){var d=this.$().find("#"+this.getId()+"-wallitem-description");var c=this._oRB.getText("CRTL_WALL_ITEMSTICKER_COLOR_"+(this.getColor()?this.getColor().toUpperCase():"YELLOW"));var t=sap.ino.wall.util.Helper.stripTags(this.getProperty("title"));if(t&&t.trim()!==""){d.html(this._oRB.getText("CRTL_WALL_ITEMSTICKER_EXP_READERTEXT",[c,t]));}else{d.html(this._oRB.getText("CRTL_WALL_ITEMSTICKER_EXP_READERTEXT_EMPTY",[c]));}};sap.ino.wall.WallItemSticker.prototype.formatToJSON=function(){var j=sap.ino.wall.WallItemBase.prototype.formatToJSON.call(this);j.color=this.getColor();j.description=this.getTitle();delete j.title;return j;};})();
