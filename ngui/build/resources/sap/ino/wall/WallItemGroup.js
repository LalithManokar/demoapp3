/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.WallItemGroup");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallItemBase");jQuery.sap.require("sap.ino.wall.util.Helper");jQuery.sap.require("sap.ino.wall.ColorPicker");sap.ino.wall.WallItemBase.extend("sap.ino.wall.WallItemGroup",{metadata:{properties:{"color":{type:"string",group:"Appearance",defaultValue:'#ffffff'}},aggregations:{"_buttonColorSelector":{type:"sap.m.Button",multiple:false,visibility:"hidden"},"_colorPicker":{type:"sap.ino.wall.ColorPicker",multiple:false,visibility:"hidden"}}}});sap.ino.wall.WallItemGroup.prototype.init=function(){sap.ino.wall.WallItemBase.prototype.init.call(this);this.setW("300px");this.setH("300px");this._recalculateItemDimensions=true;this.setResizable(true);};sap.ino.wall.WallItemGroup.prototype.onAfterRendering=function(){var l=sap.ino.wall.util.Helper.getColorLuminance(this.getColor()),b=sap.ui.getCore().byId(this.getId()+"-buttonColorSelector");sap.ino.wall.WallItemBase.prototype.onAfterRendering.apply(this,arguments);if(b){sap.ui.getCore().byId(this.getId()+"-buttonColorSelector").$().find(".sapMBtnInner").css("background-color",this.getColor());}if(l<=0.6){this._getButtonColorSelector().addStyleClass("sapInoWallWIGroupColorSelectorButtonBright").removeStyleClass("sapInoWallWIGroupColorSelectorButtonNormal");}else{this._getButtonColorSelector().addStyleClass("sapInoWallWIGroupColorSelectorButtonNormal").removeStyleClass("sapInoWallWIGroupColorSelectorButtonBright");}};sap.ino.wall.WallItemGroup.prototype.ontouchstart=function(e){sap.ino.wall.WallItemBase.prototype.ontouchstart.apply(this,arguments);};sap.ino.wall.WallItemGroup.prototype.setColor=function(c,s){var l,$=this.$().children(".flippable").children(".front"),a=this.$().children(".flippable").children(".back"),b=$.find(".sapInoWallWIGTitle").children(0),B=sap.ino.wall.util.Helper.transparentColor(sap.ino.wall.util.Helper.shadeColor(c,-30),30);if(c!==this.getColor()){this.setProperty("color",c,true);if(this._isRendered()){l=sap.ino.wall.util.Helper.getColorLuminance(sap.ino.wall.util.Helper.shadeColor(c,-20));$.css("border-color",c);$.css("background-color",B);a.css("border-color",c);a.css("background-color",B);b.css("background-color",sap.ino.wall.util.Helper.shadeColor(c,-20));b.css("color",(l<=0.6?"#F5F5F5":"#232323"));b.css("border-color",sap.ino.wall.util.Helper.shadeColor(c,-10));b.css("background-image",sap.ino.wall.util.Helper.addBrowserPrefix("linear-gradient(top, "+sap.ino.wall.util.Helper.shadeColor(c,5)+" 0%, "+sap.ino.wall.util.Helper.shadeColor(c,-5)+" 100%)"));sap.ui.getCore().byId(this.getId()+"-buttonColorSelector").$().find(".sapMBtnInner").css("background-color",c);if(l<=0.6){this._getButtonColorSelector().addStyleClass("sapInoWallWIGroupColorSelectorButtonBright").removeStyleClass("sapInoWallWIGroupColorSelectorButtonNormal");}else{this._getButtonColorSelector().addStyleClass("sapInoWallWIGroupColorSelectorButtonNormal").removeStyleClass("sapInoWallWIGroupColorSelectorButtonBright");}}if(this.getParent()&&!s){this.getParent()._notifyItemChanged(this);}}};sap.ino.wall.WallItemGroup.prototype.addChildWithoutRendering=function(i,s){var $=this.$().find(".sapInoWallWIGroupContent");if(!s){i.setX(Math.max(0,parseInt(i.getX(),10)-parseInt(this.getX(),10))+"px");i.setY(Math.max(0,parseInt(i.getY(),10)-parseInt(this.getY(),10))+"px");}this.addAggregation("childs",i,true);sap.ino.wall.util.Helper.renderItemIntoContainer($[0],i,false,true);return this;};sap.ino.wall.WallItemGroup.prototype.removeChildWithoutRerendering=function(i){i.setX(Math.max(0,parseInt(i.getX(),10)+parseInt(this.getX(),10))+"px");i.setY(Math.max(0,parseInt(i.getY(),10)+parseInt(this.getY(),10))+"px");this.removeAggregation("childs",i,true);i.$().remove();return this;};sap.ino.wall.WallItemGroup.prototype._onResize=function(s,d,D){var b,B,w,h,g=this.getChilds(),m=10,G=parseFloat(this.getW(),10),f=parseFloat(this.getH(),10),M,a,i=0;if(g.length===0){return;}if(this._recalculateItemDimensions){this._boundingBox=this.getParent()._calculateBoundingBox(g);if(!this._boundingBox){return;}this._recalculateItemDimensions=false;}b=this._boundingBox[1].getX()-this._boundingBox[0].getX();B=this._boundingBox[1].getY()-this._boundingBox[0].getY();w=G-b-this._boundingBox[0].getX()-m;h=f-B-this._boundingBox[0].getY()-m;if(w<0){if(this._boundingBox[0].getX()>m){for(;i<g.length;i++){g[i].setX(Math.max(m,parseInt(g[i].getX(),10)-Math.min(Math.abs(w),this._boundingBox[0].getX()))+"px");}this._recalculateItemDimensions=true;}M=(this._boundingBox[1].getX()-this._boundingBox[0].getX()+2*m);if(G-M<0){this.setW(M+"px");}}if(h<0){if(this._boundingBox[0].getY()>m){for(;i<g.length;i++){g[i].setY(Math.max(m,parseInt(g[i].getY(),10)-Math.min(Math.abs(h),this._boundingBox[0].getY()))+"px");}this._recalculateItemDimensions=true;}a=(this._boundingBox[1].getY()-this._boundingBox[0].getY()+2*m);if(f-a<0){this.setH(a+"px");}}};sap.ino.wall.WallItemGroup.prototype.formatToJSON=function(){var j=sap.ino.wall.WallItemBase.prototype.formatToJSON.apply(this),g=this.getChilds(),c,i=0;j.color=this.getColor();j.childs=[];for(;i<g.length;i++){c=sap.ino.wall.WallItemBase.prototype.formatToJSON.call(g[i]);j.childs.push(c);}return j;};sap.ino.wall.WallItemGroup.prototype._getButtonColorSelector=function(){var t=this,c=this.getAggregation("_buttonColorSelector");if(!c){c=new sap.m.Button(this.getId()+"-buttonColorSelector",{tooltip:this._oRB.getText("WALL_ITEMLINE_STATUSMSG_COLOR_SELECT"),press:function(e){var C=t._getColorPicker();if(C.isOpen()){C.close();}else{C.openBy(c,0,0);}},icon:"sap-icon://palette"}).addStyleClass("noflip").addStyleClass("sapInoWallWIGroupColorSelectorButton").addStyleClass("sapInoWallWIGroupColorSelectorButtonNormal");this.setAggregation("_buttonColorSelector",c,true);}return c;};sap.ino.wall.WallItemGroup.prototype._getColorPicker=function(){var t=this,c=this.getAggregation("_colorPicker");if(!c){c=new sap.ino.wall.ColorPicker(this.getId()+"-colorPicker",{color:this.getColor(),change:function(e){t.setColor(e.getParameter("color"));}});c.setPlacement(sap.m.PlacementType.Vertical);this.setAggregation("_colorPicker",c,true);}return c;};})();
