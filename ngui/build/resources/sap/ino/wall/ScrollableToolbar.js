/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.ScrollableToolbar");(function(){"use strict";sap.ui.core.Control.extend("sap.ino.wall.ScrollableToolbar",{metadata:{properties:{"visible":{type:"boolean",group:"Appearance",defaultValue:true},"orientation":{type:"string",group:"Appearance",defaultValue:"Horizontal"},"scrollStep":{type:"float",defaultValue:500},"scrollIntoView":{type:"boolean",defaultValue:true}},aggregations:{"content":{type:"sap.ui.core.Control",multiple:true,singularName:"content"}}}});sap.ino.wall.ScrollableToolbar.prototype._bDeviceDesktop=true;sap.ino.wall.ScrollableToolbar.prototype._bDoScroll=false;sap.ino.wall.ScrollableToolbar.prototype.init=function(){this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;this._iCurrentScrollLeft=0;this._iCurrentScrollTop=0;this._bRtl=sap.ui.getCore().getConfiguration().getRTL();this.startScrollX=0;this.startTouchX=0;this.startScrollY=0;this.startTouchY=0;this._scrollable=null;this._oItemNavigation=new sap.ui.core.delegate.ItemNavigation().setCycling(false);this._oItemNavigation.attachEvent(sap.ui.core.delegate.ItemNavigation.Events.AfterFocus,this._onItemNavigationAfterFocus,this);this.addDelegate(this._oItemNavigation);if(this._bDoScroll){jQuery.sap.require("sap.ui.core.delegate.ScrollEnablement");this._oScroller=new sap.ui.core.delegate.ScrollEnablement(this,this.getId()+"-head",{horizontal:(this.getOrientation()==="Horizontal"?true:false),vertical:(this.getOrientation()!=="Horizontal"?true:false),nonTouchScrolling:true});}};sap.ino.wall.ScrollableToolbar.prototype.exit=function(){if(this._oArrowLeft){this._oArrowLeft.destroy();}if(this._oArrowRight){this._oArrowRight.destroy();}if(this._oItemNavigation){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation;}if(this._oScroller){this._oScroller.destroy();this._oScroller=null;}if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);this._sResizeListenerId=null;}};sap.ino.wall.ScrollableToolbar.prototype.onBeforeRendering=function(){if(this._sResizeListenerId){sap.ui.core.ResizeHandler.deregister(this._sResizeListenerId);this._sResizeListenerId=null;}};sap.ino.wall.ScrollableToolbar.prototype._onItemNavigationAfterFocus=function(e){var h=this.getDomRef("head"),i=e.getParameter("index"),$=e.getParameter('event');if($.keyCode===undefined){return;}if(this.getOrientation()==="Horizontal"){this._iCurrentScrollLeft=h.scrollLeft;}else{this._iCurrentScrollTop=h.scrollTop;}this._checkOverflow(h,this.$());if(i!==null&&i!==undefined){this._scrollIntoView(this.getContent()[i]);}};sap.ino.wall.ScrollableToolbar.prototype._getFirstVisibleItem=function(I){for(var i=0;i<I.length;i++){if(I[i].getVisible()){return I[i];}}return null;};sap.ino.wall.ScrollableToolbar.prototype.onAfterRendering=function(){var t=this,h=this.getDomRef("head"),$=this.$(),i,T;if(this._oScroller){this._oScroller.setIconTabBar(this,jQuery.proxy(this._afterIscroll,this),jQuery.proxy(this._scrollPreparation,this));}if(this._bDoScroll){jQuery.sap.delayedCall(350,this,"_checkOverflow",[h,$]);}else{this._checkOverflow(h,$);}if(this.getOrientation()==="Horizontal"){if(this._iCurrentScrollLeft!==0&&!this._bDoScroll){setTimeout(function(){h.scrollLeft=t._iCurrentScrollLeft;},0);}}else{if(this._iCurrentScrollTop!==0&&!this._bDoScroll){setTimeout(function(){h.scrollTop=t._iCurrentScrollTop;},0);}}i=this.getContent();T=[];i.forEach(function(I){var o=I.getFocusDomRef();jQuery(o).attr("tabindex","-1");T.push(o);});if(!this._oItemNavigation){this._oItemNavigation=new sap.ui.core.delegate.ItemNavigation();this._oItemNavigation.attachEvent(sap.ui.core.delegate.ItemNavigation.Events.AfterFocus,this._onItemNavigationAfterFocus,this);this.addDelegate(this._oItemNavigation);}this._oItemNavigation.setRootDomRef(h);this._oItemNavigation.setItemDomRefs(T);this._sResizeListenerId=sap.ui.core.ResizeHandler.register(this.getDomRef(),jQuery.proxy(this._fnResize,this));};sap.ino.wall.ScrollableToolbar.prototype._checkScrolling=function(h,$){var s=false,d,a;if(this._bDoScroll){d=this.getDomRef("scrollContainer");a=this.getDomRef("head");if(this.getOrientation()==="Horizontal"){if(a.offsetWidth>d.offsetWidth){s=true;}}else{if(a.offsetHeight>d.offsetHeight){s=true;}}}else{if(h){if(this.getOrientation()==="Horizontal"){if(h.scrollWidth>h.clientWidth){s=true;}}else{if(h.scrollHeight>h.clientHeight){s=true;}}}}if(this._scrollable!==s){$.toggleClass("sapInoWallScrollableToolbarScrollable",s);$.toggleClass("sapInoWallScrollableToolbarNotScrollable",!s);this._scrollable=s;}return s;};sap.ino.wall.ScrollableToolbar.prototype._getScrollingArrow=function(n){var p={src:"sap-icon://navigation-"+n+"-arrow"},s=this._bTextOnly?"TextOnly":"",l="sapInoWallScrollableToolbarArrowScrollLeft"+s,r="sapInoWallScrollableToolbarArrowScrollRight"+s,c=["sapInoWallScrollableToolbarArrowScroll",l],C=["sapInoWallScrollableToolbarArrowScroll",r];if(n==="left"||n==="up"){if(!this._oArrowLeft){this._oArrowLeft=sap.m.ImageHelper.getImageControl(this.getId()+"-arrowScrollLeft",this._oArrowLeft,this,p,c);}return this._oArrowLeft;}if(n==="right"||n==="down"){if(!this._oArrowRight){this._oArrowRight=sap.m.ImageHelper.getImageControl(this.getId()+"-arrowScrollRight",this._oArrowRight,this,p,C);}return this._oArrowRight;}};sap.ino.wall.ScrollableToolbar.prototype._checkOverflow=function(b,$){var s,S,d,a,i,r,c,e,f,g,l;if(this._checkScrolling(b,$)&&b){s=false;S=false;if(this._bDoScroll){d=this.getDomRef("scrollContainer");a=this.getDomRef("head");if(this.getOrientation()==="Horizontal"){if(this._oScroller.getScrollLeft()>0){s=true;}if((this._oScroller.getScrollLeft()+d.offsetWidth)<a.offsetWidth){S=true;}}else{if(this._oScroller.getScrollTop()>0){s=true;}if((this._oScroller.getScrollTop()+d.offsetHeight)<a.offsetHeight){S=true;}}}else{if(this.getOrientation()==="Horizontal"){i=this._iCurrentScrollLeft;r=b.scrollWidth;c=b.clientWidth;if(Math.abs(r-c)===1){r=c;}if(!this._bRtl){if(i>0){s=true;}if((r>c)&&(i+c<r)){S=true;}}else{l=jQuery(b);if(l.scrollLeftRTL()>0){S=true;}if(l.scrollRightRTL()>0){s=true;}}}else{e=this._iCurrentScrollTop;f=b.scrollHeight;g=b.clientHeight;if(Math.abs(f-g)===1){f=g;}if(e>0){s=true;}if((f>g)&&(e+g<f)){S=true;}}}if((S!==this._bPreviousScrollForward)||(s!==this._bPreviousScrollBack)){this._bPreviousScrollForward=S;this._bPreviousScrollBack=s;$.toggleClass("sapInoWallScrollableToolbarNoScrollBack",!s);$.toggleClass("sapInoWallScrollableToolbarNoScrollForward",!S);}}else{this._bPreviousScrollForward=false;this._bPreviousScrollBack=false;}};sap.ino.wall.ScrollableToolbar.prototype._handleActivation=function(e){var t=e.target.id,c=e.srcControl,C,i,s,S,a,b,h,H;if(t){i=this.getId();e.preventDefault();if(t===i+"-arrowScrollLeft"&&this._bDeviceDesktop){if(this._bDoScroll&&sap.ui.Device.os.windows&&sap.ui.Device.os.version===8){if(this.getOrientation()==="Horizontal"){s=this._oScroller.getScrollLeft()-this.getScrollStep();if(s<0){s=0;}}else{S=this._oScroller.getScrollTop()-this.getScrollStep();if(S<0){S=0;}}this._scrollPreparation();jQuery.sap.delayedCall(0,this._oScroller,"scrollTo",[s,0,500]);jQuery.sap.delayedCall(500,this,"_afterIscroll");}else{this._scroll(-this.getScrollStep(),500);}}else if(t===i+"-arrowScrollRight"&&this._bDeviceDesktop){if(this._bDoScroll&&sap.ui.Device.os.windows&&sap.ui.Device.os.version===8){if(this.getOrientation()==="Horizontal"){s=this._oScroller.getScrollLeft()+this.getScrollStep();a=this.$("scrollContainer").width();h=this.$("head").width();if(s>(h-a)){s=h-a;}}else{S=this._oScroller.getScrollTop()+this.getScrollStep();b=this.$("scrollContainer").height();H=this.$("head").height();if(S>(H-b)){S=H-b;}}this._scrollPreparation();jQuery.sap.delayedCall(0,this._oScroller,"scrollTo",[s,0,500]);jQuery.sap.delayedCall(500,this,"_afterIscroll");}else{this._scroll(this.getScrollStep(),500);}}else{if(!(c instanceof sap.ino.wall.ScrollableToolbar)){C=c;while(C&&!(C.getParent()instanceof sap.ino.wall.ScrollableToolbar)){C=C.getParent();}if(C){this._scrollIntoView(C);}}}}};sap.ino.wall.ScrollableToolbar.prototype._scrollIntoView=function(i,d){if(!this.getScrollIntoView()){return this;}var $=i.$(),a,h,H,s,n,c,I,b,S,N,C,e,f;if($.length>0){if(this.getOrientation()==="Horizontal"){a=this.$('head');h=a.innerWidth()-a.width();I=$.outerWidth(true);b=$.position().left-h/2;if(this._bDoScroll){s=this._oScroller.getScrollLeft();c=this.$("scrollContainer").width();n=0;if(b-s<0||b-s>c-I){if(b-s<0){n+=b;}else{n+=b+I-c;}this._scrollPreparation();this._iCurrentScrollLeft=n;jQuery.sap.delayedCall(0,this._oScroller,"scrollTo",[n,0,d]);jQuery.sap.delayedCall(d,this,"_afterIscroll");}}else{H=this.getDomRef("head");s=H.scrollLeft;c=$.parent().width();n=s;if(b<0||b>c-I){if(b<0){n+=b;}else{n+=b+I-c;}this._scrollPreparation();this._iCurrentScrollLeft=n;jQuery(H).stop(true,true).animate({scrollLeft:n},d,jQuery.proxy(this._adjustAndShowArrow,this));}}}else{e=$.outerHeight(true);f=$.position().top;if(this._bDoScroll){S=this._oScroller.getScrollTop();C=this.$("scrollContainer").height();N=0;if(f-S<0||f-S>C-e){if(f-S<0){N+=f;}else{N+=f+e-C;}this._scrollPreparation();this._iCurrentScrollTop=N;jQuery.sap.delayedCall(0,this._oScroller,"scrollTo",[0,N,d]);jQuery.sap.delayedCall(d,this,"_afterIscroll");}}else{H=this.getDomRef("head");S=H.scrollTop;C=$.parent().height();N=S;if(f<0||f>C-e){if(f<0){N+=f;}else{N+=f+e-C;}this._scrollPreparation();this._iCurrentScrollTop=N;jQuery(H).stop(true,true).animate({scrollTop:N},d,jQuery.proxy(this._adjustAndShowArrow,this));}}}}return this;};sap.ino.wall.ScrollableToolbar.prototype._scroll=function(d,D){var o,s,S,i;this._scrollPreparation();o=this.getDomRef("head");if(this.getOrientation()==="Horizontal"){s=o.scrollLeft;if(!!!sap.ui.Device.browser.internet_explorer&&this._bRtl){d=-d;}i=s+d;jQuery(o).stop(true,true).animate({scrollLeft:i},D,jQuery.proxy(this._adjustAndShowArrow,this));this._iCurrentScrollLeft=i;}else{S=o.scrollTop;if(!!!sap.ui.Device.browser.internet_explorer&&this._bRtl){d=-d;}i=S+d;jQuery(o).stop(true,true).animate({scrollTop:i},D,jQuery.proxy(this._adjustAndShowArrow,this));this._iCurrentScrollTop=i;}};sap.ino.wall.ScrollableToolbar.prototype._adjustAndShowArrow=function(){if(this._$bar){this._$bar.toggleClass("sapInoWallScrollableToolbarScroll",false);}this._$bar=null;if(this._bDeviceDesktop){this._checkOverflow(this.getDomRef("head"),this.$());}};sap.ino.wall.ScrollableToolbar.prototype._scrollPreparation=function(){if(!this._$bar){this._$bar=this.$().toggleClass("sapInoWallScrollableToolbarScroll",true);}};sap.ino.wall.ScrollableToolbar.prototype._afterIscroll=function(){var h=this.getDomRef("head");this._checkOverflow(h,this.$());this._adjustAndShowArrow();};sap.ino.wall.ScrollableToolbar.prototype._fnResize=function(){var h=this.getDomRef("head");this._checkOverflow(h,this.$());};sap.ino.wall.ScrollableToolbar.prototype.applyFocusInfo=function(f){if(f.focusDomRef){jQuery(f.focusDomRef).focus();}};sap.ino.wall.ScrollableToolbar.prototype.ontouchstart=function(e){if(e.target!=this._oArrowLeft.$()[0]&&e.target!=this._oArrowRight.$()[0]){return;}var t=e.targetTouches[0];this._iActiveTouch=t.identifier;this._iTouchStartPageX=t.pageX;this._iTouchDragX=0;this._iTouchStartPageY=t.pageY;this._iTouchDragY=0;};sap.ino.wall.ScrollableToolbar.prototype.ontouchmove=function(e){if(e.target!=this._oArrowLeft.$()[0]&&e.target!=this._oArrowRight.$()[0]){return;}var t;if(!this._iActiveTouch){return;}t=sap.m.touch.find(e.changedTouches,this._iActiveTouch);if(this.getOrientation()==="Horizontal"){if(!t||t.pageX===this._iTouchStartPageX){return;}this._iTouchDragX+=Math.abs(this._iTouchStartPageX-t.pageX);this._iTouchStartPageX=t.pageX;}else{if(!t||t.pageY===this._iTouchStartPageY){return;}this._iTouchDragY+=Math.abs(this._iTouchStartPageY-t.pageY);this._iTouchStartPageY=t.pageY;}};sap.ino.wall.ScrollableToolbar.prototype.validate=function(){var t=this;setTimeout(function(){var h=t.getDomRef("head");t._iCurrentScrollTop=h.scrollTop;t._iCurrentScrollLeft=h.scrollLeft;t._checkOverflow(h,t.$());},500+250);};sap.ino.wall.ScrollableToolbar.prototype.ontouchend=function(e){if(e.target!=this._oArrowLeft.$()[0]&&e.target!=this._oArrowRight.$()[0]){return;}if(this.getOrientation()==="Horizontal"){if(this._iTouchDragX>5||e.isMarked()){return;}}else{if(this._iTouchDragY>5||e.isMarked()){return;}}this._handleActivation(e);};sap.ino.wall.ScrollableToolbar.prototype.ontouchcancel=sap.ino.wall.ScrollableToolbar.prototype.ontouchend;sap.ino.wall.ScrollableToolbar.prototype.onsapselect=function(e){this._handleActivation(e);};})();
