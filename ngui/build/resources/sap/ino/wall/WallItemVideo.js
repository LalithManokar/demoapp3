/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.WallItemVideo");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallItemBase");jQuery.sap.require("sap.ino.wall.util.Formatter");sap.ino.wall.WallItemBase.extend("sap.ino.wall.WallItemVideo",{metadata:{properties:{"status":{type:"string",group:"Behavior",defaultValue:'Normal'},"preview":{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null},"video":{type:"sap.ui.core.URI",group:"Behavior",defaultValue:null}},aggregations:{"textAreaDescription":{type:"sap.m.TextArea",multiple:false,visibility:"hidden"},"imagePreview":{type:"sap.m.Image",multiple:false,visibility:"hidden"},"_busyIndicator":{type:"sap.m.BusyIndicator",multiple:false,visibility:"hidden"},"_inputVideo":{type:"sap.m.Input",multiple:false,visibility:"hidden"}}}});sap.ino.wall.WallItemVideo.prototype.setPreview=function(u){var o=this.getAggregation("imagePreview");this.setProperty("preview",u,false);if(o){o.destroy(true);}this.setAggregation("imagePreview",new sap.m.Image({src:u,densityAware:false}),true);this.getAggregation("imagePreview").setWidth("240px");if(!this.getAggregation("imagePreview")||!this.getAggregation("imagePreview").getSrc()){this.setAggregation("imagePreview",new sap.m.Image({src:"",densityAware:false,decorative:true}).addStyleClass("sapInoWallWIVVideoError"),true);}if(this._isRendered()){this._renderItemIntoContainer(this.$().find("#"+this.getId()+"-imagePreviewWrapper"),this.getAggregation("imagePreview"),true,false);if(this.getParent()){this.getParent()._notifyItemChanged(this);}}return this;};sap.ino.wall.WallItemVideo.prototype.setVideo=function(u){var o=this.getAggregation("imagePreview"),v=null,V=null;if(u&&u.indexOf("http://")!=0&&u.indexOf("https://")!=0&&u.indexOf("mailto:")!=0){u="http://"+u;}if(jQuery.sap.validateUrl(u)){this.setProperty("video",u,false);if(o){o.destroy();}this._getInputVideo().setValueState("None");if(/www\.youtube\.com/.test(u)){v=/www\.youtube\.com\/watch\?v=([^&]+)/.exec(u);if(!v){v=/www\.youtube\.com\/v\/([^&]+)/.exec(u);}if(!v){v=/www\.youtube\.com\/embed\/([^?]+)/.exec(u);}if(v){V=v[1];this.setPreview("https://img.youtube.com/vi/"+V+"/mqdefault.jpg");}}else if(/youtu\.be/.test(u)){v=/youtu\.be\/([^?]+)/.exec(u);if(v){V=v[1];this.setPreview("https://img.youtube.com/vi/"+V+"/mqdefault.jpg");}}}else{this._getInputVideo().setValueState("Error");}return this;};sap.ino.wall.WallItemVideo.prototype.setTitle=function(t,s){sap.ino.wall.WallItemBase.prototype.setTitle.apply(this,[t,s]);if(t!==this._oRB.getText("WALL_ITEMVIDEO_NEW_TEXT")){this._getInputTitle().setProperty("value",t,true);this._getInputTitle().$().children("input").attr("value",t);}};sap.ino.wall.WallItemVideo.prototype._getBusyIndicator=function(){var b=this.getAggregation("_busyIndicator");if(!b){b=new sap.m.BusyIndicator(this.getId()+"-busy").addStyleClass("sapInoWallIndicatorBusy");this.setAggregation("_busyIndicator",b,true);}return b;};sap.ino.wall.WallItemVideo.prototype._getImagePreview=function(){var p=this.getAggregation("imagePreview");if(!p){p=new sap.m.Image({src:"",densityAware:false}).addStyleClass("sapInoWallWIVVideoDefault");this.setAggregation("imagePreview",p,true);}return p;};sap.ino.wall.WallItemVideo.prototype._getInputVideo=function(){var t=this,i=this.getAggregation("_inputVideo");if(!i){i=new sap.m.Input({value:sap.ino.wall.util.Formatter.escapeBindingCharacters(this.getVideo()),placeholder:this._oRB.getText("WALL_ITEMVIDEO_PLACEHOLDER_LINK"),change:function(e){t.setVideo(e.getParameter("newValue"));}}).addStyleClass("sapInoWallWIVVideo");this.setAggregation("_inputVideo",i,true);}return i;};sap.ino.wall.WallItemVideo.prototype.setStatus=function(s){this.setProperty("status",s,true);if(this._isRendered()){if(this.getStatus()==="Busy"){sap.ui.getCore().byId(this.getId()+"-busy").removeStyleClass("sapInoWallInvisible");sap.ui.getCore().byId(this.getId()+"-preview").addStyleClass("sapInoWallImageBusy");}else{sap.ui.getCore().byId(this.getId()+"-busy").addStyleClass("sapInoWallInvisible");sap.ui.getCore().byId(this.getId()+"-preview").removeStyleClass("sapInoWallImageBusy");}}};sap.ino.wall.WallItemVideo.prototype.formatToJSON=function(){var j=sap.ino.wall.WallItemBase.prototype.formatToJSON.call(this);j.content.video=this.getVideo();j.content.preview=this.getPreview();return j;};})();
