/*!
 * SAP Innovation Management (c) Copyright 2014 SAP AG. All rights reserved.
 */
jQuery.sap.declare("sap.ino.wall.WallItemLink");(function(){"use strict";jQuery.sap.require("sap.ino.wall.WallItemBase");jQuery.sap.require("sap.ino.wall.util.Formatter");jQuery.sap.require("sap.ino.wall.LinkType");sap.ino.wall.WallItemBase.extend("sap.ino.wall.WallItemLink",{metadata:{properties:{"type":{type:"sap.ino.wall.LinkType",group:"Misc",defaultValue:'MISC'},"description":{type:"string",group:"Misc",defaultValue:null}},aggregations:{"_icon":{type:"sap.ui.core.Icon",multiple:false,visibility:"hidden"},"_inputLink":{type:"sap.m.Input",multiple:false,visibility:"hidden"},"_selectType":{type:"sap.m.Select",multiple:false,visibility:"hidden"}}}});sap.ino.wall.WallItemLink.prototype.getLinkText=function(){return this.getDescription().replace("https://www.","").replace("http://www.","").replace("http://","").replace("https://","").replace("mailto://","");};sap.ino.wall.WallItemLink.prototype._getIcon=function(){var t=this,i=this.getAggregation("_icon"),I,s;switch(this.getType()){case sap.ino.wall.LinkType.COLLABORATE:s="85px";I=sap.ui.core.IconPool.getIconURI("collaborate");break;case sap.ino.wall.LinkType.WIKI:s="80px";I=sap.ui.core.IconPool.getIconURI("documents");break;case sap.ino.wall.LinkType.PRIVATE:s="95px";I=sap.ui.core.IconPool.getIconURI("private");break;case sap.ino.wall.LinkType.WALL:s="70px";I=sap.ui.core.IconPool.getIconURI("full-stacked-chart");break;case sap.ino.wall.LinkType.IDEA:s="75px";I=sap.ui.core.IconPool.getIconURI("lightbulb");break;case sap.ino.wall.LinkType.MISC:default:s="103px";I=sap.ui.core.IconPool.getIconURI("world");}if(!i){i=new sap.ui.core.Icon({color:"#e6e6e6",activeColor:"#e6e6e6",press:function(){var p=this.getParent(),d=this.getDescription();if(p instanceof sap.ino.wall.WallItemBase){p=p.getParent();}if(!this._bMoving&&!p._hasFollowCursorItems()){if(d&&d!=="http://"&&d!=="https://"&&d!=="file://"){var w=window.open(d,'_blank');w.opener=null;}else{if(!(this.getParent()instanceof sap.ino.wall.WallItemBase&&!(this.getParent()instanceof sap.ino.wall.WallItemGroup))){this.setFlipped(true);}}}}.bind(this)});i.addStyleClass("sapInoWallWILIcon").addStyleClass("noflip");this.setAggregation("_icon",i,true);}if(i.getSrc()!==I){i.setSrc(I);i.setSize(s);}return i;};sap.ino.wall.WallItemLink.prototype.onkeydown=function(e){var d=this.getDescription();if(jQuery(e.target).hasClass("sapInoWallWIB")&&d&&d!=="http://"&&d!=="https://"&&((e.ctrlKey&&e.keyCode===jQuery.sap.KeyCodes.ENTER)||e.keyCode===jQuery.sap.KeyCodes.SPACE)){var w=window.open(d,'_blank');w.opener=null;e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();}else{sap.ino.wall.WallItemBase.prototype.onkeydown.apply(this,arguments);}};sap.ino.wall.WallItemLink.prototype._getSelectType=function(){var t=this,s=this.getAggregation("_selectType"),S=null,I,a,T=this.getType(),k=null,i=0;if(!s){s=new sap.m.Select(this.getId()+"-type",{width:"100%",change:function(e){t.setType(e.getParameter("selectedItem").getKey());}}).addStyleClass("sapInoWallWIBSelect").addStyleClass("noflip").addEventDelegate({onsapenter:function(e){e.preventDefault();e.stopPropagation();}});for(k in sap.ino.wall.LinkType){if(sap.ino.wall.LinkType.hasOwnProperty(k)){I=new sap.ui.core.Item({key:sap.ino.wall.LinkType[k],text:this._oRB.getText("WALL_ITEMLINK_TYPE_"+sap.ino.wall.LinkType[k])});s.addItem(I);if(T===k&&!S){S=I.getId();}}}s.setSelectedItem(S);s.addDelegate({onAfterRendering:this._afterSelectOpen});this.setAggregation("_selectType",s,true);}else{a=s.getItems();for(;i<a.length;i++){if(a[i].getKey()===T){s.setSelectedItem(a[i]);break;}}}return s;};sap.ino.wall.WallItemLink.prototype._getInputLink=function(){var t=this,c=this.getAggregation("_inputLink");if(!c){c=new sap.m.Input({value:sap.ino.wall.util.Formatter.escapeBindingCharacters(sap.ino.wall.util.Formatter.escapeNetworkPaths(this.getDescription())),placeholder:this._oRB.getText("WALL_ITEMLINK_PLACEHOLDER_LINK"),change:function(e){var u=e.getParameter("newValue");if(u&&u.indexOf("http://")!=0&&u.indexOf("https://")!=0&&u.indexOf("mailto:")!=0){u="http://"+u;this.setValue(u);}t.setDescription(u);}}).addStyleClass("sapInoWallWILLinkIP");this.setAggregation("_inputLink",c,true);}return c;};sap.ino.wall.WallItemLink.prototype.setDescription=function(t){this.setProperty("description",t,true);t=this.getDescription();this.$().find(".front .sapInoWallWILDescriptionLink").attr("href",t);this.$().find(".front .sapInoWallWILLinkText").text(this.getLinkText());if(this.getParent()){this.getParent()._notifyItemChanged(this);}return this;};sap.ino.wall.WallItemLink.prototype.setType=function(t){var d=this.getDomRef("icon"),o=this.getType();this.setProperty("type",t,true);if(t!==o&&d){this._renderItemIntoContainer(d,this._getIcon(),true,false);}if(this.getParent()){this.getParent()._notifyItemChanged(this);}return this;};sap.ino.wall.WallItemLink.prototype.formatToJSON=function(){var j=sap.ino.wall.WallItemBase.prototype.formatToJSON.call(this);j.type=this.getType();j.description=this.getDescription();return j;};})();
