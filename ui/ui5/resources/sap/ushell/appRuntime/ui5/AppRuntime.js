// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
prepareModules();sap.ui.define(["sap/base/util/LoaderExtensions","sap/ushell/appRuntime/ui5/AppRuntimePostMessageAPI","sap/ushell/appRuntime/ui5/AppCommunicationMgr","sap/ushell/appRuntime/ui5/AppRuntimeService","sap/ui/thirdparty/URI","sap/ushell/appRuntime/ui5/SessionHandlerAgent","sap/ushell/appRuntime/ui5/services/AppLifeCycleAgent","sap/ushell/appRuntime/ui5/services/ShellUIService","sap/ushell/ui5service/UserStatus","sap/ushell/appRuntime/ui5/services/AppConfiguration","sap/ushell/appRuntime/ui5/services/UserInfo","sap/ui/core/Popup","sap/ui/thirdparty/jquery","sap/base/util/isEmptyObject","sap/base/Log","sap/ui/core/ComponentContainer","sap/ushell/appRuntime/ui5/renderers/fiori2/AccessKeysAgent","sap/ui/core/BusyIndicator","sap/ushell/iconfonts","sap/ushell/utils/WindowUtils"],function(L,A,a,b,U,S,c,d,f,g,h,P,q,i,j,C,k,B,I,W){"use strict";var _,p=new U().search(true),s,u=false,o,l=false,m={},n;function r(){this.main=function(){q("body").css("height","100%").css("width","100%");a.init(true);this.getPageConfig();Promise.all([c.getURLParameters(_._getURI())]).then(function(e){var y=e[0],z=y["sap-ui-app-id"];_.setModulePaths();_.init();Promise.all([_.initServicesContainer(),_.getAppInfo(z)]).then(function(e){var D=e[1];S.init();k.init();_.createApplication(z,y,D).then(function(E){_.renderApplication(E);});});});};this._getURI=function(){return new U().query(true);};this.init=function(){I.registerFiori2IconFont();A.registerCommHandlers({"sap.ushell.appRuntime":{oServiceCalls:{"hashChange":{executeServiceCallFn:function(e){var H=e.oMessageData.body.sHash,y=sap.ushell.Container.getService("URLParsing");if(typeof H==="string"){var N=y.parseShellHash(H),O=y.parseShellHash(window.hasher.getHash());if(N&&O&&N.semanticObject===O.semanticObject&&N.action===O.action){window.hasher.replaceHash(H);}}return new q.Deferred().resolve().promise();}},"setDirtyFlag":{executeServiceCallFn:function(e){var y=e.oMessageData.body.bIsDirty;if(y!==sap.ushell.Container.getDirtyFlag()){sap.ushell.Container.setDirtyFlag(y);}return new q.Deferred().resolve().promise();}},"themeChange":{executeServiceCallFn:function(e){var y=e.oMessageData.body.currentThemeId;sap.ushell.Container.getUser().setTheme(y);return new q.Deferred().resolve().promise();}},"buttonClick":{executeServiceCallFn:function(e){sap.ushell.renderers.fiori2.Renderer.handleHeaderButtonClick(e.oMessageData.body.buttonId);return new q.Deferred().resolve().promise();}},"executeLogoutFunctions":{executeServiceCallFn:function(e){return sap.ushell.Container.executeAsyncAndSyncLogoutFunctions();}},"uiDensityChange":{executeServiceCallFn:function(e){var y=e.oMessageData.body.isTouch;q("body").toggleClass("sapUiSizeCompact",(y==="0")).toggleClass("sapUiSizeCozy",(y==="1"));return new q.Deferred().resolve().promise();}},"handleDirtyStateProvider":{executeServiceCallFn:function(e){return new q.Deferred().resolve(sap.ushell.Container.handleDirtyStateProvider(e.oMessageData.body.oNavigationContext)).promise();}}}}});};this.handleLinkElementOpen=function(F,e){try{if(e.isDefaultPrevented&&e.isDefaultPrevented()===true){return;}var T=e.target;if(T&&T.tagName==="A"&&T.href&&T.href.indexOf('#')>0){if(T.target==="_blank"){var N=_.rebuildNewAppUrl(T.href,F);if(N!==T.href){W.openURL(N);e.preventDefault();}}else if(T.target===undefined||T.target===""){var y=T.href.split("#"),z=document.URL.split("#");if(y[0]===z[0]){var D=y[1]&&y[1].split("&/"),E=z[1]&&z[1].split("&/");if(typeof D[0]==="string"&&typeof E[0]==="string"&&D[0]!==E[0]){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(H){H.toExternal({target:{shellHash:y[1]}});});e.preventDefault();}}}}}catch(G){}};this.rebuildNewAppUrl=function(T,F){var e=T.split('#');if(e[0].length===0||e[0]===document.URL.split('#')[0]){return F+"#"+e[1];}return T;};this.getStartupPlugins=function(){return m;};this.inIframe=function(){try{return window.self!==window.top;}catch(e){return true;}};this.getPageConfig=function(){var e,y={};e=q("meta[name='sap.ushellConfig.ui5appruntime']")[0];if(e!==undefined){y=JSON.parse(e.content);}window["sap-ushell-config"]=q.extend(true,{},t(),y);};this.setModulePaths=function(){if(window["sap-ushell-config"].modulePaths){var e=Object.keys(window["sap-ushell-config"].modulePaths);for(var y in e){(function(){var z={};z[e[y].replace(/\./g,"/")]=window["sap-ushell-config"].modulePaths[e[y]];sap.ui.loader.config({paths:z});}());}}};this.initServicesContainer=function(){return new Promise(function(R){sap.ui.require(["sap/ushell/appRuntime/ui5/services/Container"],function(e){e.bootstrap("apprt",{apprt:"sap.ushell.appRuntime.ui5.services.adapters"}).then(function(){sap.ushell.Container.getFLPUrlAsync().then(function(F){q(document).on("click.appruntime",_.handleLinkElementOpen.bind(_,F));q(document).on("keydown.appruntime",function(y){if(y.code==="Enter"){return _.handleLinkElementOpen(F,y);}});});R();});});});};this._getURIParams=function(){return p;};this.getAppInfo=function(e){var D=window["sap-ushell-config"].ui5appruntime.config.appIndex.data,M=window["sap-ushell-config"].ui5appruntime.config.appIndex.module;return new Promise(function(R){if(D&&!i(D)){c.init(M,_.createApplication.bind(_),_.renderApplication.bind(_),e,D);R(D);}else{c.init(M,_.createApplication.bind(_),_.renderApplication.bind(_));c.getAppInfo(e).then(function(y){R(y);});}});};this.setApplicationParameters=function(e,y){var z,D,E,F=new q.Deferred();function G(H,J){var K="";if(H&&H.length>0){K=(H.startsWith("?")?"":"?")+H;}if(J&&J.length>0){K+=(K.length>0?"&":"?")+J;}return K;}if(y.hasOwnProperty("sap-startup-params")){z=(new U("?"+y["sap-startup-params"])).query(true);if(z.hasOwnProperty("sap-intent-param")){D=z["sap-intent-param"];delete z["sap-intent-param"];}E=(new U("?")).query(z).toString();if(D){b.sendMessageToOuterShell("sap.ushell.services.CrossApplicationNavigation.getAppStateData",{"sAppStateKey":D}).then(function(M){e.url+=G(E,M);F.resolve();},function(H){e.url+=G(E);F.resolve();});}else{e.url+=G(E);F.resolve();}}else{F.resolve();}return F.promise();};this.setHashChangedCallback=function(){function e(y,z){if(window.hasher.disableCFLPUpdate===true){return;}if(y&&typeof y==="string"&&y.length>0){if(z&&typeof z==="string"&&z.length>0){var T=y.split("&/"),D=z.split("&/");if(T[0]!==D[0]){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(E){E.toExternal({target:{shellHash:y}});});return;}}b.sendMessageToOuterShell("sap.ushell.appRuntime.hashChange",{"newHash":y});}}window.hasher.changed.add(e.bind(this),this);};this.createApplication=function(e,y,z){var D=sap.ushell.Container.getService("URLParsing"),H=D.getHash(window.location.href);var E=D.parseShellHash(H);var F=function(G){b.sendMessageToOuterShell("sap.ushell.services.ShellUIService.showShellUIBlocker",{"bShow":G.getParameters().visible});};return new Promise(function(R){var G=new C({id:e+"-content",width:"100%",height:"100%"});G.addStyleClass("sapAppRuntimeBaseStyle");var J="0";if(p.hasOwnProperty("sap-touch")){J=p["sap-touch"];if(J!=="0"&&J!=="1"){J="0";}}q("body").toggleClass("sapUiSizeCompact",(J==="0")).toggleClass("sapUiSizeCozy",(J==="1"));if(!s){sap.ushell.renderers.fiori2.utils.init();s=sap.ushell.Container.getService("ShellNavigation");s.init(function(){});}if(n===undefined){n=new d({scopeObject:G,scopeType:"component"});new f({scopeObject:G,scopeType:"component"});c.setShellUIService(n);}if(P.attachBlockLayerStateChange){P.attachBlockLayerStateChange(F);}_.setApplicationParameters(z,y).done(function(){_.setHashChangedCallback();sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(K){K.createComponent({ui5ComponentName:e,applicationDependencies:z,url:z.url},E,false).then(function(M){sap.ushell.Container.getServiceAsync("AppLifeCycle").then(function(N){N.prepareCurrentAppObject("UI5",M.componentHandle.getInstance(),false,undefined);try{var O=N.getCurrentApplication();var Q=M.componentHandle.getMetadata();var z={};z.appVersion=Q.getVersion();Promise.all([O.getTechnicalParameter("sap-fiori-id"),O.getTechnicalParameter("sap-ach")]).then(function(V){if(Array.isArray(V[0])&&V[0][0]){z.appId=V[0][0];}if(Array.isArray(V[1])&&V[1][0]){z.appSupportInfo=V[1][0];}z.appFrameworkId="UI5";z.technicalAppComponentId=z.ui5ComponentName;b.sendMessageToOuterShell("sap.ushell.services.AppLifeCycle.setNewAppInfo",{info:z});});}catch(T){}});_.overrideUrlHelperFuncs();_.loadPlugins();R({oComponentContainer:G,oResolutionResultWithComponentHandle:M});});});});});};this.overrideUrlHelperFuncs=function(){if(u===true){return;}u=true;if(sap.m&&sap.m.URLHelper){sap.m.URLHelper.triggerEmail=function(T,e,y,z,D){b.sendMessageToOuterShell("sap.ushell.services.ShellUIService.sendEmail",{sTo:T,sSubject:e,sBody:y,sCc:z,sBcc:D,sIFrameURL:document.URL,bSetAppStateToPublic:true});};o=sap.m.URLHelper.redirect;sap.m.URLHelper.redirect=function(e,N){if(e&&N===true&&e.indexOf('#')>=0){sap.ushell.Container.getFLPUrlAsync().then(function(F){var y=_.rebuildNewAppUrl(e,F);o.call(sap.m.URLHelper,y,N);});}else{o.call(sap.m.URLHelper,e,N);}};}};this.loadPlugins=function(){if(l===true){return;}w();x();l=true;sap.ushell.Container.getServiceAsync("PluginManager").then(function(e){e.loadPlugins("RendererExtensions");});};function w(){sap.ushell.Container.getService("PluginManager").registerPlugins({RTAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.rtaAgent",url:q.sap.getResourcePath("sap/ushell/appRuntime/ui5/plugins/rtaAgent"),config:{"sap-plugin-agent":true}}});}function x(){var e;if(p.hasOwnProperty("sap-wa-debug")&&p["sap-wa-debug"]=="dev"){e="https://education3.hana.ondemand.com/education3/web_assistant/framework/FioriAgent.js";}else if(p.hasOwnProperty("sap-wa-debug")&&p["sap-wa-debug"]=="prev"){e="https://webassistant-outlook.enable-now.cloud.sap/web_assistant/framework/FioriAgent.js";}else{e="https://webassistant.enable-now.cloud.sap/web_assistant/framework/FioriAgent.js";}sap.ushell.Container.getService("PluginManager").registerPlugins({WAPluginAgent:{component:"sap.ushell.appRuntime.ui5.plugins.scriptAgent",url:q.sap.getResourcePath("sap/ushell/appRuntime/ui5/plugins/scriptAgent"),config:{"sap-plugin-agent":true,"url":e}}});}this.renderApplication=function(e){e.oComponentContainer.setComponent(e.oResolutionResultWithComponentHandle.componentHandle.getInstance()).placeAt("content");B.hide();window.setTimeout(function(){if(e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active){e.oResolutionResultWithComponentHandle.componentHandle.getInstance().active();}},0);c.setComponent(e.oComponentContainer);};}function t(){return{services:{CrossApplicationNavigation:{module:"sap.ushell.appRuntime.ui5.services.CrossApplicationNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},NavTargetResolution:{module:"sap.ushell.appRuntime.ui5.services.NavTargetResolution",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},ShellNavigation:{module:"sap.ushell.appRuntime.ui5.services.ShellNavigation",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppConfiguration:{module:"sap.ushell.appRuntime.ui5.services.AppConfiguration"},Bookmark:{module:"sap.ushell.appRuntime.ui5.services.Bookmark",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},LaunchPage:{module:"sap.ushell.appRuntime.ui5.services.LaunchPage",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},UserInfo:{module:"sap.ushell.appRuntime.ui5.services.UserInfo",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},AppState:{module:"sap.ushell.appRuntime.ui5.services.AppState",adapter:{module:"sap.ushell.appRuntime.ui5.services.adapters.EmptyAdapter"}},PluginManager:{module:"sap.ushell.appRuntime.ui5.services.PluginManager",config:{isBlueBox:true}},Ui5ComponentLoader:{config:{amendedLoading:false}}}};}var v=new r();_=v;v.main();return v;});
function prepareModules(){"use strict";sap.ui.require(["sap/ui/core/BusyIndicator"],function(B){B.show(0);});if(document.URL.indexOf("ui5appruntime")>0){sap.ui.define("sap/ushell/ApplicationType",[],function(){return{URL:{type:"URL"},WDA:{type:"WDA"},TR:{type:"TR"},NWBC:{type:"NWBC"},WCF:{type:"WCF"},SAPUI5:{type:"SAPUI5"}};});sap.ui.define("sap/ushell/components/applicationIntegration/AppLifeCycle",[],function(){return{};});sap.ui.define("sap/ushell/services/_AppState/WindowAdapter",[],function(){return function(){};});sap.ui.define("sap/ushell/services/_AppState/SequentializingAdapter",[],function(){return function(){};});sap.ui.define("sap/ushell/services/_AppState/Sequentializer",[],function(){return function(){};});sap.ui.define("sap/ushell/services/Configuration",[],function(){function C(){this.attachSizeBehaviorUpdate=function(){};this.hasNoAdapter=true;}C.hasNoAdapter=true;return C;});sap.ui.define("sap/ushell/services/_PluginManager/Extensions",[],function(){return function(){};});}}
