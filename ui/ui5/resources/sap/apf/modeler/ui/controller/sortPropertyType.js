/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/modeler/ui/utils/optionsValueModelBuilder","sap/apf/modeler/ui/utils/staticValuesBuilder","sap/apf/modeler/ui/utils/constants","sap/apf/modeler/ui/utils/textManipulator","sap/apf/modeler/ui/utils/nullObjectChecker","sap/apf/utils/utils"],function(o,s,c,t,n,u){"use strict";var p='idSortProperty';var a='idSortDirection';var o=sap.apf.modeler.ui.utils.optionsValueModelBuilder;var T=sap.apf.modeler.ui.utils.textManipulator;var C=sap.apf.modeler.ui.utils.CONSTANTS.events;function _(i){i.byId("idSortLabel").setText(i.oTextReader("sortingField"));i.byId("idSortLabel").setTooltip(i.oTextReader("sortingField"));i.byId("idSortDirectionLabel").setText(i.oTextReader("direction"));i.byId("idSortDirectionLabel").setTooltip(i.oTextReader("direction"));i.byId("idAddPropertyIcon").setTooltip(i.oTextReader("addButton"));i.byId("idRemovePropertyIcon").setTooltip(i.oTextReader("deleteButton"));}function b(i){if(sap.ui.Device.browser.msie&&sap.ui.Device.browser.version>=11){i.byId("idAriaPropertyForSortGroup").setText(i.oTextReader("sorting"));}i.byId("idAriaPropertyForAdd").setText(i.oTextReader("ariaTextForAddIcon"));i.byId("idAriaPropertyForDelete").setText(i.oTextReader("ariaTextForDeleteIcon"));}function d(i){var j=i.byId(p);i.getAllPropertiesAsPromise().done(function(r){var m=o.convert(r.aAllProperties);j.setModel(m);j.setSelectedKey(r.sSelectedKey);});}function e(i){var j=i.byId(a);var s=new sap.apf.modeler.ui.utils.StaticValuesBuilder(i.oTextReader,o);var m=s.getSortDirections();j.setModel(m);j.setSelectedKey(i.getView().getViewData().oPropertyTypeData.sContext);}function f(i){var S=true,j=true;var P=i.getView().getViewData().oPropertyTypeState;if(P.indexOfPropertyTypeViewId(i.getView().getId())===0){j=false;}i.byId("idAddPropertyIcon").setVisible(S);i.byId("idRemovePropertyIcon").setVisible(j);}function g(i){i.byId("idAddPropertyIcon").attachEvent(C.SETFOCUSONADDICON,i.setFocusOnAddRemoveIcons.bind(i));}var h=sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.sortPropertyType",{oConfigurationEditor:{},oParentObject:{},oStepPropertyMetadataHandler:{},oTextReader:{},onInit:function(){var i=this;i.oConfigurationEditor=i.getView().getViewData().oConfigurationEditor;i.oParentObject=i.getView().getViewData().oParentObject;i.oStepPropertyMetadataHandler=i.getView().getViewData().oStepPropertyMetadataHandler;i.oTextReader=i.getView().getViewData().oCoreApi.getText;i.setDetailData();},onAfterRendering:function(){var i=this;i.byId("idAddPropertyIcon").fireEvent(C.SETFOCUSONADDICON);},setDetailData:function(){var i=this;_(i);b(i);d(i);e(i);f(i);i.disableView();},handleChangeForSortProperty:function(i){var j=this;var S=T.removePrefixText(j.byId(p).getSelectedKey(),j.oTextReader(sap.apf.modeler.ui.utils.CONSTANTS.texts.NOTAVAILABLE));var P=j.getView().getViewData().oPropertyOrchestration;var v=j.getView().getId();return new Promise(function(r){j.getView().fireEvent(C.UPDATEPROPERTYVALUESTATE,{"sProperty":S});P.updatePropertyTypeRow(v,S);P.updateAllSelectControlsForPropertyType().then(function(){j.updateOfConfigurationObject();j.oConfigurationEditor.setIsUnsaved();r();});});},handleChangeForSortDirection:function(){var i=this;i.updateOfConfigurationObject();i.oConfigurationEditor.setIsUnsaved();},setFocusOnAddRemoveIcons:function(){var i=this;i.byId("idAddPropertyIcon").focus();},handlePressOfAddPropertyIcon:function(){var i=this;g(i);i.addPropertyAsPromise();},handlePressOfRemovePropertyIcon:function(){var i=this;var v=i.getView().getViewData();return new Promise(function(r){i.getView().fireEvent(C.FOCUSONREMOVE);var P=v.oPropertyOrchestration;P.removePropertyTypeReference(i.getView().getId());P.updateAllSelectControlsForPropertyType().then(function(){i.updateOfConfigurationObject();v.oPropertyTypeHandlerBackLink.handlePressOfRemove({oSourceView:i.getView()});i.oConfigurationEditor.setIsUnsaved();i.getView().destroy();r();});});},updateOfConfigurationObject:function(){var i=this;var P=i.getView().getViewData().oPropertyOrchestration;var j=P.getSortPropertyInformationList(a);i.updateOfConfigurationObjectOfSubclass(j);},getSelectedSortProperty:function(){var i=this;var P=i.getView().getViewData().oPropertyTypeState;var j=P.getPropertyValueState();var k=P.indexOfPropertyTypeViewId(i.getView().getId());return j[k];},removeAllItemsFromDropDownList:function(){var i=this;var v=i.byId(p);v.getItems().forEach(function(I){v.removeItem(I);});},setItemsOfDropDownList:function(i,A,j){function k(r,w){return r.indexOf(w)!==-1;}var l=this;var v=l.byId(p);var m=(j===l.oTextReader("none"));var q=JSON.parse(JSON.stringify(i));v.addItem(new sap.ui.core.Item({key:l.oTextReader("none"),text:l.oTextReader("none")}));if(!k(q,j)&&!m){q.unshift(j);}q=q.filter(function(r){return r!==l.oTextReader("none");});q.forEach(function(V){var r=V;if(!k(A,V)&&!m){V=T.addPrefixText([V],l.oTextReader)[0];}var I=new sap.ui.core.Item({key:V,text:V});v.addItem(I);if(r===j){j=V;}});v.setSelectedKey(j);},updateOfConfigurationObjectOfSubclass:function(S){},getOrderBy:function(){},setNextPropertyInParentObject:function(){},removePropertyFromParentObject:function(){},disableView:function(){},addPropertyAsPromise:function(){return sap.apf.utils.createPromise();}});return h;},true);
