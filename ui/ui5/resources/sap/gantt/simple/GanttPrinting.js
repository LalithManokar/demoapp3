/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/gantt/library","sap/ui/thirdparty/jquery","sap/ui/core/Element","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/m/Label","sap/m/Text","sap/m/Title","sap/m/Dialog","sap/m/Button","sap/m/Input","sap/m/FlexBox","sap/m/library","sap/m/FlexItemData","sap/m/ScrollContainer","sap/m/ComboBox","sap/m/RadioButton","sap/m/RadioButtonGroup","sap/m/CheckBox","sap/m/Slider","sap/m/ResponsiveScale","sap/m/StepInput","sap/m/DatePicker","sap/m/BusyDialog","sap/m/MessageStrip","sap/m/Switch","sap/m/Panel","sap/m/TextArea","sap/gantt/misc/Format","sap/gantt/simple/GanttChartContainer","sap/gantt/config/TimeHorizon","sap/gantt/axistime/FullScreenStrategy","sap/ui/core/Item","sap/ui/core/HTML","sap/ui/layout/VerticalLayout","sap/ui/layout/HorizontalLayout","sap/ui/layout/GridData","sap/ui/layout/form/SimpleForm","sap/ui/model/json/JSONModel","sap/ui/core/theming/Parameters","sap/ui/core/ResizeHandler","sap/gantt/thirdparty/jspdf","sap/gantt/thirdparty/html2canvas"],function(G,$,E,C,N,L,T,a,D,B,I,F,M,b,S,c,R,d,e,f,g,h,j,k,l,m,P,o,p,q,r,s,t,H,V,u,v,w,J,x,y,z,A){"use strict";var K=M.FlexDirection,O=G.simple.GanttChartWithTableDisplayType;A=window.html2canvas;z=window.jsPDF;var Q=E.extend("sap.gantt.simple.GanttPrinting",{metadata:{associations:{ganttChart:{type:"sap.gantt.simple.GanttChartWithTable",multiple:false}}}});Q._oPaperSizes={"A5":{width:Y(148),height:Y(210)},"A4":{width:Y(210),height:Y(297)},"A3":{width:Y(297),height:Y(420)},"A2":{width:Y(420),height:Y(594)},"A1":{width:Y(594),height:Y(841)},"A0":{width:Y(841),height:Y(1189)},"Letter":{width:_(8.5),height:_(11)},"Legal":{width:_(8.5),height:_(14)},"Tabloid":{width:_(11),height:_(17)},"Custom":{width:undefined,height:undefined}};var U="9px Arial, Helvetica, sans-serif";var W="12px Arial, Helvetica, sans-serif";var X="16384";Q.prototype.init=function(){this._oRb=C.getLibraryResourceBundle("sap.gantt");var i={"multiplePage":true,"qualityWarning":false,"showOrientationMessage":false,"orientationMessage":this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"),"portrait":true,"paperSize":"A4","paperWidth":Q._oPaperSizes.A4.width,"paperHeight":Q._oPaperSizes.A4.height,"unit":"mm","repeatSelectionPanel":false,"scale":100,"duration":"all","startDate":new Date(),"endDate":new Date(),"showPageNumber":false,"showHeaderText":false,"headerText":"","showFooterText":false,"footerText":"","exportAll":true,"exportRange":"","exportAsJPEG":true,"compressionQuality":75,"previewPageNumber":1,"lastPageNumber":undefined,"marginType":"default","marginLocked":false,"marginTop":Y(5),"marginRight":Y(5),"marginBottom":Y(5),"marginLeft":Y(5),"cropMarks":false,"cropMarksWeight":0.25,"cropMarksOffset":Y(3)};this._oModel=new J(i);this._oGanttCanvas=undefined;this._iHeaderAndFooterHeight=Y(8);this._ganttChartContainer=new q();};Q.prototype.export=function(){this._savePdf();};Q.prototype.renderGanttClone=function(){if(C.getConfiguration().getRTL()){return Promise.resolve();}return new Promise(function(i){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",i,this);this._ganttChartClone.invalidate();}.bind(this));};Q.prototype.mergeCanvases=function(i){var c1=document.createElement('canvas'),d1=c1.getContext('2d'),e1=i[0].width,f1=[],g1=i.reduce(function(n,h1,i1,i){f1.push({cnv:h1,y:n});n+=i[i1].height;return n;},0);c1.width=e1;c1.height=g1;f1.forEach(function(n){d1.beginPath();d1.drawImage(n.cnv,0,n.y,e1,n.cnv.height);});if(c1.width>X||c1.height>X){this._oClonedGanttDiv.style.height=c1.height+"px";this._oClonedGanttDiv.style.width=c1.width+"px";return undefined;}return c1;};Q.prototype.generateCanvasAsync=function(i){var n=0;var c1=this._getOriginalGanttChart().getTable()._getTotalRowCount()/this.iThreshold;this.bLast=c1>1?false:true;var d1=this;var e1=[];function f1(i){d1._oClonedGanttDiv.style.height=X+"px";var h1=i*d1.iThreshold;var i1=d1._getOriginalGanttChart().getTable()._getTotalRowCount();d1.iThreshold=Math.min(d1.iThreshold,i1-h1);d1.bLast=n+1>=c1?true:false;d1._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);d1._ganttChartClone.getTable().setVisibleRowCount(d1.iThreshold);d1.bFirst=(i===0)?true:false;d1._ganttChartClone.getTable().setFirstVisibleRow(h1);if(C.getConfiguration().getRTL()){d1._ganttChartClone._bRenderGanttClone=true;}return new Promise(function(j1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",j1,d1);this._ganttChartClone.invalidate();}.bind(d1));}function g1(i){return f1(i).then(function(){return d1._expandAndCollapse();}).then(function(){d1._ganttChartClone._bExpandRows=true;return d1._expandRowSettings();}).then(function(){d1._ganttChartClone._bExpandRows=false;d1._setCloneDivHeight();document.getElementById(d1._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=d1._iContentHeight;document.getElementById(d1._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=d1._iContentHeight;if(d1.bLast&&!d1.bFirst){return d1._createGanttCanvas();}else{return Promise.resolve();}}).then(function(){return d1._createGanttCanvas();}).then(function(h1){return e1.push(h1);}).then(function(){if(i===0){d1._ganttChartClone.setShowGanttHeader(false);}n=n+1;if(n<c1){g1(n);}else{d1._oGanttCanvas=d1.mergeCanvases(e1);d1._updateDialogPreview();d1._oDialog.getContent()[0].setBusy(false);d1._oFlexBoxPreview.setBusy(false);d1._oButtonExport.setEnabled(true);}});}return g1(i);};Q.prototype.open=function(){if(!this.getGanttChart()||!this._getOriginalGanttChart().isA("sap.gantt.simple.GanttChartWithTable")){throw new Error("Association 'ganttChart' of type 'sap.gantt.simple.GanttChartWithTable' is not set");}var i=this;this._createAndOpenDialog();this._oDialog.getContent()[0].setBusy(true);this._oButtonExport.setEnabled(false);if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.setShowGanttHeader(true);return this._drawClonedGantt().then(function(){return i.generateCanvasAsync(0);}).catch(function(n){if(n&&n.bMaxCanvasSizeExceeded){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false);}});}else{if(C.getConfiguration().getRTL()){i._ganttChartClone._bRenderGanttClone=true;}return this._drawClonedGantt().then(function(){return i._expandAndCollapse();}).then(function(){i._ganttChartClone._bExpandRows=true;return i._expandRowSettings();}).then(function(){i._ganttChartClone._bExpandRows=false;i._setCloneDivHeightNonOptimised();document.getElementById(i._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=i._iContentHeight;document.getElementById(i._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=i._iContentHeight;return i._createGanttCanvas();}).then(function(n){i._oGanttCanvas=n;i._updateDialogPreview();i._oDialog.getContent()[0].setBusy(false);i._oButtonExport.setEnabled(true);}).catch(function(n){if(n&&n.bMaxCanvasSizeExceeded){i._updateDialogPreviewCanvas();i._oDialog.getContent()[0].setBusy(false);}});}};Q.prototype.close=function(){this._ganttChartClone.destroy();this._ganttChartClone=null;this._ganttChartContainer.destroy();this._ganttChartContainer=null;document.body.removeChild(this._oClonedGanttDiv);y.deregister(this._sResizeHandlerId);this._oDialog.close();this._oDialog.destroy();};Q.prototype.setGanttChart=function(i){this.setAssociation("ganttChart",i);this._ganttChartClone=i.clone();this._ganttChartClone._enableOptimisation=i.getPrintingBatchSize()>0?true:false;this.canvasScale=2;if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.getTable().destroyExtension();var n=Math.max((i.getAxisTimeStrategy().getZoomLevel()),1);this.iThreshold=Math.min(Math.round(i.getPrintingBatchSize()/n),i.getTable()._getTotalRowCount());this.bFirst=true;this._ganttChartClone.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);this._ganttChartClone.getTable().setVisibleRowCount(this.iThreshold);this._ganttChartClone.getTable().setThreshold(this.iThreshold);this._ganttChartClone.setParent(this._getOriginalGanttChart(),"originalGanttChart",true);}else{this._ganttChartContainer.setParent(this._getOriginalGanttChart(),"originalGanttChart",true);}this._addBackOriginalGanttRowBinding(this._ganttChartClone,i);this._originalHasRenderedShapes=i.getInnerGantt().hasRenderedShapes();this._ganttChartClone.mEventRegistry={};this._ganttChartClone.setHeight("100%");var c1=i._oSplitter._calculatedSizes[0];this._ganttChartClone.setSelectionPanelSize(c1.toString()+"px");var d1=i.getAxisTimeStrategy();if(!d1.isA("sap.gantt.axistime.FullScreenStrategy")){i._getScrollExtension()._updateVisibleHorizonForce();var e1=this._ganttChartClone.getAxisTimeStrategy();e1.setTotalHorizon(d1.getTotalHorizon());e1.setVisibleHorizon(d1.getTotalHorizon());}var f1=d1.getVisibleHorizon();var g1=this._getHorizonDates(f1);var h1=this._horizonWidthInSec(g1);this._fPixelsBySec=i.getVisibleWidth()/h1;this._ganttChartClone._bClonedGantt=true;if(!this._ganttChartClone._enableOptimisation){this._ganttChartContainer.addGanttChart(this._ganttChartClone);}return this;};Q.prototype._expandAndCollapse=function(){var n=this._getOriginalGanttChart().getTable();if(!n.isA("sap.ui.table.TreeTable")){return new Promise(function(f1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",f1,this);this._ganttChartClone.invalidate();}.bind(this));}var c1=n.getBinding("rows"),d1=this._ganttChartClone.getTable().getBinding("rows"),e1=false;for(var i=0;i<c1.getLength();i++){if((d1.isExpanded(i)!==undefined)&&c1.isExpanded(i)&&!d1.isExpanded(i)){d1.expand(i);e1=true;}else if((d1.isExpanded(i)!==undefined)&&!c1.isExpanded(i)&&d1.isExpanded(i)){d1.collapse(i);e1=true;}}if(e1){return new Promise(function(f1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",f1,this);this._ganttChartClone.invalidate();}.bind(this));}else{return Promise.resolve();}};Q.prototype._expandRowSettings=function(){var i=this._ganttChartClone.getShapeSchemes().find(function(n){return!n.getPrimary();});if(i){this._ganttChartClone.expand(i.getKey(),this._getOriginalGanttChart()._aExpandedIndices);}return new Promise(function(n){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",n,this);this._ganttChartClone.invalidate();}.bind(this));};Q.prototype._onResize=function(){var i=this._oHTMLDialogPreview.getDomRef();i.style.overflow="hidden";this._resizePrintingPreviewPage();i.style.overflow="visible";};function Y(i){return i*3.78;}function Z(i){return i/3.78;}function _(i){return i/0.01042;}function a1(i){return i*0.01042;}Q.prototype._convertUnitToPx=function(i){var n=this._oModel.getProperty("/unit");if(!n){return undefined;}switch(n){case"mm":return Y(i);case"cm":return Y(i)*10;case"in":return _(i);default:return undefined;}};Q.prototype._convertPxToUnit=function(i){var n=this._oModel.getProperty("/unit");if(!n){return undefined;}switch(n){case"mm":return Z(i);case"cm":return Z(i)/10;case"in":return a1(i);default:return undefined;}};Q.prototype._onChangeUnitComboBox=function(){this._updatePaperSizeInputs();this._updateMarginInputs();};Q.prototype._updatePaperSizeInputs=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(i,n);};Q.prototype._setPaperSizeInputs=function(i,n){if(this._oInputPaperWidth){this._oInputPaperWidth.setValue(this._convertPxToUnit(i));}if(this._oInputPaperHeight){this._oInputPaperHeight.setValue(this._convertPxToUnit(n));}};Q.prototype._setPaperSizesToModel=function(i,n){this._oModel.setProperty("/paperWidth",i);this._oModel.setProperty("/paperHeight",n);};Q.prototype._updatePaperSizeValues=function(){var i=this._oModel.getProperty("/paperSize"),n=this._oModel.getProperty("/portrait"),c1,d1;if(!i||i==="Custom"){return;}var e1=Q._oPaperSizes[i];if(n){c1=e1.width;d1=e1.height;}else{c1=e1.height;d1=e1.width;}this._setPaperSizeInputs(c1,d1);this._setPaperSizesToModel(c1,d1);if(i==="Letter"||i==="Legal"||i==="Tabloid"){this._oComboBoxUnit.setSelectedKey("in");}else{this._oComboBoxUnit.setSelectedKey("mm");}this._onChangeUnitComboBox();this._updateDialogPreview();};Q.prototype._updatePaperOrientation=function(i){var n=this._oModel.getProperty("/paperWidth"),c1=this._oModel.getProperty("/paperHeight");if(c1>n){this._oModel.setProperty("/portrait",true);this._radioGroupOrientation.setSelectedIndex(0);}else{this._oModel.setProperty("/portrait",false);this._radioGroupOrientation.setSelectedIndex(1);}};Q.prototype._onChangePaperSizeInput=function(i){var n=i.getSource();var c1=this._convertUnitToPx(N.getFloatInstance().parse(n.getValue()));if(n===this._oInputPaperWidth){this._oModel.setProperty("/paperWidth",c1);}else{this._oModel.setProperty("/paperHeight",c1);}this._oComboBoxPaperSizes.setSelectedKey("Custom");this._updatePaperOrientation();this._updateDialogPreview();};Q.prototype._onChangeCompressionSlider=function(i){var n=i.getSource();var c1=n.getValue();this._setCompressionComboBoxItem(c1);};Q.prototype._setCompressionComboBoxItem=function(n){if(n===100){this._oComboBoxCompression.setSelectedKey("maximum");}else if(n>=75){this._oComboBoxCompression.setSelectedKey("high");}else if(n>=50){this._oComboBoxCompression.setSelectedKey("medium");}else{this._oComboBoxCompression.setSelectedKey("low");}};Q.prototype._onChangeCompressionComboBox=function(i){var n=i.getSource().getSelectedKey();var c1={maximum:100,high:75,medium:50,low:25};this._oModel.setProperty("/compressionQuality",c1[n]);};Q.prototype._onChangeOrientation=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/paperHeight");this._setPaperSizeInputs(n,i);this._setPaperSizesToModel(n,i);this._updateDialogPreview();};Q.prototype._onChangeExportTypes=function(){this._updateDialogPreview();};Q.prototype._setMarginInputs=function(i,n,c1,d1){this._oInputMarginTop.setValue(this._convertPxToUnit(i));this._oInputMarginRight.setValue(this._convertPxToUnit(n));this._oInputMarginBottom.setValue(this._convertPxToUnit(c1));this._oInputMarginLeft.setValue(this._convertPxToUnit(d1));};Q.prototype._setMarginsToModel=function(i,n,c1,d1){if(i!==undefined){this._oModel.setProperty("/marginTop",i);}if(n!==undefined){this._oModel.setProperty("/marginRight",n);}if(c1!==undefined){this._oModel.setProperty("/marginBottom",c1);}if(d1!==undefined){this._oModel.setProperty("/marginLeft",d1);}};Q.prototype._onChangeMarginComboBox=function(i){var n=i.getSource().getSelectedKey();var c1=Y(5);if(n==="none"){c1=0;}this._setMarginsToModel(c1,c1,c1,c1);this._setMarginInputs(c1,c1,c1,c1);this._updateDialogPreview();};Q.prototype._updateModelFromMarginInputs=function(){var i,n,c1,d1;if(this._oInputMarginTop.getValueState()!=="Error"){i=this._convertUnitToPx(this._oInputMarginTop.getValue());}if(this._oInputMarginRight.getValueState()!=="Error"){n=this._convertUnitToPx(this._oInputMarginRight.getValue());}if(this._oInputMarginBottom.getValueState()!=="Error"){c1=this._convertUnitToPx(this._oInputMarginBottom.getValue());}if(this._oInputMarginLeft.getValueState()!=="Error"){d1=this._convertUnitToPx(this._oInputMarginLeft.getValue());}this._setMarginsToModel(i,n,c1,d1);};Q.prototype._updateMarginInputs=function(){var i=this._oModel.getProperty("/marginTop");var n=this._oModel.getProperty("/marginRight");var c1=this._oModel.getProperty("/marginBottom");var d1=this._oModel.getProperty("/marginLeft");this._setMarginInputs(i,n,c1,d1);};Q.prototype._updateCropMarksOffsetInput=function(){var i=this._oModel.getProperty("/cropMarksOffset");this._oInputCropMarksOffset.setValue(this._convertPxToUnit(i));};Q.prototype._onChangeMarginInput=function(i){var n=i.getSource();if(n.getValueState()==="Error"){return;}if(this._oModel.getProperty("/marginLocked")){var c1=this._convertUnitToPx(n.getValue());this._setMarginInputs(c1,c1,c1,c1);this._setMarginsToModel(c1,c1,c1,c1);}else{this._updateModelFromMarginInputs();}this._updateDialogPreview();};Q.prototype._onChangeCropMarksInput=function(i){var n=i.getSource();var c1=this._convertUnitToPx(n.getValue());this._oInputCropMarksOffset.setValue(this._convertPxToUnit(c1));this._oModel.setProperty("/cropMarksOffset",c1);};Q.prototype._allRange=function(){this._oModel.setProperty("/startDate",this._oDatePickerFrom.getMinDate());this._oModel.setProperty("/endDate",this._oDatePickerTo.getMaxDate());};Q.prototype._getFirstDayOfNextWeek=function(i){var n=this._getOriginalGanttChart().getAxisTimeStrategy().getFirstDayOfWeek();var c1=(n+7-i.getDay())%7;return new Date(i.getFullYear(),i.getMonth(),i.getDate()+(c1===0?7:c1));};Q.prototype._nextWeekRange=function(){var n=new Date();var i=this._getFirstDayOfNextWeek(n);this._oModel.setProperty("/startDate",this._validateDate(i));this._oModel.setProperty("/endDate",this._validateDate(new Date(i.getFullYear(),i.getMonth(),i.getDate()+7)));};Q.prototype._getFirstDayOfNextMonth=function(i){return new Date(i.getFullYear(),i.getMonth()+1,1);};Q.prototype._nextMonthRange=function(){var n=new Date();this._oModel.setProperty("/startDate",this._validateDate(this._getFirstDayOfNextMonth(n)));this._oModel.setProperty("/endDate",this._validateDate(new Date(n.getFullYear(),n.getMonth()+2,1)));};Q.prototype._validateDate=function(i){var n=this._oDatePickerTo.getMaxDate(),c1=this._oDatePickerFrom.getMinDate();if(i.getTime()>n.getTime()){return n;}if(i.getTime()<c1.getTime()){return c1;}return i;};Q.prototype._onChangeDurationComboBox=function(){var i=this._oModel.getProperty("/duration");switch(i){case"all":{this._allRange();}break;case"week":{this._nextWeekRange();}break;case"month":{this._nextMonthRange();}break;case"custom":default:return;}this._updateGanttCanvas();};Q.prototype._onChangeDurationDatePicker=function(){this._oComboBoxDuration.setSelectedKey("custom");this._updateGanttCanvas();};Q.prototype._setEnabledPreviousButtons=function(i){this._oButtonFirst.setEnabled(i);this._oButtonPrevious.setEnabled(i);};Q.prototype._setEnabledNextButtons=function(i){this._oButtonNext.setEnabled(i);this._oButtonLast.setEnabled(i);};Q.prototype._updatePageNumberButtons=function(){if(!this._oGanttCanvas){this._setEnabledNextButtons(false);this._setEnabledPreviousButtons(false);return;}var i=this._oModel.getProperty("/previewPageNumber"),n=this._oModel.getProperty("/lastPageNumber");if(!n){n=Number.MAX_SAFE_INTEGER;}if(i<=1){this._setEnabledPreviousButtons(false);}if(i>=n){this._setEnabledNextButtons(false);}if(i>1){this._setEnabledPreviousButtons(true);}if(i<n){this._setEnabledNextButtons(true);}};Q.prototype._getHeaderHeight=function(){var i=this._oModel.getProperty("/showHeaderText");if(i){return this._iHeaderAndFooterHeight;}return 0;};Q.prototype._isFooterMultiline=function(){if(!this._oModel.getProperty("/multiplePage")){return false;}var i=this._oModel.getProperty("/showPageNumber"),n=this._oModel.getProperty("/showFooterText");if(!n||!i){return false;}var c1=this._oModel.getProperty("/footerText"),d1=this._oModel.getProperty("/paperWidth"),e1;var f1=C.getConfiguration().getRTL();if(f1){e1=this._oModel.getProperty("/marginRight");}else{e1=this._oModel.getProperty("/marginLeft");}var g1=7;var h1=this._oGanttCanvas.getContext("2d");h1.font=U;var i1=h1.measureText(c1).width;if(d1/2>(e1+Y(4)+i1+Y(10)+g1)){return false;}else{return true;}};Q.prototype._getFooterHeight=function(){var i=this._oModel.getProperty("/showPageNumber"),n=this._oModel.getProperty("/showFooterText");if(n&&i){return this._isFooterMultiline()?2*this._iHeaderAndFooterHeight:this._iHeaderAndFooterHeight;}if(n||i){return this._iHeaderAndFooterHeight;}return 0;};Q.prototype._isShrinkableToOnePageByWidth=function(){var i=this._getPaperContentWidth()/this._getPaperContentHeight(),n=this._oGanttCanvas.width/this._oGanttCanvas.height;return i<=n;};Q.prototype._getPaperContentWidth=function(){var i=this._oModel.getProperty("/paperWidth"),n=this._oModel.getProperty("/marginLeft"),c1=this._oModel.getProperty("/marginRight");return i-n-c1;};Q.prototype._getPaperContentHeight=function(){var i=this._oModel.getProperty("/paperHeight"),n=this._oModel.getProperty("/marginTop"),c1=this._oModel.getProperty("/marginBottom");return i-n-this._getHeaderHeight()-c1-this._getFooterHeight();};Q.prototype._getScale=function(){return(100/this._oModel.getProperty("/scale"))*2;};Q.prototype._getCroppingWidth=function(){return this._getScale()*this._getPaperContentWidth();};Q.prototype._getCroppingHeight=function(){return this._getScale()*this._getPaperContentHeight();};Q.prototype._getPagesInARow=function(){return Math.ceil(this._oGanttCanvas.width/this._getCroppingWidth());};Q.prototype._getPagesInAColumn=function(){return Math.ceil(this._oGanttCanvas.height/this._getCroppingHeight());};Q.prototype._updateLastPageNumber=function(){if(!this._oGanttCanvas){return;}var i=this._getPagesInARow()*this._getPagesInAColumn();this._oModel.setProperty("/lastPageNumber",i);var n=this._oModel.getProperty("/previewPageNumber");if(n>i){this._oModel.setProperty("/previewPageNumber",i);}};Q.prototype._onPressButtonFirst=function(){this._oModel.setProperty("/previewPageNumber",1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};Q.prototype._onPressButtonPrevious=function(){var i=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",i-1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};Q.prototype._onPressButtonNext=function(){var i=this._oModel.getProperty("/previewPageNumber");this._oModel.setProperty("/previewPageNumber",i+1);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};Q.prototype._onPressButtonLast=function(){var i=this._oModel.getProperty("/lastPageNumber");if(!i){return;}this._oModel.setProperty("/previewPageNumber",i);this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};Q.prototype._getOriginalGanttChart=function(){return sap.ui.getCore().byId(this.getAssociation("ganttChart"));};Q.prototype._setGanttCloneDivWidth=function(i){var n=this._getOriginalGanttChart(),c1=this._getHorizonDates(i),d1=this._horizonWidthInSec(c1),e1=Math.ceil(this._fPixelsBySec*d1);var f1=n.getDisplayType()===O.Both?n.getTable().getDomRef().offsetWidth:0;this._oClonedGanttDiv.style.width=(f1+e1+10).toString()+"px";};Q.prototype._setGanttCloneDivHeight=function(){var i=this._getOriginalGanttChart().getTable();var n=i._getTotalRowCount(),c1=i._aRowHeights;var d1=c1.reduce(function(f1,g1){return f1+g1;});var e1=Math.ceil((d1/c1.length)*n);this._iGanttHeight=e1+102;this._oClonedGanttDiv.style.height=this._iGanttHeight.toString()+"px";};Q.prototype._setCloneDivHeight=function(){var n=this.bFirst?document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value:0;var c1=this._ganttChartClone.getTable().getVisibleRowCount();var d1=0;var e1=this.bLast?3:0;var f1=this._ganttChartClone.getTable().getRows()[0].getIndex();var g1=this._ganttChartClone.getTable().getFirstVisibleRow();var h1=Math.abs(f1-g1);var i1=this._ganttChartClone.getTable()._aRowHeights;for(var i=h1;i<c1+h1;i++){d1=d1+i1[i];}this._iContentHeight=d1+"px";this._oClonedGanttDiv.style.height=(d1+n+e1).toString()+"px";};Q.prototype._setCloneDivHeightNonOptimised=function(){var n=document.getElementById(this._ganttChartClone.getId()+"-header-svg").height.baseVal.value;var c1=this._ganttChartClone.getTable()._getTotalRowCount();var d1=3;var e1=this._ganttChartClone.getTable()._aRowHeights;for(var i=0;i<c1;i++){var f1=e1[i]?e1[i]:0;d1=d1+f1;}this._iContentHeight=d1.toString()+"px";this._oClonedGanttDiv.style.height=(d1+n).toString()+"px";};Q.prototype._createImgElementsFromSvgImages=function(){var n=this._ganttChartClone.$().find("svg.sapGanttChartSvg");if(!n.length){return;}var c1=this._ganttChartClone.$().find(".sapGanttChartCnt")[0];if(!c1){return;}c1.style.position="relative";var d1=n.find("image");for(var i=0;i<d1.length;i++){var e1=d1[i];var f1=document.createElement("img");f1.src=e1.getAttribute("xlink:href");f1.style.position="absolute";f1.style.top=e1.getAttribute("y")+"px";f1.style.left=e1.getAttribute("x")+"px";f1.style.width=e1.getAttribute("width")+"px";f1.style.height=e1.getAttribute("height")+"px";c1.appendChild(f1);}};Q.prototype._createGanttCanvas=function(){this._setStyleToGanttChartSvg(this._ganttChartClone);this._createImgElementsFromSvgImages();return A(this._oClonedGanttDiv,{allowTaint:true,scale:this.canvasScale,logging:false});};Q.prototype._updateGanttCanvas=function(){var i=this._oModel;var n=this._ganttChartClone.getAxisTimeStrategy();var c1=n.getVisibleHorizon().clone();var d1=n.getTotalHorizon().clone();c1.setStartTime(i.getProperty("/startDate"));c1.setEndTime(i.getProperty("/endDate"));d1.setStartTime(i.getProperty("/startDate"));d1.setEndTime(i.getProperty("/endDate"));this._oButtonExport.setEnabled(false);this._oFlexBoxPreview.setBusy(true);this._setGanttCloneDivWidth(d1);this._setGanttCloneDivHeight();if((this._oClonedGanttDiv.offsetWidth*this.canvasScale)>X||(this._oClonedGanttDiv.offsetHeight*this.canvasScale)>X){this._oClonedGanttDiv.style.height=(this._oClonedGanttDiv.offsetHeight*this.canvasScale)+"px";this._oClonedGanttDiv.style.width=(this._oClonedGanttDiv.offsetWidth*this.canvasScale)+"px";this._oGanttCanvas=undefined;this._updateDialogPreviewCanvas();this._oFlexBoxPreview.setBusy(false);return undefined;}n.setTotalHorizon(d1);n.setVisibleHorizon(c1);if(!this._ganttChartClone._enableOptimisation){this._ganttChartClone.invalidate();}this._ganttChartClone._bRenderGanttClone=true;if(this._ganttChartClone._enableOptimisation){var e1=this._getOriginalGanttChart();var f1=Math.max((e1.getAxisTimeStrategy().getZoomLevel()),1);this.iThreshold=Math.min(Math.round(e1.getPrintingBatchSize()/f1),e1.getTable()._getTotalRowCount());this._ganttChartClone.setShowGanttHeader(true);return this.renderGanttClone().then(function(){this._ganttChartClone._bRenderGanttClone=false;this.generateCanvasAsync(0);}.bind(this));}else{this._oClonedGanttDiv.style.height=(this._iGanttHeight*2)+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes).then(function(){this._ganttChartClone._bRenderGanttClone=false;this.renderGanttClone().then(function(){this._setCloneDivHeightNonOptimised();document.getElementById(this._ganttChartClone.getId()+"-sapGanttBackgroundTableContent").style.height=this._iContentHeight;document.getElementById(this._ganttChartClone.getTable().getId()+"-tableCCnt").style.height=this._iContentHeight;this._createGanttCanvas().then(function(g1){this._oGanttCanvas=g1;this._updateDialogPreview();this._oFlexBoxPreview.setBusy(false);}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false);}.bind(this));}.bind(this));}.bind(this)).catch(function(){this._oFlexBoxPreview.setBusy(false);}.bind(this));}};Q.prototype._drawClonedGantt=function(){if(this._oClonedGanttDiv){return Promise.reject();}this._oClonedGanttDiv=document.createElement("div");this._oClonedGanttDiv.id="clonedGanttDiv";if(this._getOriginalGanttChart().$().closest(".sapUiSizeCompact").length>0){this._oClonedGanttDiv.classList.add("sapUiSizeCompact");}this._oClonedGanttDiv.style.position="absolute";this._oClonedGanttDiv.style.top="-17000px";this._oClonedGanttDiv.style.left="-17000px";document.body.appendChild(this._oClonedGanttDiv);this._setGanttCloneDivWidth(this._ganttChartClone.getAxisTimeStrategy().getTotalHorizon());this._setGanttCloneDivHeight();var i=this._oModel;var n=this._ganttChartClone.getAxisTimeStrategy();n.getVisibleHorizon().setStartTime(i.getProperty("/startDate"));n.getVisibleHorizon().setEndTime(i.getProperty("/endDate"));if(this._ganttChartClone._enableOptimisation){this._ganttChartClone.placeAt("clonedGanttDiv");}else{this._ganttChartContainer.placeAt("clonedGanttDiv");}this._addBackOriginalGanttRowBinding(this._ganttChartClone,this._getOriginalGanttChart());if((this._oClonedGanttDiv.offsetWidth*this.canvasScale)>X||(this._oClonedGanttDiv.offsetHeight*this.canvasScale)>X){this._oClonedGanttDiv.style.height=(this._oClonedGanttDiv.offsetHeight*this.canvasScale)+"px";this._oClonedGanttDiv.style.width=(this._oClonedGanttDiv.offsetWidth*this.canvasScale)+"px";return Promise.reject({bMaxCanvasSizeExceeded:true});}if(this._ganttChartClone._enableOptimisation){return new Promise(function(c1){this._ganttChartClone.getTable().attachEventOnce("_rowsUpdated",c1,this);this._ganttChartClone.invalidate();}.bind(this));}else{this._oClonedGanttDiv.style.height=(this._iGanttHeight*2)+"px";return this._ganttChartClone.getInnerGantt().resolveWhenReady(this._originalHasRenderedShapes);}};Q.prototype._addBackOriginalGanttRowBinding=function(i,n){if(i.getTable().getBindingInfo("rows").binding==null){i.oPropagatedProperties=n._getPropertiesToPropagate();i.propagateProperties(true);}if(this._ganttChartClone._enableOptimisation){i.getTable().setVisibleRowCountMode(sap.ui.table.VisibleRowCountMode.Fixed);i.getTable().setVisibleRowCount(this.iThreshold);i.getTable().setThreshold(this.iThreshold);}var c1=n.getTable().getBinding("rows"),d1=i.getTable().getBinding("rows");if(c1){if(c1.sCustomParams){d1.sCustomParams=c1.sCustomParams;}if(c1.aFilters&&c1.aFilters.length>0){d1.filter(c1.aFilters);}if(c1.aApplicationFilters&&c1.aApplicationFilters.length>0){d1.filter(c1.aApplicationFilters,sap.ui.model.FilterType.Application);}if(c1.aSorters&&c1.aSorters.length>0){d1.sort(c1.aSorters);}}};Q.prototype._resizePrintingPreviewPage=function(){var i=this._oHTMLDialogPreview.getDomRef(),n=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv")[0],c1=i.offsetHeight,d1=this._oModel.getProperty("/paperHeight"),e1=this._oModel.getProperty("/paperWidth"),f1=this._oModel.getProperty("/portrait"),g1,h1;if(f1){g1=c1/d1;h1=e1*g1;}else{g1=c1/e1;h1=c1;c1=d1*g1;}n.style.width=h1.toString()+"px";n.style.height=c1.toString()+"px";};Q.prototype._updateSinglePageMessages=function(i,n){if(n>i){this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_PORTRAIT"));}else{this._oModel.setProperty("/orientationMessage",this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_LANDSCAPE"));}if(this._getPagesInARow()>3||this._getPagesInAColumn()>3){this._oModel.setProperty("/qualityWarning",true);}else{this._oModel.setProperty("/qualityWarning",false);}if((n>=i&&this._oModel.getProperty("/portrait"))||(n<=i&&!this._oModel.getProperty("/portrait"))){this._oModel.setProperty("/showOrientationMessage",false);}else{this._oModel.setProperty("/showOrientationMessage",true);}};Q.prototype._getCanvasOfPageN=function(i,n){var c1=this._oModel.getProperty("/lastPageNumber");if(i>c1){return null;}var d1=document.createElement("canvas");var e1=d1.getContext("2d");e1.imageSmoothingEnabled=false;var f1=this._getCroppingWidth(),g1=this._getCroppingHeight();var h1=this._getPagesInARow();var i1=this._oModel.getProperty("/paperWidth"),j1=this._oModel.getProperty("/paperHeight");var k1=this._oModel.getProperty("/marginTop"),l1=this._oModel.getProperty("/marginRight"),m1=this._oModel.getProperty("/marginBottom"),n1=this._oModel.getProperty("/marginLeft");var o1=(i-1)%h1,p1=Math.floor((i-1)/h1);d1.width=i1;d1.height=j1;if(!n){d1.style.height="100%";d1.style.width="auto";}e1.fillStyle="white";e1.fillRect(0,0,d1.width,d1.height);e1.fillStyle=x.get("sapUiBaseText");e1.textBaseline="middle";e1.font=U;var q1;var r1=C.getConfiguration().getRTL();if(r1){e1.textAlign="right";q1=i1-l1-Y(4);}else{e1.textAlign="left";q1=n1+Y(4);}var s1=this._oModel.getProperty("/showHeaderText");if(s1){var t1=this._oModel.getProperty("/headerText");e1.fillText(t1,q1,k1+(this._iHeaderAndFooterHeight/2));}if(this._oModel.getProperty("/showFooterText")){e1.fillText(this._oModel.getProperty("/footerText"),q1,j1-m1-(this._iHeaderAndFooterHeight/2)-(this._isFooterMultiline()?this._iHeaderAndFooterHeight:0));}var u1=this._oModel.getProperty("/showPageNumber"),v1=this._oModel.getProperty("/multiplePage");if(v1&&u1){e1.font=W;e1.textAlign="center";e1.fillText(i.toString(),i1/2,j1-m1-(this._iHeaderAndFooterHeight/2));}if(v1){var w1=o1*f1,x1=p1*g1,y1=0,z1=0;var A1=false;if((w1+f1)>this._oGanttCanvas.width){A1=true;f1=(this._oGanttCanvas.width-w1);z1=f1/this._getScale();}var B1=false;if((x1+g1)>this._oGanttCanvas.height){B1=true;g1=(this._oGanttCanvas.height-x1);y1=g1/this._getScale();}e1.drawImage(this._oGanttCanvas,w1,x1,f1,g1,n1,k1+this._getHeaderHeight(),A1?z1:this._getPaperContentWidth(),B1?y1:this._getPaperContentHeight());}else{var C1=this._getPaperContentWidth(),D1=this._getPaperContentHeight();var E1=this._isShrinkableToOnePageByWidth();var F1;if(E1){F1=C1/this._oGanttCanvas.width;D1=this._oGanttCanvas.height*F1;}else{F1=D1/this._oGanttCanvas.height;C1=this._oGanttCanvas.width*F1;}this._updateSinglePageMessages(C1,D1);var G1=C1/this._oGanttCanvas.width;if(G1<1){this._downScaleCanvas(this._oGanttCanvas,e1,G1,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,n1,k1+this._getHeaderHeight());}else{e1.drawImage(this._oGanttCanvas,0,0,this._oGanttCanvas.width,this._oGanttCanvas.height,n1,k1+this._getHeaderHeight(),C1,D1);}}return d1;};Q.prototype._downScaleCanvas=function(i,n,c1,d1,e1,f1,g1,h1,i1){var j1=document.createElement('canvas');j1.width=f1;j1.height=g1;var k1=j1.getContext('2d');k1.drawImage(i,d1,e1,f1,g1);var l1=c1*c1;var m1=Math.floor(f1*c1);var n1=Math.floor(g1*c1);var o1=0,p1=0,q1=0;var r1=0,s1=0,t1=0,u1=0;var v1=0,w1=0;var x1=0,y1=0,z1=0;var A1=0,B1=0,C1=0;var D1=false,E1=false;var F1=j1.getContext('2d').getImageData(0,0,f1,g1).data;var G1=new Float32Array(3*m1*n1);var H1=0,I1=0,J1=0;for(p1=0;p1<g1;p1++){s1=p1*c1;w1=0|s1;t1=3*w1*m1;E1=(w1!==(0|(s1+c1)));if(E1){z1=(w1+1-s1);C1=(s1+c1-w1-1);}for(o1=0;o1<f1;o1++,q1+=4){r1=o1*c1;v1=0|r1;u1=t1+v1*3;D1=(v1!==(0|(r1+c1)));if(D1){y1=(v1+1-r1);B1=(r1+c1-v1-1);}H1=F1[q1];I1=F1[q1+1];J1=F1[q1+2];if(!D1&&!E1){G1[u1]+=H1*l1;G1[u1+1]+=I1*l1;G1[u1+2]+=J1*l1;}else if(!D1&&E1){x1=z1*c1;G1[u1]+=H1*x1;G1[u1+1]+=I1*x1;G1[u1+2]+=J1*x1;A1=C1*c1;G1[u1+3*m1]+=H1*A1;G1[u1+3*m1+1]+=I1*A1;G1[u1+3*m1+2]+=J1*A1;}else if(D1&&!E1){x1=y1*c1;G1[u1]+=H1*x1;G1[u1+1]+=I1*x1;G1[u1+2]+=J1*x1;A1=B1*c1;G1[u1+3]+=H1*A1;G1[u1+4]+=I1*A1;G1[u1+5]+=J1*A1;}else{x1=y1*z1;G1[u1]+=H1*x1;G1[u1+1]+=I1*x1;G1[u1+2]+=J1*x1;A1=B1*z1;G1[u1+3]+=H1*A1;G1[u1+4]+=I1*A1;G1[u1+5]+=J1*A1;A1=y1*C1;G1[u1+3*m1]+=H1*A1;G1[u1+3*m1+1]+=I1*A1;G1[u1+3*m1+2]+=J1*A1;A1=B1*C1;G1[u1+3*m1+3]+=H1*A1;G1[u1+3*m1+4]+=I1*A1;G1[u1+3*m1+5]+=J1*A1;}}}var K1=document.createElement('canvas');K1.width=m1;K1.height=n1;var L1=K1.getContext('2d');var M1=L1.getImageData(0,0,m1,n1);var N1=M1.data;var O1=0;for(q1=0,u1=0;O1<m1*n1;q1+=3,u1+=4,O1++){N1[u1]=0|(G1[q1]);N1[u1+1]=0|(G1[q1+1]);N1[u1+2]=0|(G1[q1+2]);N1[u1+3]=255;}n.putImageData(M1,h1,i1);return;};function b1(i){while(i.firstChild){i.removeChild(i.firstChild);}}Q.prototype._createPreviewErrorMessageStrip=function(i){return new l({text:this._oRb.getText(i?"GNT_PRNTG_ERROR_TOOHIGHCHART":"GNT_PRNTG_ERROR_BIGCHART"),showIcon:true,type:"Error"});};Q.prototype._updateDialogPreviewCanvas=function(){var i=this._oHTMLDialogPreview.$().find(".sapGanttPrintingPreviewPageDiv");var n=i[0];if(this._oGanttCanvas){this._oButtonExport.setEnabled(true);var c1=this._oModel.getProperty("/multiplePage");if(c1){this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);}var d1=this._getCanvasOfPageN(c1?this._oModel.getProperty("/previewPageNumber"):1,false);b1(n);this._resizePrintingPreviewPage();n.appendChild(d1);}else if(!this._oGanttCanvas&&(this._oClonedGanttDiv.offsetWidth>X||this._oClonedGanttDiv.offsetHeight>X)){this._oButtonExport.setEnabled(false);this._resizePrintingPreviewPage();this._oModel.setProperty("/qualityWarning",false);this._oModel.setProperty("/showOrientationMessage",false);if(!this._oHTMLDialogPreview.$().find("#"+this.getId()+"-previewErrorMessageStrip").length){b1(n);if(!this._oPreviewErrorMessageStrip){this._oPreviewErrorMessageStrip=this._createPreviewErrorMessageStrip(this._oClonedGanttDiv.offsetHeight>X);}var e1=document.createElement("div");e1.id=this.getId()+"-previewErrorMessageStrip";e1.style.width="80%";n.appendChild(e1);this._oPreviewErrorMessageStrip.placeAt(this.getId()+"-previewErrorMessageStrip");}}else{throw new Error("Gantt chart canvas does not exist.");}i.addClass("sapGanttPrintingPreviewPageDivBorder");};Q.prototype._updateDialogPreview=function(){this._updateLastPageNumber();this._updatePageNumberButtons();this._updateDialogPreviewCanvas();};Q.prototype._setStylesToDom=function(n){function c1(e1){var f1=getComputedStyle(e1);var i,g1,h1,i1;var j1=["height","width","min-height","min-width"];var k1="";for(i=0,g1=f1.length;i<g1;i++){h1=f1[i];if(!((e1 instanceof SVGElement)&&j1.indexOf(h1)>=0)){i1=f1.getPropertyValue(h1);k1+=h1+":"+i1+";";}}e1.setAttribute("style",k1);}function d1(i){c1(i);e1(i);function e1(f1){if(f1&&f1.hasChildNodes()){var g1=f1.firstChild;while(g1){if(g1.nodeType===1&&g1.nodeName!="SCRIPT"){c1(g1);e1(g1);}g1=g1.nextSibling;}}}}d1(n);};Q.prototype._setStyleToGanttChartSvg=function(i){var n=i.$().find("svg.sapGanttChartSvg")[0];var c1=i.$().find("svg.sapGanttChartHeaderSvg")[0];if(n){this._setStylesToDom(n);}if(c1){this._setStylesToDom(c1);}};Q.prototype._getHorizonDates=function(i){var n=i.getStartTime();var c1=i.getEndTime();return{"startTime":new Date(p.abapTimestampToDate(n)),"endTime":new Date(p.abapTimestampToDate(c1))};};Q.prototype._horizonWidthInSec=function(i){if(i&&i.startTime&&i.endTime){return i.endTime.getTime()-i.startTime.getTime();}return 0;};Q.prototype._pageToBeExported=function(){if(!this._oModel.getProperty("/multiplePage")){return[1];}var n=this._oModel.getProperty("/lastPageNumber"),c1=this._oModel.getProperty("/exportAll"),d1=[];if(c1){for(var i=1;i<=n;i++){d1.push(i);}return d1;}else{var e1=this._oModel.getProperty("/exportRange");e1=e1.replace(/\s/g,"");var f1=N.getIntegerInstance();var g1=e1.split(",");g1.forEach(function(h1){if(h1.indexOf("-")!==-1){var i1=h1.split("-");var j1=f1.parse(i1[0]);var k1=f1.parse(i1[1]);for(var i=j1;i<=k1;i++){d1.push(i);}}else{d1.push(f1.parse(h1));}});return d1;}};Q.prototype._validateFields=function(){var i=true;i&=this._validateExportRangeInput();i&=(this._oInputMarginTop.getValueState()!=="Error");i&=(this._oInputMarginRight.getValueState()!=="Error");i&=(this._oInputMarginBottom.getValueState()!=="Error");i&=(this._oInputMarginLeft.getValueState()!=="Error");return i;};Q.prototype._savePdf=function(){if(!this._validateFields()){return;}var n=this._oModel.getProperty("/portrait")?"p":"l",c1=this._oModel.getProperty("/paperWidth"),d1=this._oModel.getProperty("/paperHeight"),e1=this._oModel.getProperty("/exportAsJPEG"),f1=this._oModel.getProperty("/compressionQuality")/100,g1=this._oModel.getProperty("/paperSize");var h1=new z({orientation:n,unit:"px",format:g1==="Custom"?[c1*0.75,d1*0.75]:g1.toLowerCase()});var i1=this._pageToBeExported();for(var i=0;i<i1.length;i++){var j1=this._getCanvasOfPageN(i1[i],true);if(!j1){continue;}if(i!==0){h1.addPage();}if(e1){h1.addImage(j1.toDataURL("image/jpeg",f1),"JPEG",0,0);}else{h1.addImage(j1.toDataURL("image/png"),"PNG",0,0);}}var k1=new Date();h1.save("GanttChartExport-"+k1.toISOString()+".pdf");};Q.prototype._createPaperComboBox=function(){this._oComboBoxPaperSizes=new c({selectedKey:"{setting>/paperSize}",change:this._updatePaperSizeValues.bind(this),items:[new t({key:"A5",text:"A5"}),new t({key:"A4",text:"A4"}),new t({key:"A3",text:"A3"}),new t({key:"A2",text:"A2"}),new t({key:"A1",text:"A1"}),new t({key:"A0",text:"A0"}),new t({key:"Letter",text:"Letter"}),new t({key:"Legal",text:"Legal"}),new t({key:"Tabloid",text:"Tabloid"}),new t({key:"Custom",text:"Custom"})]});return this._oComboBoxPaperSizes;};Q.prototype._createPaperSizeFields=function(){this._oInputPaperWidth=new I({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._oInputPaperHeight=new I({width:"20%",type:"Number",change:this._onChangePaperSizeInput.bind(this)});this._updatePaperSizeInputs();return new F({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oInputPaperWidth,new T({text:"Ã—"}),this._oInputPaperHeight,this._oComboBoxUnit=new c({width:"50%",selectedKey:"{setting>/unit}",change:this._onChangeUnitComboBox.bind(this),items:[new t({key:"mm",text:this._oRb.getText("GNT_PRNTG_MILLIMETERS")}),new t({key:"cm",text:this._oRb.getText("GNT_PRNTG_CENTIMETERS")}),new t({key:"in",text:this._oRb.getText("GNT_PRNTG_INCHES")})]})]});};Q.prototype._createDurationComboBox=function(){var i=this._getOriginalGanttChart().getAxisTimeStrategy(),n=i.getTotalHorizon(),c1=new Date(p.abapTimestampToDate(n.getEndTime())),d1=new Date();this._oComboBoxDuration=new c({selectedKey:"{setting>/duration}",change:this._onChangeDurationComboBox.bind(this),items:[new t({key:"all",text:this._oRb.getText("GNT_PRNTG_DURATION_ALL")}),new t({key:"week",enabled:this._getFirstDayOfNextWeek(d1).getTime()<c1.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_WEEK")}),new t({key:"month",enabled:this._getFirstDayOfNextMonth(d1).getTime()<c1.getTime(),text:this._oRb.getText("GNT_PRNTG_DURATION_NEXT_MONTH")}),new t({key:"custom",text:this._oRb.getText("GNT_PRNTG_DURATION_CUSTOM")})]});return this._oComboBoxDuration;};Q.prototype._createDatePicker=function(){var i=this._getOriginalGanttChart().getAxisTimeStrategy();var n=i.getTotalHorizon();var c1=new Date(p.abapTimestampToDate(n.getStartTime()));var d1=new Date(p.abapTimestampToDate(n.getEndTime()));this._oModel.setProperty("/startDate",c1);this._oModel.setProperty("/endDate",d1);this._oDatePickerFrom=new j({width:"47%",minDate:c1,maxDate:"{setting>/endDate}",dateValue:"{setting>/startDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});this._oDatePickerTo=new j({width:"47%",minDate:"{setting>/startDate}",maxDate:d1,dateValue:"{setting>/endDate}",change:this._onChangeDurationDatePicker.bind(this),enabled:true});return new F({renderType:"Bare",alignItems:"Center",justifyContent:"SpaceBetween",items:[this._oDatePickerFrom,new T({text:"~"}),this._oDatePickerTo]});};Q.prototype._createScale=function(){return new f({min:50,max:200,step:1,width:"25rem",value:"{setting>/scale}",visible:"{setting>/multiplePage}",liveChange:this._updateDialogPreview.bind(this),showAdvancedTooltip:true,inputsAsTooltips:true});};Q.prototype._validateExportRangeInput=function(){if(this._oModel.getProperty("/exportAll")){return true;}var i=this._oModel.getProperty("/exportRange").replace(/\s/g,"");if(/^((\d+),|(\d+-\d+),)*((\d+)|(\d+-\d+))+$/.test(i)){this._oInputRange.setValueState("None");return true;}this._oInputRange.setValueState("Error");this._oInputRange.setValueStateText(this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ERROR"));return false;};Q.prototype._createPageRange=function(){var i=function(n){var c1=n.getSource().getSelectedIndex();if(c1===0){this._oButtonExport.setEnabled(true);this._oInputRange.setValueState("None");}};return new F({renderType:"Bare",alignItems:"Center",visible:"{setting>/multiplePage}",justifyContent:"SpaceBetween",items:[new d({layoutData:new b({shrinkFactor:0,growFactor:1}),selectedIndex:this._oModel.getProperty("/exportAll")?0:1,columns:2,select:i.bind(this),buttons:[new R({id:"all",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_ALL"),selected:"{setting>/exportAll}"}),new R({id:"range",text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE_RANGE")+" "})]}),this._oInputRange=new I({layoutData:new b({growFactor:1}),value:"{setting>/exportRange}",change:this._validateExportRangeInput.bind(this),enabled:{path:"setting>/exportAll",formatter:function(n){return!n;}}}).addStyleClass("sapGanttPrintingPageRangeInput")]});};Q.prototype._createLabelWithSwitch=function(i,n){return new F({renderType:"Bare",visible:"{setting>/multiplePage}",alignItems:"Center",items:[new L({text:i}),new m({state:n,change:this._updateDialogPreview.bind(this)}).addStyleClass("sapGanttPrintingSwitchPadding")]});};Q.prototype._createCheckBoxWithInput=function(i,n,c1){return new F({renderType:"Bare",alignItems:"Start",justifyContent:"SpaceBetween",items:[new e({selected:n,text:i,select:this._updateDialogPreview.bind(this)}),new I({width:"65%",value:c1,enabled:n,change:this._updateDialogPreview.bind(this)})]});};Q.prototype._createPanel=function(i,n){return new P({expandable:true,expanded:false,headerText:i,content:[new F({renderType:"Bare",direction:K.Column,items:[n]})]});};Q.prototype._createCompressionSlider=function(){return new f({min:1,max:100,step:1,change:this._onChangeCompressionSlider.bind(this),value:{path:"setting>/compressionQuality",type:"sap.ui.model.type.Integer"},visible:"{setting>/exportAsJPEG}",showAdvancedTooltip:true,inputsAsTooltips:true});};Q.prototype._createCompressionComboBox=function(){this._oComboBoxCompression=new c({visible:"{setting>/exportAsJPEG}",change:this._onChangeCompressionComboBox.bind(this),items:[new t({key:"maximum",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MAXIMUM")}),new t({key:"high",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_HIGH")}),new t({key:"medium",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_MEDIUM")}),new t({key:"low",text:this._oRb.getText("GNT_PRNTG_COMPRESSION_LOW")})]});var i=this._oModel.getProperty("/compressionQuality");this._setCompressionComboBoxItem(i);return this._oComboBoxCompression;};Q.prototype._updateInputsStep=function(i){var n=0.1;if(i==="mm"){n=1;}return n;};Q.prototype._createMargin=function(){function i(n){return Math.round(this._convertPxToUnit(n/3));}return[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN")+":"}),new c({change:this._onChangeMarginComboBox.bind(this),selectedKey:"{setting>/marginType}",items:[new t({key:"default",text:this._oRb.getText("GNT_PRNTG_MARGIN_DEFAULT")}),new t({key:"none",text:this._oRb.getText("GNT_PRNTG_MARGIN_NONE")}),new t({key:"custom",text:this._oRb.getText("GNT_PRNTG_MARGIN_CUSTOM")})]}),new F({renderType:"Bare",alignItems:"Center",visible:{path:"setting>/marginType",formatter:function(n){return n==="custom";}},items:[new F({direction:K.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_TOP")}),this._oInputMarginTop=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginTop")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_LEFT")}),this._oInputMarginLeft=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginLeft")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"})]}),new F({direction:K.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_BOTTOM")}),this._oInputMarginBottom=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginBottom")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_HEIGHT_ERROR"),max:{parts:[{path:"setting>/paperHeight"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_MARGIN_RIGHT")}),this._oInputMarginRight=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeMarginInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/marginRight")),fieldWidth:"7rem",validationMode:"LiveChange",valueStateText:this._oRb.getText("GNT_PRNTG_MARGIN_WIDTH_ERROR"),max:{parts:[{path:"setting>/paperWidth"},{path:"setting>/unit"}],formatter:i.bind(this)},description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin"),new B({icon:{path:"setting>/marginLocked",formatter:function(n){if(n){return"sap-icon://chain-link";}return"sap-icon://broken-link";}},press:function(){var n=this._oModel.getProperty("/marginLocked");this._oModel.setProperty("/marginLocked",!n);}.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingLockButton sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingTopMargin")];};Q.prototype._createCropMarks=function(){return[new m({state:"{setting>/cropMarks}"}),new F({renderType:"Bare",visible:"{setting>/cropMarks}",items:[new F({direction:K.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:"Weight:"}),new h({min:0,step:0.05,displayValuePrecision:2,value:"{setting>/cropMarksWeight}",fieldWidth:"7rem",description:"pt"})]}),new F({direction:K.Column,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"8rem"}),items:[new L({text:"Offset:"}),this._oInputCropMarksOffset=new h({min:0,step:{path:"setting>/unit",formatter:this._updateInputsStep},displayValuePrecision:1,change:this._onChangeCropMarksInput.bind(this),value:this._convertPxToUnit(this._oModel.getProperty("/cropMarksOffset")),fieldWidth:"7rem",description:"{setting>/unit}"})]}).addStyleClass("sapGanttPrintingLeftMargin")]}).addStyleClass("sapGanttPrintingTopMargin")];};Q.prototype._createCompression=function(){var i=this._oModel.getProperty("/exportAsJPEG");return[new L({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),new d({columns:2,selectedIndex:i?0:1,buttons:[new R({id:"jpeg",text:"JPEG",selected:"{setting>/exportAsJPEG}"}),new R({id:"png",text:"PNG"})]}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_QUALITY"),visible:"{setting>/exportAsJPEG}"}),this._createCompressionComboBox(),this._createCompressionSlider().addStyleClass("sapGanttPrintingTopMargin sapGanttPrintingBottomMargin"),new l({text:this._oRb.getText("GNT_PRNTG_COMPRESSION_PNG_WARNING"),showIcon:true,type:"Warning",visible:{path:"setting>/exportAsJPEG",type:"sap.ui.model.type.Boolean",formatter:function(i){return!i;}}}).addStyleClass("sapGanttPrintingBottomMargin")];};Q.prototype._createOptionsForm=function(){return new F({renderType:"Bare",direction:K.Column,items:[new L({text:this._oRb.getText("GNT_PRNTG_EXPORT_TYPES")}),this._radioGroupPage=new d({columns:2,selectedIndex:this._oModel.getProperty("/multiplePage")?0:1,select:this._onChangeExportTypes.bind(this),buttons:[new R({id:"Multiple",text:this._oRb.getText("GNT_PRNTG_MULTIPLE_PAGE"),selected:"{setting>/multiplePage}"}),new R({id:"Single",text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_ORIENTATION")}),this._radioGroupOrientation=new d({columns:2,selectedIndex:this._oModel.getProperty("/portrait")?0:1,select:this._onChangeOrientation.bind(this),buttons:[new R({id:"Portrait",text:this._oRb.getText("GNT_PRNTG_PORTRAIT"),selected:"{setting>/portrait}"}),new R({id:"Landscape",text:this._oRb.getText("GNT_PRNTG_LANDSCAPE")})]}).addStyleClass("sapGanttPrintingBottomMargin"),new l({text:"{setting>/orientationMessage}",type:"Information",showIcon:true,visible:"{setting>/showOrientationMessage}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new L({text:this._oRb.getText("GNT_PRNTG_PAPER_SIZE")}),this._createPaperComboBox(),this._createPaperSizeFields().addStyleClass("sapGanttPrintingBottomMargin"),new l({text:this._oRb.getText("GNT_PRNTG_SINGLE_PAGE_QUALITY"),type:"Information",showIcon:true,visible:"{setting>/qualityWarning}"}).addStyleClass("sapGanttPrintingSinglePageMessage"),new L({text:this._oRb.getText("GNT_PRNTG_DURATION")}),this._createDurationComboBox(),this._createDatePicker().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_SCALE"),visible:"{setting>/multiplePage}"}),this._createScale().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_PAGE_RANGE"),visible:"{setting>/multiplePage}"}),this._createPageRange().addStyleClass("sapGanttPrintingBottomMargin"),new L({text:this._oRb.getText("GNT_PRNTG_HEADER_AND_FOOTER")}),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_HEADER"),"{setting>/showHeaderText}","{setting>/headerText}"),this._createCheckBoxWithInput(this._oRb.getText("GNT_PRNTG_FOOTER"),"{setting>/showFooterText}","{setting>/footerText}").addStyleClass("sapGanttPrintingBottomMargin"),this._createLabelWithSwitch(this._oRb.getText("GNT_PRNTG_SHOW_PAGE_NUMBER"),"{setting>/showPageNumber}").addStyleClass("sapGanttPrintingBottomMargin"),this._createPanel(this._oRb.getText("GNT_PRNTG_MARGIN"),this._createMargin()),this._createPanel(this._oRb.getText("GNT_PRNTG_COMPRESSION"),this._createCompression())]});};Q.prototype._createDialogContent=function(){var i=new F({renderType:"Bare",fitContainer:true,items:[this._oFlexBoxPreview=new F({renderType:"Bare",layoutData:new b({shrinkFactor:1,growFactor:1,baseSize:"auto"}),direction:K.Column,items:[new F({renderType:"Bare",layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"3.5rem"})}),this._oHTMLDialogPreview=new H({content:"<div class=\"sapGanttPrintingPreviewContentDiv\"><div class=\"sapGanttPrintingPreviewPageDiv\"></div></div>"}),new F({renderType:"Bare",justifyContent:"Center",alignItems:"Center",layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"6rem"}),items:[this._oButtonFirst=new B({icon:"sap-icon://close-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonFirst.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonPrevious=new B({icon:"sap-icon://navigation-left-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonPrevious.bind(this),type:"Transparent"}),new T({textAlign:"Center",visible:"{setting>/multiplePage}",width:"7.25rem",text:{parts:[{path:"setting>/previewPageNumber"},{path:"setting>/lastPageNumber"}],formatter:function(n,c1){return c1?this._oRb.getText("GNT_PRNTG_OF",[n,c1]):n.toString();}.bind(this)}}).addStyleClass("sapGanttPrintingPreviewText"),this._oButtonNext=new B({icon:"sap-icon://navigation-right-arrow",visible:"{setting>/multiplePage}",press:this._onPressButtonNext.bind(this),type:"Transparent"}).addStyleClass("sapGanttPrintingPreviewIconMarginRight"),this._oButtonLast=new B({icon:"sap-icon://open-command-field",visible:"{setting>/multiplePage}",press:this._onPressButtonLast.bind(this),type:"Transparent"})]}).addStyleClass("sapGanttPrintingPreviewFooter")]}).addStyleClass("sapGanttPrintingPreviewContent"),new S({horizontal:false,vertical:true,layoutData:new b({shrinkFactor:0,growFactor:0,baseSize:"27rem"}),content:[this._createOptionsForm().addStyleClass("sapGanttPrintingDialogSettings")]})]});this._updatePageNumberButtons();return i;};Q.prototype._createAndOpenDialog=function(){this._oDialog=new D({title:this._oRb.getText("GNT_PRNTG_PDF_EXPORT_TITLE"),contentWidth:"100%",contentHeight:"100%",horizontalScrolling:false,verticalScrolling:false,content:[this._createDialogContent()],buttons:[this._oButtonExport=new B({text:this._oRb.getText("GNT_PRNTG_EXPORT"),type:M.ButtonType.Emphasized,press:this.export.bind(this)}),new B({text:this._oRb.getText("GNT_PRNTG_CANCEL"),press:function(){this.close();}.bind(this)})]}).addStyleClass("sapGanttPrintingDialog");this._oDialog.onsapescape=function(i){this.close();i.preventDefault();i.stopPropagation();}.bind(this);this._oDialog.setModel(this._oModel,"setting");this._oDialog.open();this._sResizeHandlerId=y.register(this._oDialog,this._onResize.bind(this));};return Q;});
