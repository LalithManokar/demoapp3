schema = "SAP_INO";
query = 
"
        select 
            eval.id as evaluation_id,
            role_privilege.role_code,
            role_privilege.privilege
        from \"sap.ino.db.evaluation::t_evaluation\" as eval
        inner join \"sap.ino.db.idea::t_idea\" as idea
            on idea.id = eval.idea_id
        left outer join \"sap.ino.db.subresponsibility::t_responsibility_value_stage\" as resp_value
            on resp_value.code = idea.resp_value_code
        left outer join \"sap.ino.db.iam::v_auth_application_user_role_transitive\" as role_eval
            on role_eval.object_id = eval.id and
               role_eval.object_type_code = 'EVALUATION'
        left outer join \"sap.ino.db.iam::v_auth_application_user_role_transitive\" as role_idea
            on role_idea.object_id = eval.idea_id and
               role_idea.object_type_code = 'IDEA'
        left outer join \"sap.ino.db.iam::v_auth_application_user_role_transitive\" as role_camp
        on  (role_camp.object_id = idea.campaign_id and
            role_camp.object_type_code = 'CAMPAIGN') 
            or (role_camp.object_id = resp_value.id and role_camp.object_type_code = 'RESPONSIBILITY')
        inner join \"sap.ino.db.iam::t_role_privilege\"  as role_privilege
            on  role_privilege.role_code = role_eval.role_code or 
                role_privilege.role_code = role_idea.role_code or 
                role_privilege.role_code = role_camp.role_code 
        where ( role_privilege.privilege = 'EVALUATION_READ' ) or 
              ( role_privilege.privilege = 'IDEA_EVAL_SUBMITTER_READ' and
                ( eval.status_code = 'sap.ino.config.EVAL_PUB_SUBMITTER' or
                  eval.status_code = 'sap.ino.config.EVAL_PUB_COMMUNITY' ) ) or 
              ( role_privilege.privilege = 'CAMP_EVAL_PUBLIC_READ' and
                eval.status_code = 'sap.ino.config.EVAL_PUB_COMMUNITY' ) or
              ( role_privilege.privilege = 'CAMP_EVAL_PROTECTED_READ' and
                ( eval.status_code = 'sap.ino.config.EVAL_FINISHED' or 
                eval.status_code = 'sap.ino.config.EVAL_PUB_SUBMITTER' or 
                eval.status_code = 'sap.ino.config.EVAL_PUB_COMMUNITY' ) )
with read only
";

depends_on_table = ["sap.ino.db.idea::t_idea",
                    "sap.ino.db.evaluation::t_evaluation",
                    "sap.ino.db.iam::t_role_privilege",
                    "sap.ino.db.subresponsibility::t_responsibility_value_stage"];

depends_on_view = ["sap.ino.db.iam::v_auth_application_user_role_transitive"];