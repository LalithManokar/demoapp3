schema = "SAP_INO";
query = "
    select model.code as model_code,
        campaign.id as campaign_id,
        txt.name as campaign_name,
        campaign.status_code as campaign_status_code,
        idea.id as idea_id,
        idea.name as idea_name,
        count(distinct eval.id) as evaluation_count
    from \"sap.ino.db.evaluation::v_model_stage_union\" as model
        inner join \"sap.ino.db.campaign::t_campaign_phase\" as phase on phase.evaluation_model_code = model.code
        left outer join \"sap.ino.db.campaign::t_campaign\" as campaign on phase.CAMPAIGN_ID = campaign.id
        left outer join \"sap.ino.db.campaign::v_campaign_t_locale\" as txt on phase.CAMPAIGN_ID = txt.CAMPAIGN_ID
        left outer join \"sap.ino.db.idea::t_idea\" as idea on idea.campaign_id = campaign.id
        inner join \"sap.ino.db.idea::v_auth_ideas_read\" as idea_auth on idea.id = idea_auth.idea_id
        left outer join \"sap.ino.db.evaluation::t_evaluation\" as eval on eval.model_code = model.code and eval.idea_id = idea.id
    group by 
        model.code,
        campaign.id, 
        txt.name, 
        campaign.status_code,
        idea.id,
        idea.name
union 
select  model.code as model_code,
        0 as campaign_id,
        '' as campaign_name,
        '' as campaign_status_code,
        idea.id as idea_id,
        idea.name as idea_name,
        count(distinct eval.id) as evaluation_count
    from \"sap.ino.db.evaluation::v_model_stage_union\" as model
        inner join \"sap.ino.db.evaluation::t_evaluation\" as eval on eval.model_code = model.code
        left outer join \"sap.ino.db.idea::t_idea\" as idea on idea.id = eval.idea_id
        inner join \"sap.ino.db.idea::v_auth_ideas_read\" as idea_auth on idea.id = idea_auth.idea_id
        left outer join \"sap.ino.db.campaign::t_campaign_phase\" as phase on phase.evaluation_model_code = model.code
    where phase.campaign_id is null --left outer join as anti join
    group by 
        model.code,
        idea.id,
        idea.name
    with read only ";

depends_on_table = ["sap.ino.db.evaluation::t_evaluation",
                    "sap.ino.db.campaign::t_campaign",
                    "sap.ino.db.campaign::t_campaign_phase",
                    "sap.ino.db.idea::t_idea"];
depends_on_view = ["sap.ino.db.campaign::v_campaign_t_locale",
                   "sap.ino.db.evaluation::v_model_stage_union",
                   "sap.ino.db.idea::v_auth_ideas_read"];

